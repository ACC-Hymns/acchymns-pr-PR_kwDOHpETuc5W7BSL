var Wn=Object.defineProperty;var Un=(r,e,t)=>e in r?Wn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ke=(r,e,t)=>(Un(r,typeof e!="symbol"?e+"":e,t),t),Lt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var D=(r,e,t)=>(Lt(r,e,"read from private field"),t?t.call(r):e.get(r)),he=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Ce=(r,e,t,n)=>(Lt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Ot=(r,e,t,n)=>({set _(s){Ce(r,e,s,t)},get _(){return D(r,e,n)}}),me=(r,e,t)=>(Lt(r,e,"access private method"),t);import{_ as _imports_0$1}from"./chevron-back-outline-a1cf55c8.js";import{d as defineComponent,r as ref,o as onMounted,H as Capacitor,e as createElementBlock,n as openBlock,I as useMediaQuery,a as useLocalStorage,C as computed,J as readonly,g as getAllBookMetaData,K as onUpdated,h as unref,i as createBlock,j as isRef,L as normalizeClass,k as createCommentVNode,s as pushScopeId,v as popScopeId,f as createBaseVNode,B as _export_sfc,u as useRouter,b as getSongMetaData,M as onUnmounted,t as toDisplayString,F as Fragment,z as _imports_2,m as createVNode,N as _imports_2$1}from"./index-6cf0da3a.js";import{_ as _imports_3}from"./bookmark-0652ebf8.js";import{_ as _imports_0}from"./wifi_off-544d9241.js";import{T as Toast}from"./index-303ce190.js";import{u as useCapacitorPreferences}from"./preferences-63d29ac4.js";const _imports_1="/acchymns-pr-PR_kwDOHpETuc5W7BSL/assets/musical-notes-outline.svg";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(e,s);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var wheel$1={exports:{}};wheel$1.exports=addWheelListener;wheel$1.exports.addWheelListener=addWheelListener;wheel$1.exports.removeWheelListener=removeWheelListener;function addWheelListener(r,e,t){r.addEventListener("wheel",e,t)}function removeWheelListener(r,e,t){r.removeEventListener("wheel",e,t)}var wheelExports=wheel$1.exports,amator={exports:{}},NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported=typeof Float32Array=="function";function A(r,e){return 1-3*e+3*r}function B(r,e){return 3*e-6*r}function C(r){return 3*r}function calcBezier(r,e,t){return((A(e,t)*r+B(e,t))*r+C(e))*r}function getSlope(r,e,t){return 3*A(e,t)*r*r+2*B(e,t)*r+C(e)}function binarySubdivide(r,e,t,n,s){var i,o,c=0;do o=e+(t-e)/2,i=calcBezier(o,n,s)-r,i>0?t=o:e=o;while(Math.abs(i)>SUBDIVISION_PRECISION&&++c<SUBDIVISION_MAX_ITERATIONS);return o}function newtonRaphsonIterate(r,e,t,n){for(var s=0;s<NEWTON_ITERATIONS;++s){var i=getSlope(e,t,n);if(i===0)return e;var o=calcBezier(e,t,n)-r;e-=o/i}return e}function LinearEasing(r){return r}var src=function(e,t,n,s){if(!(0<=e&&e<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&n===s)return LinearEasing;for(var i=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize),o=0;o<kSplineTableSize;++o)i[o]=calcBezier(o*kSampleStepSize,e,n);function c(u){for(var l=0,a=1,h=kSplineTableSize-1;a!==h&&i[a]<=u;++a)l+=kSampleStepSize;--a;var y=(u-i[a])/(i[a+1]-i[a]),g=l+y*kSampleStepSize,m=getSlope(g,e,n);return m>=NEWTON_MIN_SLOPE?newtonRaphsonIterate(u,g,e,n):m===0?g:binarySubdivide(u,l,l+kSampleStepSize,e,n)}return function(l){return l===0?0:l===1?1:calcBezier(c(l),t,s)}},BezierEasing=src,animations={ease:BezierEasing(.25,.1,.25,1),easeIn:BezierEasing(.42,0,1,1),easeOut:BezierEasing(0,0,.58,1),easeInOut:BezierEasing(.42,0,.58,1),linear:BezierEasing(0,0,1,1)};amator.exports=animate$1;amator.exports.makeAggregateRaf=makeAggregateRaf;amator.exports.sharedScheduler=makeAggregateRaf();function animate$1(r,e,t){var n=Object.create(null),s=Object.create(null);t=t||{};var i=typeof t.easing=="function"?t.easing:animations[t.easing];i||(t.easing&&console.warn("Unknown easing function in amator: "+t.easing),i=animations.ease);var o=typeof t.step=="function"?t.step:noop$2,c=typeof t.done=="function"?t.done:noop$2,u=getScheduler(t.scheduler),l=Object.keys(e);l.forEach(function(S){n[S]=r[S],s[S]=e[S]-r[S]});var a=typeof t.duration=="number"?t.duration:400,h=Math.max(1,a*.06),y,g=0;return y=u.next(b),{cancel:m};function m(){u.cancel(y),y=0}function b(){var S=i(g/h);g+=1,v(S),g<=h?(y=u.next(b),o(r)):(y=0,setTimeout(function(){c(r)},0))}function v(S){l.forEach(function(N){r[N]=s[N]*S+n[N]})}}function noop$2(){}function getScheduler(r){if(!r){var e=typeof window<"u"&&window.requestAnimationFrame;return e?rafScheduler():timeoutScheduler()}if(typeof r.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof r.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return r}function rafScheduler(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function timeoutScheduler(){return{next:function(r){return setTimeout(r,1e3/60)},cancel:function(r){return clearTimeout(r)}}}function makeAggregateRaf(){var r=new Set,e=new Set,t=0;return{next:s,cancel:s,clearAll:n};function n(){r.clear(),e.clear(),cancelAnimationFrame(t),t=0}function s(c){e.add(c),i()}function i(){t||(t=requestAnimationFrame(o))}function o(){t=0;var c=e;e=r,r=c,r.forEach(function(u){u()}),r.clear()}}var amatorExports=amator.exports,ngraph_events=function(e){validateSubject(e);var t=createEventsStorage(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function createEventsStorage(r){var e=Object.create(null);return{on:function(t,n,s){if(typeof n!="function")throw new Error("callback is expected to be a function");var i=e[t];return i||(i=e[t]=[]),i.push({callback:n,ctx:s}),r},off:function(t,n){var s=typeof t>"u";if(s)return e=Object.create(null),r;if(e[t]){var i=typeof n!="function";if(i)delete e[t];else for(var o=e[t],c=0;c<o.length;++c)o[c].callback===n&&o.splice(c,1)}return r},fire:function(t){var n=e[t];if(!n)return r;var s;arguments.length>1&&(s=Array.prototype.splice.call(arguments,1));for(var i=0;i<n.length;++i){var o=n[i];o.callback.apply(o.ctx,s)}return r}}}function validateSubject(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(r.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var kinetic_1=kinetic$1;function kinetic$1(r,e,t){typeof t!="object"&&(t={});var n=typeof t.minVelocity=="number"?t.minVelocity:5,s=typeof t.amplitude=="number"?t.amplitude:.25,i=typeof t.cancelAnimationFrame=="function"?t.cancelAnimationFrame:getCancelAnimationFrame(),o=typeof t.requestAnimationFrame=="function"?t.requestAnimationFrame:getRequestAnimationFrame(),c,u,l=342,a,h,y,g,m,b,v,S;return{start:k,stop:f,cancel:N};function N(){i(a),i(S)}function k(){c=r(),g=v=h=m=0,u=new Date,i(a),i(S),a=o(O)}function O(){var p=Date.now(),_=p-u;u=p;var w=r(),M=w.x-c.x,E=w.y-c.y;c=w;var F=1e3/(1+_);h=.8*M*F+.2*h,m=.8*E*F+.2*m,a=o(O)}function f(){i(a),i(S);var p=r();y=p.x,b=p.y,u=Date.now(),(h<-n||h>n)&&(g=s*h,y+=g),(m<-n||m>n)&&(v=s*m,b+=v),S=o(d)}function d(){var p=Date.now()-u,_=!1,w=0,M=0;g&&(w=-g*Math.exp(-p/l),w>.5||w<-.5?_=!0:w=g=0),v&&(M=-v*Math.exp(-p/l),M>.5||M<-.5?_=!0:M=v=0),_&&(e(y+w,b+M),S=o(d))}}function getCancelAnimationFrame(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function getRequestAnimationFrame(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(r){return setTimeout(r,16)}}var createTextSelectionInterceptor_1=createTextSelectionInterceptor$1;function createTextSelectionInterceptor$1(r){if(r)return{capture:noop$1,release:noop$1};var e,t,n,s=!1;return{capture:i,release:o};function i(c){s=!0,t=window.document.onselectstart,n=window.document.ondragstart,window.document.onselectstart=disabled,e=c,e.ondragstart=disabled}function o(){s&&(s=!1,window.document.onselectstart=t,e&&(e.ondragstart=n))}}function disabled(r){return r.stopPropagation(),!1}function noop$1(){}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1,transform=r;function r(){this.x=0,this.y=0,this.scale=1}return transform}var svgController={exports:{}},hasRequiredSvgController;function requireSvgController(){if(hasRequiredSvgController)return svgController.exports;hasRequiredSvgController=1,svgController.exports=r,svgController.exports.canAttach=e;function r(t,n){if(!e(t))throw new Error("svg element is required for svg.panzoom to work");var s=t.ownerSVGElement;if(!s)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");n.disableKeyboardInteraction||s.setAttribute("tabindex",0);var i={getBBox:c,getScreenCTM:u,getOwner:o,applyTransform:a,initTransform:l};return i;function o(){return s}function c(){var h=t.getBBox();return{left:h.x,top:h.y,width:h.width,height:h.height}}function u(){var h=s.getCTM();return h||s.getScreenCTM()}function l(h){var y=t.getCTM();y===null&&(y=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),h.x=y.e,h.y=y.f,h.scale=y.a,s.removeAttributeNS(null,"viewBox")}function a(h){t.setAttribute("transform","matrix("+h.scale+" 0 0 "+h.scale+" "+h.x+" "+h.y+")")}}function e(t){return t&&t.ownerSVGElement&&t.getCTM}return svgController.exports}var domController={exports:{}},hasRequiredDomController;function requireDomController(){if(hasRequiredDomController)return domController.exports;hasRequiredDomController=1,domController.exports=r,domController.exports.canAttach=e;function r(t,n){var s=e(t);if(!s)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var i=t.parentElement;t.scrollTop=0,n.disableKeyboardInteraction||i.setAttribute("tabindex",0);var o={getBBox:u,getOwner:c,applyTransform:l};return o;function c(){return i}function u(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}}function l(a){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+a.scale+", 0, 0, "+a.scale+", "+a.x+", "+a.y+")"}}function e(t){return t&&t.parentElement&&t.style}return domController.exports}var wheel=wheelExports,animate=amatorExports,eventify=ngraph_events,kinetic=kinetic_1,createTextSelectionInterceptor=createTextSelectionInterceptor_1,domTextSelectionInterceptor=createTextSelectionInterceptor(),fakeTextSelectorInterceptor=createTextSelectionInterceptor(!0),Transform=requireTransform(),makeSvgController=requireSvgController(),makeDomController=requireDomController(),defaultZoomSpeed=1,defaultDoubleTapZoomSpeed=1.75,doubleTapSpeedInMS=300,clickEventTimeInMS=200,panzoom=createPanZoom,initialWidth=0,initialHeight=0;function createPanZoom(r,e){initialWidth=r.offsetWidth,initialHeight=r.offsetHeight,e=e||{};var t=e.controller;if(t||(makeSvgController.canAttach(r)?t=makeSvgController(r,e):makeDomController.canAttach(r)&&(t=makeDomController(r,e))),!t)throw new Error("Cannot create panzoom for the current type of dom element");var n=t.getOwner(),s={x:0,y:0},i=!1,o=new Transform;t.initTransform&&t.initTransform(o);var c=typeof e.filterKey=="function"?e.filterKey:noop,u=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,l=e.bounds,a=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,h=typeof e.minZoom=="number"?e.minZoom:0,y=typeof e.boundsPadding=="number"?e.boundsPadding:.05,g=typeof e.zoomDoubleClickSpeed=="number"?e.zoomDoubleClickSpeed:defaultDoubleTapZoomSpeed,m=e.beforeWheel||noop,b=e.beforeMouseDown||noop,v=typeof e.zoomSpeed=="number"?e.zoomSpeed:defaultZoomSpeed,S=parseTransformOrigin(e.transformOrigin),N=e.enableTextSelection?fakeTextSelectorInterceptor:domTextSelectionInterceptor;validateBounds(l),e.autocenter&&L();var k,O=0,f=0,d=0,p=null,_=new Date,w,M=!1,E=!0,F=!0,G=!1,H,K,Z,ae,oe,ie;"smoothScroll"in e&&!e.smoothScroll?ie=rigidScroll():ie=kinetic(xe,Re,e.smoothScroll);var ne,J,ge,_e=!1;Ee();var X={dispose:je,moveBy:Se,moveTo:Oe,smoothMoveTo:te,centerOn:re,zoomTo:gt,zoomAbs:Q,smoothZoom:dt,smoothZoomAbs:bt,showRectangle:T,pause:ee,resume:z,isPaused:x,getTransform:U,getMinZoom:Y,setMinZoom:ce,getMaxZoom:le,setMaxZoom:fe,setVerticalPan:q,setHorizontalPan:j,getInitWidth:V,getInitHeight:$,getTransformOrigin:de,setTransformOrigin:ye,getZoomSpeed:be,setZoomSpeed:ve};eventify(X);var P=typeof e.initialX=="number"?e.initialX:o.x,R=typeof e.initialY=="number"?e.initialY:o.y,W=typeof e.initialZoom=="number"?e.initialZoom:o.scale;return(P!=o.x||R!=o.y||W!=o.scale)&&Q(P,R,W),X;function $(){return initialHeight}function V(){return initialWidth}function ee(){nt(),_e=!0}function z(){_e&&(Ee(),_e=!1)}function j(pe){E=pe}function q(pe){F=pe}function x(){return _e}function T(pe){var we=n.getBoundingClientRect(),ke=I(we.width,we.height),Me=pe.right-pe.left,qe=pe.bottom-pe.top;if(!Number.isFinite(Me)||!Number.isFinite(qe))throw new Error("Invalid rectangle");var Qe=ke.x/Me,Je=ke.y/qe,ot=Math.min(Qe,Je);o.x=-(pe.left+Me/2)*ot+ke.x/2,o.y=-(pe.top+qe/2)*ot+ke.y/2,o.scale=ot}function I(pe,we){if(t.getScreenCTM){var ke=t.getScreenCTM(),Me=ke.a,qe=ke.d,Qe=ke.e,Je=ke.f;s.x=pe*Me-Qe,s.y=we*qe-Je}else s.x=pe,s.y=we;return s}function L(){var pe,we,ke=0,Me=0,qe=se();if(qe)ke=qe.left,Me=qe.top,pe=qe.right-qe.left,we=qe.bottom-qe.top;else{var Qe=n.getBoundingClientRect();pe=Qe.width,we=Qe.height}var Je=t.getBBox();if(!(Je.width===0||Je.height===0)){var ot=we/Je.height,St=pe/Je.width,yt=Math.min(St,ot);o.x=-(Je.left+Je.width/2)*yt+pe/2+ke,o.y=-(Je.top+Je.height/2)*yt+we/2+Me,o.scale=yt}}function U(){return o}function Y(){return h}function ce(pe){h=pe}function le(){return a}function fe(pe){a=pe}function de(){return S}function ye(pe){S=parseTransformOrigin(pe)}function be(){return v}function ve(pe){if(!Number.isFinite(pe))throw new Error("Zoom speed should be a number");v=pe}function xe(){return{x:o.x,y:o.y}}function Oe(pe,we){o.x=pe,o.y=we,Le(),_t("pan"),Ve()}function Pe(pe,we){Oe(E?o.x+pe:o.x,F?o.y+we:o.y)}function Le(){var pe=se();if(pe){var we=!1,ke=Te(),Me=pe.left-ke.right;return Me>0&&(o.x+=Me,we=!0),Me=pe.right-ke.left,Me<0&&(o.x+=Me,we=!0),F&&(Me=pe.top-ke.bottom,Me>0&&(o.y+=Me,we=!0),Me=pe.bottom-ke.top,Me<0&&(o.y+=Me,we=!0)),we}}function se(){if(l){if(typeof l=="boolean"){var pe=n.getBoundingClientRect(),we=pe.width,ke=pe.height;return{left:we*y,top:ke*y,right:we*(1-y),bottom:ke*(1-y)}}return l}}function Te(){var pe=t.getBBox(),we=Ue(pe.left,pe.top);return{left:we.x,top:we.y,right:pe.width*o.scale+we.x,bottom:pe.height*o.scale+we.y}}function Ue(pe,we){return{x:pe*o.scale+o.x,y:we*o.scale+o.y}}function Ve(){i=!0,k=window.requestAnimationFrame(et)}function $e(pe,we,ke){if(isNaN$1(pe)||isNaN$1(we)||isNaN$1(ke))throw new Error("zoom requires valid numbers");var Me=o.scale*ke;if(Me<h){if(o.scale===h)return;ke=h/o.scale}if(Me>a){if(o.scale===a)return;ke=a/o.scale}var qe=I(pe,we);if(o.x=qe.x-ke*(qe.x-o.x),o.y=qe.y-ke*(qe.y-o.y),l&&y===1&&h===1)o.scale*=ke,Le();else{var Qe=Le();Qe||(o.scale*=ke)}_t("zoom"),Ve()}function Q(pe,we,ke){var Me=ke/o.scale;$e(pe,we,Me)}function re(pe){var we=pe.ownerSVGElement;if(!we)throw new Error("ui element is required to be within the scene");var ke=pe.getBoundingClientRect(),Me=ke.left+ke.width/2,qe=ke.top+ke.height/2,Qe=we.getBoundingClientRect(),Je=Qe.width/2-Me,ot=Qe.height/2-qe;Se(Je,ot,!0)}function te(pe,we){Se(pe-o.x,we-o.y,!0)}function Se(pe,we,ke){if(!ke)return Pe(pe,we);ne&&ne.cancel();var Me={x:0,y:0},qe={x:pe,y:we},Qe=0,Je=0;ne=animate(Me,qe,{step:function(ot){Pe(ot.x-Qe,ot.y-Je),Qe=ot.x,Je=ot.y}})}function Re(pe,we){vt(),Oe(pe,we)}function je(){nt()}function Ee(){n.addEventListener("mousedown",it,{passive:!1}),n.addEventListener("dblclick",Ze,{passive:!1}),n.addEventListener("touchstart",Ne,{passive:!1}),n.addEventListener("keydown",Ae,{passive:!1}),wheel.addWheelListener(n,mt,{passive:!1}),Ve()}function nt(){wheel.removeWheelListener(n,mt),n.removeEventListener("mousedown",it),n.removeEventListener("keydown",Ae),n.removeEventListener("dblclick",Ze),n.removeEventListener("touchstart",Ne),k&&(window.cancelAnimationFrame(k),k=0),ie.cancel(),ct(),st(),N.release(),Dt()}function et(){i&&ue()}function ue(){i=!1,t.applyTransform(o),_t("transform"),k=0}function Ae(pe){var we=0,ke=0,Me=0;if(pe.keyCode===38?ke=1:pe.keyCode===40?ke=-1:pe.keyCode===37?we=1:pe.keyCode===39?we=-1:pe.keyCode===189||pe.keyCode===109?Me=1:(pe.keyCode===187||pe.keyCode===107)&&(Me=-1),!c(pe,we,ke,Me)){if(we||ke){pe.preventDefault(),pe.stopPropagation();var qe=n.getBoundingClientRect(),Qe=Math.min(qe.width,qe.height),Je=.05,ot=Qe*Je*we,St=Qe*Je*ke;Se(ot,St)}if(Me){var yt=sn(Me*100),Qe=S?ut():Ie();gt(Qe.x,Qe.y,yt)}}}function Ie(){var pe=n.getBoundingClientRect();return{x:pe.width/2,y:pe.height/2}}function Ne(pe){if(De(pe),ze(),pe.touches.length===1)return Be(pe,pe.touches[0]);pe.touches.length===2&&(oe=Xe(pe.touches[0],pe.touches[1]),ge=!0,We())}function De(pe){e.onTouch&&!e.onTouch(pe)||(pe.stopPropagation(),pe.preventDefault())}function Fe(pe){ze(),!(e.onDoubleClick&&!e.onDoubleClick(pe))&&(pe.preventDefault(),pe.stopPropagation())}function Be(pe){f=new Date;var we=pe.touches[0],ke=at(we);w=ke;var Me=I(ke.x,ke.y);H=Me.x,K=Me.y,Z=H,ae=K,ie.cancel(),We()}function We(){M||(M=!0,document.addEventListener("touchmove",He),document.addEventListener("touchend",Ge),document.addEventListener("touchcancel",Ge))}function He(pe){if(pe.touches.length===1){pe.stopPropagation();var we=pe.touches[0],ke=at(we),Me=I(ke.x,ke.y),qe=Me.x-H,Qe=Me.y-K;qe!==0&&Qe!==0&&on(),H=Me.x,K=Me.y,Se(qe,Qe)}else if(pe.touches.length===2){ge=!0;var Je=pe.touches[0],ot=pe.touches[1],St=Xe(Je,ot),yt=1+(St/oe-1)*u,an=at(Je),cn=at(ot);if(H=(an.x+cn.x)/2,K=(an.y+cn.y)/2,S){var ke=ut();H=ke.x,K=ke.y}gt(H,K,yt),oe=St,pe.stopPropagation(),pe.preventDefault()}}function ze(){d&&(clearTimeout(d),d=0)}function Ye(pe){if(e.onClick){ze();var we=H-Z,ke=K-ae,Me=Math.sqrt(we*we+ke*ke);Me>5||(d=setTimeout(function(){d=0,e.onClick(pe)},doubleTapSpeedInMS))}}function Ge(pe){if(ze(),pe.touches.length>0){var we=at(pe.touches[0]),ke=I(we.x,we.y);H=ke.x,K=ke.y}else{var Me=new Date;if(Me-O<doubleTapSpeedInMS)if(S){var we=ut();dt(we.x,we.y,g)}else dt(w.x,w.y,g);else Me-f<clickEventTimeInMS&&Ye(pe);O=Me,Dt(),st()}}function Xe(pe,we){var ke=pe.clientX-we.clientX,Me=pe.clientY-we.clientY;return Math.sqrt(ke*ke+Me*Me)}function Ze(pe){Fe(pe);var we=at(pe);S&&(we=ut()),dt(we.x,we.y,g)}function it(pe){if(ze(),!b(pe)){if(p=pe,_=new Date,M)return pe.stopPropagation(),!1;var we=pe.button===1&&window.event!==null||pe.button===0;if(we){ie.cancel();var ke=at(pe),Me=I(ke.x,ke.y);return Z=H=Me.x,ae=K=Me.y,document.addEventListener("mousemove",rt),document.addEventListener("mouseup",tt),N.capture(pe.target||pe.srcElement),!1}}}function rt(pe){if(!M){on();var we=at(pe),ke=I(we.x,we.y),Me=ke.x-H,qe=ke.y-K;H=ke.x,K=ke.y,Se(Me,qe)}}function tt(){var pe=new Date;pe-_<clickEventTimeInMS&&Ye(p),N.release(),Dt(),ct()}function ct(){document.removeEventListener("mousemove",rt),document.removeEventListener("mouseup",tt),G=!1}function st(){document.removeEventListener("touchmove",He),document.removeEventListener("touchend",Ge),document.removeEventListener("touchcancel",Ge),G=!1,ge=!1,M=!1}function mt(pe){if(!m(pe)){ie.cancel();var we=pe.deltaY;pe.deltaMode>0&&(we*=100);var ke=sn(we);if(ke!==1){var Me=S?ut():at(pe);gt(Me.x,Me.y,ke),pe.preventDefault()}}}function at(pe){var we,ke,Me=n.getBoundingClientRect();return we=pe.clientX-Me.left,ke=pe.clientY-Me.top,{x:we,y:ke}}function dt(pe,we,ke){var Me=o.scale,qe={scale:Me},Qe={scale:ke*Me};ie.cancel(),vt(),J=animate(qe,Qe,{step:function(Je){Q(pe,we,Je.scale)},done:Vn})}function bt(pe,we,ke){var Me=o.scale,qe={scale:Me},Qe={scale:ke};ie.cancel(),vt(),J=animate(qe,Qe,{step:function(Je){Q(pe,we,Je.scale)}})}function ut(){var pe=n.getBoundingClientRect();return{x:pe.width*S.x,y:pe.height*S.y}}function gt(pe,we,ke){return ie.cancel(),vt(),$e(pe,we,ke)}function vt(){J&&(J.cancel(),J=null)}function sn(pe){var we=Math.sign(pe),ke=Math.min(.25,Math.abs(v*pe/128));return 1-we*ke}function on(){G||(_t("panstart"),G=!0,ie.start())}function Dt(){G&&(ge||ie.stop(),_t("panend"))}function Vn(){_t("zoomend")}function _t(pe){X.fire(pe,X)}}function parseTransformOrigin(r){if(r){if(typeof r=="object")return(!isNumber$1(r.x)||!isNumber$1(r.y))&&failTransformOrigin(r),r;failTransformOrigin()}}function failTransformOrigin(r){throw console.error(r),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function noop(){}function validateBounds(r){var e=typeof r;if(!(e==="undefined"||e==="boolean")){var t=isNumber$1(r.left)&&isNumber$1(r.top)&&isNumber$1(r.bottom)&&isNumber$1(r.right);if(!t)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function isNumber$1(r){return Number.isFinite(r)}function isNaN$1(r){return Number.isNaN?Number.isNaN(r):r!==r}function rigidScroll(){return{start:noop,stop:noop,cancel:noop}}function autoRun(){if(typeof document>"u")return;var r=document.getElementsByTagName("script");if(!r)return;for(var e,t=0;t<r.length;++t){var n=r[t];if(n.src&&n.src.match(/\bpanzoom(\.min)?\.js/)){e=n;break}}if(!e)return;var s=e.getAttribute("query");if(!s)return;var i=e.getAttribute("name")||"pz",o=Date.now();c();function c(){var a=document.querySelector(s);if(!a){var h=Date.now(),y=h-o;if(y<2e3){setTimeout(c,100);return}console.error("Cannot find the panzoom element",i);return}var g=u(e);console.log(g),window[i]=createPanZoom(a,g)}function u(a){for(var h=a.attributes,y={},g=0;g<h.length;++g){var m=h[g],b=l(m);b&&(y[b.name]=b.value)}return y}function l(a){if(a.name){var h=a.name[0]==="p"&&a.name[1]==="z"&&a.name[2]==="-";if(h){var y=a.name.substr(3),g=JSON.parse(a.value);return{name:y,value:g}}}}}autoRun();const createPanZoom$1=getDefaultExportFromCjs(panzoom);function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$6=getAugmentedNamespace(__viteBrowserExternal$1);var path2dPolyfill_min={},hasRequiredPath2dPolyfill_min;function requirePath2dPolyfill_min(){return hasRequiredPath2dPolyfill_min||(hasRequiredPath2dPolyfill_min=1,function(){function r(a,h,y){if(y||arguments.length===2)for(var g,m=0,b=h.length;m<b;m++)!g&&m in h||(g||(g=Array.prototype.slice.call(h,0,m)),g[m]=h[m]);return a.concat(g||Array.prototype.slice.call(h))}var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi,n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function s(a){var h=[],y=String(a).trim();return y[0]!=="M"&&y[0]!=="m"||y.replace(t,function(g,m,b){var v=function(k){var O=k.match(n);return O?O.map(Number):[]}(b),S=m.toLowerCase(),N=m;if(S==="m"&&v.length>2&&(h.push(r([N],v.splice(0,2),!0)),S="l",N=N==="m"?"l":"L"),v.length<e[S])return"";for(h.push(r([N],v.splice(0,e[S]),!0));v.length>=e[S]&&v.length&&e[S];)h.push(r([N],v.splice(0,e[S]),!0));return""}),h}function i(a,h){var y=a.x*Math.cos(h)-a.y*Math.sin(h),g=a.y*Math.cos(h)+a.x*Math.sin(h);a.x=y,a.y=g}function o(a,h){a.x*=h,a.y*=h}var c=function(){function a(h){var y;this.commands=[],h&&h instanceof a?(y=this.commands).push.apply(y,h.commands):h&&(this.commands=s(h))}return a.prototype.addPath=function(h){var y;h&&h instanceof a&&(y=this.commands).push.apply(y,h.commands)},a.prototype.moveTo=function(h,y){this.commands.push(["M",h,y])},a.prototype.lineTo=function(h,y){this.commands.push(["L",h,y])},a.prototype.arc=function(h,y,g,m,b,v){this.commands.push(["AC",h,y,g,m,b,!!v])},a.prototype.arcTo=function(h,y,g,m,b){this.commands.push(["AT",h,y,g,m,b])},a.prototype.ellipse=function(h,y,g,m,b,v,S,N){this.commands.push(["E",h,y,g,m,b,v,S,!!N])},a.prototype.closePath=function(){this.commands.push(["Z"])},a.prototype.bezierCurveTo=function(h,y,g,m,b,v){this.commands.push(["C",h,y,g,m,b,v])},a.prototype.quadraticCurveTo=function(h,y,g,m){this.commands.push(["Q",h,y,g,m])},a.prototype.rect=function(h,y,g,m){this.commands.push(["R",h,y,g,m])},a.prototype.roundRect=function(h,y,g,m,b){b===void 0?this.commands.push(["RR",h,y,g,m,0]):this.commands.push(["RR",h,y,g,m,b])},a}();function u(a,h){var y,g,m,b,v,S,N,k,O,f,d,p,_,w,M,E,F,G,H,K,Z,ae,oe,ie,ne=0,J=0,ge=null,_e=null,X=null,P=null,R=null,W=null;a.beginPath();for(var $=0;$<h.length;++$){(G=h[$][0])!=="S"&&G!=="s"&&G!=="C"&&G!=="c"&&(ge=null,_e=null),G!=="T"&&G!=="t"&&G!=="Q"&&G!=="q"&&(X=null,P=null);var V=void 0;switch(G){case"m":case"M":V=h[$],G==="m"?(ne+=V[1],J+=V[2]):(ne=V[1],J=V[2]),G!=="M"&&R||(R={x:ne,y:J}),a.moveTo(ne,J);break;case"l":ne+=(V=h[$])[1],J+=V[2],a.lineTo(ne,J);break;case"L":ne=(V=h[$])[1],J=V[2],a.lineTo(ne,J);break;case"H":ne=(V=h[$])[1],a.lineTo(ne,J);break;case"h":ne+=(V=h[$])[1],a.lineTo(ne,J);break;case"V":J=(V=h[$])[1],a.lineTo(ne,J);break;case"v":J+=(V=h[$])[1],a.lineTo(ne,J);break;case"a":case"A":if(V=h[$],W===null)throw new Error("This should never happen");G==="a"?(ne+=V[6],J+=V[7]):(ne=V[6],J=V[7]),w=V[1],M=V[2],N=V[3]*Math.PI/180,m=!!V[4],b=!!V[5],v={x:ne,y:J},i(S={x:(W.x-v.x)/2,y:(W.y-v.y)/2},-N),(k=S.x*S.x/(w*w)+S.y*S.y/(M*M))>1&&(w*=k=Math.sqrt(k),M*=k),O=w*w*M*M,f=w*w*S.y*S.y+M*M*S.x*S.x,o(H={x:w*S.y/M,y:-M*S.x/w},b!==m?Math.sqrt((O-f)/f)||0:-Math.sqrt((O-f)/f)||0),g=Math.atan2((S.y-H.y)/M,(S.x-H.x)/w),y=Math.atan2(-(S.y+H.y)/M,-(S.x+H.x)/w),i(H,N),ae=H,oe=(v.x+W.x)/2,ie=(v.y+W.y)/2,ae.x+=oe,ae.y+=ie,a.save(),a.translate(H.x,H.y),a.rotate(N),a.scale(w,M),a.arc(0,0,1,g,y,!b),a.restore();break;case"C":ge=(V=h[$])[3],_e=V[4],ne=V[5],J=V[6],a.bezierCurveTo(V[1],V[2],ge,_e,ne,J);break;case"c":V=h[$],a.bezierCurveTo(V[1]+ne,V[2]+J,V[3]+ne,V[4]+J,V[5]+ne,V[6]+J),ge=V[3]+ne,_e=V[4]+J,ne+=V[5],J+=V[6];break;case"S":V=h[$],ge!==null&&_e!==null||(ge=ne,_e=J),a.bezierCurveTo(2*ne-ge,2*J-_e,V[1],V[2],V[3],V[4]),ge=V[1],_e=V[2],ne=V[3],J=V[4];break;case"s":V=h[$],ge!==null&&_e!==null||(ge=ne,_e=J),a.bezierCurveTo(2*ne-ge,2*J-_e,V[1]+ne,V[2]+J,V[3]+ne,V[4]+J),ge=V[1]+ne,_e=V[2]+J,ne+=V[3],J+=V[4];break;case"Q":X=(V=h[$])[1],P=V[2],ne=V[3],J=V[4],a.quadraticCurveTo(X,P,ne,J);break;case"q":X=(V=h[$])[1]+ne,P=V[2]+J,ne+=V[3],J+=V[4],a.quadraticCurveTo(X,P,ne,J);break;case"T":X!==null&&P!==null||(X=ne,P=J),X=2*ne-X,P=2*J-P,ne=(V=h[$])[1],J=V[2],a.quadraticCurveTo(X,P,ne,J);break;case"t":X!==null&&P!==null||(X=ne,P=J),X=2*ne-X,P=2*J-P,ne+=(V=h[$])[1],J+=V[2],a.quadraticCurveTo(X,P,ne,J);break;case"z":case"Z":R&&(ne=R.x,J=R.y),R=null,a.closePath();break;case"AC":ne=(V=h[$])[1],J=V[2],_=V[3],g=V[4],y=V[5],K=V[6],a.arc(ne,J,_,g,y,K);break;case"AT":d=(V=h[$])[1],p=V[2],ne=V[3],J=V[4],_=V[5],a.arcTo(d,p,ne,J,_);break;case"E":ne=(V=h[$])[1],J=V[2],w=V[3],M=V[4],N=V[5],g=V[6],y=V[7],K=V[8],a.save(),a.translate(ne,J),a.rotate(N),a.scale(w,M),a.arc(0,0,1,g,y,K),a.restore();break;case"R":ne=(V=h[$])[1],J=V[2],E=V[3],F=V[4],R={x:ne,y:J},a.rect(ne,J,E,F);break;case"RR":ne=(V=h[$])[1],J=V[2],E=V[3],F=V[4],Z=V[5],R={x:ne,y:J},a.roundRect(ne,J,E,F,Z)}W?(W.x=ne,W.y=J):W={x:ne,y:J}}}function l(a,h,y,g,m){var b=this;if(m===void 0&&(m=0),typeof m=="number"&&(m=[m]),Array.isArray(m)){if(m.length===0||m.length>4)throw new RangeError("Failed to execute 'roundRect' on '".concat(this.constructor.name,"': ").concat(m.length," radii provided. Between one and four radii are necessary."));if(m.forEach(function(f){if(f<0)throw new RangeError("Failed to execute 'roundRect' on '".concat(b.constructor.name,"': Radius value ").concat(f," is negative."))}),m.length===1&&m[0]===0)return this.rect(a,h,y,g);var v,S,N,k=Math.min(y,g)/2,O=v=S=N=Math.min(k,m[0]);m.length===2&&(v=N=Math.min(k,m[1])),m.length===3&&(v=N=Math.min(k,m[1]),S=Math.min(k,m[2])),m.length===4&&(v=Math.min(k,m[1]),S=Math.min(k,m[2]),N=Math.min(k,m[3])),this.moveTo(a,h+g-N),this.arcTo(a,h,a+O,h,O),this.arcTo(a+y,h,a+y,h+v,v),this.arcTo(a+y,h+g,a+y-S,h+g,S),this.arcTo(a,h+g,a,h+g-N,N),this.moveTo(a,h)}}(function(a){if(a&&a.CanvasRenderingContext2D&&!a.Path2D){var h=a.CanvasRenderingContext2D,y=h.prototype.fill,g=h.prototype.stroke,m=h.prototype.isPointInPath;h.prototype.fill=function(){for(var b=[],v=0;v<arguments.length;v++)b[v]=arguments[v];if(!(b[0]instanceof c))return N=b[0]||"nonzero",y.apply(this,[N]);var S=b[0],N=b[1]||"nonzero";u(this,S.commands),y.apply(this,[N])},h.prototype.stroke=function(b){b&&u(this,b.commands),g.apply(this)},h.prototype.isPointInPath=function(){for(var b=[],v=0;v<arguments.length;v++)b[v]=arguments[v];if(b[0]instanceof c){var S=b[0],N=b[1],k=b[2],O=b[3]||"nonzero";return u(this,S.commands),m.apply(this,[N,k,O])}return m.apply(this,b)},a.Path2D=c}})(window),function(a){if(a&&a.CanvasRenderingContext2D){var h=a.CanvasRenderingContext2D,y=a.Path2D;h&&!h.prototype.roundRect&&(h.prototype.roundRect=l),y&&!y.prototype.roundRect&&(y.prototype.roundRect=l)}}(window)}()),path2dPolyfill_min}(function(module,exports){(function(e,t){module.exports=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,(r,e,t)=>{var $e;Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.RenderingIntentFlag=e.PromiseCapability=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.MAX_IMAGE_SIZE_TO_CACHE=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=ge,e.bytesToString=x,e.createValidAbsoluteUrl=X,e.getModificationDate=Le,e.getVerbosityLevel=oe,e.info=ie,e.isArrayBuffer=Oe,e.isArrayEqual=Pe,e.normalizeUnicode=Ve,e.objectFromMap=U,e.objectSize=L,e.setVerbosityLevel=ae,e.shadow=P,e.string32=I,e.stringToBytes=T,e.stringToPDFString=be,e.stringToUTF8String=ve,e.unreachable=J,e.utf8StringToString=xe,e.warn=ne,globalThis._pdfjsCompatibilityChecked||(globalThis._pdfjsCompatibilityChecked=!0,t(2));const n=[1,0,0,1,0,0];e.IDENTITY_MATRIX=n;const s=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=s;const i=1e7;e.MAX_IMAGE_SIZE_TO_CACHE=i;const o=1.35;e.LINE_FACTOR=o;const c=.35;e.LINE_DESCENT_FACTOR=c;const u=c/o;e.BASELINE_FACTOR=u;const l={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=l;const a={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=a;const h="pdfjs_internal_editor_";e.AnnotationEditorPrefix=h;const y={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=y;const g={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=g;const m={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=m;const b={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=b;const v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=v;const S={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=S;const N={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=N;const k={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=k;const O={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=O;const f={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=f;const d={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=d;const p={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=p;const _={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=_;const w={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=w;const M={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=M;const E={O:"PageOpen",C:"PageClose"};e.PageActionEventType=E;const F={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=F;const G={NONE:0,BINARY:1};e.CMapCompressionType=G;const H={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=H;const K={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=K;let Z=F.WARNINGS;function ae(Q){Number.isInteger(Q)&&(Z=Q)}function oe(){return Z}function ie(Q){Z>=F.INFOS&&console.log(`Info: ${Q}`)}function ne(Q){Z>=F.WARNINGS&&console.log(`Warning: ${Q}`)}function J(Q){throw new Error(Q)}function ge(Q,re){Q||J(re)}function _e(Q){switch(Q==null?void 0:Q.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function X(Q){let re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Q)return null;try{if(te&&typeof Q=="string"){if(te.addDefaultProtocol&&Q.startsWith("www.")){const Re=Q.match(/\./g);(Re==null?void 0:Re.length)>=2&&(Q=`http://${Q}`)}if(te.tryConvertEncoding)try{Q=ve(Q)}catch{}}const Se=re?new URL(Q,re):new URL(Q);if(_e(Se))return Se}catch{}return null}function P(Q,re,te){let Se=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return Object.defineProperty(Q,re,{value:te,enumerable:!Se,configurable:!0,writable:!1}),te}const R=function(){function re(te,Se){this.constructor===re&&J("Cannot initialize BaseException."),this.message=te,this.name=Se}return re.prototype=new Error,re.constructor=re,re}();e.BaseException=R;class W extends R{constructor(re,te){super(re,"PasswordException"),this.code=te}}e.PasswordException=W;class $ extends R{constructor(re,te){super(re,"UnknownErrorException"),this.details=te}}e.UnknownErrorException=$;class V extends R{constructor(re){super(re,"InvalidPDFException")}}e.InvalidPDFException=V;class ee extends R{constructor(re){super(re,"MissingPDFException")}}e.MissingPDFException=ee;class z extends R{constructor(re,te){super(re,"UnexpectedResponseException"),this.status=te}}e.UnexpectedResponseException=z;class j extends R{constructor(re){super(re,"FormatError")}}e.FormatError=j;class q extends R{constructor(re){super(re,"AbortException")}}e.AbortException=q;function x(Q){(typeof Q!="object"||(Q==null?void 0:Q.length)===void 0)&&J("Invalid argument for bytesToString");const re=Q.length,te=8192;if(re<te)return String.fromCharCode.apply(null,Q);const Se=[];for(let Re=0;Re<re;Re+=te){const je=Math.min(Re+te,re),Ee=Q.subarray(Re,je);Se.push(String.fromCharCode.apply(null,Ee))}return Se.join("")}function T(Q){typeof Q!="string"&&J("Invalid argument for stringToBytes");const re=Q.length,te=new Uint8Array(re);for(let Se=0;Se<re;++Se)te[Se]=Q.charCodeAt(Se)&255;return te}function I(Q){return String.fromCharCode(Q>>24&255,Q>>16&255,Q>>8&255,Q&255)}function L(Q){return Object.keys(Q).length}function U(Q){const re=Object.create(null);for(const[te,Se]of Q)re[te]=Se;return re}function Y(){const Q=new Uint8Array(4);return Q[0]=1,new Uint32Array(Q.buffer,0,1)[0]===1}function ce(){try{return new Function(""),!0}catch{return!1}}class le{static get isLittleEndian(){return P(this,"isLittleEndian",Y())}static get isEvalSupported(){return P(this,"isEvalSupported",ce())}static get isOffscreenCanvasSupported(){return P(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?P(this,"platform",{isWin:!1,isMac:!1}):P(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}e.FeatureTest=le;const fe=[...Array(256).keys()].map(Q=>Q.toString(16).padStart(2,"0"));class de{static makeHexColor(re,te,Se){return`#${fe[re]}${fe[te]}${fe[Se]}`}static scaleMinMax(re,te){let Se;re[0]?(re[0]<0&&(Se=te[0],te[0]=te[1],te[1]=Se),te[0]*=re[0],te[1]*=re[0],re[3]<0&&(Se=te[2],te[2]=te[3],te[3]=Se),te[2]*=re[3],te[3]*=re[3]):(Se=te[0],te[0]=te[2],te[2]=Se,Se=te[1],te[1]=te[3],te[3]=Se,re[1]<0&&(Se=te[2],te[2]=te[3],te[3]=Se),te[2]*=re[1],te[3]*=re[1],re[2]<0&&(Se=te[0],te[0]=te[1],te[1]=Se),te[0]*=re[2],te[1]*=re[2]),te[0]+=re[4],te[1]+=re[4],te[2]+=re[5],te[3]+=re[5]}static transform(re,te){return[re[0]*te[0]+re[2]*te[1],re[1]*te[0]+re[3]*te[1],re[0]*te[2]+re[2]*te[3],re[1]*te[2]+re[3]*te[3],re[0]*te[4]+re[2]*te[5]+re[4],re[1]*te[4]+re[3]*te[5]+re[5]]}static applyTransform(re,te){const Se=re[0]*te[0]+re[1]*te[2]+te[4],Re=re[0]*te[1]+re[1]*te[3]+te[5];return[Se,Re]}static applyInverseTransform(re,te){const Se=te[0]*te[3]-te[1]*te[2],Re=(re[0]*te[3]-re[1]*te[2]+te[2]*te[5]-te[4]*te[3])/Se,je=(-re[0]*te[1]+re[1]*te[0]+te[4]*te[1]-te[5]*te[0])/Se;return[Re,je]}static getAxialAlignedBoundingBox(re,te){const Se=de.applyTransform(re,te),Re=de.applyTransform(re.slice(2,4),te),je=de.applyTransform([re[0],re[3]],te),Ee=de.applyTransform([re[2],re[1]],te);return[Math.min(Se[0],Re[0],je[0],Ee[0]),Math.min(Se[1],Re[1],je[1],Ee[1]),Math.max(Se[0],Re[0],je[0],Ee[0]),Math.max(Se[1],Re[1],je[1],Ee[1])]}static inverseTransform(re){const te=re[0]*re[3]-re[1]*re[2];return[re[3]/te,-re[1]/te,-re[2]/te,re[0]/te,(re[2]*re[5]-re[4]*re[3])/te,(re[4]*re[1]-re[5]*re[0])/te]}static singularValueDecompose2dScale(re){const te=[re[0],re[2],re[1],re[3]],Se=re[0]*te[0]+re[1]*te[2],Re=re[0]*te[1]+re[1]*te[3],je=re[2]*te[0]+re[3]*te[2],Ee=re[2]*te[1]+re[3]*te[3],nt=(Se+Ee)/2,et=Math.sqrt((Se+Ee)**2-4*(Se*Ee-je*Re))/2,ue=nt+et||1,Ae=nt-et||1;return[Math.sqrt(ue),Math.sqrt(Ae)]}static normalizeRect(re){const te=re.slice(0);return re[0]>re[2]&&(te[0]=re[2],te[2]=re[0]),re[1]>re[3]&&(te[1]=re[3],te[3]=re[1]),te}static intersect(re,te){const Se=Math.max(Math.min(re[0],re[2]),Math.min(te[0],te[2])),Re=Math.min(Math.max(re[0],re[2]),Math.max(te[0],te[2]));if(Se>Re)return null;const je=Math.max(Math.min(re[1],re[3]),Math.min(te[1],te[3])),Ee=Math.min(Math.max(re[1],re[3]),Math.max(te[1],te[3]));return je>Ee?null:[Se,je,Re,Ee]}static bezierBoundingBox(re,te,Se,Re,je,Ee,nt,et){const ue=[],Ae=[[],[]];let Ie,Ne,De,Fe,Be,We,He,ze;for(let Ze=0;Ze<2;++Ze){if(Ze===0?(Ne=6*re-12*Se+6*je,Ie=-3*re+9*Se-9*je+3*nt,De=3*Se-3*re):(Ne=6*te-12*Re+6*Ee,Ie=-3*te+9*Re-9*Ee+3*et,De=3*Re-3*te),Math.abs(Ie)<1e-12){if(Math.abs(Ne)<1e-12)continue;Fe=-De/Ne,0<Fe&&Fe<1&&ue.push(Fe);continue}He=Ne*Ne-4*De*Ie,ze=Math.sqrt(He),!(He<0)&&(Be=(-Ne+ze)/(2*Ie),0<Be&&Be<1&&ue.push(Be),We=(-Ne-ze)/(2*Ie),0<We&&We<1&&ue.push(We))}let Ye=ue.length,Ge;const Xe=Ye;for(;Ye--;)Fe=ue[Ye],Ge=1-Fe,Ae[0][Ye]=Ge*Ge*Ge*re+3*Ge*Ge*Fe*Se+3*Ge*Fe*Fe*je+Fe*Fe*Fe*nt,Ae[1][Ye]=Ge*Ge*Ge*te+3*Ge*Ge*Fe*Re+3*Ge*Fe*Fe*Ee+Fe*Fe*Fe*et;return Ae[0][Xe]=re,Ae[1][Xe]=te,Ae[0][Xe+1]=nt,Ae[1][Xe+1]=et,Ae[0].length=Ae[1].length=Xe+2,[Math.min(...Ae[0]),Math.min(...Ae[1]),Math.max(...Ae[0]),Math.max(...Ae[1])]}}e.Util=de;const ye=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function be(Q){if(Q[0]>="ï"){let te;if(Q[0]==="þ"&&Q[1]==="ÿ"?te="utf-16be":Q[0]==="ÿ"&&Q[1]==="þ"?te="utf-16le":Q[0]==="ï"&&Q[1]==="»"&&Q[2]==="¿"&&(te="utf-8"),te)try{const Se=new TextDecoder(te,{fatal:!0}),Re=T(Q);return Se.decode(Re)}catch(Se){ne(`stringToPDFString: "${Se}".`)}}const re=[];for(let te=0,Se=Q.length;te<Se;te++){const Re=ye[Q.charCodeAt(te)];re.push(Re?String.fromCharCode(Re):Q.charAt(te))}return re.join("")}function ve(Q){return decodeURIComponent(escape(Q))}function xe(Q){return unescape(encodeURIComponent(Q))}function Oe(Q){return typeof Q=="object"&&(Q==null?void 0:Q.byteLength)!==void 0}function Pe(Q,re){if(Q.length!==re.length)return!1;for(let te=0,Se=Q.length;te<Se;te++)if(Q[te]!==re[te])return!1;return!0}function Le(){let Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[Q.getUTCFullYear().toString(),(Q.getUTCMonth()+1).toString().padStart(2,"0"),Q.getUTCDate().toString().padStart(2,"0"),Q.getUTCHours().toString().padStart(2,"0"),Q.getUTCMinutes().toString().padStart(2,"0"),Q.getUTCSeconds().toString().padStart(2,"0")].join("")}class se{constructor(){he(this,$e,!1);this.promise=new Promise((re,te)=>{this.resolve=Se=>{Ce(this,$e,!0),re(Se)},this.reject=Se=>{Ce(this,$e,!0),te(Se)}})}get settled(){return D(this,$e)}}$e=new WeakMap,e.PromiseCapability=se;let Te=null,Ue=null;function Ve(Q){return Te||(Te=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ue=new Map([["ﬅ","ſt"]])),Q.replaceAll(Te,(re,te,Se)=>te?te.normalize("NFKC"):Ue.get(Se))}},(r,e,t)=>{var n=t(3);(function(){globalThis.DOMMatrix||!n.isNodeJS||(globalThis.DOMMatrix=require$$6.DOMMatrix)})(),function(){if(globalThis.Path2D||!n.isNodeJS)return;const{CanvasRenderingContext2D:i}=require$$6,{polyfillPath2D:o}=requirePath2dPolyfill_min();globalThis.CanvasRenderingContext2D=i,o(globalThis)}(),function(){Array.prototype.at||t(4)}(),function(){Uint8Array.prototype.at||t(78)}(),function(){globalThis.structuredClone||t(90)}()},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(r,e,t)=>{t(5);var n=t(77);r.exports=n("Array","at")},(r,e,t)=>{var n=t(6),s=t(43),i=t(67),o=t(65),c=t(72);n({target:"Array",proto:!0},{at:function(l){var a=s(this),h=i(a),y=o(l),g=y>=0?y:h+y;return g<0||g>=h?void 0:a[g]}}),c("at")},(r,e,t)=>{var n=t(7),s=t(8).f,i=t(47),o=t(51),c=t(41),u=t(59),l=t(71);r.exports=function(a,h){var y=a.target,g=a.global,m=a.stat,b,v,S,N,k,O;if(g?v=n:m?v=n[y]||c(y,{}):v=(n[y]||{}).prototype,v)for(S in h){if(k=h[S],a.dontCallGetSet?(O=s(v,S),N=O&&O.value):N=v[S],b=l(g?S:y+(m?".":"#")+S,a.forced),!b&&N!==void 0){if(typeof k==typeof N)continue;u(k,N)}(a.sham||N&&N.sham)&&i(k,"sham",!0),o(v,S,k,a)}}},function(r){var e=function(t){return t&&t.Math==Math&&t};r.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||this||Function("return this")()},(r,e,t)=>{var n=t(9),s=t(11),i=t(13),o=t(14),c=t(15),u=t(21),l=t(42),a=t(45),h=Object.getOwnPropertyDescriptor;e.f=n?h:function(g,m){if(g=c(g),m=u(m),a)try{return h(g,m)}catch{}if(l(g,m))return o(!s(i.f,g,m),g[m])}},(r,e,t)=>{var n=t(10);r.exports=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},r=>{r.exports=function(e){try{return!!e()}catch{return!0}}},(r,e,t)=>{var n=t(12),s=Function.prototype.call;r.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},(r,e,t)=>{var n=t(10);r.exports=!n(function(){var s=function(){}.bind();return typeof s!="function"||s.hasOwnProperty("prototype")})},(r,e)=>{var t={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!t.call({1:2},1);e.f=s?function(o){var c=n(this,o);return!!c&&c.enumerable}:t},r=>{r.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},(r,e,t)=>{var n=t(16),s=t(19);r.exports=function(i){return n(s(i))}},(r,e,t)=>{var n=t(17),s=t(10),i=t(18),o=Object,c=n("".split);r.exports=s(function(){return!o("z").propertyIsEnumerable(0)})?function(u){return i(u)=="String"?c(u,""):o(u)}:o},(r,e,t)=>{var n=t(12),s=Function.prototype,i=s.call,o=n&&s.bind.bind(i,i);r.exports=n?o:function(c){return function(){return i.apply(c,arguments)}}},(r,e,t)=>{var n=t(17),s=n({}.toString),i=n("".slice);r.exports=function(o){return i(s(o),8,-1)}},(r,e,t)=>{var n=t(20),s=TypeError;r.exports=function(i){if(n(i))throw s("Can't call method on "+i);return i}},r=>{r.exports=function(e){return e==null}},(r,e,t)=>{var n=t(22),s=t(26);r.exports=function(i){var o=n(i,"string");return s(o)?o:o+""}},(r,e,t)=>{var n=t(11),s=t(23),i=t(26),o=t(33),c=t(36),u=t(37),l=TypeError,a=u("toPrimitive");r.exports=function(h,y){if(!s(h)||i(h))return h;var g=o(h,a),m;if(g){if(y===void 0&&(y="default"),m=n(g,h,y),!s(m)||i(m))return m;throw l("Can't convert object to primitive value")}return y===void 0&&(y="number"),c(h,y)}},(r,e,t)=>{var n=t(24),s=t(25),i=s.all;r.exports=s.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:n(o)||o===i}:function(o){return typeof o=="object"?o!==null:n(o)}},(r,e,t)=>{var n=t(25),s=n.all;r.exports=n.IS_HTMLDDA?function(i){return typeof i=="function"||i===s}:function(i){return typeof i=="function"}},r=>{var e=typeof document=="object"&&document.all,t=typeof e>"u"&&e!==void 0;r.exports={all:e,IS_HTMLDDA:t}},(r,e,t)=>{var n=t(27),s=t(24),i=t(28),o=t(29),c=Object;r.exports=o?function(u){return typeof u=="symbol"}:function(u){var l=n("Symbol");return s(l)&&i(l.prototype,c(u))}},(r,e,t)=>{var n=t(7),s=t(24),i=function(o){return s(o)?o:void 0};r.exports=function(o,c){return arguments.length<2?i(n[o]):n[o]&&n[o][c]}},(r,e,t)=>{var n=t(17);r.exports=n({}.isPrototypeOf)},(r,e,t)=>{var n=t(30);r.exports=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(r,e,t)=>{var n=t(31),s=t(10),i=t(7),o=i.String;r.exports=!!Object.getOwnPropertySymbols&&!s(function(){var c=Symbol();return!o(c)||!(Object(c)instanceof Symbol)||!Symbol.sham&&n&&n<41})},(r,e,t)=>{var n=t(7),s=t(32),i=n.process,o=n.Deno,c=i&&i.versions||o&&o.version,u=c&&c.v8,l,a;u&&(l=u.split("."),a=l[0]>0&&l[0]<4?1:+(l[0]+l[1])),!a&&s&&(l=s.match(/Edge\/(\d+)/),(!l||l[1]>=74)&&(l=s.match(/Chrome\/(\d+)/),l&&(a=+l[1]))),r.exports=a},r=>{r.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},(r,e,t)=>{var n=t(34),s=t(20);r.exports=function(i,o){var c=i[o];return s(c)?void 0:n(c)}},(r,e,t)=>{var n=t(24),s=t(35),i=TypeError;r.exports=function(o){if(n(o))return o;throw i(s(o)+" is not a function")}},r=>{var e=String;r.exports=function(t){try{return e(t)}catch{return"Object"}}},(r,e,t)=>{var n=t(11),s=t(24),i=t(23),o=TypeError;r.exports=function(c,u){var l,a;if(u==="string"&&s(l=c.toString)&&!i(a=n(l,c))||s(l=c.valueOf)&&!i(a=n(l,c))||u!=="string"&&s(l=c.toString)&&!i(a=n(l,c)))return a;throw o("Can't convert object to primitive value")}},(r,e,t)=>{var n=t(7),s=t(38),i=t(42),o=t(44),c=t(30),u=t(29),l=n.Symbol,a=s("wks"),h=u?l.for||l:l&&l.withoutSetter||o;r.exports=function(y){return i(a,y)||(a[y]=c&&i(l,y)?l[y]:h("Symbol."+y)),a[y]}},(r,e,t)=>{var n=t(39),s=t(40);(r.exports=function(i,o){return s[i]||(s[i]=o!==void 0?o:{})})("versions",[]).push({version:"3.30.2",mode:n?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})},r=>{r.exports=!1},(r,e,t)=>{var n=t(7),s=t(41),i="__core-js_shared__",o=n[i]||s(i,{});r.exports=o},(r,e,t)=>{var n=t(7),s=Object.defineProperty;r.exports=function(i,o){try{s(n,i,{value:o,configurable:!0,writable:!0})}catch{n[i]=o}return o}},(r,e,t)=>{var n=t(17),s=t(43),i=n({}.hasOwnProperty);r.exports=Object.hasOwn||function(c,u){return i(s(c),u)}},(r,e,t)=>{var n=t(19),s=Object;r.exports=function(i){return s(n(i))}},(r,e,t)=>{var n=t(17),s=0,i=Math.random(),o=n(1 .toString);r.exports=function(c){return"Symbol("+(c===void 0?"":c)+")_"+o(++s+i,36)}},(r,e,t)=>{var n=t(9),s=t(10),i=t(46);r.exports=!n&&!s(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!=7})},(r,e,t)=>{var n=t(7),s=t(23),i=n.document,o=s(i)&&s(i.createElement);r.exports=function(c){return o?i.createElement(c):{}}},(r,e,t)=>{var n=t(9),s=t(48),i=t(14);r.exports=n?function(o,c,u){return s.f(o,c,i(1,u))}:function(o,c,u){return o[c]=u,o}},(r,e,t)=>{var n=t(9),s=t(45),i=t(49),o=t(50),c=t(21),u=TypeError,l=Object.defineProperty,a=Object.getOwnPropertyDescriptor,h="enumerable",y="configurable",g="writable";e.f=n?i?function(b,v,S){if(o(b),v=c(v),o(S),typeof b=="function"&&v==="prototype"&&"value"in S&&g in S&&!S[g]){var N=a(b,v);N&&N[g]&&(b[v]=S.value,S={configurable:y in S?S[y]:N[y],enumerable:h in S?S[h]:N[h],writable:!1})}return l(b,v,S)}:l:function(b,v,S){if(o(b),v=c(v),o(S),s)try{return l(b,v,S)}catch{}if("get"in S||"set"in S)throw u("Accessors not supported");return"value"in S&&(b[v]=S.value),b}},(r,e,t)=>{var n=t(9),s=t(10);r.exports=n&&s(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},(r,e,t)=>{var n=t(23),s=String,i=TypeError;r.exports=function(o){if(n(o))return o;throw i(s(o)+" is not an object")}},(r,e,t)=>{var n=t(24),s=t(48),i=t(52),o=t(41);r.exports=function(c,u,l,a){a||(a={});var h=a.enumerable,y=a.name!==void 0?a.name:u;if(n(l)&&i(l,y,a),a.global)h?c[u]=l:o(u,l);else{try{a.unsafe?c[u]&&(h=!0):delete c[u]}catch{}h?c[u]=l:s.f(c,u,{value:l,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return c}},(r,e,t)=>{var n=t(17),s=t(10),i=t(24),o=t(42),c=t(9),u=t(53).CONFIGURABLE,l=t(54),a=t(55),h=a.enforce,y=a.get,g=String,m=Object.defineProperty,b=n("".slice),v=n("".replace),S=n([].join),N=c&&!s(function(){return m(function(){},"length",{value:8}).length!==8}),k=String(String).split("String"),O=r.exports=function(f,d,p){b(g(d),0,7)==="Symbol("&&(d="["+v(g(d),/^Symbol\(([^)]*)\)/,"$1")+"]"),p&&p.getter&&(d="get "+d),p&&p.setter&&(d="set "+d),(!o(f,"name")||u&&f.name!==d)&&(c?m(f,"name",{value:d,configurable:!0}):f.name=d),N&&p&&o(p,"arity")&&f.length!==p.arity&&m(f,"length",{value:p.arity});try{p&&o(p,"constructor")&&p.constructor?c&&m(f,"prototype",{writable:!1}):f.prototype&&(f.prototype=void 0)}catch{}var _=h(f);return o(_,"source")||(_.source=S(k,typeof d=="string"?d:"")),f};Function.prototype.toString=O(function(){return i(this)&&y(this).source||l(this)},"toString")},(r,e,t)=>{var n=t(9),s=t(42),i=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,c=s(i,"name"),u=c&&function(){}.name==="something",l=c&&(!n||n&&o(i,"name").configurable);r.exports={EXISTS:c,PROPER:u,CONFIGURABLE:l}},(r,e,t)=>{var n=t(17),s=t(24),i=t(40),o=n(Function.toString);s(i.inspectSource)||(i.inspectSource=function(c){return o(c)}),r.exports=i.inspectSource},(r,e,t)=>{var n=t(56),s=t(7),i=t(23),o=t(47),c=t(42),u=t(40),l=t(57),a=t(58),h="Object already initialized",y=s.TypeError,g=s.WeakMap,m,b,v,S=function(f){return v(f)?b(f):m(f,{})},N=function(f){return function(d){var p;if(!i(d)||(p=b(d)).type!==f)throw y("Incompatible receiver, "+f+" required");return p}};if(n||u.state){var k=u.state||(u.state=new g);k.get=k.get,k.has=k.has,k.set=k.set,m=function(f,d){if(k.has(f))throw y(h);return d.facade=f,k.set(f,d),d},b=function(f){return k.get(f)||{}},v=function(f){return k.has(f)}}else{var O=l("state");a[O]=!0,m=function(f,d){if(c(f,O))throw y(h);return d.facade=f,o(f,O,d),d},b=function(f){return c(f,O)?f[O]:{}},v=function(f){return c(f,O)}}r.exports={set:m,get:b,has:v,enforce:S,getterFor:N}},(r,e,t)=>{var n=t(7),s=t(24),i=n.WeakMap;r.exports=s(i)&&/native code/.test(String(i))},(r,e,t)=>{var n=t(38),s=t(44),i=n("keys");r.exports=function(o){return i[o]||(i[o]=s(o))}},r=>{r.exports={}},(r,e,t)=>{var n=t(42),s=t(60),i=t(8),o=t(48);r.exports=function(c,u,l){for(var a=s(u),h=o.f,y=i.f,g=0;g<a.length;g++){var m=a[g];!n(c,m)&&!(l&&n(l,m))&&h(c,m,y(u,m))}}},(r,e,t)=>{var n=t(27),s=t(17),i=t(61),o=t(70),c=t(50),u=s([].concat);r.exports=n("Reflect","ownKeys")||function(a){var h=i.f(c(a)),y=o.f;return y?u(h,y(a)):h}},(r,e,t)=>{var n=t(62),s=t(69),i=s.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(c){return n(c,i)}},(r,e,t)=>{var n=t(17),s=t(42),i=t(15),o=t(63).indexOf,c=t(58),u=n([].push);r.exports=function(l,a){var h=i(l),y=0,g=[],m;for(m in h)!s(c,m)&&s(h,m)&&u(g,m);for(;a.length>y;)s(h,m=a[y++])&&(~o(g,m)||u(g,m));return g}},(r,e,t)=>{var n=t(15),s=t(64),i=t(67),o=function(c){return function(u,l,a){var h=n(u),y=i(h),g=s(a,y),m;if(c&&l!=l){for(;y>g;)if(m=h[g++],m!=m)return!0}else for(;y>g;g++)if((c||g in h)&&h[g]===l)return c||g||0;return!c&&-1}};r.exports={includes:o(!0),indexOf:o(!1)}},(r,e,t)=>{var n=t(65),s=Math.max,i=Math.min;r.exports=function(o,c){var u=n(o);return u<0?s(u+c,0):i(u,c)}},(r,e,t)=>{var n=t(66);r.exports=function(s){var i=+s;return i!==i||i===0?0:n(i)}},r=>{var e=Math.ceil,t=Math.floor;r.exports=Math.trunc||function(s){var i=+s;return(i>0?t:e)(i)}},(r,e,t)=>{var n=t(68);r.exports=function(s){return n(s.length)}},(r,e,t)=>{var n=t(65),s=Math.min;r.exports=function(i){return i>0?s(n(i),9007199254740991):0}},r=>{r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(r,e)=>{e.f=Object.getOwnPropertySymbols},(r,e,t)=>{var n=t(10),s=t(24),i=/#|\.prototype\./,o=function(h,y){var g=u[c(h)];return g==a?!0:g==l?!1:s(y)?n(y):!!y},c=o.normalize=function(h){return String(h).replace(i,".").toLowerCase()},u=o.data={},l=o.NATIVE="N",a=o.POLYFILL="P";r.exports=o},(r,e,t)=>{var n=t(37),s=t(73),i=t(48).f,o=n("unscopables"),c=Array.prototype;c[o]==null&&i(c,o,{configurable:!0,value:s(null)}),r.exports=function(u){c[o][u]=!0}},(r,e,t)=>{var n=t(50),s=t(74),i=t(69),o=t(58),c=t(76),u=t(46),l=t(57),a=">",h="<",y="prototype",g="script",m=l("IE_PROTO"),b=function(){},v=function(f){return h+g+a+f+h+"/"+g+a},S=function(f){f.write(v("")),f.close();var d=f.parentWindow.Object;return f=null,d},N=function(){var f=u("iframe"),d="java"+g+":",p;return f.style.display="none",c.appendChild(f),f.src=String(d),p=f.contentWindow.document,p.open(),p.write(v("document.F=Object")),p.close(),p.F},k,O=function(){try{k=new ActiveXObject("htmlfile")}catch{}O=typeof document<"u"?document.domain&&k?S(k):N():S(k);for(var f=i.length;f--;)delete O[y][i[f]];return O()};o[m]=!0,r.exports=Object.create||function(d,p){var _;return d!==null?(b[y]=n(d),_=new b,b[y]=null,_[m]=d):_=O(),p===void 0?_:s.f(_,p)}},(r,e,t)=>{var n=t(9),s=t(49),i=t(48),o=t(50),c=t(15),u=t(75);e.f=n&&!s?Object.defineProperties:function(a,h){o(a);for(var y=c(h),g=u(h),m=g.length,b=0,v;m>b;)i.f(a,v=g[b++],y[v]);return a}},(r,e,t)=>{var n=t(62),s=t(69);r.exports=Object.keys||function(o){return n(o,s)}},(r,e,t)=>{var n=t(27);r.exports=n("document","documentElement")},(r,e,t)=>{var n=t(7),s=t(17);r.exports=function(i,o){return s(n[i].prototype[o])}},(r,e,t)=>{t(79)},(r,e,t)=>{var n=t(80),s=t(67),i=t(65),o=n.aTypedArray,c=n.exportTypedArrayMethod;c("at",function(l){var a=o(this),h=s(a),y=i(l),g=y>=0?y:h+y;return g<0||g>=h?void 0:a[g]})},(r,e,t)=>{var n=t(81),s=t(9),i=t(7),o=t(24),c=t(23),u=t(42),l=t(82),a=t(35),h=t(47),y=t(51),g=t(84),m=t(28),b=t(85),v=t(87),S=t(37),N=t(44),k=t(55),O=k.enforce,f=k.get,d=i.Int8Array,p=d&&d.prototype,_=i.Uint8ClampedArray,w=_&&_.prototype,M=d&&b(d),E=p&&b(p),F=Object.prototype,G=i.TypeError,H=S("toStringTag"),K=N("TYPED_ARRAY_TAG"),Z="TypedArrayConstructor",ae=n&&!!v&&l(i.opera)!=="Opera",oe=!1,ie,ne,J,ge={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},_e={BigInt64Array:8,BigUint64Array:8},X=function(j){if(!c(j))return!1;var q=l(j);return q==="DataView"||u(ge,q)||u(_e,q)},P=function(z){var j=b(z);if(c(j)){var q=f(j);return q&&u(q,Z)?q[Z]:P(j)}},R=function(z){if(!c(z))return!1;var j=l(z);return u(ge,j)||u(_e,j)},W=function(z){if(R(z))return z;throw G("Target is not a typed array")},$=function(z){if(o(z)&&(!v||m(M,z)))return z;throw G(a(z)+" is not a typed array constructor")},V=function(z,j,q,x){if(s){if(q)for(var T in ge){var I=i[T];if(I&&u(I.prototype,z))try{delete I.prototype[z]}catch{try{I.prototype[z]=j}catch{}}}(!E[z]||q)&&y(E,z,q?j:ae&&p[z]||j,x)}},ee=function(z,j,q){var x,T;if(s){if(v){if(q){for(x in ge)if(T=i[x],T&&u(T,z))try{delete T[z]}catch{}}if(!M[z]||q)try{return y(M,z,q?j:ae&&M[z]||j)}catch{}else return}for(x in ge)T=i[x],T&&(!T[z]||q)&&y(T,z,j)}};for(ie in ge)ne=i[ie],J=ne&&ne.prototype,J?O(J)[Z]=ne:ae=!1;for(ie in _e)ne=i[ie],J=ne&&ne.prototype,J&&(O(J)[Z]=ne);if((!ae||!o(M)||M===Function.prototype)&&(M=function(){throw G("Incorrect invocation")},ae))for(ie in ge)i[ie]&&v(i[ie],M);if((!ae||!E||E===F)&&(E=M.prototype,ae))for(ie in ge)i[ie]&&v(i[ie].prototype,E);if(ae&&b(w)!==E&&v(w,E),s&&!u(E,H)){oe=!0,g(E,H,{configurable:!0,get:function(){return c(this)?this[K]:void 0}});for(ie in ge)i[ie]&&h(i[ie],K,ie)}r.exports={NATIVE_ARRAY_BUFFER_VIEWS:ae,TYPED_ARRAY_TAG:oe&&K,aTypedArray:W,aTypedArrayConstructor:$,exportTypedArrayMethod:V,exportTypedArrayStaticMethod:ee,getTypedArrayConstructor:P,isView:X,isTypedArray:R,TypedArray:M,TypedArrayPrototype:E}},r=>{r.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(r,e,t)=>{var n=t(83),s=t(24),i=t(18),o=t(37),c=o("toStringTag"),u=Object,l=i(function(){return arguments}())=="Arguments",a=function(h,y){try{return h[y]}catch{}};r.exports=n?i:function(h){var y,g,m;return h===void 0?"Undefined":h===null?"Null":typeof(g=a(y=u(h),c))=="string"?g:l?i(y):(m=i(y))=="Object"&&s(y.callee)?"Arguments":m}},(r,e,t)=>{var n=t(37),s=n("toStringTag"),i={};i[s]="z",r.exports=String(i)==="[object z]"},(r,e,t)=>{var n=t(52),s=t(48);r.exports=function(i,o,c){return c.get&&n(c.get,o,{getter:!0}),c.set&&n(c.set,o,{setter:!0}),s.f(i,o,c)}},(r,e,t)=>{var n=t(42),s=t(24),i=t(43),o=t(57),c=t(86),u=o("IE_PROTO"),l=Object,a=l.prototype;r.exports=c?l.getPrototypeOf:function(h){var y=i(h);if(n(y,u))return y[u];var g=y.constructor;return s(g)&&y instanceof g?g.prototype:y instanceof l?a:null}},(r,e,t)=>{var n=t(10);r.exports=!n(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype})},(r,e,t)=>{var n=t(88),s=t(50),i=t(89);r.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,c={},u;try{u=n(Object.prototype,"__proto__","set"),u(c,[]),o=c instanceof Array}catch{}return function(a,h){return s(a),i(h),o?u(a,h):a.__proto__=h,a}}():void 0)},(r,e,t)=>{var n=t(17),s=t(34);r.exports=function(i,o,c){try{return n(s(Object.getOwnPropertyDescriptor(i,o)[c]))}catch{}}},(r,e,t)=>{var n=t(24),s=String,i=TypeError;r.exports=function(o){if(typeof o=="object"||n(o))return o;throw i("Can't set "+s(o)+" as a prototype")}},(r,e,t)=>{t(91),t(98),t(100),t(123),t(125);var n=t(137);r.exports=n.structuredClone},(r,e,t)=>{var n=t(15),s=t(72),i=t(92),o=t(55),c=t(48).f,u=t(93),l=t(97),a=t(39),h=t(9),y="Array Iterator",g=o.set,m=o.getterFor(y);r.exports=u(Array,"Array",function(v,S){g(this,{type:y,target:n(v),index:0,kind:S})},function(){var v=m(this),S=v.target,N=v.kind,k=v.index++;return!S||k>=S.length?(v.target=void 0,l(void 0,!0)):N=="keys"?l(k,!1):N=="values"?l(S[k],!1):l([k,S[k]],!1)},"values");var b=i.Arguments=i.Array;if(s("keys"),s("values"),s("entries"),!a&&h&&b.name!=="values")try{c(b,"name",{value:"values"})}catch{}},r=>{r.exports={}},(r,e,t)=>{var n=t(6),s=t(11),i=t(39),o=t(53),c=t(24),u=t(94),l=t(85),a=t(87),h=t(96),y=t(47),g=t(51),m=t(37),b=t(92),v=t(95),S=o.PROPER,N=o.CONFIGURABLE,k=v.IteratorPrototype,O=v.BUGGY_SAFARI_ITERATORS,f=m("iterator"),d="keys",p="values",_="entries",w=function(){return this};r.exports=function(M,E,F,G,H,K,Z){u(F,E,G);var ae=function(W){if(W===H&&ge)return ge;if(!O&&W in ne)return ne[W];switch(W){case d:return function(){return new F(this,W)};case p:return function(){return new F(this,W)};case _:return function(){return new F(this,W)}}return function(){return new F(this)}},oe=E+" Iterator",ie=!1,ne=M.prototype,J=ne[f]||ne["@@iterator"]||H&&ne[H],ge=!O&&J||ae(H),_e=E=="Array"&&ne.entries||J,X,P,R;if(_e&&(X=l(_e.call(new M)),X!==Object.prototype&&X.next&&(!i&&l(X)!==k&&(a?a(X,k):c(X[f])||g(X,f,w)),h(X,oe,!0,!0),i&&(b[oe]=w))),S&&H==p&&J&&J.name!==p&&(!i&&N?y(ne,"name",p):(ie=!0,ge=function(){return s(J,this)})),H)if(P={values:ae(p),keys:K?ge:ae(d),entries:ae(_)},Z)for(R in P)(O||ie||!(R in ne))&&g(ne,R,P[R]);else n({target:E,proto:!0,forced:O||ie},P);return(!i||Z)&&ne[f]!==ge&&g(ne,f,ge,{name:H}),b[E]=ge,P}},(r,e,t)=>{var n=t(95).IteratorPrototype,s=t(73),i=t(14),o=t(96),c=t(92),u=function(){return this};r.exports=function(l,a,h,y){var g=a+" Iterator";return l.prototype=s(n,{next:i(+!y,h)}),o(l,g,!1,!0),c[g]=u,l}},(r,e,t)=>{var n=t(10),s=t(24),i=t(23),o=t(73),c=t(85),u=t(51),l=t(37),a=t(39),h=l("iterator"),y=!1,g,m,b;[].keys&&(b=[].keys(),"next"in b?(m=c(c(b)),m!==Object.prototype&&(g=m)):y=!0);var v=!i(g)||n(function(){var S={};return g[h].call(S)!==S});v?g={}:a&&(g=o(g)),s(g[h])||u(g,h,function(){return this}),r.exports={IteratorPrototype:g,BUGGY_SAFARI_ITERATORS:y}},(r,e,t)=>{var n=t(48).f,s=t(42),i=t(37),o=i("toStringTag");r.exports=function(c,u,l){c&&!l&&(c=c.prototype),c&&!s(c,o)&&n(c,o,{configurable:!0,value:u})}},r=>{r.exports=function(e,t){return{value:e,done:t}}},(r,e,t)=>{var n=t(83),s=t(51),i=t(99);n||s(Object.prototype,"toString",i,{unsafe:!0})},(r,e,t)=>{var n=t(83),s=t(82);r.exports=n?{}.toString:function(){return"[object "+s(this)+"]"}},(r,e,t)=>{t(101)},(r,e,t)=>{var n=t(102),s=t(120);n("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},s)},(r,e,t)=>{var n=t(6),s=t(7),i=t(17),o=t(71),c=t(51),u=t(103),l=t(110),a=t(117),h=t(24),y=t(20),g=t(23),m=t(10),b=t(118),v=t(96),S=t(119);r.exports=function(N,k,O){var f=N.indexOf("Map")!==-1,d=N.indexOf("Weak")!==-1,p=f?"set":"add",_=s[N],w=_&&_.prototype,M=_,E={},F=function(ie){var ne=i(w[ie]);c(w,ie,ie=="add"?function(ge){return ne(this,ge===0?0:ge),this}:ie=="delete"?function(J){return d&&!g(J)?!1:ne(this,J===0?0:J)}:ie=="get"?function(ge){return d&&!g(ge)?void 0:ne(this,ge===0?0:ge)}:ie=="has"?function(ge){return d&&!g(ge)?!1:ne(this,ge===0?0:ge)}:function(ge,_e){return ne(this,ge===0?0:ge,_e),this})},G=o(N,!h(_)||!(d||w.forEach&&!m(function(){new _().entries().next()})));if(G)M=O.getConstructor(k,N,f,p),u.enable();else if(o(N,!0)){var H=new M,K=H[p](d?{}:-0,1)!=H,Z=m(function(){H.has(1)}),ae=b(function(ie){new _(ie)}),oe=!d&&m(function(){for(var ie=new _,ne=5;ne--;)ie[p](ne,ne);return!ie.has(-0)});ae||(M=k(function(ie,ne){a(ie,w);var J=S(new _,ie,M);return y(ne)||l(ne,J[p],{that:J,AS_ENTRIES:f}),J}),M.prototype=w,w.constructor=M),(Z||oe)&&(F("delete"),F("has"),f&&F("get")),(oe||K)&&F(p),d&&w.clear&&delete w.clear}return E[N]=M,n({global:!0,constructor:!0,forced:M!=_},E),v(M,N),d||O.setStrong(M,N,f),M}},(r,e,t)=>{var n=t(6),s=t(17),i=t(58),o=t(23),c=t(42),u=t(48).f,l=t(61),a=t(104),h=t(107),y=t(44),g=t(109),m=!1,b=y("meta"),v=0,S=function(p){u(p,b,{value:{objectID:"O"+v++,weakData:{}}})},N=function(p,_){if(!o(p))return typeof p=="symbol"?p:(typeof p=="string"?"S":"P")+p;if(!c(p,b)){if(!h(p))return"F";if(!_)return"E";S(p)}return p[b].objectID},k=function(p,_){if(!c(p,b)){if(!h(p))return!0;if(!_)return!1;S(p)}return p[b].weakData},O=function(p){return g&&m&&h(p)&&!c(p,b)&&S(p),p},f=function(){d.enable=function(){},m=!0;var p=l.f,_=s([].splice),w={};w[b]=1,p(w).length&&(l.f=function(M){for(var E=p(M),F=0,G=E.length;F<G;F++)if(E[F]===b){_(E,F,1);break}return E},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:a.f}))},d=r.exports={enable:f,fastKey:N,getWeakData:k,onFreeze:O};i[b]=!0},(r,e,t)=>{var n=t(18),s=t(15),i=t(61).f,o=t(105),c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],u=function(l){try{return i(l)}catch{return o(c)}};r.exports.f=function(a){return c&&n(a)=="Window"?u(a):i(s(a))}},(r,e,t)=>{var n=t(64),s=t(67),i=t(106),o=Array,c=Math.max;r.exports=function(u,l,a){for(var h=s(u),y=n(l,h),g=n(a===void 0?h:a,h),m=o(c(g-y,0)),b=0;y<g;y++,b++)i(m,b,u[y]);return m.length=b,m}},(r,e,t)=>{var n=t(21),s=t(48),i=t(14);r.exports=function(o,c,u){var l=n(c);l in o?s.f(o,l,i(0,u)):o[l]=u}},(r,e,t)=>{var n=t(10),s=t(23),i=t(18),o=t(108),c=Object.isExtensible,u=n(function(){});r.exports=u||o?function(a){return!s(a)||o&&i(a)=="ArrayBuffer"?!1:c?c(a):!0}:c},(r,e,t)=>{var n=t(10);r.exports=n(function(){if(typeof ArrayBuffer=="function"){var s=new ArrayBuffer(8);Object.isExtensible(s)&&Object.defineProperty(s,"a",{value:8})}})},(r,e,t)=>{var n=t(10);r.exports=!n(function(){return Object.isExtensible(Object.preventExtensions({}))})},(r,e,t)=>{var n=t(111),s=t(11),i=t(50),o=t(35),c=t(113),u=t(67),l=t(28),a=t(114),h=t(115),y=t(116),g=TypeError,m=function(v,S){this.stopped=v,this.result=S},b=m.prototype;r.exports=function(v,S,N){var k=N&&N.that,O=!!(N&&N.AS_ENTRIES),f=!!(N&&N.IS_RECORD),d=!!(N&&N.IS_ITERATOR),p=!!(N&&N.INTERRUPTED),_=n(S,k),w,M,E,F,G,H,K,Z=function(oe){return w&&y(w,"normal",oe),new m(!0,oe)},ae=function(oe){return O?(i(oe),p?_(oe[0],oe[1],Z):_(oe[0],oe[1])):p?_(oe,Z):_(oe)};if(f)w=v.iterator;else if(d)w=v;else{if(M=h(v),!M)throw g(o(v)+" is not iterable");if(c(M)){for(E=0,F=u(v);F>E;E++)if(G=ae(v[E]),G&&l(b,G))return G;return new m(!1)}w=a(v,M)}for(H=f?v.next:w.next;!(K=s(H,w)).done;){try{G=ae(K.value)}catch(oe){y(w,"throw",oe)}if(typeof G=="object"&&G&&l(b,G))return G}return new m(!1)}},(r,e,t)=>{var n=t(112),s=t(34),i=t(12),o=n(n.bind);r.exports=function(c,u){return s(c),u===void 0?c:i?o(c,u):function(){return c.apply(u,arguments)}}},(r,e,t)=>{var n=t(18),s=t(17);r.exports=function(i){if(n(i)==="Function")return s(i)}},(r,e,t)=>{var n=t(37),s=t(92),i=n("iterator"),o=Array.prototype;r.exports=function(c){return c!==void 0&&(s.Array===c||o[i]===c)}},(r,e,t)=>{var n=t(11),s=t(34),i=t(50),o=t(35),c=t(115),u=TypeError;r.exports=function(l,a){var h=arguments.length<2?c(l):a;if(s(h))return i(n(h,l));throw u(o(l)+" is not iterable")}},(r,e,t)=>{var n=t(82),s=t(33),i=t(20),o=t(92),c=t(37),u=c("iterator");r.exports=function(l){if(!i(l))return s(l,u)||s(l,"@@iterator")||o[n(l)]}},(r,e,t)=>{var n=t(11),s=t(50),i=t(33);r.exports=function(o,c,u){var l,a;s(o);try{if(l=i(o,"return"),!l){if(c==="throw")throw u;return u}l=n(l,o)}catch(h){a=!0,l=h}if(c==="throw")throw u;if(a)throw l;return s(l),u}},(r,e,t)=>{var n=t(28),s=TypeError;r.exports=function(i,o){if(n(o,i))return i;throw s("Incorrect invocation")}},(r,e,t)=>{var n=t(37),s=n("iterator"),i=!1;try{var o=0,c={next:function(){return{done:!!o++}},return:function(){i=!0}};c[s]=function(){return this},Array.from(c,function(){throw 2})}catch{}r.exports=function(u,l){if(!l&&!i)return!1;var a=!1;try{var h={};h[s]=function(){return{next:function(){return{done:a=!0}}}},u(h)}catch{}return a}},(r,e,t)=>{var n=t(24),s=t(23),i=t(87);r.exports=function(o,c,u){var l,a;return i&&n(l=c.constructor)&&l!==u&&s(a=l.prototype)&&a!==u.prototype&&i(o,a),o}},(r,e,t)=>{var n=t(73),s=t(84),i=t(121),o=t(111),c=t(117),u=t(20),l=t(110),a=t(93),h=t(97),y=t(122),g=t(9),m=t(103).fastKey,b=t(55),v=b.set,S=b.getterFor;r.exports={getConstructor:function(N,k,O,f){var d=N(function(E,F){c(E,p),v(E,{type:k,index:n(null),first:void 0,last:void 0,size:0}),g||(E.size=0),u(F)||l(F,E[f],{that:E,AS_ENTRIES:O})}),p=d.prototype,_=S(k),w=function(E,F,G){var H=_(E),K=M(E,F),Z,ae;return K?K.value=G:(H.last=K={index:ae=m(F,!0),key:F,value:G,previous:Z=H.last,next:void 0,removed:!1},H.first||(H.first=K),Z&&(Z.next=K),g?H.size++:E.size++,ae!=="F"&&(H.index[ae]=K)),E},M=function(E,F){var G=_(E),H=m(F),K;if(H!=="F")return G.index[H];for(K=G.first;K;K=K.next)if(K.key==F)return K};return i(p,{clear:function(){for(var F=this,G=_(F),H=G.index,K=G.first;K;)K.removed=!0,K.previous&&(K.previous=K.previous.next=void 0),delete H[K.index],K=K.next;G.first=G.last=void 0,g?G.size=0:F.size=0},delete:function(E){var F=this,G=_(F),H=M(F,E);if(H){var K=H.next,Z=H.previous;delete G.index[H.index],H.removed=!0,Z&&(Z.next=K),K&&(K.previous=Z),G.first==H&&(G.first=K),G.last==H&&(G.last=Z),g?G.size--:F.size--}return!!H},forEach:function(F){for(var G=_(this),H=o(F,arguments.length>1?arguments[1]:void 0),K;K=K?K.next:G.first;)for(H(K.value,K.key,this);K&&K.removed;)K=K.previous},has:function(F){return!!M(this,F)}}),i(p,O?{get:function(F){var G=M(this,F);return G&&G.value},set:function(F,G){return w(this,F===0?0:F,G)}}:{add:function(F){return w(this,F=F===0?0:F,F)}}),g&&s(p,"size",{configurable:!0,get:function(){return _(this).size}}),d},setStrong:function(N,k,O){var f=k+" Iterator",d=S(k),p=S(f);a(N,k,function(_,w){v(this,{type:f,target:_,state:d(_),kind:w,last:void 0})},function(){for(var _=p(this),w=_.kind,M=_.last;M&&M.removed;)M=M.previous;return!_.target||!(_.last=M=M?M.next:_.state.first)?(_.target=void 0,h(void 0,!0)):w=="keys"?h(M.key,!1):w=="values"?h(M.value,!1):h([M.key,M.value],!1)},O?"entries":"values",!O,!0),y(k)}}},(r,e,t)=>{var n=t(51);r.exports=function(s,i,o){for(var c in i)n(s,c,i[c],o);return s}},(r,e,t)=>{var n=t(27),s=t(84),i=t(37),o=t(9),c=i("species");r.exports=function(u){var l=n(u);o&&l&&!l[c]&&s(l,c,{configurable:!0,get:function(){return this}})}},(r,e,t)=>{t(124)},(r,e,t)=>{var n=t(102),s=t(120);n("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},s)},(r,e,t)=>{var n=t(39),s=t(6),i=t(7),o=t(27),c=t(17),u=t(10),l=t(44),a=t(24),h=t(126),y=t(20),g=t(23),m=t(26),b=t(110),v=t(50),S=t(82),N=t(42),k=t(106),O=t(47),f=t(67),d=t(127),p=t(128),_=t(130),w=t(131),M=t(132),E=t(133),F=i.Object,G=i.Array,H=i.Date,K=i.Error,Z=i.EvalError,ae=i.RangeError,oe=i.ReferenceError,ie=i.SyntaxError,ne=i.TypeError,J=i.URIError,ge=i.PerformanceMark,_e=i.WebAssembly,X=_e&&_e.CompileError||K,P=_e&&_e.LinkError||K,R=_e&&_e.RuntimeError||K,W=o("DOMException"),$=_.Map,V=_.has,ee=_.get,z=_.set,j=w.Set,q=w.add,x=o("Object","keys"),T=c([].push),I=c((!0).valueOf),L=c(1 .valueOf),U=c("".valueOf),Y=c(H.prototype.getTime),ce=l("structuredClone"),le="DataCloneError",fe="Transferring",de=function(Q){return!u(function(){var re=new i.Set([7]),te=Q(re),Se=Q(F(7));return te==re||!te.has(7)||typeof Se!="object"||Se!=7})&&Q},ye=function(Q,re){return!u(function(){var te=new re,Se=Q({a:te,b:te});return!(Se&&Se.a===Se.b&&Se.a instanceof re&&Se.a.stack===te.stack)})},be=function(Q){return!u(function(){var re=Q(new i.AggregateError([1],ce,{cause:3}));return re.name!="AggregateError"||re.errors[0]!=1||re.message!=ce||re.cause!=3})},ve=i.structuredClone,xe=n||!ye(ve,K)||!ye(ve,W)||!be(ve),Oe=!ve&&de(function(Q){return new ge(ce,{detail:Q}).detail}),Pe=de(ve)||Oe,Le=function(Q){throw new W("Uncloneable type: "+Q,le)},se=function(Q,re){throw new W((re||"Cloning")+" of "+Q+" cannot be properly polyfilled in this engine",le)},Te=function(Q,re){return Pe||se(re),Pe(Q)},Ue=function(){var Q;try{Q=new i.DataTransfer}catch{try{Q=new i.ClipboardEvent("").clipboardData}catch{}}return Q&&Q.items&&Q.files?Q:null},Ve=function(Q,re){if(m(Q)&&Le("Symbol"),!g(Q))return Q;if(re){if(V(re,Q))return ee(re,Q)}else re=new $;var te=S(Q),Se=!1,Re,je,Ee,nt,et,ue,Ae,Ie,Ne,De,Fe;switch(te){case"Array":Ee=G(f(Q)),Se=!0;break;case"Object":Ee={},Se=!0;break;case"Map":Ee=new $,Se=!0;break;case"Set":Ee=new j,Se=!0;break;case"RegExp":Ee=new RegExp(Q.source,p(Q));break;case"Error":switch(je=Q.name,je){case"AggregateError":Ee=o("AggregateError")([]);break;case"EvalError":Ee=Z();break;case"RangeError":Ee=ae();break;case"ReferenceError":Ee=oe();break;case"SyntaxError":Ee=ie();break;case"TypeError":Ee=ne();break;case"URIError":Ee=J();break;case"CompileError":Ee=X();break;case"LinkError":Ee=P();break;case"RuntimeError":Ee=R();break;default:Ee=K()}Se=!0;break;case"DOMException":Ee=new W(Q.message,Q.name),Se=!0;break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":Re=i[te],g(Re)||se(te),Ee=new Re(Ve(Q.buffer,re),Q.byteOffset,te==="DataView"?Q.byteLength:Q.length);break;case"DOMQuad":try{Ee=new DOMQuad(Ve(Q.p1,re),Ve(Q.p2,re),Ve(Q.p3,re),Ve(Q.p4,re))}catch{Ee=Te(Q,te)}break;case"File":if(Pe)try{Ee=Pe(Q),S(Ee)!==te&&(Ee=void 0)}catch{}if(!Ee)try{Ee=new File([Q],Q.name,Q)}catch{}Ee||se(te);break;case"FileList":if(nt=Ue(),nt){for(et=0,ue=f(Q);et<ue;et++)nt.items.add(Ve(Q[et],re));Ee=nt.files}else Ee=Te(Q,te);break;case"ImageData":try{Ee=new ImageData(Ve(Q.data,re),Q.width,Q.height,{colorSpace:Q.colorSpace})}catch{Ee=Te(Q,te)}break;default:if(Pe)Ee=Pe(Q);else switch(te){case"BigInt":Ee=F(Q.valueOf());break;case"Boolean":Ee=F(I(Q));break;case"Number":Ee=F(L(Q));break;case"String":Ee=F(U(Q));break;case"Date":Ee=new H(Y(Q));break;case"ArrayBuffer":Re=i.DataView,!Re&&typeof Q.slice!="function"&&se(te);try{if(typeof Q.slice=="function"&&!Q.resizable)Ee=Q.slice(0);else for(ue=Q.byteLength,Fe=("maxByteLength"in Q)?{maxByteLength:Q.maxByteLength}:void 0,Ee=new ArrayBuffer(ue,Fe),Ne=new Re(Q),De=new Re(Ee),et=0;et<ue;et++)De.setUint8(et,Ne.getUint8(et))}catch{throw new W("ArrayBuffer is detached",le)}break;case"SharedArrayBuffer":Ee=Q;break;case"Blob":try{Ee=Q.slice(0,Q.size,Q.type)}catch{se(te)}break;case"DOMPoint":case"DOMPointReadOnly":Re=i[te];try{Ee=Re.fromPoint?Re.fromPoint(Q):new Re(Q.x,Q.y,Q.z,Q.w)}catch{se(te)}break;case"DOMRect":case"DOMRectReadOnly":Re=i[te];try{Ee=Re.fromRect?Re.fromRect(Q):new Re(Q.x,Q.y,Q.width,Q.height)}catch{se(te)}break;case"DOMMatrix":case"DOMMatrixReadOnly":Re=i[te];try{Ee=Re.fromMatrix?Re.fromMatrix(Q):new Re(Q)}catch{se(te)}break;case"AudioData":case"VideoFrame":a(Q.clone)||se(te);try{Ee=Q.clone()}catch{Le(te)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":se(te);default:Le(te)}}if(z(re,Q,Ee),Se)switch(te){case"Array":case"Object":for(Ae=x(Q),et=0,ue=f(Ae);et<ue;et++)Ie=Ae[et],k(Ee,Ie,Ve(Q[Ie],re));break;case"Map":Q.forEach(function(Be,We){z(Ee,Ve(We,re),Ve(Be,re))});break;case"Set":Q.forEach(function(Be){q(Ee,Ve(Be,re))});break;case"Error":O(Ee,"message",Ve(Q.message,re)),N(Q,"cause")&&O(Ee,"cause",Ve(Q.cause,re)),je=="AggregateError"&&(Ee.errors=Ve(Q.errors,re));case"DOMException":M&&O(Ee,"stack",Ve(Q.stack,re))}return Ee},$e=function(Q,re){if(!g(Q))throw ne("Transfer option cannot be converted to a sequence");var te=[];b(Q,function(Ne){T(te,v(Ne))});var Se=0,Re=f(te),je,Ee,nt,et,ue,Ae,Ie;if(E)for(et=ve(te,{transfer:te});Se<Re;)z(re,te[Se],et[Se++]);else for(;Se<Re;){if(je=te[Se++],V(re,je))throw new W("Duplicate transferable",le);switch(Ee=S(je),Ee){case"ImageBitmap":nt=i.OffscreenCanvas,h(nt)||se(Ee,fe);try{Ae=new nt(je.width,je.height),Ie=Ae.getContext("bitmaprenderer"),Ie.transferFromImageBitmap(je),ue=Ae.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!a(je.clone)||!a(je.close))&&se(Ee,fe);try{ue=je.clone(),je.close()}catch{}break;case"ArrayBuffer":a(je.transfer)||se(Ee,fe),ue=je.transfer();break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":se(Ee,fe)}if(ue===void 0)throw new W("This object cannot be transferred: "+Ee,le);z(re,je,ue)}};s({global:!0,enumerable:!0,sham:!E,forced:xe},{structuredClone:function(re){var te=d(arguments.length,1)>1&&!y(arguments[1])?v(arguments[1]):void 0,Se=te?te.transfer:void 0,Re;return Se!==void 0&&(Re=new $,$e(Se,Re)),Ve(re,Re)}})},(r,e,t)=>{var n=t(17),s=t(10),i=t(24),o=t(82),c=t(27),u=t(54),l=function(){},a=[],h=c("Reflect","construct"),y=/^\s*(?:class|function)\b/,g=n(y.exec),m=!y.exec(l),b=function(N){if(!i(N))return!1;try{return h(l,a,N),!0}catch{return!1}},v=function(N){if(!i(N))return!1;switch(o(N)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return m||!!g(y,u(N))}catch{return!0}};v.sham=!0,r.exports=!h||s(function(){var S;return b(b.call)||!b(Object)||!b(function(){S=!0})||S})?v:b},r=>{var e=TypeError;r.exports=function(t,n){if(t<n)throw e("Not enough arguments");return t}},(r,e,t)=>{var n=t(11),s=t(42),i=t(28),o=t(129),c=RegExp.prototype;r.exports=function(u){var l=u.flags;return l===void 0&&!("flags"in c)&&!s(u,"flags")&&i(c,u)?n(o,u):l}},(r,e,t)=>{var n=t(50);r.exports=function(){var s=n(this),i="";return s.hasIndices&&(i+="d"),s.global&&(i+="g"),s.ignoreCase&&(i+="i"),s.multiline&&(i+="m"),s.dotAll&&(i+="s"),s.unicode&&(i+="u"),s.unicodeSets&&(i+="v"),s.sticky&&(i+="y"),i}},(r,e,t)=>{var n=t(17),s=Map.prototype;r.exports={Map,set:n(s.set),get:n(s.get),has:n(s.has),remove:n(s.delete),proto:s}},(r,e,t)=>{var n=t(17),s=Set.prototype;r.exports={Set,add:n(s.add),has:n(s.has),remove:n(s.delete),proto:s}},(r,e,t)=>{var n=t(10),s=t(14);r.exports=!n(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",s(1,7)),i.stack!==7):!0})},(r,e,t)=>{var n=t(7),s=t(10),i=t(31),o=t(134),c=t(135),u=t(136),l=n.structuredClone;r.exports=!!l&&!s(function(){if(c&&i>92||u&&i>94||o&&i>97)return!1;var a=new ArrayBuffer(8),h=l(a,{transfer:[a]});return a.byteLength!=0||h.byteLength!=8})},(r,e,t)=>{var n=t(135),s=t(136);r.exports=!n&&!s&&typeof window=="object"&&typeof document=="object"},r=>{r.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(r,e,t)=>{var n=t(18);r.exports=typeof process<"u"&&n(process)=="process"},(r,e,t)=>{var n=t(7);r.exports=n},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,t,n,s,Tt,o,kt,u,l,a,h,y,g,m,Bt,v,S,Vt,k,O;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(139),_display_utils=__w_pdfjs_require__(142),_font_loader=__w_pdfjs_require__(145),_canvas=__w_pdfjs_require__(146),_worker_options=__w_pdfjs_require__(149),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(150),_metadata=__w_pdfjs_require__(151),_optional_content_config=__w_pdfjs_require__(152),_transport_stream=__w_pdfjs_require__(153),_xfa_text=__w_pdfjs_require__(154);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultFilterFactory=_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:d,NodeCMapReaderFactory:p,NodeFilterFactory:_,NodeStandardFontDataFactory:w}=__w_pdfjs_require__(155);exports.DefaultCanvasFactory=DefaultCanvasFactory=d,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=p,exports.DefaultFilterFactory=DefaultFilterFactory=_,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=w}let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:d}=__w_pdfjs_require__(156);createPDFNetworkStream=p=>new d(p)}else{const{PDFNetworkStream:d}=__w_pdfjs_require__(159),{PDFFetchStream:p}=__w_pdfjs_require__(160);createPDFNetworkStream=_=>(0,_display_utils.isValidFetchUrl)(_.url)?new p(_):new d(_)}function getDocument(d){if(typeof d=="string"||d instanceof URL?d={url:d}:(0,_util.isArrayBuffer)(d)&&(d={data:d}),typeof d!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!d.url&&!d.data&&!d.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const p=new PDFDocumentLoadingTask,{docId:_}=p,w=d.url?getUrlProp(d.url):null,M=d.data?getDataProp(d.data):null,E=d.httpHeaders||null,F=d.withCredentials===!0,G=d.password??null,H=d.range instanceof PDFDataRangeTransport?d.range:null,K=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Z=d.worker instanceof PDFWorker?d.worker:null;const ae=d.verbosity,oe=typeof d.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(d.docBaseUrl)?d.docBaseUrl:null,ie=typeof d.cMapUrl=="string"?d.cMapUrl:null,ne=d.cMapPacked!==!1,J=d.CMapReaderFactory||DefaultCMapReaderFactory,ge=typeof d.standardFontDataUrl=="string"?d.standardFontDataUrl:null,_e=d.StandardFontDataFactory||DefaultStandardFontDataFactory,X=d.stopAtErrors!==!0,P=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,R=d.isEvalSupported!==!1,W=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!_is_node.isNodeJS,$=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,V=typeof d.disableFontFace=="boolean"?d.disableFontFace:_is_node.isNodeJS,ee=d.fontExtraProperties===!0,z=d.enableXfa===!0,j=d.ownerDocument||globalThis.document,q=d.disableRange===!0,x=d.disableStream===!0,T=d.disableAutoFetch===!0,I=d.pdfBug===!0,L=H?H.length:d.length??NaN,U=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!_is_node.isNodeJS&&!V,Y=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:J===_display_utils.DOMCMapReaderFactory&&_e===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(ie,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(ge,document.baseURI),ce=d.canvasFactory||new DefaultCanvasFactory({ownerDocument:j}),le=d.filterFactory||new DefaultFilterFactory({docId:_,ownerDocument:j}),fe=null;(0,_util.setVerbosityLevel)(ae);const de={canvasFactory:ce,filterFactory:le};if(Y||(de.cMapReaderFactory=new J({baseUrl:ie,isCompressed:ne}),de.standardFontDataFactory=new _e({baseUrl:ge})),!Z){const ve={verbosity:ae,port:_worker_options.GlobalWorkerOptions.workerPort};Z=ve.port?PDFWorker.fromPort(ve):new PDFWorker(ve),p._worker=Z}const ye={docId:_,apiVersion:"3.7.107",data:M,password:G,disableAutoFetch:T,rangeChunkSize:K,length:L,docBaseUrl:oe,enableXfa:z,evaluatorOptions:{maxImageSize:P,disableFontFace:V,ignoreErrors:X,isEvalSupported:R,isOffscreenCanvasSupported:W,canvasMaxAreaInBytes:$,fontExtraProperties:ee,useSystemFonts:U,cMapUrl:Y?ie:null,standardFontDataUrl:Y?ge:null}},be={ignoreErrors:X,isEvalSupported:R,disableFontFace:V,fontExtraProperties:ee,enableXfa:z,ownerDocument:j,disableAutoFetch:T,pdfBug:I,styleElement:fe};return Z.promise.then(function(){if(p.destroyed)throw new Error("Loading aborted");const ve=_fetchDocument(Z,ye),xe=new Promise(function(Oe){let Pe;H?Pe=new _transport_stream.PDFDataTransportStream({length:L,initialData:H.initialData,progressiveDone:H.progressiveDone,contentDispositionFilename:H.contentDispositionFilename,disableRange:q,disableStream:x},H):M||(Pe=createPDFNetworkStream({url:w,length:L,httpHeaders:E,withCredentials:F,rangeChunkSize:K,disableRange:q,disableStream:x})),Oe(Pe)});return Promise.all([ve,xe]).then(function(Oe){let[Pe,Le]=Oe;if(p.destroyed)throw new Error("Loading aborted");const se=new _message_handler.MessageHandler(_,Pe,Z.port),Te=new WorkerTransport(se,p,Le,be,de);p._transport=Te,se.send("Ready",null)})}).catch(p._capability.reject),p}async function _fetchDocument(d,p){if(d.destroyed)throw new Error("Worker was destroyed");const _=await d.messageHandler.sendWithPromise("GetDocRequest",p,p.data?[p.data.buffer]:null);if(d.destroyed)throw new Error("Worker was destroyed");return _}function getUrlProp(d){if(d instanceof URL)return d.href;try{return new URL(d,window.location).href}catch{if(_is_node.isNodeJS&&typeof d=="string")return d}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(d){if(_is_node.isNodeJS&&typeof Buffer<"u"&&d instanceof Buffer)return(0,_display_utils.deprecated)("Please provide binary data as `Uint8Array`, rather than `Buffer`."),new Uint8Array(d);if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return(0,_util.stringToBytes)(d);if(typeof d=="object"&&!isNaN(d==null?void 0:d.length)||(0,_util.isArrayBuffer)(d))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const e=class{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Ot(e,r)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var p;this.destroyed=!0,await((p=this._transport)===null||p===void 0?void 0:p.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};let PDFDocumentLoadingTask=e;r=new WeakMap,he(PDFDocumentLoadingTask,r,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(p,_){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=p,this.initialData=_,this.progressiveDone=w,this.contentDispositionFilename=M,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(p){this._rangeListeners.push(p)}addProgressListener(p){this._progressListeners.push(p)}addProgressiveReadListener(p){this._progressiveReadListeners.push(p)}addProgressiveDoneListener(p){this._progressiveDoneListeners.push(p)}onDataRange(p,_){for(const w of this._rangeListeners)w(p,_)}onDataProgress(p,_){this._readyCapability.promise.then(()=>{for(const w of this._progressListeners)w(p,_)})}onDataProgressiveRead(p){this._readyCapability.promise.then(()=>{for(const _ of this._progressiveReadListeners)_(p)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const p of this._progressiveDoneListeners)p()})}transportReady(){this._readyCapability.resolve()}requestDataRange(p,_){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(p,_){this._pdfInfo=p,this._transport=_}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(p){return this._transport.getPage(p)}getPageIndex(p){return this._transport.getPageIndex(p)}getDestinations(){return this._transport.getDestinations()}getDestination(p){return this._transport.getDestination(p)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(p||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(p,_,w){he(this,s);he(this,o);he(this,t,null);he(this,n,!1);let M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this._pageIndex=p,this._pageInfo=_,this._transport=w,this._stats=M?new _display_utils.StatTimer:null,this._pdfBug=M,this.commonObjs=w.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:p,rotation:_=this.rotate,offsetX:w=0,offsetY:M=0,dontFlip:E=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:p,rotation:_,offsetX:w,offsetY:M,dontFlip:E})}getAnnotations(){let{intent:p="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const _=this._transport.getRenderingIntent(p);return this._transport.getAnnotations(this._pageIndex,_.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var p;return((p=this._transport._htmlForXfa)===null||p===void 0?void 0:p.children[this._pageIndex])||null}render(p){var _,w;let{canvasContext:M,viewport:E,intent:F="display",annotationMode:G=_util.AnnotationMode.ENABLE,transform:H=null,background:K=null,optionalContentConfigPromise:Z=null,annotationCanvasMap:ae=null,pageColors:oe=null,printAnnotationStorage:ie=null}=p;if((_=arguments[0])!==null&&_!==void 0&&_.canvasFactory)throw new Error("render no longer accepts the `canvasFactory`-option, please pass it to the `getDocument`-function instead.");(w=this._stats)===null||w===void 0||w.time("Overall");const ne=this._transport.getRenderingIntent(F,G,ie);Ce(this,n,!1),me(this,o,kt).call(this),Z||(Z=this._transport.getOptionalContentConfig());let J=this._intentStates.get(ne.cacheKey);J||(J=Object.create(null),this._intentStates.set(ne.cacheKey,J)),J.streamReaderCancelTimeout&&(clearTimeout(J.streamReaderCancelTimeout),J.streamReaderCancelTimeout=null);const ge=!!(ne.renderingIntent&_util.RenderingIntentFlag.PRINT);if(!J.displayReadyCapability){var _e;J.displayReadyCapability=new _util.PromiseCapability,J.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(_e=this._stats)===null||_e===void 0||_e.time("Page Request"),this._pumpOperatorList(ne)}const X=W=>{var $,V;J.renderTasks.delete(P),(this._maybeCleanupAfterRender||ge)&&Ce(this,n,!0),me(this,s,Tt).call(this,!ge),W?(P.capability.reject(W),this._abortOperatorList({intentState:J,reason:W instanceof Error?W:new Error(W)})):P.capability.resolve(),($=this._stats)===null||$===void 0||$.timeEnd("Rendering"),(V=this._stats)===null||V===void 0||V.timeEnd("Overall")},P=new InternalRenderTask({callback:X,params:{canvasContext:M,viewport:E,transform:H,background:K},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:ae,operatorList:J.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!ge,pdfBug:this._pdfBug,pageColors:oe});(J.renderTasks||(J.renderTasks=new Set)).add(P);const R=P.task;return Promise.all([J.displayReadyCapability.promise,Z]).then(W=>{var $;let[V,ee]=W;if(D(this,n)){X();return}($=this._stats)===null||$===void 0||$.time("Rendering"),P.initializeGraphics({transparency:V,optionalContentConfig:ee}),P.operatorListChanged()}).catch(X),R}getOperatorList(){let{intent:p="display",annotationMode:_=_util.AnnotationMode.ENABLE,printAnnotationStorage:w=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function M(){F.operatorList.lastChunk&&(F.opListReadCapability.resolve(F.operatorList),F.renderTasks.delete(G))}const E=this._transport.getRenderingIntent(p,_,w,!0);let F=this._intentStates.get(E.cacheKey);F||(F=Object.create(null),this._intentStates.set(E.cacheKey,F));let G;if(!F.opListReadCapability){var H;G=Object.create(null),G.operatorListChanged=M,F.opListReadCapability=new _util.PromiseCapability,(F.renderTasks||(F.renderTasks=new Set)).add(G),F.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(H=this._stats)===null||H===void 0||H.time("Page Request"),this._pumpOperatorList(E)}return F.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:p=!1,disableNormalization:_=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const w=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:p===!0,disableNormalization:_===!0},{highWaterMark:w,size(M){return M.items.length}})}getTextContent(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(w=>_xfa_text.XfaText.textContent(w));const _=this.streamTextContent(p);return new Promise(function(w,M){function E(){F.read().then(function(H){let{value:K,done:Z}=H;if(Z){w(G);return}Object.assign(G.styles,K.styles),G.items.push(...K.items),E()},M)}const F=_.getReader(),G={items:[],styles:Object.create(null)};E()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const p=[];for(const _ of this._intentStates.values())if(this._abortOperatorList({intentState:_,reason:new Error("Page was destroyed."),force:!0}),!_.opListReadCapability)for(const w of _.renderTasks)p.push(w.completed),w.cancel();return this.objs.clear(),Ce(this,n,!1),me(this,o,kt).call(this),Promise.all(p)}cleanup(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;Ce(this,n,!0);const _=me(this,s,Tt).call(this,!1);return p&&_&&this._stats&&(this._stats=new _display_utils.StatTimer),_}_startRenderPage(p,_){var w,M;const E=this._intentStates.get(_);E&&((w=this._stats)===null||w===void 0||w.timeEnd("Page Request"),(M=E.displayReadyCapability)===null||M===void 0||M.resolve(p))}_renderPageChunk(p,_){for(let w=0,M=p.length;w<M;w++)_.operatorList.fnArray.push(p.fnArray[w]),_.operatorList.argsArray.push(p.argsArray[w]);_.operatorList.lastChunk=p.lastChunk,_.operatorList.separateAnnots=p.separateAnnots;for(const w of _.renderTasks)w.operatorListChanged();p.lastChunk&&me(this,s,Tt).call(this,!0)}_pumpOperatorList(p){let{renderingIntent:_,cacheKey:w,annotationStorageMap:M}=p;const F=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:_,cacheKey:w,annotationStorage:M}).getReader(),G=this._intentStates.get(w);G.streamReader=F;const H=()=>{F.read().then(K=>{let{value:Z,done:ae}=K;if(ae){G.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Z,G),H())},K=>{if(G.streamReader=null,!this._transport.destroyed){if(G.operatorList){G.operatorList.lastChunk=!0;for(const Z of G.renderTasks)Z.operatorListChanged();me(this,s,Tt).call(this,!0)}if(G.displayReadyCapability)G.displayReadyCapability.reject(K);else if(G.opListReadCapability)G.opListReadCapability.reject(K);else throw K}})};H()}_abortOperatorList(p){let{intentState:_,reason:w,force:M=!1}=p;if(_.streamReader){if(_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null),!M){if(_.renderTasks.size>0)return;if(w instanceof _display_utils.RenderingCancelledException){let E=RENDERING_CANCELLED_TIMEOUT;w.extraDelay>0&&w.extraDelay<1e3&&(E+=w.extraDelay),_.streamReaderCancelTimeout=setTimeout(()=>{_.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:_,reason:w,force:!0})},E);return}}if(_.streamReader.cancel(new _util.AbortException(w.message)).catch(()=>{}),_.streamReader=null,!this._transport.destroyed){for(const[E,F]of this._intentStates)if(F===_){this._intentStates.delete(E);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,n=new WeakMap,s=new WeakSet,Tt=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(me(this,o,kt).call(this),!D(this,n))return!1;if(p)return Ce(this,t,setTimeout(()=>{Ce(this,t,null),me(this,s,Tt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:_,operatorList:w}of this._intentStates.values())if(_.size>0||!w.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Ce(this,n,!1),!0},o=new WeakSet,kt=function(){D(this,t)&&(clearTimeout(D(this,t)),Ce(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){he(this,u,new Set);he(this,l,Promise.resolve())}postMessage(p,_){const w={data:structuredClone(p,null)};D(this,l).then(()=>{for(const M of D(this,u))M.call(this,w)})}addEventListener(p,_){D(this,u).add(_)}removeEventListener(p,_){D(this,u).delete(_)}terminate(){D(this,u).clear()}}u=new WeakMap,l=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){var _document,_document$currentScri;const d=(_document=document)===null||_document===void 0||(_document$currentScri=_document.currentScript)===null||_document$currentScri===void 0?void 0:_document$currentScri.src;d&&(PDFWorkerUtil.fallbackWorkerSrc=d.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(d,p){let _;try{if(_=new URL(d),!_.origin||_.origin==="null")return!1}catch{return!1}const w=new URL(p,_);return _.origin===w.origin},PDFWorkerUtil.createCDNWrapper=function(d){const p=`importScripts("${d}");`;return URL.createObjectURL(new Blob([p]))}}const _PDFWorker=class{constructor(){let{name:d=null,port:p=null,verbosity:_=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(p&&D(_PDFWorker,a).has(p))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=d,this.destroyed=!1,this.verbosity=_,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,p){D(_PDFWorker,a).set(p,this),this._initializeFromPort(p);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(d){this._port=d,this._messageHandler=new _message_handler.MessageHandler("main","worker",d),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:d}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,d)||(d=PDFWorkerUtil.createCDNWrapper(new URL(d,window.location).href));const p=new Worker(d),_=new _message_handler.MessageHandler("main","worker",p),w=()=>{p.removeEventListener("error",M),_.destroy(),p.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},M=()=>{this._webWorker||w()};p.addEventListener("error",M),_.on("test",F=>{if(p.removeEventListener("error",M),this.destroyed){w();return}F?(this._messageHandler=_,this._port=p,this._webWorker=p,this._readyCapability.resolve(),_.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),_.destroy(),p.terminate())}),_.on("ready",F=>{if(p.removeEventListener("error",M),this.destroyed){w();return}try{E()}catch{this._setupFakeWorker()}});const E=()=>{const F=new Uint8Array;_.send("test",F,[F.buffer])};E();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(d=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const p=new LoopbackPort;this._port=p;const _=`fake${PDFWorkerUtil.fakeWorkerId++}`,w=new _message_handler.MessageHandler(_+"_worker",_,p);d.setup(w,p);const M=new _message_handler.MessageHandler(_,_+"_worker",p);this._messageHandler=M,this._readyCapability.resolve(),M.send("configure",{verbosity:this.verbosity})}).catch(d=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${d.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),D(_PDFWorker,a).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(d){if(!(d!=null&&d.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return D(this,a).has(d.port)?D(this,a).get(d.port):new _PDFWorker(d)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{var d;return((d=globalThis.pdfjsWorker)===null||d===void 0?void 0:d.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};let PDFWorker=_PDFWorker;a=new WeakMap,he(PDFWorker,a,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(p,_,w,M,E){he(this,m);he(this,h,new Map);he(this,y,new Map);he(this,g,new Map);this.messageHandler=p,this.loadingTask=_,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:M.ownerDocument,styleElement:M.styleElement}),this._params=M,this.canvasFactory=E.canvasFactory,this.filterFactory=E.filterFactory,this.cMapReaderFactory=E.cMapReaderFactory,this.standardFontDataFactory=E.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=w,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,E=_util.RenderingIntentFlag.DISPLAY,F=null;switch(p){case"any":E=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":E=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${p}`)}switch(_){case _util.AnnotationMode.DISABLE:E+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:E+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:E+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,F=(E&_util.RenderingIntentFlag.PRINT&&w instanceof _annotation_storage.PrintAnnotationStorage?w:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${_}`)}return M&&(E+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:E,cacheKey:`${E}_${_annotation_storage.AnnotationStorage.getHash(F)}`,annotationStorageMap:F}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const p=[];for(const w of D(this,y).values())p.push(w._destroy());D(this,y).clear(),D(this,g).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const _=this.messageHandler.sendWithPromise("Terminate",null);return p.push(_),Promise.all(p).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),D(this,h).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:p,loadingTask:_}=this;p.on("GetReader",(w,M)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=E=>{this._lastProgress={loaded:E.loaded,total:E.total}},M.onPull=()=>{this._fullReader.read().then(function(E){let{value:F,done:G}=E;if(G){M.close();return}(0,_util.assert)(F instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),M.enqueue(new Uint8Array(F),1,[F])}).catch(E=>{M.error(E)})},M.onCancel=E=>{this._fullReader.cancel(E),M.ready.catch(F=>{if(!this.destroyed)throw F})}}),p.on("ReaderHeadersReady",w=>{const M=new _util.PromiseCapability,E=this._fullReader;return E.headersReady.then(()=>{if(!E.isStreamingSupported||!E.isRangeSupported){if(this._lastProgress){var F;(F=_.onProgress)===null||F===void 0||F.call(_,this._lastProgress)}E.onProgress=G=>{var H;(H=_.onProgress)===null||H===void 0||H.call(_,{loaded:G.loaded,total:G.total})}}M.resolve({isStreamingSupported:E.isStreamingSupported,isRangeSupported:E.isRangeSupported,contentLength:E.contentLength})},M.reject),M.promise}),p.on("GetRangeReader",(w,M)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const E=this._networkStream.getRangeReader(w.begin,w.end);if(!E){M.close();return}M.onPull=()=>{E.read().then(function(F){let{value:G,done:H}=F;if(H){M.close();return}(0,_util.assert)(G instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),M.enqueue(new Uint8Array(G),1,[G])}).catch(F=>{M.error(F)})},M.onCancel=F=>{E.cancel(F),M.ready.catch(G=>{if(!this.destroyed)throw G})}}),p.on("GetDoc",w=>{let{pdfInfo:M}=w;this._numPages=M.numPages,this._htmlForXfa=M.htmlForXfa,delete M.htmlForXfa,_._capability.resolve(new PDFDocumentProxy(M,this))}),p.on("DocException",function(w){let M;switch(w.name){case"PasswordException":M=new _util.PasswordException(w.message,w.code);break;case"InvalidPDFException":M=new _util.InvalidPDFException(w.message);break;case"MissingPDFException":M=new _util.MissingPDFException(w.message);break;case"UnexpectedResponseException":M=new _util.UnexpectedResponseException(w.message,w.status);break;case"UnknownErrorException":M=new _util.UnknownErrorException(w.message,w.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}_._capability.reject(M)}),p.on("PasswordRequest",w=>{if(this._passwordCapability=new _util.PromiseCapability,_.onPassword){const M=E=>{E instanceof Error?this._passwordCapability.reject(E):this._passwordCapability.resolve({password:E})};try{_.onPassword(M,w.code)}catch(E){this._passwordCapability.reject(E)}}else this._passwordCapability.reject(new _util.PasswordException(w.message,w.code));return this._passwordCapability.promise}),p.on("DataLoaded",w=>{var M;(M=_.onProgress)===null||M===void 0||M.call(_,{loaded:w.length,total:w.length}),this.downloadInfoCapability.resolve(w)}),p.on("StartRenderPage",w=>{if(this.destroyed)return;D(this,y).get(w.pageIndex)._startRenderPage(w.transparency,w.cacheKey)}),p.on("commonobj",w=>{var M;let[E,F,G]=w;if(!this.destroyed&&!this.commonObjs.has(E))switch(F){case"Font":const H=this._params;if("error"in G){const ae=G.error;(0,_util.warn)(`Error during font loading: ${ae}`),this.commonObjs.resolve(E,ae);break}const K=H.pdfBug&&(M=globalThis.FontInspector)!==null&&M!==void 0&&M.enabled?(ae,oe)=>globalThis.FontInspector.fontAdded(ae,oe):null,Z=new _font_loader.FontFaceObject(G,{isEvalSupported:H.isEvalSupported,disableFontFace:H.disableFontFace,ignoreErrors:H.ignoreErrors,inspectFont:K});this.fontLoader.bind(Z).catch(ae=>p.sendWithPromise("FontFallback",{id:E})).finally(()=>{!H.fontExtraProperties&&Z.data&&(Z.data=null),this.commonObjs.resolve(E,Z)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(E,G);break;default:throw new Error(`Got unknown common object type ${F}`)}}),p.on("obj",w=>{let[M,E,F,G]=w;if(this.destroyed)return;const H=D(this,y).get(E);if(!H.objs.has(M))switch(F){case"Image":if(H.objs.resolve(M,G),G){let Z;if(G.bitmap){const{width:ae,height:oe}=G;Z=ae*oe*4}else{var K;Z=((K=G.data)===null||K===void 0?void 0:K.length)||0}Z>_util.MAX_IMAGE_SIZE_TO_CACHE&&(H._maybeCleanupAfterRender=!0)}break;case"Pattern":H.objs.resolve(M,G);break;default:throw new Error(`Got unknown object type ${F}`)}}),p.on("DocProgress",w=>{var M;this.destroyed||(M=_.onProgress)===null||M===void 0||M.call(_,{loaded:w.loaded,total:w.total})}),p.on("FetchBuiltInCMap",w=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(w):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),p.on("FetchStandardFontData",w=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(w):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var p;return this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:((p=this._fullReader)===null||p===void 0?void 0:p.filename)??null}).finally(()=>{this.annotationStorage.resetModified()})}getPage(p){if(!Number.isInteger(p)||p<=0||p>this._numPages)return Promise.reject(new Error("Invalid page request."));const _=p-1,w=D(this,g).get(_);if(w)return w;const M=this.messageHandler.sendWithPromise("GetPage",{pageIndex:_}).then(E=>{if(this.destroyed)throw new Error("Transport destroyed");const F=new PDFPageProxy(_,E,this,this._params.pdfBug);return D(this,y).set(_,F),F});return D(this,g).set(_,M),M}getPageIndex(p){return typeof p!="object"||p===null||!Number.isInteger(p.num)||p.num<0||!Number.isInteger(p.gen)||p.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:p.num,gen:p.gen})}getAnnotations(p,_){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:p,intent:_})}getFieldObjects(){return me(this,m,Bt).call(this,"GetFieldObjects")}hasJSActions(){return me(this,m,Bt).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(p){return typeof p!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:p})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(p){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:p})}getStructTree(p){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:p})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(p=>new _optional_content_config.OptionalContentConfig(p))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const p="GetMetadata",_=D(this,h).get(p);if(_)return _;const w=this.messageHandler.sendWithPromise(p,null).then(M=>{var E,F;return{info:M[0],metadata:M[1]?new _metadata.Metadata(M[1]):null,contentDispositionFilename:((E=this._fullReader)===null||E===void 0?void 0:E.filename)??null,contentLength:((F=this._fullReader)===null||F===void 0?void 0:F.contentLength)??null}});return D(this,h).set(p,w),w}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const _ of D(this,y).values())if(!_.cleanup())throw new Error(`startCleanup: Page ${_.pageNumber} is currently rendering.`);this.commonObjs.clear(),p||this.fontLoader.clear(),D(this,h).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:p,enableXfa:_}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:p,enableXfa:_})}}h=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakSet,Bt=function(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const w=D(this,h).get(p);if(w)return w;const M=this.messageHandler.sendWithPromise(p,_);return D(this,h).set(p,M),M};class PDFObjects{constructor(){he(this,S);he(this,v,Object.create(null))}get(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(_){const M=me(this,S,Vt).call(this,p);return M.capability.promise.then(()=>_(M.data)),null}const w=D(this,v)[p];if(!(w!=null&&w.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${p}.`);return w.data}has(p){const _=D(this,v)[p];return(_==null?void 0:_.capability.settled)||!1}resolve(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const w=me(this,S,Vt).call(this,p);w.data=_,w.capability.resolve()}clear(){for(const _ in D(this,v)){var p;const{data:w}=D(this,v)[_];w==null||(p=w.bitmap)===null||p===void 0||p.close()}Ce(this,v,Object.create(null))}}v=new WeakMap,S=new WeakSet,Vt=function(p){const _=D(this,v)[p];return _||(D(this,v)[p]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(p){he(this,k,null);Ce(this,k,p),this.onContinue=null}get promise(){return D(this,k).capability.promise}cancel(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;D(this,k).cancel(null,p)}get separateAnnots(){const{separateAnnots:p}=D(this,k).operatorList;if(!p)return!1;const{annotationCanvasMap:_}=D(this,k);return p.form||p.canvas&&(_==null?void 0:_.size)>0}}k=new WeakMap,exports.RenderTask=RenderTask;const f=class{constructor(p){let{callback:_,params:w,objs:M,commonObjs:E,annotationCanvasMap:F,operatorList:G,pageIndex:H,canvasFactory:K,filterFactory:Z,useRequestAnimationFrame:ae=!1,pdfBug:oe=!1,pageColors:ie=null}=p;this.callback=_,this.params=w,this.objs=M,this.commonObjs=E,this.annotationCanvasMap=F,this.operatorListIdx=null,this.operatorList=G,this._pageIndex=H,this.canvasFactory=K,this.filterFactory=Z,this._pdfBug=oe,this.pageColors=ie,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=ae===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=w.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(p){var _,w;let{transparency:M=!1,optionalContentConfig:E}=p;if(this.cancelled)return;if(this._canvas){if(D(f,O).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");D(f,O).add(this._canvas)}this._pdfBug&&(_=globalThis.StepperManager)!==null&&_!==void 0&&_.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:F,viewport:G,transform:H,background:K}=this.params;this.gfx=new _canvas.CanvasGraphics(F,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:E},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:H,viewport:G,transparency:M,background:K}),this.operatorListIdx=0,this.graphicsReady=!0,(w=this.graphicsReadyCallback)===null||w===void 0||w.call(this)}cancel(){var p;let _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.running=!1,this.cancelled=!0,(p=this.gfx)===null||p===void 0||p.endDrawing(),this._canvas&&D(f,O).delete(this._canvas),this.callback(_||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas",w))}operatorListChanged(){var p;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(p=this.stepper)===null||p===void 0||p.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&D(f,O).delete(this._canvas),this.callback())))}};let InternalRenderTask=f;O=new WeakMap,he(InternalRenderTask,O,new WeakSet);const version="3.7.107";exports.version=version;const build="036f855dc";exports.build=build},(r,e,t)=>{var u,l,a,ln,y;Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var n=t(1),s=t(140),i=t(144);class o{constructor(){he(this,a);he(this,u,!1);he(this,l,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(m,b){const v=D(this,l).get(m);return v===void 0?b:Object.assign(b,v)}getRawValue(m){return D(this,l).get(m)}remove(m){if(D(this,l).delete(m),D(this,l).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const b of D(this,l).values())if(b instanceof s.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(m,b){const v=D(this,l).get(m);let S=!1;if(v!==void 0)for(const[N,k]of Object.entries(b))v[N]!==k&&(S=!0,v[N]=k);else S=!0,D(this,l).set(m,b);S&&me(this,a,ln).call(this),b instanceof s.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(b.constructor._type)}has(m){return D(this,l).has(m)}getAll(){return D(this,l).size>0?(0,n.objectFromMap)(D(this,l)):null}setAll(m){for(const[b,v]of Object.entries(m))this.setValue(b,v)}get size(){return D(this,l).size}resetModified(){D(this,u)&&(Ce(this,u,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new c(this)}get serializable(){if(D(this,l).size===0)return null;const m=new Map;for(const[b,v]of D(this,l)){const S=v instanceof s.AnnotationEditor?v.serialize():v;S&&m.set(b,S)}return m}static getHash(m){if(!m)return"";const b=new i.MurmurHash3_64;for(const[v,S]of m)b.update(`${v}:${JSON.stringify(S)}`);return b.hexdigest()}}u=new WeakMap,l=new WeakMap,a=new WeakSet,ln=function(){D(this,u)||(Ce(this,u,!0),typeof this.onSetModified=="function"&&this.onSetModified())},e.AnnotationStorage=o;class c extends o{constructor(b){super();he(this,y,null);Ce(this,y,structuredClone(b.serializable))}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return D(this,y)}}y=new WeakMap,e.PrintAnnotationStorage=c},(r,e,t)=>{var o,c,u,l,a,h;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var n=t(141),s=t(1);const y=class{constructor(m){he(this,o,this.focusin.bind(this));he(this,c,this.focusout.bind(this));he(this,u,!1);he(this,l,!1);he(this,a,!1);Ke(this,"_uiManager",null);he(this,h,y._zIndex++);this.constructor===y&&(0,s.unreachable)("Cannot initialize AnnotationEditor."),this.parent=m.parent,this.id=m.id,this.width=this.height=null,this.pageIndex=m.parent.pageIndex,this.name=m.name,this.div=null,this._uiManager=m.uiManager;const{rotation:b,rawDims:{pageWidth:v,pageHeight:S,pageX:N,pageY:k}}=this.parent.viewport;this.rotation=b,this.pageRotation=(360+b-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[v,S],this.pageTranslation=[N,k];const[O,f]=this.parentDimensions;this.x=m.x/O,this.y=m.y/f,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,s.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}addCommands(m){this._uiManager.addCommands(m)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=D(this,h)}setParent(m){m!==null&&(this.pageIndex=m.pageIndex,this.pageDimensions=m.pageDimensions),this.parent=m}focusin(m){D(this,u)?Ce(this,u,!1):this.parent.setSelected(this)}focusout(m){var b;if(!this.isAttachedToDOM)return;const v=m.relatedTarget;v!=null&&v.closest(`#${this.id}`)||(m.preventDefault(),(b=this.parent)!==null&&b!==void 0&&b.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(m){const b=this.parent.div.getBoundingClientRect();this.startX=m.clientX-b.x,this.startY=m.clientY-b.y,m.dataTransfer.setData("text/plain",this.id),m.dataTransfer.effectAllowed="move"}setAt(m,b,v,S){const[N,k]=this.parentDimensions;[v,S]=this.screenToPageTranslation(v,S),this.x=(m+v)/N,this.y=(b+S)/k,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(m,b){const[v,S]=this.parentDimensions;[m,b]=this.screenToPageTranslation(m,b),this.x+=m/v,this.y+=b/S,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(m,b){switch(this.parentRotation){case 90:return[b,-m];case 180:return[-m,-b];case 270:return[-b,m];default:return[m,b]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:m}=this._uiManager.viewParameters,[b,v]=this.pageDimensions;return[b*m,v*m]}setDims(m,b){const[v,S]=this.parentDimensions;this.div.style.width=`${100*m/v}%`,this.div.style.height=`${100*b/S}%`}fixDims(){const{style:m}=this.div,{height:b,width:v}=m,S=v.endsWith("%"),N=b.endsWith("%");if(S&&N)return;const[k,O]=this.parentDimensions;S||(m.width=`${100*parseFloat(v)/k}%`),N||(m.height=`${100*parseFloat(b)/O}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",D(this,o)),this.div.addEventListener("focusout",D(this,c));const[m,b]=this.getInitialTranslation();return this.translate(m,b),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(m){const{isMac:b}=s.FeatureTest.platform;if(m.button!==0||m.ctrlKey&&b){m.preventDefault();return}m.ctrlKey&&!b||m.shiftKey||m.metaKey&&b?this.parent.toggleSelected(this):this.parent.setSelected(this),Ce(this,u,!0)}getRect(m,b){const v=this.parentScale,[S,N]=this.pageDimensions,[k,O]=this.pageTranslation,f=m/v,d=b/v,p=this.x*S,_=this.y*N,w=this.width*S,M=this.height*N;switch(this.rotation){case 0:return[p+f+k,N-_-d-M+O,p+f+w+k,N-_-d+O];case 90:return[p+d+k,N-_+f+O,p+d+M+k,N-_+f+w+O];case 180:return[p-f-w+k,N-_+d+O,p-f+k,N-_+d+M+O];case 270:return[p-d-M+k,N-_-f-w+O,p-d+k,N-_-f+O];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(m,b){const[v,S,N,k]=m,O=N-v,f=k-S;switch(this.rotation){case 0:return[v,b-k,O,f];case 90:return[v,b-S,f,O];case 180:return[N,b-S,O,f];case 270:return[N,b-k,f,O];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Ce(this,a,!0)}disableEditMode(){Ce(this,a,!1)}isInEditMode(){return D(this,a)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var m;(m=this.div)===null||m===void 0||m.addEventListener("focusin",D(this,o))}serialize(){(0,s.unreachable)("An editor must be serializable")}static deserialize(m,b,v){const S=new this.prototype.constructor({parent:b,id:b.getNextId(),uiManager:v});S.rotation=m.rotation;const[N,k]=S.pageDimensions,[O,f,d,p]=S.getRectInCurrentCoords(m.rect,k);return S.x=O/N,S.y=f/k,S.width=d/N,S.height=p/k,S}remove(){this.div.removeEventListener("focusin",D(this,o)),this.div.removeEventListener("focusout",D(this,c)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var m;(m=this.div)===null||m===void 0||m.classList.add("selectedEditor")}unselect(){var m;(m=this.div)===null||m===void 0||m.classList.remove("selectedEditor")}updateParams(m,b){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return D(this,l)}set isEditing(m){Ce(this,l,m),m?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};let i=y;o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap,Ke(i,"_colorManager",new n.ColorManager),Ke(i,"_zIndex",1),e.AnnotationEditor=i},(r,e,t)=>{var y,g,m,b,v,S,un,O,f,d,p,_,w,M,E,F,G,H,K,Z,ae,oe,ie,ne,J,ge,_e,X,P,R,W,hn,V,Wt,z,dn,q,fn,T,lt,L,wt,Y,pn,le,mn,de,Ut,be,Nt,xe,$t;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=i,e.opacityToHex=o;var n=t(1),s=t(142);function i(Le,se,Te){for(const Ue of Te)se.addEventListener(Ue,Le[Ue].bind(Le))}function o(Le){return Math.round(Math.min(255,Math.max(1,255*Le))).toString(16).padStart(2,"0")}class c{constructor(){he(this,y,0)}getId(){return`${n.AnnotationEditorPrefix}${Ot(this,y)._++}`}}y=new WeakMap;class u{constructor(){he(this,g,[]);he(this,m,!1);he(this,b,void 0);he(this,v,-1);let se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;Ce(this,b,se)}add(se){let{cmd:Te,undo:Ue,mustExec:Ve,type:$e=NaN,overwriteIfSameType:Q=!1,keepUndo:re=!1}=se;if(Ve&&Te(),D(this,m))return;const te={cmd:Te,undo:Ue,type:$e};if(D(this,v)===-1){D(this,g).length>0&&(D(this,g).length=0),Ce(this,v,0),D(this,g).push(te);return}if(Q&&D(this,g)[D(this,v)].type===$e){re&&(te.undo=D(this,g)[D(this,v)].undo),D(this,g)[D(this,v)]=te;return}const Se=D(this,v)+1;Se===D(this,b)?D(this,g).splice(0,1):(Ce(this,v,Se),Se<D(this,g).length&&D(this,g).splice(Se)),D(this,g).push(te)}undo(){D(this,v)!==-1&&(Ce(this,m,!0),D(this,g)[D(this,v)].undo(),Ce(this,m,!1),Ce(this,v,D(this,v)-1))}redo(){D(this,v)<D(this,g).length-1&&(Ce(this,v,D(this,v)+1),Ce(this,m,!0),D(this,g)[D(this,v)].cmd(),Ce(this,m,!1))}hasSomethingToUndo(){return D(this,v)!==-1}hasSomethingToRedo(){return D(this,v)<D(this,g).length-1}destroy(){Ce(this,g,null)}}g=new WeakMap,m=new WeakMap,b=new WeakMap,v=new WeakMap,e.CommandManager=u;class l{constructor(se){he(this,S);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:Te}=n.FeatureTest.platform;for(const[Ue,Ve]of se)for(const $e of Ue){const Q=$e.startsWith("mac+");Te&&Q?(this.callbacks.set($e.slice(4),Ve),this.allKeys.add($e.split("+").at(-1))):!Te&&!Q&&(this.callbacks.set($e,Ve),this.allKeys.add($e.split("+").at(-1)))}}exec(se,Te){if(!this.allKeys.has(Te.key))return;const Ue=this.callbacks.get(me(this,S,un).call(this,Te));Ue&&(Ue.bind(se)(),Te.stopPropagation(),Te.preventDefault())}}S=new WeakSet,un=function(se){se.altKey&&this.buffer.push("alt"),se.ctrlKey&&this.buffer.push("ctrl"),se.metaKey&&this.buffer.push("meta"),se.shiftKey&&this.buffer.push("shift"),this.buffer.push(se.key);const Te=this.buffer.join("+");return this.buffer.length=0,Te},e.KeyboardManager=l;const k=class{get _colors(){const se=new Map([["CanvasText",null],["Canvas",null]]);return(0,s.getColorValues)(se),(0,n.shadow)(this,"_colors",se)}convert(se){const Te=(0,s.getRGB)(se);if(!window.matchMedia("(forced-colors: active)").matches)return Te;for(const[Ue,Ve]of this._colors)if(Ve.every(($e,Q)=>$e===Te[Q]))return k._colorsMapping.get(Ue);return Te}getHexCode(se){const Te=this._colors.get(se);return Te?n.Util.makeHexColor(...Te):se}};let a=k;Ke(a,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),e.ColorManager=a;const Pe=class{constructor(se,Te,Ue){he(this,W);he(this,V);he(this,z);he(this,q);he(this,T);he(this,L);he(this,Y);he(this,le);he(this,de);he(this,be);he(this,xe);he(this,O,null);he(this,f,new Map);he(this,d,new Map);he(this,p,null);he(this,_,new u);he(this,w,0);he(this,M,null);he(this,E,new Set);he(this,F,null);he(this,G,new c);he(this,H,!1);he(this,K,n.AnnotationEditorType.NONE);he(this,Z,new Set);he(this,ae,this.copy.bind(this));he(this,oe,this.cut.bind(this));he(this,ie,this.paste.bind(this));he(this,ne,this.keydown.bind(this));he(this,J,this.onEditingAction.bind(this));he(this,ge,this.onPageChanging.bind(this));he(this,_e,this.onScaleChanging.bind(this));he(this,X,this.onRotationChanging.bind(this));he(this,P,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});he(this,R,null);Ce(this,R,se),Ce(this,F,Te),D(this,F)._on("editingaction",D(this,J)),D(this,F)._on("pagechanging",D(this,ge)),D(this,F)._on("scalechanging",D(this,_e)),D(this,F)._on("rotationchanging",D(this,X)),Ce(this,p,Ue),this.viewParameters={realScale:s.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){me(this,V,Wt).call(this),D(this,F)._off("editingaction",D(this,J)),D(this,F)._off("pagechanging",D(this,ge)),D(this,F)._off("scalechanging",D(this,_e)),D(this,F)._off("rotationchanging",D(this,X));for(const se of D(this,d).values())se.destroy();D(this,d).clear(),D(this,f).clear(),D(this,E).clear(),Ce(this,O,null),D(this,Z).clear(),D(this,_).destroy()}onPageChanging(se){let{pageNumber:Te}=se;Ce(this,w,Te-1)}focusMainContainer(){D(this,R).focus()}addShouldRescale(se){D(this,E).add(se)}removeShouldRescale(se){D(this,E).delete(se)}onScaleChanging(se){let{scale:Te}=se;this.commitOrRemove(),this.viewParameters.realScale=Te*s.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Ue of D(this,E))Ue.onScaleChanging()}onRotationChanging(se){let{pagesRotation:Te}=se;this.commitOrRemove(),this.viewParameters.rotation=Te}addToAnnotationStorage(se){!se.isEmpty()&&D(this,p)&&!D(this,p).has(se.id)&&D(this,p).setValue(se.id,se)}copy(se){if(se.preventDefault(),D(this,O)&&D(this,O).commitOrRemove(),!this.hasSelection)return;const Te=[];for(const Ue of D(this,Z))Ue.isEmpty()||Te.push(Ue.serialize());Te.length!==0&&se.clipboardData.setData("application/pdfjs",JSON.stringify(Te))}cut(se){this.copy(se),this.delete()}paste(se){se.preventDefault();let Te=se.clipboardData.getData("application/pdfjs");if(!Te)return;try{Te=JSON.parse(Te)}catch(Ve){(0,n.warn)(`paste: "${Ve.message}".`);return}if(!Array.isArray(Te))return;this.unselectAll();const Ue=D(this,d).get(D(this,w));try{const Ve=[];for(const re of Te){const te=Ue.deserialize(re);if(!te)return;Ve.push(te)}const $e=()=>{for(const re of Ve)me(this,de,Ut).call(this,re);me(this,xe,$t).call(this,Ve)},Q=()=>{for(const re of Ve)re.remove()};this.addCommands({cmd:$e,undo:Q,mustExec:!0})}catch(Ve){(0,n.warn)(`paste: "${Ve.message}".`)}}keydown(se){var Te;(Te=this.getActive())!==null&&Te!==void 0&&Te.shouldGetKeyboardEvents()||Pe._keyboardManager.exec(this,se)}onEditingAction(se){["undo","redo","delete","selectAll"].includes(se.name)&&this[se.name]()}setEditingState(se){se?(me(this,W,hn).call(this),me(this,z,dn).call(this),me(this,T,lt).call(this,{isEditing:D(this,K)!==n.AnnotationEditorType.NONE,isEmpty:me(this,be,Nt).call(this),hasSomethingToUndo:D(this,_).hasSomethingToUndo(),hasSomethingToRedo:D(this,_).hasSomethingToRedo(),hasSelectedEditor:!1})):(me(this,V,Wt).call(this),me(this,q,fn).call(this),me(this,T,lt).call(this,{isEditing:!1}))}registerEditorTypes(se){if(!D(this,M)){Ce(this,M,se);for(const Te of D(this,M))me(this,L,wt).call(this,Te.defaultPropertiesToUpdate)}}getId(){return D(this,G).getId()}get currentLayer(){return D(this,d).get(D(this,w))}get currentPageIndex(){return D(this,w)}addLayer(se){D(this,d).set(se.pageIndex,se),D(this,H)?se.enable():se.disable()}removeLayer(se){D(this,d).delete(se.pageIndex)}updateMode(se){if(Ce(this,K,se),se===n.AnnotationEditorType.NONE)this.setEditingState(!1),me(this,le,mn).call(this);else{this.setEditingState(!0),me(this,Y,pn).call(this);for(const Te of D(this,d).values())Te.updateMode(se)}}updateToolbar(se){se!==D(this,K)&&D(this,F).dispatch("switchannotationeditormode",{source:this,mode:se})}updateParams(se,Te){if(D(this,M)){for(const Ue of D(this,Z))Ue.updateParams(se,Te);for(const Ue of D(this,M))Ue.updateDefaultParams(se,Te)}}getEditors(se){const Te=[];for(const Ue of D(this,f).values())Ue.pageIndex===se&&Te.push(Ue);return Te}getEditor(se){return D(this,f).get(se)}addEditor(se){D(this,f).set(se.id,se)}removeEditor(se){var Te;D(this,f).delete(se.id),this.unselect(se),(Te=D(this,p))===null||Te===void 0||Te.remove(se.id)}setActiveEditor(se){D(this,O)!==se&&(Ce(this,O,se),se&&me(this,L,wt).call(this,se.propertiesToUpdate))}toggleSelected(se){if(D(this,Z).has(se)){D(this,Z).delete(se),se.unselect(),me(this,T,lt).call(this,{hasSelectedEditor:this.hasSelection});return}D(this,Z).add(se),se.select(),me(this,L,wt).call(this,se.propertiesToUpdate),me(this,T,lt).call(this,{hasSelectedEditor:!0})}setSelected(se){for(const Te of D(this,Z))Te!==se&&Te.unselect();D(this,Z).clear(),D(this,Z).add(se),se.select(),me(this,L,wt).call(this,se.propertiesToUpdate),me(this,T,lt).call(this,{hasSelectedEditor:!0})}isSelected(se){return D(this,Z).has(se)}unselect(se){se.unselect(),D(this,Z).delete(se),me(this,T,lt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return D(this,Z).size!==0}undo(){D(this,_).undo(),me(this,T,lt).call(this,{hasSomethingToUndo:D(this,_).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:me(this,be,Nt).call(this)})}redo(){D(this,_).redo(),me(this,T,lt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:D(this,_).hasSomethingToRedo(),isEmpty:me(this,be,Nt).call(this)})}addCommands(se){D(this,_).add(se),me(this,T,lt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:me(this,be,Nt).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const se=[...D(this,Z)],Te=()=>{for(const Ve of se)Ve.remove()},Ue=()=>{for(const Ve of se)me(this,de,Ut).call(this,Ve)};this.addCommands({cmd:Te,undo:Ue,mustExec:!0})}commitOrRemove(){var se;(se=D(this,O))===null||se===void 0||se.commitOrRemove()}selectAll(){for(const se of D(this,Z))se.commit();me(this,xe,$t).call(this,D(this,f).values())}unselectAll(){if(D(this,O)){D(this,O).commitOrRemove();return}if(D(this,Z).size!==0){for(const se of D(this,Z))se.unselect();D(this,Z).clear(),me(this,T,lt).call(this,{hasSelectedEditor:!1})}}isActive(se){return D(this,O)===se}getActive(){return D(this,O)}getMode(){return D(this,K)}};let h=Pe;O=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap,_=new WeakMap,w=new WeakMap,M=new WeakMap,E=new WeakMap,F=new WeakMap,G=new WeakMap,H=new WeakMap,K=new WeakMap,Z=new WeakMap,ae=new WeakMap,oe=new WeakMap,ie=new WeakMap,ne=new WeakMap,J=new WeakMap,ge=new WeakMap,_e=new WeakMap,X=new WeakMap,P=new WeakMap,R=new WeakMap,W=new WeakSet,hn=function(){D(this,R).addEventListener("keydown",D(this,ne))},V=new WeakSet,Wt=function(){D(this,R).removeEventListener("keydown",D(this,ne))},z=new WeakSet,dn=function(){document.addEventListener("copy",D(this,ae)),document.addEventListener("cut",D(this,oe)),document.addEventListener("paste",D(this,ie))},q=new WeakSet,fn=function(){document.removeEventListener("copy",D(this,ae)),document.removeEventListener("cut",D(this,oe)),document.removeEventListener("paste",D(this,ie))},T=new WeakSet,lt=function(se){Object.entries(se).some(Ue=>{let[Ve,$e]=Ue;return D(this,P)[Ve]!==$e})&&D(this,F).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(D(this,P),se)})},L=new WeakSet,wt=function(se){D(this,F).dispatch("annotationeditorparamschanged",{source:this,details:se})},Y=new WeakSet,pn=function(){if(!D(this,H)){Ce(this,H,!0);for(const se of D(this,d).values())se.enable()}},le=new WeakSet,mn=function(){if(this.unselectAll(),D(this,H)){Ce(this,H,!1);for(const se of D(this,d).values())se.disable()}},de=new WeakSet,Ut=function(se){const Te=D(this,d).get(se.pageIndex);Te?Te.addOrRebuild(se):this.addEditor(se)},be=new WeakSet,Nt=function(){if(D(this,f).size===0)return!0;if(D(this,f).size===1)for(const se of D(this,f).values())return se.isEmpty();return!1},xe=new WeakSet,$t=function(se){D(this,Z).clear();for(const Te of se)Te.isEmpty()||(D(this,Z).add(Te),Te.select());me(this,T,lt).call(this,{hasSelectedEditor:!0})},Ke(h,"_keyboardManager",new l([[["ctrl+a","mac+meta+a"],Pe.prototype.selectAll],[["ctrl+z","mac+meta+z"],Pe.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],Pe.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],Pe.prototype.delete],[["Escape","mac+Escape"],Pe.prototype.unselectAll]])),e.AnnotationEditorUIManager=h},(r,e,t)=>{var ae,oe,ie,ne,J,ge,_e,X,P,Ct,W,pt,V,ht;Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMFilterFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=p,e.getColorValues=F,e.getCurrentTransform=G,e.getCurrentTransformInverse=H,e.getFilenameFromUrl=N,e.getPdfFilenameFromUrl=k,e.getRGB=E,e.getXfaPageViewport=M,e.isDataScheme=v,e.isPdfFile=S,e.isValidFetchUrl=f,e.loadScript=d,e.setLayerDimensions=K;var n=t(143),s=t(1);const i="http://www.w3.org/2000/svg",o="pdfjs_internal_id_";e.AnnotationPrefix=o;const Z=class{};let c=Z;Ke(c,"CSS",96),Ke(c,"PDF",72),Ke(c,"PDF_TO_CSS_UNITS",Z.CSS/Z.PDF),e.PixelsPerInch=c;class u extends n.BaseFilterFactory{constructor(){let{docId:q,ownerDocument:x=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super();he(this,P);he(this,W);he(this,V);he(this,ae,void 0);he(this,oe,void 0);he(this,ie,void 0);he(this,ne,void 0);he(this,J,void 0);he(this,ge,void 0);he(this,_e,void 0);he(this,X,0);Ce(this,ie,q),Ce(this,ne,x)}addFilter(q){if(!q)return"none";let x=D(this,P,Ct).get(q);if(x)return x;let T,I,L,U;if(q.length===1){const de=q[0],ye=new Array(256);for(let be=0;be<256;be++)ye[be]=de[be]/255;U=T=I=L=ye.join(",")}else{const[de,ye,be]=q,ve=new Array(256),xe=new Array(256),Oe=new Array(256);for(let Pe=0;Pe<256;Pe++)ve[Pe]=de[Pe]/255,xe[Pe]=ye[Pe]/255,Oe[Pe]=be[Pe]/255;T=ve.join(","),I=xe.join(","),L=Oe.join(","),U=`${T}${I}${L}`}if(x=D(this,P,Ct).get(U),x)return D(this,P,Ct).set(q,x),x;const Y=`g_${D(this,ie)}_transfer_map_${Ot(this,X)._++}`,ce=`url(#${Y})`;D(this,P,Ct).set(q,ce),D(this,P,Ct).set(U,ce);const le=D(this,ne).createElementNS(i,"filter",i);le.setAttribute("id",Y),le.setAttribute("color-interpolation-filters","sRGB");const fe=D(this,ne).createElementNS(i,"feComponentTransfer");return le.append(fe),me(this,V,ht).call(this,fe,"feFuncR",T),me(this,V,ht).call(this,fe,"feFuncG",I),me(this,V,ht).call(this,fe,"feFuncB",L),D(this,W,pt).append(le),ce}addHCMFilter(q,x){var T;const I=`${q}-${x}`;if(D(this,ge)===I)return D(this,_e);if(Ce(this,ge,I),Ce(this,_e,"none"),(T=D(this,J))===null||T===void 0||T.remove(),!q||!x)return D(this,_e);D(this,W,pt).style.color=q,q=getComputedStyle(D(this,W,pt)).getPropertyValue("color");const L=E(q);q=s.Util.makeHexColor(...L),D(this,W,pt).style.color=x,x=getComputedStyle(D(this,W,pt)).getPropertyValue("color");const U=E(x);if(x=s.Util.makeHexColor(...U),D(this,W,pt).style.color="",q==="#000000"&&x==="#ffffff"||q===x)return D(this,_e);const Y=new Array(256);for(let ve=0;ve<=255;ve++){const xe=ve/255;Y[ve]=xe<=.03928?xe/12.92:((xe+.055)/1.055)**2.4}const ce=Y.join(","),le=`g_${D(this,ie)}_hcm_filter`,fe=Ce(this,J,D(this,ne).createElementNS(i,"filter",i));fe.setAttribute("id",le),fe.setAttribute("color-interpolation-filters","sRGB");let de=D(this,ne).createElementNS(i,"feComponentTransfer");fe.append(de),me(this,V,ht).call(this,de,"feFuncR",ce),me(this,V,ht).call(this,de,"feFuncG",ce),me(this,V,ht).call(this,de,"feFuncB",ce);const ye=D(this,ne).createElementNS(i,"feColorMatrix");ye.setAttribute("type","matrix"),ye.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),fe.append(ye),de=D(this,ne).createElementNS(i,"feComponentTransfer"),fe.append(de);const be=(ve,xe)=>{const Oe=L[ve]/255,Pe=U[ve]/255,Le=new Array(xe+1);for(let se=0;se<=xe;se++)Le[se]=Oe+se/xe*(Pe-Oe);return Le.join(",")};return me(this,V,ht).call(this,de,"feFuncR",be(0,5)),me(this,V,ht).call(this,de,"feFuncG",be(1,5)),me(this,V,ht).call(this,de,"feFuncB",be(2,5)),D(this,W,pt).append(fe),Ce(this,_e,`url(#${le})`),D(this,_e)}destroy(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&D(this,_e)||(D(this,oe)&&(D(this,oe).parentNode.parentNode.remove(),Ce(this,oe,null)),D(this,ae)&&(D(this,ae).clear(),Ce(this,ae,null)),Ce(this,X,0))}}ae=new WeakMap,oe=new WeakMap,ie=new WeakMap,ne=new WeakMap,J=new WeakMap,ge=new WeakMap,_e=new WeakMap,X=new WeakMap,P=new WeakSet,Ct=function(){return D(this,ae)||Ce(this,ae,new Map)},W=new WeakSet,pt=function(){if(!D(this,oe)){const q=D(this,ne).createElement("div"),{style:x}=q;x.visibility="hidden",x.contain="strict",x.width=x.height=0,x.position="absolute",x.top=x.left=0,x.zIndex=-1;const T=D(this,ne).createElementNS(i,"svg");T.setAttribute("width",0),T.setAttribute("height",0),Ce(this,oe,D(this,ne).createElementNS(i,"defs")),q.append(T),T.append(D(this,oe)),D(this,ne).body.append(q)}return D(this,oe)},V=new WeakSet,ht=function(q,x,T){const I=D(this,ne).createElementNS(i,x);I.setAttribute("type","discrete"),I.setAttribute("tableValues",T),q.append(I)},e.DOMFilterFactory=u;class l extends n.BaseCanvasFactory{constructor(){let{ownerDocument:j=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=j}_createCanvas(j,q){const x=this._document.createElement("canvas");return x.width=j,x.height=q,x}}e.DOMCanvasFactory=l;async function a(z){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(f(z,document.baseURI)){const q=await fetch(z);if(!q.ok)throw new Error(q.statusText);return j?new Uint8Array(await q.arrayBuffer()):(0,s.stringToBytes)(await q.text())}return new Promise((q,x)=>{const T=new XMLHttpRequest;T.open("GET",z,!0),j&&(T.responseType="arraybuffer"),T.onreadystatechange=()=>{if(T.readyState===XMLHttpRequest.DONE){if(T.status===200||T.status===0){let I;if(j&&T.response?I=new Uint8Array(T.response):!j&&T.responseText&&(I=(0,s.stringToBytes)(T.responseText)),I){q(I);return}}x(new Error(T.statusText))}},T.send(null)})}class h extends n.BaseCMapReaderFactory{_fetchData(j,q){return a(j,this.isCompressed).then(x=>({cMapData:x,compressionType:q}))}}e.DOMCMapReaderFactory=h;class y extends n.BaseStandardFontDataFactory{_fetchData(j){return a(j,!0)}}e.DOMStandardFontDataFactory=y;class g extends n.BaseSVGFactory{_createSVG(j){return document.createElementNS(i,j)}}e.DOMSVGFactory=g;class m{constructor(j){let{viewBox:q,scale:x,rotation:T,offsetX:I=0,offsetY:L=0,dontFlip:U=!1}=j;this.viewBox=q,this.scale=x,this.rotation=T,this.offsetX=I,this.offsetY=L;const Y=(q[2]+q[0])/2,ce=(q[3]+q[1])/2;let le,fe,de,ye;switch(T%=360,T<0&&(T+=360),T){case 180:le=-1,fe=0,de=0,ye=1;break;case 90:le=0,fe=1,de=1,ye=0;break;case 270:le=0,fe=-1,de=-1,ye=0;break;case 0:le=1,fe=0,de=0,ye=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}U&&(de=-de,ye=-ye);let be,ve,xe,Oe;le===0?(be=Math.abs(ce-q[1])*x+I,ve=Math.abs(Y-q[0])*x+L,xe=(q[3]-q[1])*x,Oe=(q[2]-q[0])*x):(be=Math.abs(Y-q[0])*x+I,ve=Math.abs(ce-q[1])*x+L,xe=(q[2]-q[0])*x,Oe=(q[3]-q[1])*x),this.transform=[le*x,fe*x,de*x,ye*x,be-le*x*Y-de*x*ce,ve-fe*x*Y-ye*x*ce],this.width=xe,this.height=Oe}get rawDims(){const{viewBox:j}=this;return(0,s.shadow)(this,"rawDims",{pageWidth:j[2]-j[0],pageHeight:j[3]-j[1],pageX:j[0],pageY:j[1]})}clone(){let{scale:j=this.scale,rotation:q=this.rotation,offsetX:x=this.offsetX,offsetY:T=this.offsetY,dontFlip:I=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new m({viewBox:this.viewBox.slice(),scale:j,rotation:q,offsetX:x,offsetY:T,dontFlip:I})}convertToViewportPoint(j,q){return s.Util.applyTransform([j,q],this.transform)}convertToViewportRectangle(j){const q=s.Util.applyTransform([j[0],j[1]],this.transform),x=s.Util.applyTransform([j[2],j[3]],this.transform);return[q[0],q[1],x[0],x[1]]}convertToPdfPoint(j,q){return s.Util.applyInverseTransform([j,q],this.transform)}}e.PageViewport=m;class b extends s.BaseException{constructor(j,q){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(j,"RenderingCancelledException"),this.type=q,this.extraDelay=x}}e.RenderingCancelledException=b;function v(z){const j=z.length;let q=0;for(;q<j&&z[q].trim()==="";)q++;return z.substring(q,q+5).toLowerCase()==="data:"}function S(z){return typeof z=="string"&&/\.pdf$/i.test(z)}function N(z){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)||([z]=z.split(/[#?]/,1)),z.substring(z.lastIndexOf("/")+1)}function k(z){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof z!="string")return j;if(v(z))return(0,s.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),j;const q=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,x=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,T=q.exec(z);let I=x.exec(T[1])||x.exec(T[2])||x.exec(T[3]);if(I&&(I=I[0],I.includes("%")))try{I=x.exec(decodeURIComponent(I))[0]}catch{}return I||j}class O{constructor(){Ke(this,"started",Object.create(null));Ke(this,"times",[])}time(j){j in this.started&&(0,s.warn)(`Timer is already running for ${j}`),this.started[j]=Date.now()}timeEnd(j){j in this.started||(0,s.warn)(`Timer has not been started for ${j}`),this.times.push({name:j,start:this.started[j],end:Date.now()}),delete this.started[j]}toString(){const j=[];let q=0;for(const{name:x}of this.times)q=Math.max(x.length,q);for(const{name:x,start:T,end:I}of this.times)j.push(`${x.padEnd(q)} ${I-T}ms
`);return j.join("")}}e.StatTimer=O;function f(z,j){try{const{protocol:q}=j?new URL(z,j):new URL(z);return q==="http:"||q==="https:"}catch{return!1}}function d(z){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((q,x)=>{const T=document.createElement("script");T.src=z,T.onload=function(I){j&&T.remove(),q(I)},T.onerror=function(){x(new Error(`Cannot load script at: ${T.src}`))},(document.head||document.documentElement).append(T)})}function p(z){console.log("Deprecated API usage: "+z)}let _;class w{static toDateObject(j){if(!j||typeof j!="string")return null;_||(_=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const q=_.exec(j);if(!q)return null;const x=parseInt(q[1],10);let T=parseInt(q[2],10);T=T>=1&&T<=12?T-1:0;let I=parseInt(q[3],10);I=I>=1&&I<=31?I:1;let L=parseInt(q[4],10);L=L>=0&&L<=23?L:0;let U=parseInt(q[5],10);U=U>=0&&U<=59?U:0;let Y=parseInt(q[6],10);Y=Y>=0&&Y<=59?Y:0;const ce=q[7]||"Z";let le=parseInt(q[8],10);le=le>=0&&le<=23?le:0;let fe=parseInt(q[9],10)||0;return fe=fe>=0&&fe<=59?fe:0,ce==="-"?(L+=le,U+=fe):ce==="+"&&(L-=le,U-=fe),new Date(Date.UTC(x,T,I,L,U,Y))}}e.PDFDateString=w;function M(z,j){let{scale:q=1,rotation:x=0}=j;const{width:T,height:I}=z.attributes.style,L=[0,0,parseInt(T),parseInt(I)];return new m({viewBox:L,scale:q,rotation:x})}function E(z){if(z.startsWith("#")){const j=parseInt(z.slice(1),16);return[(j&16711680)>>16,(j&65280)>>8,j&255]}return z.startsWith("rgb(")?z.slice(4,-1).split(",").map(j=>parseInt(j)):z.startsWith("rgba(")?z.slice(5,-1).split(",").map(j=>parseInt(j)).slice(0,3):((0,s.warn)(`Not a valid color format: "${z}"`),[0,0,0])}function F(z){const j=document.createElement("span");j.style.visibility="hidden",document.body.append(j);for(const q of z.keys()){j.style.color=q;const x=window.getComputedStyle(j).color;z.set(q,E(x))}j.remove()}function G(z){const{a:j,b:q,c:x,d:T,e:I,f:L}=z.getTransform();return[j,q,x,T,I,L]}function H(z){const{a:j,b:q,c:x,d:T,e:I,f:L}=z.getTransform().invertSelf();return[j,q,x,T,I,L]}function K(z,j){let q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(j instanceof m){const{pageWidth:T,pageHeight:I}=j.rawDims,{style:L}=z,U=`calc(var(--scale-factor) * ${T}px)`,Y=`calc(var(--scale-factor) * ${I}px)`;!q||j.rotation%180===0?(L.width=U,L.height=Y):(L.width=Y,L.height=U)}x&&z.setAttribute("data-main-rotation",j.rotation)}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseFilterFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var n=t(1);class s{constructor(){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(a){return"none"}addHCMFilter(a,h){return"none"}destroy(){}}e.BaseFilterFactory=s;class i{constructor(){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(a,h){if(a<=0||h<=0)throw new Error("Invalid canvas size");const y=this._createCanvas(a,h);return{canvas:y,context:y.getContext("2d")}}reset(a,h,y){if(!a.canvas)throw new Error("Canvas is not specified");if(h<=0||y<=0)throw new Error("Invalid canvas size");a.canvas.width=h,a.canvas.height=y}destroy(a){if(!a.canvas)throw new Error("Canvas is not specified");a.canvas.width=0,a.canvas.height=0,a.canvas=null,a.context=null}_createCanvas(a,h){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=i;class o{constructor(a){let{baseUrl:h=null,isCompressed:y=!0}=a;this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=h,this.isCompressed=y}async fetch(a){let{name:h}=a;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!h)throw new Error("CMap name must be specified.");const y=this.baseUrl+h+(this.isCompressed?".bcmap":""),g=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(y,g).catch(m=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${y}`)})}_fetchData(a,h){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class c{constructor(a){let{baseUrl:h=null}=a;this.constructor===c&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=h}async fetch(a){let{filename:h}=a;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!h)throw new Error("Font filename must be specified.");const y=`${this.baseUrl}${h}`;return this._fetchData(y).catch(g=>{throw new Error(`Unable to load font data at: ${y}`)})}_fetchData(a){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=c;class u{constructor(){this.constructor===u&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(a,h){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(a<=0||h<=0)throw new Error("Invalid SVG dimensions");const g=this._createSVG("svg:svg");return g.setAttribute("version","1.1"),y||(g.setAttribute("width",`${a}px`),g.setAttribute("height",`${h}px`)),g.setAttribute("preserveAspectRatio","none"),g.setAttribute("viewBox",`0 0 ${a} ${h}`),g}createElement(a){if(typeof a!="string")throw new Error("Invalid SVG element type");return this._createSVG(a)}_createSVG(a){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=u},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var n=t(1);const s=3285377520,i=4294901760,o=65535;class c{constructor(l){this.h1=l?l&4294967295:s,this.h2=l?l&4294967295:s}update(l){let a,h;if(typeof l=="string"){a=new Uint8Array(l.length*2),h=0;for(let p=0,_=l.length;p<_;p++){const w=l.charCodeAt(p);w<=255?a[h++]=w:(a[h++]=w>>>8,a[h++]=w&255)}}else if((0,n.isArrayBuffer)(l))a=l.slice(),h=a.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const y=h>>2,g=h-y*4,m=new Uint32Array(a.buffer,0,y);let b=0,v=0,S=this.h1,N=this.h2;const k=3432918353,O=461845907,f=k&o,d=O&o;for(let p=0;p<y;p++)p&1?(b=m[p],b=b*k&i|b*f&o,b=b<<15|b>>>17,b=b*O&i|b*d&o,S^=b,S=S<<13|S>>>19,S=S*5+3864292196):(v=m[p],v=v*k&i|v*f&o,v=v<<15|v>>>17,v=v*O&i|v*d&o,N^=v,N=N<<13|N>>>19,N=N*5+3864292196);switch(b=0,g){case 3:b^=a[y*4+2]<<16;case 2:b^=a[y*4+1]<<8;case 1:b^=a[y*4],b=b*k&i|b*f&o,b=b<<15|b>>>17,b=b*O&i|b*d&o,y&1?S^=b:N^=b}this.h1=S,this.h2=N}hexdigest(){let l=this.h1,a=this.h2;return l^=a>>>1,l=l*3981806797&i|l*36045&o,a=a*4283543511&i|((a<<16|l>>>16)*2950163797&i)>>>16,l^=a>>>1,l=l*444984403&i|l*60499&o,a=a*3301882366&i|((a<<16|l>>>16)*3120437893&i)>>>16,l^=a>>>1,(l>>>0).toString(16).padStart(8,"0")+(a>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=c},(r,e,t)=>{var c;Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var n=t(1),s=t(3);class i{constructor(l){he(this,c,new Set);let{ownerDocument:a=globalThis.document,styleElement:h=null}=l;this._document=a,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(l){this.nativeFontFaces.add(l),this._document.fonts.add(l)}removeNativeFontFace(l){this.nativeFontFaces.delete(l),this._document.fonts.delete(l)}insertRule(l){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const a=this.styleElement.sheet;a.insertRule(l,a.cssRules.length)}clear(){for(const l of this.nativeFontFaces)this._document.fonts.delete(l);this.nativeFontFaces.clear(),D(this,c).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(l){if(!(!l||D(this,c).has(l.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:a,src:h,style:y}=l,g=new FontFace(a,h,y);this.addNativeFontFace(g);try{await g.load(),D(this,c).add(a)}catch{(0,n.warn)(`Cannot load system font: ${l.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(g)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(l){if(l.attached||l.missingFile&&!l.systemFontInfo)return;if(l.attached=!0,l.systemFontInfo){await this.loadSystemFont(l.systemFontInfo);return}if(this.isFontLoadingAPISupported){const h=l.createNativeFontFace();if(h){this.addNativeFontFace(h);try{await h.loaded}catch(y){throw(0,n.warn)(`Failed to load font '${h.family}': '${y}'.`),l.disableFontFace=!0,y}}return}const a=l.createFontFaceRule();if(a){if(this.insertRule(a),this.isSyncFontLoadingSupported)return;await new Promise(h=>{const y=this._queueLoadingCallback(h);this._prepareFontLoadEvent(l,y)})}}get isFontLoadingAPISupported(){var l;const a=!!((l=this._document)!==null&&l!==void 0&&l.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",a)}get isSyncFontLoadingSupported(){let l=!1;return(s.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(l=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",l)}_queueLoadingCallback(l){function a(){for((0,n.assert)(!y.done,"completeRequest() cannot be called twice."),y.done=!0;h.length>0&&h[0].done;){const g=h.shift();setTimeout(g.callback,0)}}const{loadingRequests:h}=this,y={done:!1,complete:a,callback:l};return h.push(y),y}get _loadTestFont(){const l=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",l)}_prepareFontLoadEvent(l,a){function h(F,G){return F.charCodeAt(G)<<24|F.charCodeAt(G+1)<<16|F.charCodeAt(G+2)<<8|F.charCodeAt(G+3)&255}function y(F,G,H,K){const Z=F.substring(0,G),ae=F.substring(G+H);return Z+K+ae}let g,m;const b=this._document.createElement("canvas");b.width=1,b.height=1;const v=b.getContext("2d");let S=0;function N(F,G){if(++S>30){(0,n.warn)("Load test font never loaded."),G();return}if(v.font="30px "+F,v.fillText(".",0,20),v.getImageData(0,0,1,1).data[3]>0){G();return}setTimeout(N.bind(null,F,G))}const k=`lt${Date.now()}${this.loadTestFontId++}`;let O=this._loadTestFont;O=y(O,976,k.length,k);const d=16,p=1482184792;let _=h(O,d);for(g=0,m=k.length-3;g<m;g+=4)_=_-p+h(k,g)|0;g<k.length&&(_=_-p+h(k+"XXX",g)|0),O=y(O,d,4,(0,n.string32)(_));const w=`url(data:font/opentype;base64,${btoa(O)});`,M=`@font-face {font-family:"${k}";src:${w}}`;this.insertRule(M);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const F of[l.loadedName,k]){const G=this._document.createElement("span");G.textContent="Hi",G.style.fontFamily=F,E.append(G)}this._document.body.append(E),N(k,()=>{E.remove(),a.complete()})}}c=new WeakMap,e.FontLoader=i;class o{constructor(l,a){let{isEvalSupported:h=!0,disableFontFace:y=!1,ignoreErrors:g=!1,inspectFont:m=null}=a;this.compiledGlyphs=Object.create(null);for(const b in l)this[b]=l[b];this.isEvalSupported=h!==!1,this.disableFontFace=y===!0,this.ignoreErrors=g===!0,this._inspectFont=m}createNativeFontFace(){var l;if(!this.data||this.disableFontFace)return null;let a;if(!this.cssFontInfo)a=new FontFace(this.loadedName,this.data,{});else{const h={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(h.style=`oblique ${this.cssFontInfo.italicAngle}deg`),a=new FontFace(this.cssFontInfo.fontFamily,this.data,h)}return(l=this._inspectFont)===null||l===void 0||l.call(this,this),a}createFontFaceRule(){var l;if(!this.data||this.disableFontFace)return null;const a=(0,n.bytesToString)(this.data),h=`url(data:${this.mimetype};base64,${btoa(a)});`;let y;if(!this.cssFontInfo)y=`@font-face {font-family:"${this.loadedName}";src:${h}}`;else{let g=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(g+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),y=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${g}src:${h}}`}return(l=this._inspectFont)===null||l===void 0||l.call(this,this,h),y}getPathGenerator(l,a){if(this.compiledGlyphs[a]!==void 0)return this.compiledGlyphs[a];let h;try{h=l.get(this.loadedName+"_path_"+a)}catch(y){if(!this.ignoreErrors)throw y;return(0,n.warn)(`getPathGenerator - ignoring character: "${y}".`),this.compiledGlyphs[a]=function(g,m){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const y=[];for(const g of h){const m=g.args!==void 0?g.args.join(","):"";y.push("c.",g.cmd,"(",m,`);
`)}return this.compiledGlyphs[a]=new Function("c","size",y.join(""))}return this.compiledGlyphs[a]=function(y,g){for(const m of h)m.cmd==="scale"&&(m.args=[g,-g]),y[m.cmd].apply(y,m.args)}}}e.FontFaceObject=o},(r,e,t)=>{var ie,Gt,J,zt;Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var n=t(1),s=t(142),i=t(147),o=t(148),c=t(3);const u=16,l=100,a=4096,h=15,y=10,g=1e3,m=16;function b(X,P){if(X._removeMirroring)throw new Error("Context is already forwarding operations.");X.__originalSave=X.save,X.__originalRestore=X.restore,X.__originalRotate=X.rotate,X.__originalScale=X.scale,X.__originalTranslate=X.translate,X.__originalTransform=X.transform,X.__originalSetTransform=X.setTransform,X.__originalResetTransform=X.resetTransform,X.__originalClip=X.clip,X.__originalMoveTo=X.moveTo,X.__originalLineTo=X.lineTo,X.__originalBezierCurveTo=X.bezierCurveTo,X.__originalRect=X.rect,X.__originalClosePath=X.closePath,X.__originalBeginPath=X.beginPath,X._removeMirroring=()=>{X.save=X.__originalSave,X.restore=X.__originalRestore,X.rotate=X.__originalRotate,X.scale=X.__originalScale,X.translate=X.__originalTranslate,X.transform=X.__originalTransform,X.setTransform=X.__originalSetTransform,X.resetTransform=X.__originalResetTransform,X.clip=X.__originalClip,X.moveTo=X.__originalMoveTo,X.lineTo=X.__originalLineTo,X.bezierCurveTo=X.__originalBezierCurveTo,X.rect=X.__originalRect,X.closePath=X.__originalClosePath,X.beginPath=X.__originalBeginPath,delete X._removeMirroring},X.save=function(){P.save(),this.__originalSave()},X.restore=function(){P.restore(),this.__originalRestore()},X.translate=function(W,$){P.translate(W,$),this.__originalTranslate(W,$)},X.scale=function(W,$){P.scale(W,$),this.__originalScale(W,$)},X.transform=function(W,$,V,ee,z,j){P.transform(W,$,V,ee,z,j),this.__originalTransform(W,$,V,ee,z,j)},X.setTransform=function(W,$,V,ee,z,j){P.setTransform(W,$,V,ee,z,j),this.__originalSetTransform(W,$,V,ee,z,j)},X.resetTransform=function(){P.resetTransform(),this.__originalResetTransform()},X.rotate=function(W){P.rotate(W),this.__originalRotate(W)},X.clip=function(W){P.clip(W),this.__originalClip(W)},X.moveTo=function(R,W){P.moveTo(R,W),this.__originalMoveTo(R,W)},X.lineTo=function(R,W){P.lineTo(R,W),this.__originalLineTo(R,W)},X.bezierCurveTo=function(R,W,$,V,ee,z){P.bezierCurveTo(R,W,$,V,ee,z),this.__originalBezierCurveTo(R,W,$,V,ee,z)},X.rect=function(R,W,$,V){P.rect(R,W,$,V),this.__originalRect(R,W,$,V)},X.closePath=function(){P.closePath(),this.__originalClosePath()},X.beginPath=function(){P.beginPath(),this.__originalBeginPath()}}class v{constructor(P){this.canvasFactory=P,this.cache=Object.create(null)}getCanvas(P,R,W){let $;return this.cache[P]!==void 0?($=this.cache[P],this.canvasFactory.reset($,R,W)):($=this.canvasFactory.create(R,W),this.cache[P]=$),$}delete(P){delete this.cache[P]}clear(){for(const P in this.cache){const R=this.cache[P];this.canvasFactory.destroy(R),delete this.cache[P]}}}function S(X,P,R,W,$,V,ee,z,j,q){const[x,T,I,L,U,Y]=(0,s.getCurrentTransform)(X);if(T===0&&I===0){const fe=ee*x+U,de=Math.round(fe),ye=z*L+Y,be=Math.round(ye),ve=(ee+j)*x+U,xe=Math.abs(Math.round(ve)-de)||1,Oe=(z+q)*L+Y,Pe=Math.abs(Math.round(Oe)-be)||1;return X.setTransform(Math.sign(x),0,0,Math.sign(L),de,be),X.drawImage(P,R,W,$,V,0,0,xe,Pe),X.setTransform(x,T,I,L,U,Y),[xe,Pe]}if(x===0&&L===0){const fe=z*I+U,de=Math.round(fe),ye=ee*T+Y,be=Math.round(ye),ve=(z+q)*I+U,xe=Math.abs(Math.round(ve)-de)||1,Oe=(ee+j)*T+Y,Pe=Math.abs(Math.round(Oe)-be)||1;return X.setTransform(0,Math.sign(T),Math.sign(I),0,de,be),X.drawImage(P,R,W,$,V,0,0,Pe,xe),X.setTransform(x,T,I,L,U,Y),[Pe,xe]}X.drawImage(P,R,W,$,V,ee,z,j,q);const ce=Math.hypot(x,T),le=Math.hypot(I,L);return[ce*j,le*q]}function N(X){const{width:P,height:R}=X;if(P>g||R>g)return null;const W=1e3,$=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),V=P+1;let ee=new Uint8Array(V*(R+1)),z,j,q;const x=P+7&-8;let T=new Uint8Array(x*R),I=0;for(const le of X.data){let fe=128;for(;fe>0;)T[I++]=le&fe?0:255,fe>>=1}let L=0;for(I=0,T[I]!==0&&(ee[0]=1,++L),j=1;j<P;j++)T[I]!==T[I+1]&&(ee[j]=T[I]?2:1,++L),I++;for(T[I]!==0&&(ee[j]=2,++L),z=1;z<R;z++){I=z*x,q=z*V,T[I-x]!==T[I]&&(ee[q]=T[I]?1:8,++L);let le=(T[I]?4:0)+(T[I-x]?8:0);for(j=1;j<P;j++)le=(le>>2)+(T[I+1]?4:0)+(T[I-x+1]?8:0),$[le]&&(ee[q+j]=$[le],++L),I++;if(T[I-x]!==T[I]&&(ee[q+j]=T[I]?2:4,++L),L>W)return null}for(I=x*(R-1),q=z*V,T[I]!==0&&(ee[q]=8,++L),j=1;j<P;j++)T[I]!==T[I+1]&&(ee[q+j]=T[I]?4:8,++L),I++;if(T[I]!==0&&(ee[q+j]=4,++L),L>W)return null;const U=new Int32Array([0,V,-1,0,-V,0,0,0,1]),Y=new Path2D;for(z=0;L&&z<=R;z++){let le=z*V;const fe=le+P;for(;le<fe&&!ee[le];)le++;if(le===fe)continue;Y.moveTo(le%V,z);const de=le;let ye=ee[le];do{const be=U[ye];do le+=be;while(!ee[le]);const ve=ee[le];ve!==5&&ve!==10?(ye=ve,ee[le]=0):(ye=ve&51*ye>>4,ee[le]&=ye>>2|ye<<2),Y.lineTo(le%V,le/V|0),ee[le]||--L}while(de!==le);--z}return T=null,ee=null,function(le){le.save(),le.scale(1/P,-1/R),le.translate(0,-R),le.fill(Y),le.beginPath(),le.restore()}}class k{constructor(P,R){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,P,R])}clone(){const P=Object.create(this);return P.clipBox=this.clipBox.slice(),P}setCurrentPoint(P,R){this.x=P,this.y=R}updatePathMinMax(P,R,W){[R,W]=n.Util.applyTransform([R,W],P),this.minX=Math.min(this.minX,R),this.minY=Math.min(this.minY,W),this.maxX=Math.max(this.maxX,R),this.maxY=Math.max(this.maxY,W)}updateRectMinMax(P,R){const W=n.Util.applyTransform(R,P),$=n.Util.applyTransform(R.slice(2),P);this.minX=Math.min(this.minX,W[0],$[0]),this.minY=Math.min(this.minY,W[1],$[1]),this.maxX=Math.max(this.maxX,W[0],$[0]),this.maxY=Math.max(this.maxY,W[1],$[1])}updateScalingPathMinMax(P,R){n.Util.scaleMinMax(P,R),this.minX=Math.min(this.minX,R[0]),this.maxX=Math.max(this.maxX,R[1]),this.minY=Math.min(this.minY,R[2]),this.maxY=Math.max(this.maxY,R[3])}updateCurvePathMinMax(P,R,W,$,V,ee,z,j,q,x){const T=n.Util.bezierBoundingBox(R,W,$,V,ee,z,j,q);if(x){x[0]=Math.min(x[0],T[0],T[2]),x[1]=Math.max(x[1],T[0],T[2]),x[2]=Math.min(x[2],T[1],T[3]),x[3]=Math.max(x[3],T[1],T[3]);return}this.updateRectMinMax(P,T)}getPathBoundingBox(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const W=[this.minX,this.minY,this.maxX,this.maxY];if(P===i.PathType.STROKE){R||(0,n.unreachable)("Stroke bounding box must include transform.");const $=n.Util.singularValueDecompose2dScale(R),V=$[0]*this.lineWidth/2,ee=$[1]*this.lineWidth/2;W[0]-=V,W[1]-=ee,W[2]+=V,W[3]+=ee}return W}updateClipFromPath(){const P=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(P||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(P){this.clipBox=P,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return n.Util.intersect(this.clipBox,this.getPathBoundingBox(P,R))}}function O(X,P){if(typeof ImageData<"u"&&P instanceof ImageData){X.putImageData(P,0,0);return}const R=P.height,W=P.width,$=R%m,V=(R-$)/m,ee=$===0?V:V+1,z=X.createImageData(W,m);let j=0,q;const x=P.data,T=z.data;let I,L,U,Y;if(P.kind===n.ImageKind.GRAYSCALE_1BPP){const ce=x.byteLength,le=new Uint32Array(T.buffer,0,T.byteLength>>2),fe=le.length,de=W+7>>3,ye=4294967295,be=n.FeatureTest.isLittleEndian?4278190080:255;for(I=0;I<ee;I++){for(U=I<V?m:$,q=0,L=0;L<U;L++){const ve=ce-j;let xe=0;const Oe=ve>de?W:ve*8-7,Pe=Oe&-8;let Le=0,se=0;for(;xe<Pe;xe+=8)se=x[j++],le[q++]=se&128?ye:be,le[q++]=se&64?ye:be,le[q++]=se&32?ye:be,le[q++]=se&16?ye:be,le[q++]=se&8?ye:be,le[q++]=se&4?ye:be,le[q++]=se&2?ye:be,le[q++]=se&1?ye:be;for(;xe<Oe;xe++)Le===0&&(se=x[j++],Le=128),le[q++]=se&Le?ye:be,Le>>=1}for(;q<fe;)le[q++]=0;X.putImageData(z,0,I*m)}}else if(P.kind===n.ImageKind.RGBA_32BPP){for(L=0,Y=W*m*4,I=0;I<V;I++)T.set(x.subarray(j,j+Y)),j+=Y,X.putImageData(z,0,L),L+=m;I<ee&&(Y=W*$*4,T.set(x.subarray(j,j+Y)),X.putImageData(z,0,L))}else if(P.kind===n.ImageKind.RGB_24BPP)for(U=m,Y=W*U,I=0;I<ee;I++){for(I>=V&&(U=$,Y=W*U),q=0,L=Y;L--;)T[q++]=x[j++],T[q++]=x[j++],T[q++]=x[j++],T[q++]=255;X.putImageData(z,0,I*m)}else throw new Error(`bad image kind: ${P.kind}`)}function f(X,P){if(P.bitmap){X.drawImage(P.bitmap,0,0);return}const R=P.height,W=P.width,$=R%m,V=(R-$)/m,ee=$===0?V:V+1,z=X.createImageData(W,m);let j=0;const q=P.data,x=z.data;for(let T=0;T<ee;T++){const I=T<V?m:$;({srcPos:j}=(0,o.convertBlackAndWhiteToRGBA)({src:q,srcPos:j,dest:x,width:W,height:I,nonBlackColor:0})),X.putImageData(z,0,T*m)}}function d(X,P){const R=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const W of R)X[W]!==void 0&&(P[W]=X[W]);X.setLineDash!==void 0&&(P.setLineDash(X.getLineDash()),P.lineDashOffset=X.lineDashOffset)}function p(X){X.strokeStyle=X.fillStyle="#000000",X.fillRule="nonzero",X.globalAlpha=1,X.lineWidth=1,X.lineCap="butt",X.lineJoin="miter",X.miterLimit=10,X.globalCompositeOperation="source-over",X.font="10px sans-serif",X.setLineDash!==void 0&&(X.setLineDash([]),X.lineDashOffset=0),c.isNodeJS||(X.filter="none")}function _(X,P,R,W){const $=X.length;for(let V=3;V<$;V+=4){const ee=X[V];if(ee===0)X[V-3]=P,X[V-2]=R,X[V-1]=W;else if(ee<255){const z=255-ee;X[V-3]=X[V-3]*ee+P*z>>8,X[V-2]=X[V-2]*ee+R*z>>8,X[V-1]=X[V-1]*ee+W*z>>8}}}function w(X,P,R){const W=X.length,$=1/255;for(let V=3;V<W;V+=4){const ee=R?R[X[V]]:X[V];P[V]=P[V]*ee*$|0}}function M(X,P,R){const W=X.length;for(let $=3;$<W;$+=4){const V=X[$-3]*77+X[$-2]*152+X[$-1]*28;P[$]=R?P[$]*R[V>>8]>>8:P[$]*V>>16}}function E(X,P,R,W,$,V,ee,z,j,q,x){const T=!!V,I=T?V[0]:0,L=T?V[1]:0,U=T?V[2]:0;let Y;$==="Luminosity"?Y=M:Y=w;const le=Math.min(W,Math.ceil(1048576/R));for(let fe=0;fe<W;fe+=le){const de=Math.min(le,W-fe),ye=X.getImageData(z-q,fe+(j-x),R,de),be=P.getImageData(z,fe+j,R,de);T&&_(ye.data,I,L,U),Y(ye.data,be.data,ee),P.putImageData(be,z,fe+j)}}function F(X,P,R,W){const $=W[0],V=W[1],ee=W[2]-$,z=W[3]-V;ee===0||z===0||(E(P.context,R,ee,z,P.subtype,P.backdrop,P.transferMap,$,V,P.offsetX,P.offsetY),X.save(),X.globalAlpha=1,X.globalCompositeOperation="source-over",X.setTransform(1,0,0,1,0,0),X.drawImage(R.canvas,0,0),X.restore())}function G(X,P){const R=n.Util.singularValueDecompose2dScale(X);R[0]=Math.fround(R[0]),R[1]=Math.fround(R[1]);const W=Math.fround((globalThis.devicePixelRatio||1)*s.PixelsPerInch.PDF_TO_CSS_UNITS);return P!==void 0?P:R[0]<=W||R[1]<=W}const H=["butt","round","square"],K=["miter","round","bevel"],Z={},ae={},_e=class{constructor(P,R,W,$,V,ee,z,j){he(this,ie);he(this,J);let{optionalContentConfig:q,markedContentStack:x=null}=ee;this.ctx=P,this.current=new k(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=R,this.objs=W,this.canvasFactory=$,this.filterFactory=V,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=x||[],this.optionalContentConfig=q,this.cachedCanvases=new v(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=z,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=j,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(P){let R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof P=="string"?P.startsWith("g_")?this.commonObjs.get(P):this.objs.get(P):R}beginDrawing(P){let{transform:R,viewport:W,transparency:$=!1,background:V=null}=P;const ee=this.ctx.canvas.width,z=this.ctx.canvas.height,j=this.ctx.fillStyle;if(this.ctx.fillStyle=V||"#ffffff",this.ctx.fillRect(0,0,ee,z),this.ctx.fillStyle=j,$){const q=this.cachedCanvases.getCanvas("transparent",ee,z);this.compositeCtx=this.ctx,this.transparentCanvas=q.canvas,this.ctx=q.context,this.ctx.save(),this.ctx.transform(...(0,s.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),p(this.ctx),R&&(this.ctx.transform(...R),this.outputScaleX=R[0],this.outputScaleY=R[0]),this.ctx.transform(...W.transform),this.viewportScale=W.scale,this.baseTransform=(0,s.getCurrentTransform)(this.ctx)}executeOperatorList(P,R,W,$){const V=P.argsArray,ee=P.fnArray;let z=R||0;const j=V.length;if(j===z)return z;const q=j-z>y&&typeof W=="function",x=q?Date.now()+h:0;let T=0;const I=this.commonObjs,L=this.objs;let U;for(;;){if($!==void 0&&z===$.nextBreakPoint)return $.breakIt(z,W),z;if(U=ee[z],U!==n.OPS.dependency)this[U].apply(this,V[z]);else for(const Y of V[z]){const ce=Y.startsWith("g_")?I:L;if(!ce.has(Y))return ce.get(Y,W),z}if(z++,z===j)return z;if(q&&++T>y){if(Date.now()>x)return W(),z;T=0}}}endDrawing(){me(this,ie,Gt).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const P of this._cachedBitmapsMap.values()){for(const R of P.values())typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement&&(R.width=R.height=0);P.clear()}this._cachedBitmapsMap.clear(),me(this,J,zt).call(this)}_scaleImage(P,R){const W=P.width,$=P.height;let V=Math.max(Math.hypot(R[0],R[1]),1),ee=Math.max(Math.hypot(R[2],R[3]),1),z=W,j=$,q="prescale1",x,T;for(;V>2&&z>1||ee>2&&j>1;){let I=z,L=j;V>2&&z>1&&(I=z>=16384?Math.floor(z/2)-1||1:Math.ceil(z/2),V/=z/I),ee>2&&j>1&&(L=j>=16384?Math.floor(j/2)-1||1:Math.ceil(j)/2,ee/=j/L),x=this.cachedCanvases.getCanvas(q,I,L),T=x.context,T.clearRect(0,0,I,L),T.drawImage(P,0,0,z,j,0,0,I,L),P=x.canvas,z=I,j=L,q=q==="prescale1"?"prescale2":"prescale1"}return{img:P,paintWidth:z,paintHeight:j}}_createMaskCanvas(P){const R=this.ctx,{width:W,height:$}=P,V=this.current.fillColor,ee=this.current.patternFill,z=(0,s.getCurrentTransform)(R);let j,q,x,T;if((P.bitmap||P.data)&&P.count>1){const xe=P.bitmap||P.data.buffer;q=JSON.stringify(ee?z:[z.slice(0,4),V]),j=this._cachedBitmapsMap.get(xe),j||(j=new Map,this._cachedBitmapsMap.set(xe,j));const Oe=j.get(q);if(Oe&&!ee){const Pe=Math.round(Math.min(z[0],z[2])+z[4]),Le=Math.round(Math.min(z[1],z[3])+z[5]);return{canvas:Oe,offsetX:Pe,offsetY:Le}}x=Oe}x||(T=this.cachedCanvases.getCanvas("maskCanvas",W,$),f(T.context,P));let I=n.Util.transform(z,[1/W,0,0,-1/$,0,0]);I=n.Util.transform(I,[1,0,0,1,0,-$]);const L=n.Util.applyTransform([0,0],I),U=n.Util.applyTransform([W,$],I),Y=n.Util.normalizeRect([L[0],L[1],U[0],U[1]]),ce=Math.round(Y[2]-Y[0])||1,le=Math.round(Y[3]-Y[1])||1,fe=this.cachedCanvases.getCanvas("fillCanvas",ce,le),de=fe.context,ye=Math.min(L[0],U[0]),be=Math.min(L[1],U[1]);de.translate(-ye,-be),de.transform(...I),x||(x=this._scaleImage(T.canvas,(0,s.getCurrentTransformInverse)(de)),x=x.img,j&&ee&&j.set(q,x)),de.imageSmoothingEnabled=G((0,s.getCurrentTransform)(de),P.interpolate),S(de,x,0,0,x.width,x.height,0,0,W,$),de.globalCompositeOperation="source-in";const ve=n.Util.transform((0,s.getCurrentTransformInverse)(de),[1,0,0,1,-ye,-be]);return de.fillStyle=ee?V.getPattern(R,this,ve,i.PathType.FILL):V,de.fillRect(0,0,W,$),j&&!ee&&(this.cachedCanvases.delete("fillCanvas"),j.set(q,fe.canvas)),{canvas:fe.canvas,offsetX:Math.round(ye),offsetY:Math.round(be)}}setLineWidth(P){P!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=P,this.ctx.lineWidth=P}setLineCap(P){this.ctx.lineCap=H[P]}setLineJoin(P){this.ctx.lineJoin=K[P]}setMiterLimit(P){this.ctx.miterLimit=P}setDash(P,R){const W=this.ctx;W.setLineDash!==void 0&&(W.setLineDash(P),W.lineDashOffset=R)}setRenderingIntent(P){}setFlatness(P){}setGState(P){for(const[R,W]of P)switch(R){case"LW":this.setLineWidth(W);break;case"LC":this.setLineCap(W);break;case"LJ":this.setLineJoin(W);break;case"ML":this.setMiterLimit(W);break;case"D":this.setDash(W[0],W[1]);break;case"RI":this.setRenderingIntent(W);break;case"FL":this.setFlatness(W);break;case"Font":this.setFont(W[0],W[1]);break;case"CA":this.current.strokeAlpha=W;break;case"ca":this.current.fillAlpha=W,this.ctx.globalAlpha=W;break;case"BM":this.ctx.globalCompositeOperation=W;break;case"SMask":this.current.activeSMask=W?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(W);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const P=this.inSMaskMode;this.current.activeSMask&&!P?this.beginSMaskMode():!this.current.activeSMask&&P&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const P=this.ctx.canvas.width,R=this.ctx.canvas.height,W="smaskGroupAt"+this.groupLevel,$=this.cachedCanvases.getCanvas(W,P,R);this.suspendedCtx=this.ctx,this.ctx=$.context;const V=this.ctx;V.setTransform(...(0,s.getCurrentTransform)(this.suspendedCtx)),d(this.suspendedCtx,V),b(V,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),d(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(P){if(!this.current.activeSMask)return;P?(P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),P[2]=Math.ceil(P[2]),P[3]=Math.ceil(P[3])):P=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const R=this.current.activeSMask,W=this.suspendedCtx;F(W,R,this.ctx,P),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(d(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const P=this.current;this.stateStack.push(P),this.current=P.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),d(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(P,R,W,$,V,ee){this.ctx.transform(P,R,W,$,V,ee),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(P,R,W){const $=this.ctx,V=this.current;let ee=V.x,z=V.y,j,q;const x=(0,s.getCurrentTransform)($),T=x[0]===0&&x[3]===0||x[1]===0&&x[2]===0,I=T?W.slice(0):null;for(let L=0,U=0,Y=P.length;L<Y;L++)switch(P[L]|0){case n.OPS.rectangle:ee=R[U++],z=R[U++];const ce=R[U++],le=R[U++],fe=ee+ce,de=z+le;$.moveTo(ee,z),ce===0||le===0?$.lineTo(fe,de):($.lineTo(fe,z),$.lineTo(fe,de),$.lineTo(ee,de)),T||V.updateRectMinMax(x,[ee,z,fe,de]),$.closePath();break;case n.OPS.moveTo:ee=R[U++],z=R[U++],$.moveTo(ee,z),T||V.updatePathMinMax(x,ee,z);break;case n.OPS.lineTo:ee=R[U++],z=R[U++],$.lineTo(ee,z),T||V.updatePathMinMax(x,ee,z);break;case n.OPS.curveTo:j=ee,q=z,ee=R[U+4],z=R[U+5],$.bezierCurveTo(R[U],R[U+1],R[U+2],R[U+3],ee,z),V.updateCurvePathMinMax(x,j,q,R[U],R[U+1],R[U+2],R[U+3],ee,z,I),U+=6;break;case n.OPS.curveTo2:j=ee,q=z,$.bezierCurveTo(ee,z,R[U],R[U+1],R[U+2],R[U+3]),V.updateCurvePathMinMax(x,j,q,ee,z,R[U],R[U+1],R[U+2],R[U+3],I),ee=R[U+2],z=R[U+3],U+=4;break;case n.OPS.curveTo3:j=ee,q=z,ee=R[U+2],z=R[U+3],$.bezierCurveTo(R[U],R[U+1],ee,z,ee,z),V.updateCurvePathMinMax(x,j,q,R[U],R[U+1],ee,z,ee,z,I),U+=4;break;case n.OPS.closePath:$.closePath();break}T&&V.updateScalingPathMinMax(x,I),V.setCurrentPoint(ee,z)}closePath(){this.ctx.closePath()}stroke(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const R=this.ctx,W=this.current.strokeColor;R.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof W=="object"&&W!==null&&W!==void 0&&W.getPattern?(R.save(),R.strokeStyle=W.getPattern(R,this,(0,s.getCurrentTransformInverse)(R),i.PathType.STROKE),this.rescaleAndStroke(!1),R.restore()):this.rescaleAndStroke(!0)),P&&this.consumePath(this.current.getClippedPathBoundingBox()),R.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const R=this.ctx,W=this.current.fillColor,$=this.current.patternFill;let V=!1;$&&(R.save(),R.fillStyle=W.getPattern(R,this,(0,s.getCurrentTransformInverse)(R),i.PathType.FILL),V=!0);const ee=this.current.getClippedPathBoundingBox();this.contentVisible&&ee!==null&&(this.pendingEOFill?(R.fill("evenodd"),this.pendingEOFill=!1):R.fill()),V&&R.restore(),P&&this.consumePath(ee)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Z}eoClip(){this.pendingClip=ae}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const P=this.pendingTextPaths,R=this.ctx;if(P===void 0){R.beginPath();return}R.save(),R.beginPath();for(const W of P)R.setTransform(...W.transform),R.translate(W.x,W.y),W.addToPath(R,W.fontSize);R.restore(),R.clip(),R.beginPath(),delete this.pendingTextPaths}setCharSpacing(P){this.current.charSpacing=P}setWordSpacing(P){this.current.wordSpacing=P}setHScale(P){this.current.textHScale=P/100}setLeading(P){this.current.leading=-P}setFont(P,R){var W;const $=this.commonObjs.get(P),V=this.current;if(!$)throw new Error(`Can't find font for ${P}`);if(V.fontMatrix=$.fontMatrix||n.FONT_IDENTITY_MATRIX,(V.fontMatrix[0]===0||V.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+P),R<0?(R=-R,V.fontDirection=-1):V.fontDirection=1,this.current.font=$,this.current.fontSize=R,$.isType3Font)return;const ee=$.loadedName||"sans-serif",z=((W=$.systemFontInfo)===null||W===void 0?void 0:W.css)||`"${ee}", ${$.fallbackName}`;let j="normal";$.black?j="900":$.bold&&(j="bold");const q=$.italic?"italic":"normal";let x=R;R<u?x=u:R>l&&(x=l),this.current.fontSizeScale=R/x,this.ctx.font=`${q} ${j} ${x}px ${z}`}setTextRenderingMode(P){this.current.textRenderingMode=P}setTextRise(P){this.current.textRise=P}moveText(P,R){this.current.x=this.current.lineX+=P,this.current.y=this.current.lineY+=R}setLeadingMoveText(P,R){this.setLeading(-R),this.moveText(P,R)}setTextMatrix(P,R,W,$,V,ee){this.current.textMatrix=[P,R,W,$,V,ee],this.current.textMatrixScale=Math.hypot(P,R),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(P,R,W,$){const V=this.ctx,ee=this.current,z=ee.font,j=ee.textRenderingMode,q=ee.fontSize/ee.fontSizeScale,x=j&n.TextRenderingMode.FILL_STROKE_MASK,T=!!(j&n.TextRenderingMode.ADD_TO_PATH_FLAG),I=ee.patternFill&&!z.missingFile;let L;(z.disableFontFace||T||I)&&(L=z.getPathGenerator(this.commonObjs,P)),z.disableFontFace||I?(V.save(),V.translate(R,W),V.beginPath(),L(V,q),$&&V.setTransform(...$),(x===n.TextRenderingMode.FILL||x===n.TextRenderingMode.FILL_STROKE)&&V.fill(),(x===n.TextRenderingMode.STROKE||x===n.TextRenderingMode.FILL_STROKE)&&V.stroke(),V.restore()):((x===n.TextRenderingMode.FILL||x===n.TextRenderingMode.FILL_STROKE)&&V.fillText(P,R,W),(x===n.TextRenderingMode.STROKE||x===n.TextRenderingMode.FILL_STROKE)&&V.strokeText(P,R,W)),T&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,s.getCurrentTransform)(V),x:R,y:W,fontSize:q,addToPath:L})}get isFontSubpixelAAEnabled(){const{context:P}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);P.scale(1.5,1),P.fillText("I",0,10);const R=P.getImageData(0,0,10,10).data;let W=!1;for(let $=3;$<R.length;$+=4)if(R[$]>0&&R[$]<255){W=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",W)}showText(P){const R=this.current,W=R.font;if(W.isType3Font)return this.showType3Text(P);const $=R.fontSize;if($===0)return;const V=this.ctx,ee=R.fontSizeScale,z=R.charSpacing,j=R.wordSpacing,q=R.fontDirection,x=R.textHScale*q,T=P.length,I=W.vertical,L=I?1:-1,U=W.defaultVMetrics,Y=$*R.fontMatrix[0],ce=R.textRenderingMode===n.TextRenderingMode.FILL&&!W.disableFontFace&&!R.patternFill;V.save(),V.transform(...R.textMatrix),V.translate(R.x,R.y+R.textRise),q>0?V.scale(x,-1):V.scale(x,1);let le;if(R.patternFill){V.save();const ve=R.fillColor.getPattern(V,this,(0,s.getCurrentTransformInverse)(V),i.PathType.FILL);le=(0,s.getCurrentTransform)(V),V.restore(),V.fillStyle=ve}let fe=R.lineWidth;const de=R.textMatrixScale;if(de===0||fe===0){const ve=R.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(ve===n.TextRenderingMode.STROKE||ve===n.TextRenderingMode.FILL_STROKE)&&(fe=this.getSinglePixelWidth())}else fe/=de;if(ee!==1&&(V.scale(ee,ee),fe/=ee),V.lineWidth=fe,W.isInvalidPDFjsFont){const ve=[];let xe=0;for(const Oe of P)ve.push(Oe.unicode),xe+=Oe.width;V.fillText(ve.join(""),0,0),R.x+=xe*Y*x,V.restore(),this.compose();return}let ye=0,be;for(be=0;be<T;++be){const ve=P[be];if(typeof ve=="number"){ye+=L*ve*$/1e3;continue}let xe=!1;const Oe=(ve.isSpace?j:0)+z,Pe=ve.fontChar,Le=ve.accent;let se,Te,Ue=ve.width;if(I){const $e=ve.vmetric||U,Q=-(ve.vmetric?$e[1]:Ue*.5)*Y,re=$e[2]*Y;Ue=$e?-$e[0]:Ue,se=Q/ee,Te=(ye+re)/ee}else se=ye/ee,Te=0;if(W.remeasure&&Ue>0){const $e=V.measureText(Pe).width*1e3/$*ee;if(Ue<$e&&this.isFontSubpixelAAEnabled){const Q=Ue/$e;xe=!0,V.save(),V.scale(Q,1),se/=Q}else Ue!==$e&&(se+=(Ue-$e)/2e3*$/ee)}if(this.contentVisible&&(ve.isInFont||W.missingFile)){if(ce&&!Le)V.fillText(Pe,se,Te);else if(this.paintChar(Pe,se,Te,le),Le){const $e=se+$*Le.offset.x/ee,Q=Te-$*Le.offset.y/ee;this.paintChar(Le.fontChar,$e,Q,le)}}let Ve;I?Ve=Ue*Y-Oe*q:Ve=Ue*Y+Oe*q,ye+=Ve,xe&&V.restore()}I?R.y-=ye:R.x+=ye*x,V.restore(),this.compose()}showType3Text(P){const R=this.ctx,W=this.current,$=W.font,V=W.fontSize,ee=W.fontDirection,z=$.vertical?1:-1,j=W.charSpacing,q=W.wordSpacing,x=W.textHScale*ee,T=W.fontMatrix||n.FONT_IDENTITY_MATRIX,I=P.length,L=W.textRenderingMode===n.TextRenderingMode.INVISIBLE;let U,Y,ce,le;if(!(L||V===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,R.save(),R.transform(...W.textMatrix),R.translate(W.x,W.y),R.scale(x,ee),U=0;U<I;++U){if(Y=P[U],typeof Y=="number"){le=z*Y*V/1e3,this.ctx.translate(le,0),W.x+=le*x;continue}const fe=(Y.isSpace?q:0)+j,de=$.charProcOperatorList[Y.operatorListId];if(!de){(0,n.warn)(`Type3 character "${Y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Y,this.save(),R.scale(V,V),R.transform(...T),this.executeOperatorList(de),this.restore()),ce=n.Util.applyTransform([Y.width,0],T)[0]*V+fe,R.translate(ce,0),W.x+=ce*x}R.restore(),this.processingType3=null}}setCharWidth(P,R){}setCharWidthAndBounds(P,R,W,$,V,ee){this.ctx.rect(W,$,V-W,ee-$),this.ctx.clip(),this.endPath()}getColorN_Pattern(P){let R;if(P[0]==="TilingPattern"){const W=P[1],$=this.baseTransform||(0,s.getCurrentTransform)(this.ctx),V={createCanvasGraphics:ee=>new _e(ee,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};R=new i.TilingPattern(P,W,this.ctx,V,$)}else R=this._getPattern(P[1],P[2]);return R}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(P,R,W){const $=n.Util.makeHexColor(P,R,W);this.ctx.strokeStyle=$,this.current.strokeColor=$}setFillRGBColor(P,R,W){const $=n.Util.makeHexColor(P,R,W);this.ctx.fillStyle=$,this.current.fillColor=$,this.current.patternFill=!1}_getPattern(P){let R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,W;return this.cachedPatterns.has(P)?W=this.cachedPatterns.get(P):(W=(0,i.getShadingPattern)(this.getObject(P)),this.cachedPatterns.set(P,W)),R&&(W.matrix=R),W}shadingFill(P){if(!this.contentVisible)return;const R=this.ctx;this.save();const W=this._getPattern(P);R.fillStyle=W.getPattern(R,this,(0,s.getCurrentTransformInverse)(R),i.PathType.SHADING);const $=(0,s.getCurrentTransformInverse)(R);if($){const V=R.canvas,ee=V.width,z=V.height,j=n.Util.applyTransform([0,0],$),q=n.Util.applyTransform([0,z],$),x=n.Util.applyTransform([ee,0],$),T=n.Util.applyTransform([ee,z],$),I=Math.min(j[0],q[0],x[0],T[0]),L=Math.min(j[1],q[1],x[1],T[1]),U=Math.max(j[0],q[0],x[0],T[0]),Y=Math.max(j[1],q[1],x[1],T[1]);this.ctx.fillRect(I,L,U-I,Y-L)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(P,R){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(P)&&P.length===6&&this.transform(...P),this.baseTransform=(0,s.getCurrentTransform)(this.ctx),R)){const W=R[2]-R[0],$=R[3]-R[1];this.ctx.rect(R[0],R[1],W,$),this.current.updateRectMinMax((0,s.getCurrentTransform)(this.ctx),R),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(P){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const R=this.ctx;P.isolated||(0,n.info)("TODO: Support non-isolated groups."),P.knockout&&(0,n.warn)("Knockout groups not supported.");const W=(0,s.getCurrentTransform)(R);if(P.matrix&&R.transform(...P.matrix),!P.bbox)throw new Error("Bounding box is required.");let $=n.Util.getAxialAlignedBoundingBox(P.bbox,(0,s.getCurrentTransform)(R));const V=[0,0,R.canvas.width,R.canvas.height];$=n.Util.intersect($,V)||[0,0,0,0];const ee=Math.floor($[0]),z=Math.floor($[1]);let j=Math.max(Math.ceil($[2])-ee,1),q=Math.max(Math.ceil($[3])-z,1),x=1,T=1;j>a&&(x=j/a,j=a),q>a&&(T=q/a,q=a),this.current.startNewPathAndClipBox([0,0,j,q]);let I="groupAt"+this.groupLevel;P.smask&&(I+="_smask_"+this.smaskCounter++%2);const L=this.cachedCanvases.getCanvas(I,j,q),U=L.context;U.scale(1/x,1/T),U.translate(-ee,-z),U.transform(...W),P.smask?this.smaskStack.push({canvas:L.canvas,context:U,offsetX:ee,offsetY:z,scaleX:x,scaleY:T,subtype:P.smask.subtype,backdrop:P.smask.backdrop,transferMap:P.smask.transferMap||null,startTransformInverse:null}):(R.setTransform(1,0,0,1,0,0),R.translate(ee,z),R.scale(x,T),R.save()),d(R,U),this.ctx=U,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(R),this.groupLevel++}endGroup(P){if(!this.contentVisible)return;this.groupLevel--;const R=this.ctx,W=this.groupStack.pop();if(this.ctx=W,this.ctx.imageSmoothingEnabled=!1,P.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const $=(0,s.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...$);const V=n.Util.getAxialAlignedBoundingBox([0,0,R.canvas.width,R.canvas.height],$);this.ctx.drawImage(R.canvas,0,0),this.ctx.restore(),this.compose(V)}}beginAnnotation(P,R,W,$,V){if(me(this,ie,Gt).call(this),p(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(R)&&R.length===4){const ee=R[2]-R[0],z=R[3]-R[1];if(V&&this.annotationCanvasMap){W=W.slice(),W[4]-=R[0],W[5]-=R[1],R=R.slice(),R[0]=R[1]=0,R[2]=ee,R[3]=z;const[j,q]=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(this.ctx)),{viewportScale:x}=this,T=Math.ceil(ee*this.outputScaleX*x),I=Math.ceil(z*this.outputScaleY*x);this.annotationCanvas=this.canvasFactory.create(T,I);const{canvas:L,context:U}=this.annotationCanvas;this.annotationCanvasMap.set(P,L),this.annotationCanvas.savedCtx=this.ctx,this.ctx=U,this.ctx.save(),this.ctx.setTransform(j,0,0,-q,0,z*q),p(this.ctx)}else p(this.ctx),this.ctx.rect(R[0],R[1],ee,z),this.ctx.clip(),this.endPath()}this.current=new k(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...W),this.transform(...$)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),me(this,J,zt).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(P){if(!this.contentVisible)return;const R=P.count;P=this.getObject(P.data,P),P.count=R;const W=this.ctx,$=this.processingType3;if($&&($.compiled===void 0&&($.compiled=N(P)),$.compiled)){$.compiled(W);return}const V=this._createMaskCanvas(P),ee=V.canvas;W.save(),W.setTransform(1,0,0,1,0,0),W.drawImage(ee,V.offsetX,V.offsetY),W.restore(),this.compose()}paintImageMaskXObjectRepeat(P,R){let W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,V=arguments.length>4?arguments[4]:void 0,ee=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;P=this.getObject(P.data,P);const z=this.ctx;z.save();const j=(0,s.getCurrentTransform)(z);z.transform(R,W,$,V,0,0);const q=this._createMaskCanvas(P);z.setTransform(1,0,0,1,q.offsetX-j[4],q.offsetY-j[5]);for(let x=0,T=ee.length;x<T;x+=2){const I=n.Util.transform(j,[R,W,$,V,ee[x],ee[x+1]]),[L,U]=n.Util.applyTransform([0,0],I);z.drawImage(q.canvas,L,U)}z.restore(),this.compose()}paintImageMaskXObjectGroup(P){if(!this.contentVisible)return;const R=this.ctx,W=this.current.fillColor,$=this.current.patternFill;for(const V of P){const{data:ee,width:z,height:j,transform:q}=V,x=this.cachedCanvases.getCanvas("maskCanvas",z,j),T=x.context;T.save();const I=this.getObject(ee,V);f(T,I),T.globalCompositeOperation="source-in",T.fillStyle=$?W.getPattern(T,this,(0,s.getCurrentTransformInverse)(R),i.PathType.FILL):W,T.fillRect(0,0,z,j),T.restore(),R.save(),R.transform(...q),R.scale(1,-1),S(R,x.canvas,0,0,z,j,0,-1,1,1),R.restore()}this.compose()}paintImageXObject(P){if(!this.contentVisible)return;const R=this.getObject(P);if(!R){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(R)}paintImageXObjectRepeat(P,R,W,$){if(!this.contentVisible)return;const V=this.getObject(P);if(!V){(0,n.warn)("Dependent image isn't ready yet");return}const ee=V.width,z=V.height,j=[];for(let q=0,x=$.length;q<x;q+=2)j.push({transform:[R,0,0,W,$[q],$[q+1]],x:0,y:0,w:ee,h:z});this.paintInlineImageXObjectGroup(V,j)}applyTransferMapsToCanvas(P){return this.current.transferMaps!=="none"&&(P.filter=this.current.transferMaps,P.drawImage(P.canvas,0,0),P.filter="none"),P.canvas}applyTransferMapsToBitmap(P){if(this.current.transferMaps==="none")return P.bitmap;const{bitmap:R,width:W,height:$}=P,V=this.cachedCanvases.getCanvas("inlineImage",W,$),ee=V.context;return ee.filter=this.current.transferMaps,ee.drawImage(R,0,0),ee.filter="none",V.canvas}paintInlineImageXObject(P){if(!this.contentVisible)return;const R=P.width,W=P.height,$=this.ctx;this.save(),c.isNodeJS||($.filter="none"),$.scale(1/R,-1/W);let V;if(P.bitmap)V=this.applyTransferMapsToBitmap(P);else if(typeof HTMLElement=="function"&&P instanceof HTMLElement||!P.data)V=P;else{const j=this.cachedCanvases.getCanvas("inlineImage",R,W).context;O(j,P),V=this.applyTransferMapsToCanvas(j)}const ee=this._scaleImage(V,(0,s.getCurrentTransformInverse)($));$.imageSmoothingEnabled=G((0,s.getCurrentTransform)($),P.interpolate),S($,ee.img,0,0,ee.paintWidth,ee.paintHeight,0,-W,R,W),this.compose(),this.restore()}paintInlineImageXObjectGroup(P,R){if(!this.contentVisible)return;const W=this.ctx;let $;if(P.bitmap)$=P.bitmap;else{const V=P.width,ee=P.height,j=this.cachedCanvases.getCanvas("inlineImage",V,ee).context;O(j,P),$=this.applyTransferMapsToCanvas(j)}for(const V of R)W.save(),W.transform(...V.transform),W.scale(1,-1),S(W,$,V.x,V.y,V.w,V.h,0,-1,1,1),W.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(P){}markPointProps(P,R){}beginMarkedContent(P){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(P,R){P==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(R)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(P){const R=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(P);const W=this.ctx;this.pendingClip&&(R||(this.pendingClip===ae?W.clip("evenodd"):W.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),W.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const P=(0,s.getCurrentTransform)(this.ctx);if(P[1]===0&&P[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(P[0]),Math.abs(P[3]));else{const R=Math.abs(P[0]*P[3]-P[2]*P[1]),W=Math.hypot(P[0],P[2]),$=Math.hypot(P[1],P[3]);this._cachedGetSinglePixelWidth=Math.max(W,$)/R}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:P}=this.current,{a:R,b:W,c:$,d:V}=this.ctx.getTransform();let ee,z;if(W===0&&$===0){const j=Math.abs(R),q=Math.abs(V);if(j===q)if(P===0)ee=z=1/j;else{const x=j*P;ee=z=x<1?1/x:1}else if(P===0)ee=1/j,z=1/q;else{const x=j*P,T=q*P;ee=x<1?1/x:1,z=T<1?1/T:1}}else{const j=Math.abs(R*V-W*$),q=Math.hypot(R,W),x=Math.hypot($,V);if(P===0)ee=x/j,z=q/j;else{const T=P*j;ee=x>T?x/T:1,z=q>T?q/T:1}}this._cachedScaleForStroking[0]=ee,this._cachedScaleForStroking[1]=z}return this._cachedScaleForStroking}rescaleAndStroke(P){const{ctx:R}=this,{lineWidth:W}=this.current,[$,V]=this.getScaleForStroking();if(R.lineWidth=W||1,$===1&&V===1){R.stroke();return}const ee=R.getLineDash();if(P&&R.save(),R.scale($,V),ee.length>0){const z=Math.max($,V);R.setLineDash(ee.map(j=>j/z)),R.lineDashOffset/=z}R.stroke(),P&&R.restore()}isContentVisible(){for(let P=this.markedContentStack.length-1;P>=0;P--)if(!this.markedContentStack[P].visible)return!1;return!0}};let oe=_e;ie=new WeakSet,Gt=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},J=new WeakSet,zt=function(){if(this.pageColors){const P=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(P!=="none"){const R=this.ctx.filter;this.ctx.filter=P,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=R}}},e.CanvasGraphics=oe;for(const X in n.OPS)oe.prototype[X]!==void 0&&(oe.prototype[n.OPS[X]]=oe.prototype[X])},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=g;var n=t(1),s=t(142);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=i;function o(S,N){if(!N)return;const k=N[2]-N[0],O=N[3]-N[1],f=new Path2D;f.rect(N[0],N[1],k,O),S.clip(f)}class c{constructor(){this.constructor===c&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class u extends c{constructor(N){super(),this._type=N[1],this._bbox=N[2],this._colorStops=N[3],this._p0=N[4],this._p1=N[5],this._r0=N[6],this._r1=N[7],this.matrix=null}_createGradient(N){let k;this._type==="axial"?k=N.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(k=N.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const O of this._colorStops)k.addColorStop(O[0],O[1]);return k}getPattern(N,k,O,f){let d;if(f===i.STROKE||f===i.FILL){const p=k.current.getClippedPathBoundingBox(f,(0,s.getCurrentTransform)(N))||[0,0,0,0],_=Math.ceil(p[2]-p[0])||1,w=Math.ceil(p[3]-p[1])||1,M=k.cachedCanvases.getCanvas("pattern",_,w,!0),E=M.context;E.clearRect(0,0,E.canvas.width,E.canvas.height),E.beginPath(),E.rect(0,0,E.canvas.width,E.canvas.height),E.translate(-p[0],-p[1]),O=n.Util.transform(O,[1,0,0,1,p[0],p[1]]),E.transform(...k.baseTransform),this.matrix&&E.transform(...this.matrix),o(E,this._bbox),E.fillStyle=this._createGradient(E),E.fill(),d=N.createPattern(M.canvas,"no-repeat");const F=new DOMMatrix(O);d.setTransform(F)}else o(N,this._bbox),d=this._createGradient(N);return d}}function l(S,N,k,O,f,d,p,_){const w=N.coords,M=N.colors,E=S.data,F=S.width*4;let G;w[k+1]>w[O+1]&&(G=k,k=O,O=G,G=d,d=p,p=G),w[O+1]>w[f+1]&&(G=O,O=f,f=G,G=p,p=_,_=G),w[k+1]>w[O+1]&&(G=k,k=O,O=G,G=d,d=p,p=G);const H=(w[k]+N.offsetX)*N.scaleX,K=(w[k+1]+N.offsetY)*N.scaleY,Z=(w[O]+N.offsetX)*N.scaleX,ae=(w[O+1]+N.offsetY)*N.scaleY,oe=(w[f]+N.offsetX)*N.scaleX,ie=(w[f+1]+N.offsetY)*N.scaleY;if(K>=ie)return;const ne=M[d],J=M[d+1],ge=M[d+2],_e=M[p],X=M[p+1],P=M[p+2],R=M[_],W=M[_+1],$=M[_+2],V=Math.round(K),ee=Math.round(ie);let z,j,q,x,T,I,L,U;for(let Y=V;Y<=ee;Y++){if(Y<ae){let ye;Y<K?ye=0:ye=(K-Y)/(K-ae),z=H-(H-Z)*ye,j=ne-(ne-_e)*ye,q=J-(J-X)*ye,x=ge-(ge-P)*ye}else{let ye;Y>ie?ye=1:ae===ie?ye=0:ye=(ae-Y)/(ae-ie),z=Z-(Z-oe)*ye,j=_e-(_e-R)*ye,q=X-(X-W)*ye,x=P-(P-$)*ye}let ce;Y<K?ce=0:Y>ie?ce=1:ce=(K-Y)/(K-ie),T=H-(H-oe)*ce,I=ne-(ne-R)*ce,L=J-(J-W)*ce,U=ge-(ge-$)*ce;const le=Math.round(Math.min(z,T)),fe=Math.round(Math.max(z,T));let de=F*Y+le*4;for(let ye=le;ye<=fe;ye++)ce=(z-ye)/(z-T),ce<0?ce=0:ce>1&&(ce=1),E[de++]=j-(j-I)*ce|0,E[de++]=q-(q-L)*ce|0,E[de++]=x-(x-U)*ce|0,E[de++]=255}}function a(S,N,k){const O=N.coords,f=N.colors;let d,p;switch(N.type){case"lattice":const _=N.verticesPerRow,w=Math.floor(O.length/_)-1,M=_-1;for(d=0;d<w;d++){let E=d*_;for(let F=0;F<M;F++,E++)l(S,k,O[E],O[E+1],O[E+_],f[E],f[E+1],f[E+_]),l(S,k,O[E+_+1],O[E+1],O[E+_],f[E+_+1],f[E+1],f[E+_])}break;case"triangles":for(d=0,p=O.length;d<p;d+=3)l(S,k,O[d],O[d+1],O[d+2],f[d],f[d+1],f[d+2]);break;default:throw new Error("illegal figure")}}class h extends c{constructor(N){super(),this._coords=N[2],this._colors=N[3],this._figures=N[4],this._bounds=N[5],this._bbox=N[7],this._background=N[8],this.matrix=null}_createMeshCanvas(N,k,O){const _=Math.floor(this._bounds[0]),w=Math.floor(this._bounds[1]),M=Math.ceil(this._bounds[2])-_,E=Math.ceil(this._bounds[3])-w,F=Math.min(Math.ceil(Math.abs(M*N[0]*1.1)),3e3),G=Math.min(Math.ceil(Math.abs(E*N[1]*1.1)),3e3),H=M/F,K=E/G,Z={coords:this._coords,colors:this._colors,offsetX:-_,offsetY:-w,scaleX:1/H,scaleY:1/K},ae=F+2*2,oe=G+2*2,ie=O.getCanvas("mesh",ae,oe,!1),ne=ie.context,J=ne.createImageData(F,G);if(k){const _e=J.data;for(let X=0,P=_e.length;X<P;X+=4)_e[X]=k[0],_e[X+1]=k[1],_e[X+2]=k[2],_e[X+3]=255}for(const _e of this._figures)a(J,_e,Z);return ne.putImageData(J,2,2),{canvas:ie.canvas,offsetX:_-2*H,offsetY:w-2*K,scaleX:H,scaleY:K}}getPattern(N,k,O,f){o(N,this._bbox);let d;if(f===i.SHADING)d=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(N));else if(d=n.Util.singularValueDecompose2dScale(k.baseTransform),this.matrix){const _=n.Util.singularValueDecompose2dScale(this.matrix);d=[d[0]*_[0],d[1]*_[1]]}const p=this._createMeshCanvas(d,f===i.SHADING?null:this._background,k.cachedCanvases);return f!==i.SHADING&&(N.setTransform(...k.baseTransform),this.matrix&&N.transform(...this.matrix)),N.translate(p.offsetX,p.offsetY),N.scale(p.scaleX,p.scaleY),N.createPattern(p.canvas,"no-repeat")}}class y extends c{getPattern(){return"hotpink"}}function g(S){switch(S[0]){case"RadialAxial":return new u(S);case"Mesh":return new h(S);case"Dummy":return new y}throw new Error(`Unknown IR type: ${S[0]}`)}const m={COLORED:1,UNCOLORED:2},v=class{constructor(N,k,O,f,d){this.operatorList=N[2],this.matrix=N[3]||[1,0,0,1,0,0],this.bbox=N[4],this.xstep=N[5],this.ystep=N[6],this.paintType=N[7],this.tilingType=N[8],this.color=k,this.ctx=O,this.canvasGraphicsFactory=f,this.baseTransform=d}createPatternCanvas(N){const k=this.operatorList,O=this.bbox,f=this.xstep,d=this.ystep,p=this.paintType,_=this.tilingType,w=this.color,M=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+_);const E=O[0],F=O[1],G=O[2],H=O[3],K=n.Util.singularValueDecompose2dScale(this.matrix),Z=n.Util.singularValueDecompose2dScale(this.baseTransform),ae=[K[0]*Z[0],K[1]*Z[1]],oe=this.getSizeAndScale(f,this.ctx.canvas.width,ae[0]),ie=this.getSizeAndScale(d,this.ctx.canvas.height,ae[1]),ne=N.cachedCanvases.getCanvas("pattern",oe.size,ie.size,!0),J=ne.context,ge=M.createCanvasGraphics(J);ge.groupLevel=N.groupLevel,this.setFillAndStrokeStyleToContext(ge,p,w);let _e=E,X=F,P=G,R=H;return E<0&&(_e=0,P+=Math.abs(E)),F<0&&(X=0,R+=Math.abs(F)),J.translate(-(oe.scale*_e),-(ie.scale*X)),ge.transform(oe.scale,0,0,ie.scale,0,0),J.save(),this.clipBbox(ge,_e,X,P,R),ge.baseTransform=(0,s.getCurrentTransform)(ge.ctx),ge.executeOperatorList(k),ge.endDrawing(),{canvas:ne.canvas,scaleX:oe.scale,scaleY:ie.scale,offsetX:_e,offsetY:X}}getSizeAndScale(N,k,O){N=Math.abs(N);const f=Math.max(v.MAX_PATTERN_SIZE,k);let d=Math.ceil(N*O);return d>=f?d=f:O=d/N,{scale:O,size:d}}clipBbox(N,k,O,f,d){const p=f-k,_=d-O;N.ctx.rect(k,O,p,_),N.current.updateRectMinMax((0,s.getCurrentTransform)(N.ctx),[k,O,f,d]),N.clip(),N.endPath()}setFillAndStrokeStyleToContext(N,k,O){const f=N.ctx,d=N.current;switch(k){case m.COLORED:const p=this.ctx;f.fillStyle=p.fillStyle,f.strokeStyle=p.strokeStyle,d.fillColor=p.fillStyle,d.strokeColor=p.strokeStyle;break;case m.UNCOLORED:const _=n.Util.makeHexColor(O[0],O[1],O[2]);f.fillStyle=_,f.strokeStyle=_,d.fillColor=_,d.strokeColor=_;break;default:throw new n.FormatError(`Unsupported paint type: ${k}`)}}getPattern(N,k,O,f){let d=O;f!==i.SHADING&&(d=n.Util.transform(d,k.baseTransform),this.matrix&&(d=n.Util.transform(d,this.matrix)));const p=this.createPatternCanvas(k);let _=new DOMMatrix(d);_=_.translate(p.offsetX,p.offsetY),_=_.scale(1/p.scaleX,1/p.scaleY);const w=N.createPattern(p.canvas,"repeat");return w.setTransform(_),w}};let b=v;Ke(b,"MAX_PATTERN_SIZE",3e3),e.TilingPattern=b},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertBlackAndWhiteToRGBA=i,e.convertToRGBA=s,e.grayToRGBA=c;var n=t(1);function s(u){switch(u.kind){case n.ImageKind.GRAYSCALE_1BPP:return i(u);case n.ImageKind.RGB_24BPP:return o(u)}return null}function i(u){let{src:l,srcPos:a=0,dest:h,width:y,height:g,nonBlackColor:m=4294967295,inverseDecode:b=!1}=u;const v=n.FeatureTest.isLittleEndian?4278190080:255,[S,N]=b?[m,v]:[v,m],k=y>>3,O=y&7,f=l.length;h=new Uint32Array(h.buffer);let d=0;for(let p=0;p<g;p++){for(const w=a+k;a<w;a++){const M=a<f?l[a]:255;h[d++]=M&128?N:S,h[d++]=M&64?N:S,h[d++]=M&32?N:S,h[d++]=M&16?N:S,h[d++]=M&8?N:S,h[d++]=M&4?N:S,h[d++]=M&2?N:S,h[d++]=M&1?N:S}if(O===0)continue;const _=a<f?l[a++]:255;for(let w=0;w<O;w++)h[d++]=_&1<<7-w?N:S}return{srcPos:a,destPos:d}}function o(u){let{src:l,srcPos:a=0,dest:h,destPos:y=0,width:g,height:m}=u,b=0;const v=l.length>>2,S=new Uint32Array(l.buffer,a,v);if(n.FeatureTest.isLittleEndian){for(;b<v-2;b+=3,y+=4){const N=S[b],k=S[b+1],O=S[b+2];h[y]=N|4278190080,h[y+1]=N>>>24|k<<8|4278190080,h[y+2]=k>>>16|O<<16|4278190080,h[y+3]=O>>>8|4278190080}for(let N=b*4,k=l.length;N<k;N+=3)h[y++]=l[N]|l[N+1]<<8|l[N+2]<<16|4278190080}else{for(;b<v-2;b+=3,y+=4){const N=S[b],k=S[b+1],O=S[b+2];h[y]=N|255,h[y+1]=N<<24|k>>>8|255,h[y+2]=k<<16|O>>>16|255,h[y+3]=O<<8|255}for(let N=b*4,k=l.length;N<k;N+=3)h[y++]=l[N]<<24|l[N+1]<<16|l[N+2]<<8|255}return{srcPos:a,destPos:y}}function c(u,l){if(n.FeatureTest.isLittleEndian)for(let a=0,h=u.length;a<h;a++)l[a]=u[a]*65793|4278190080;else for(let a=0,h=u.length;a<h;a++)l[a]=u[a]*16843008|255}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=null,t.workerSrc=""},(r,e,t)=>{var u,gn,a,vn,y,Pt;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var n=t(1);const s={UNKNOWN:0,DATA:1,ERROR:2},i={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(m){switch(m instanceof Error||typeof m=="object"&&m!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),m.name){case"AbortException":return new n.AbortException(m.message);case"MissingPDFException":return new n.MissingPDFException(m.message);case"PasswordException":return new n.PasswordException(m.message,m.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(m.message,m.status);case"UnknownErrorException":return new n.UnknownErrorException(m.message,m.details);default:return new n.UnknownErrorException(m.message,m.toString())}}class c{constructor(b,v,S){he(this,u);he(this,a);he(this,y);this.sourceName=b,this.targetName=v,this.comObj=S,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=N=>{const k=N.data;if(k.targetName!==this.sourceName)return;if(k.stream){me(this,a,vn).call(this,k);return}if(k.callback){const f=k.callbackId,d=this.callbackCapabilities[f];if(!d)throw new Error(`Cannot resolve callback ${f}`);if(delete this.callbackCapabilities[f],k.callback===s.DATA)d.resolve(k.data);else if(k.callback===s.ERROR)d.reject(o(k.reason));else throw new Error("Unexpected callback case");return}const O=this.actionHandler[k.action];if(!O)throw new Error(`Unknown action from worker: ${k.action}`);if(k.callbackId){const f=this.sourceName,d=k.sourceName;new Promise(function(p){p(O(k.data))}).then(function(p){S.postMessage({sourceName:f,targetName:d,callback:s.DATA,callbackId:k.callbackId,data:p})},function(p){S.postMessage({sourceName:f,targetName:d,callback:s.ERROR,callbackId:k.callbackId,reason:o(p)})});return}if(k.streamId){me(this,u,gn).call(this,k);return}O(k.data)},S.addEventListener("message",this._onComObjOnMessage)}on(b,v){const S=this.actionHandler;if(S[b])throw new Error(`There is already an actionName called "${b}"`);S[b]=v}send(b,v,S){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:b,data:v},S)}sendWithPromise(b,v,S){const N=this.callbackId++,k=new n.PromiseCapability;this.callbackCapabilities[N]=k;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:b,callbackId:N,data:v},S)}catch(O){k.reject(O)}return k.promise}sendWithStream(b,v,S,N){const k=this.streamId++,O=this.sourceName,f=this.targetName,d=this.comObj;return new ReadableStream({start:p=>{const _=new n.PromiseCapability;return this.streamControllers[k]={controller:p,startCall:_,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:O,targetName:f,action:b,streamId:k,data:v,desiredSize:p.desiredSize},N),_.promise},pull:p=>{const _=new n.PromiseCapability;return this.streamControllers[k].pullCall=_,d.postMessage({sourceName:O,targetName:f,stream:i.PULL,streamId:k,desiredSize:p.desiredSize}),_.promise},cancel:p=>{(0,n.assert)(p instanceof Error,"cancel must have a valid reason");const _=new n.PromiseCapability;return this.streamControllers[k].cancelCall=_,this.streamControllers[k].isClosed=!0,d.postMessage({sourceName:O,targetName:f,stream:i.CANCEL,streamId:k,reason:o(p)}),_.promise}},S)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}u=new WeakSet,gn=function(b){const v=b.streamId,S=this.sourceName,N=b.sourceName,k=this.comObj,O=this,f=this.actionHandler[b.action],d={enqueue(p){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,w=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const M=this.desiredSize;this.desiredSize-=_,M>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),k.postMessage({sourceName:S,targetName:N,stream:i.ENQUEUE,streamId:v,chunk:p},w)},close(){this.isCancelled||(this.isCancelled=!0,k.postMessage({sourceName:S,targetName:N,stream:i.CLOSE,streamId:v}),delete O.streamSinks[v])},error(p){(0,n.assert)(p instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,k.postMessage({sourceName:S,targetName:N,stream:i.ERROR,streamId:v,reason:o(p)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:b.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[v]=d,new Promise(function(p){p(f(b.data,d))}).then(function(){k.postMessage({sourceName:S,targetName:N,stream:i.START_COMPLETE,streamId:v,success:!0})},function(p){k.postMessage({sourceName:S,targetName:N,stream:i.START_COMPLETE,streamId:v,reason:o(p)})})},a=new WeakSet,vn=function(b){const v=b.streamId,S=this.sourceName,N=b.sourceName,k=this.comObj,O=this.streamControllers[v],f=this.streamSinks[v];switch(b.stream){case i.START_COMPLETE:b.success?O.startCall.resolve():O.startCall.reject(o(b.reason));break;case i.PULL_COMPLETE:b.success?O.pullCall.resolve():O.pullCall.reject(o(b.reason));break;case i.PULL:if(!f){k.postMessage({sourceName:S,targetName:N,stream:i.PULL_COMPLETE,streamId:v,success:!0});break}f.desiredSize<=0&&b.desiredSize>0&&f.sinkCapability.resolve(),f.desiredSize=b.desiredSize,new Promise(function(d){var p;d((p=f.onPull)===null||p===void 0?void 0:p.call(f))}).then(function(){k.postMessage({sourceName:S,targetName:N,stream:i.PULL_COMPLETE,streamId:v,success:!0})},function(d){k.postMessage({sourceName:S,targetName:N,stream:i.PULL_COMPLETE,streamId:v,reason:o(d)})});break;case i.ENQUEUE:if((0,n.assert)(O,"enqueue should have stream controller"),O.isClosed)break;O.controller.enqueue(b.chunk);break;case i.CLOSE:if((0,n.assert)(O,"close should have stream controller"),O.isClosed)break;O.isClosed=!0,O.controller.close(),me(this,y,Pt).call(this,O,v);break;case i.ERROR:(0,n.assert)(O,"error should have stream controller"),O.controller.error(o(b.reason)),me(this,y,Pt).call(this,O,v);break;case i.CANCEL_COMPLETE:b.success?O.cancelCall.resolve():O.cancelCall.reject(o(b.reason)),me(this,y,Pt).call(this,O,v);break;case i.CANCEL:if(!f)break;new Promise(function(d){var p;d((p=f.onCancel)===null||p===void 0?void 0:p.call(f,o(b.reason)))}).then(function(){k.postMessage({sourceName:S,targetName:N,stream:i.CANCEL_COMPLETE,streamId:v,success:!0})},function(d){k.postMessage({sourceName:S,targetName:N,stream:i.CANCEL_COMPLETE,streamId:v,reason:o(d)})}),f.sinkCapability.reject(o(b.reason)),f.isCancelled=!0,delete this.streamSinks[v];break;default:throw new Error("Unexpected stream case")}},y=new WeakSet,Pt=async function(b,v){var S,N,k;await Promise.allSettled([(S=b.startCall)===null||S===void 0?void 0:S.promise,(N=b.pullCall)===null||N===void 0?void 0:N.promise,(k=b.cancelCall)===null||k===void 0?void 0:k.promise]),delete this.streamControllers[v]},e.MessageHandler=c},(r,e,t)=>{var i,o;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class s{constructor(u){he(this,i,void 0);he(this,o,void 0);let{parsedData:l,rawData:a}=u;Ce(this,i,l),Ce(this,o,a)}getRaw(){return D(this,o)}get(u){return D(this,i).get(u)??null}getAll(){return(0,n.objectFromMap)(D(this,i))}has(u){return D(this,i).has(u)}}i=new WeakMap,o=new WeakMap,e.Metadata=s},(r,e,t)=>{var u,l,a,h,y,g,jt;Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1),s=t(144);const i=Symbol("INTERNAL");class o{constructor(v,S){he(this,u,!0);this.name=v,this.intent=S}get visible(){return D(this,u)}_setVisible(v,S){v!==i&&(0,n.unreachable)("Internal method `_setVisible` called."),Ce(this,u,S)}}u=new WeakMap;class c{constructor(v){he(this,g);he(this,l,null);he(this,a,new Map);he(this,h,null);he(this,y,null);if(this.name=null,this.creator=null,v!==null){this.name=v.name,this.creator=v.creator,Ce(this,y,v.order);for(const S of v.groups)D(this,a).set(S.id,new o(S.name,S.intent));if(v.baseState==="OFF")for(const S of D(this,a).values())S._setVisible(i,!1);for(const S of v.on)D(this,a).get(S)._setVisible(i,!0);for(const S of v.off)D(this,a).get(S)._setVisible(i,!1);Ce(this,h,this.getHash())}}isVisible(v){if(D(this,a).size===0)return!0;if(!v)return(0,n.warn)("Optional content group not defined."),!0;if(v.type==="OCG")return D(this,a).has(v.id)?D(this,a).get(v.id).visible:((0,n.warn)(`Optional content group not found: ${v.id}`),!0);if(v.type==="OCMD"){if(v.expression)return me(this,g,jt).call(this,v.expression);if(!v.policy||v.policy==="AnyOn"){for(const S of v.ids){if(!D(this,a).has(S))return(0,n.warn)(`Optional content group not found: ${S}`),!0;if(D(this,a).get(S).visible)return!0}return!1}else if(v.policy==="AllOn"){for(const S of v.ids){if(!D(this,a).has(S))return(0,n.warn)(`Optional content group not found: ${S}`),!0;if(!D(this,a).get(S).visible)return!1}return!0}else if(v.policy==="AnyOff"){for(const S of v.ids){if(!D(this,a).has(S))return(0,n.warn)(`Optional content group not found: ${S}`),!0;if(!D(this,a).get(S).visible)return!0}return!1}else if(v.policy==="AllOff"){for(const S of v.ids){if(!D(this,a).has(S))return(0,n.warn)(`Optional content group not found: ${S}`),!0;if(D(this,a).get(S).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${v.policy}.`),!0}return(0,n.warn)(`Unknown group type ${v.type}.`),!0}setVisibility(v){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!D(this,a).has(v)){(0,n.warn)(`Optional content group not found: ${v}`);return}D(this,a).get(v)._setVisible(i,!!S),Ce(this,l,null)}get hasInitialVisibility(){return this.getHash()===D(this,h)}getOrder(){return D(this,a).size?D(this,y)?D(this,y).slice():[...D(this,a).keys()]:null}getGroups(){return D(this,a).size>0?(0,n.objectFromMap)(D(this,a)):null}getGroup(v){return D(this,a).get(v)||null}getHash(){if(D(this,l)!==null)return D(this,l);const v=new s.MurmurHash3_64;for(const[S,N]of D(this,a))v.update(`${S}:${N.visible}`);return Ce(this,l,v.hexdigest())}}l=new WeakMap,a=new WeakMap,h=new WeakMap,y=new WeakMap,g=new WeakSet,jt=function(v){const S=v.length;if(S<2)return!0;const N=v[0];for(let k=1;k<S;k++){const O=v[k];let f;if(Array.isArray(O))f=me(this,g,jt).call(this,O);else if(D(this,a).has(O))f=D(this,a).get(O).visible;else return(0,n.warn)(`Optional content group not found: ${O}`),!0;switch(N){case"And":if(!f)return!1;break;case"Or":if(f)return!0;break;case"Not":return!f;default:return!0}}return N==="And"},e.OptionalContentConfig=c},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var n=t(1),s=t(142);class i{constructor(l,a){let{length:h,initialData:y,progressiveDone:g=!1,contentDispositionFilename:m=null,disableRange:b=!1,disableStream:v=!1}=l;if((0,n.assert)(a,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=g,this._contentDispositionFilename=m,(y==null?void 0:y.length)>0){const S=y instanceof Uint8Array&&y.byteLength===y.buffer.byteLength?y.buffer:new Uint8Array(y).buffer;this._queuedChunks.push(S)}this._pdfDataRangeTransport=a,this._isStreamingSupported=!v,this._isRangeSupported=!b,this._contentLength=h,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((S,N)=>{this._onReceiveData({begin:S,chunk:N})}),this._pdfDataRangeTransport.addProgressListener((S,N)=>{this._onProgress({loaded:S,total:N})}),this._pdfDataRangeTransport.addProgressiveReadListener(S=>{this._onReceiveData({chunk:S})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(l){let{begin:a,chunk:h}=l;const y=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;if(a===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(y):this._queuedChunks.push(y);else{const g=this._rangeReaders.some(function(m){return m._begin!==a?!1:(m._enqueue(y),!0)});(0,n.assert)(g,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var l;return((l=this._fullRequestReader)===null||l===void 0?void 0:l._loaded)??0}_onProgress(l){if(l.total===void 0){var a,h;(a=this._rangeReaders[0])===null||a===void 0||(h=a.onProgress)===null||h===void 0||h.call(a,{loaded:l.loaded})}else{var y,g;(y=this._fullRequestReader)===null||y===void 0||(g=y.onProgress)===null||g===void 0||g.call(y,{loaded:l.loaded,total:l.total})}}_onProgressiveDone(){var l;(l=this._fullRequestReader)===null||l===void 0||l.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(l){const a=this._rangeReaders.indexOf(l);a>=0&&this._rangeReaders.splice(a,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const l=this._queuedChunks;return this._queuedChunks=null,new o(this,l,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(l,a){if(a<=this._progressiveDataLength)return null;const h=new c(this,l,a);return this._pdfDataRangeTransport.requestDataRange(l,a),this._rangeReaders.push(h),h}cancelAllRequests(l){var a;(a=this._fullRequestReader)===null||a===void 0||a.cancel(l);for(const h of this._rangeReaders.slice(0))h.cancel(l);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=i;class o{constructor(l,a){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=l,this._done=h||!1,this._filename=(0,s.isPdfFile)(y)?y:null,this._queuedChunks=a||[],this._loaded=0;for(const g of this._queuedChunks)this._loaded+=g.byteLength;this._requests=[],this._headersReady=Promise.resolve(),l._fullRequestReader=this,this.onProgress=null}_enqueue(l){this._done||(this._requests.length>0?this._requests.shift().resolve({value:l,done:!1}):this._queuedChunks.push(l),this._loaded+=l.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const l=new n.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class c{constructor(l,a,h){this._stream=l,this._begin=a,this._end=h,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(l){if(!this._done){if(this._requests.length===0)this._queuedChunk=l;else{this._requests.shift().resolve({value:l,done:!1});for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};const l=new n.PromiseCapability;return this._requests.push(l),l.promise}cancel(l){this._done=!0;for(const a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(s){const i=[],o={items:i,styles:Object.create(null)};function c(u){var l;if(!u)return;let a=null;const h=u.name;if(h==="#text")a=u.value;else if(t.shouldBuildText(h))u!=null&&(l=u.attributes)!==null&&l!==void 0&&l.textContent?a=u.attributes.textContent:u.value&&(a=u.value);else return;if(a!==null&&i.push({str:a}),!!u.children)for(const y of u.children)c(y)}return c(s),o}static shouldBuildText(s){return!(s==="textarea"||s==="input"||s==="option"||s==="select")}}e.XfaText=t},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeFilterFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var n=t(143);const s=function(l){return new Promise((a,h)=>{require$$6.readFile(l,(g,m)=>{if(g||!m){h(new Error(g));return}a(new Uint8Array(m))})})};class i extends n.BaseFilterFactory{}e.NodeFilterFactory=i;class o extends n.BaseCanvasFactory{_createCanvas(a,h){return require$$6.createCanvas(a,h)}}e.NodeCanvasFactory=o;class c extends n.BaseCMapReaderFactory{_fetchData(a,h){return s(a).then(y=>({cMapData:y,compressionType:h}))}}e.NodeCMapReaderFactory=c;class u extends n.BaseStandardFontDataFactory{_fetchData(a){return s(a)}}e.NodeStandardFontDataFactory=u},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var n=t(1),s=t(157);const i=require$$6,o=require$$6,c=require$$6,u=require$$6,l=/^file:\/\/\/[a-zA-Z]:\//;function a(k){const O=u.parse(k);return O.protocol==="file:"||O.host?O:/^[a-z]:[/\\]/i.test(k)?u.parse(`file:///${k}`):(O.host||(O.protocol="file:"),O)}class h{constructor(O){this.source=O,this.url=a(O.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&O.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var O;return((O=this._fullRequestReader)===null||O===void 0?void 0:O._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new S(this):new b(this),this._fullRequestReader}getRangeReader(O,f){if(f<=this._progressiveDataLength)return null;const d=this.isFsUrl?new N(this,O,f):new v(this,O,f);return this._rangeRequestReaders.push(d),d}cancelAllRequests(O){var f;(f=this._fullRequestReader)===null||f===void 0||f.cancel(O);for(const d of this._rangeRequestReaders.slice(0))d.cancel(O)}}e.PDFNodeStream=h;class y{constructor(O){this._url=O.url,this._done=!1,this._storedError=null,this.onProgress=null;const f=O.source;this._contentLength=f.length,this._loaded=0,this._filename=null,this._disableRange=f.disableRange||!1,this._rangeChunkSize=f.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!f.disableStream,this._isRangeSupported=!f.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var O;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(O=this.onProgress)===null||O===void 0||O.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(O){if(!this._readableStream){this._error(O);return}this._readableStream.destroy(O)}_error(O){this._storedError=O,this._readCapability.resolve()}_setReadableStream(O){this._readableStream=O,O.on("readable",()=>{this._readCapability.resolve()}),O.on("end",()=>{O.destroy(),this._done=!0,this._readCapability.resolve()}),O.on("error",f=>{this._error(f)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class g{constructor(O){this._url=O.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const f=O.source;this._isStreamingSupported=!f.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var O;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(O=this.onProgress)===null||O===void 0||O.call(this,{loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(O){if(!this._readableStream){this._error(O);return}this._readableStream.destroy(O)}_error(O){this._storedError=O,this._readCapability.resolve()}_setReadableStream(O){this._readableStream=O,O.on("readable",()=>{this._readCapability.resolve()}),O.on("end",()=>{O.destroy(),this._done=!0,this._readCapability.resolve()}),O.on("error",f=>{this._error(f)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function m(k,O){return{protocol:k.protocol,auth:k.auth,host:k.hostname,port:k.port,path:k.path,method:"GET",headers:O}}class b extends y{constructor(O){super(O);const f=d=>{if(d.statusCode===404){const M=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=M,this._headersCapability.reject(M);return}this._headersCapability.resolve(),this._setReadableStream(d);const p=M=>this._readableStream.headers[M.toLowerCase()],{allowRangeRequests:_,suggestedLength:w}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:O.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=_,this._contentLength=w||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(p)};this._request=null,this._url.protocol==="http:"?this._request=o.request(m(this._url,O.httpHeaders),f):this._request=c.request(m(this._url,O.httpHeaders),f),this._request.on("error",d=>{this._storedError=d,this._headersCapability.reject(d)}),this._request.end()}}class v extends g{constructor(O,f,d){super(O),this._httpHeaders={};for(const _ in O.httpHeaders){const w=O.httpHeaders[_];w!==void 0&&(this._httpHeaders[_]=w)}this._httpHeaders.Range=`bytes=${f}-${d-1}`;const p=_=>{if(_.statusCode===404){const w=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=w;return}this._setReadableStream(_)};this._request=null,this._url.protocol==="http:"?this._request=o.request(m(this._url,this._httpHeaders),p):this._request=c.request(m(this._url,this._httpHeaders),p),this._request.on("error",_=>{this._storedError=_}),this._request.end()}}class S extends y{constructor(O){super(O);let f=decodeURIComponent(this._url.path);l.test(this._url.href)&&(f=f.replace(/^\//,"")),i.lstat(f,(d,p)=>{if(d){d.code==="ENOENT"&&(d=new n.MissingPDFException(`Missing PDF "${f}".`)),this._storedError=d,this._headersCapability.reject(d);return}this._contentLength=p.size,this._setReadableStream(i.createReadStream(f)),this._headersCapability.resolve()})}}class N extends g{constructor(O,f,d){super(O);let p=decodeURIComponent(this._url.path);l.test(this._url.href)&&(p=p.replace(/^\//,"")),this._setReadableStream(i.createReadStream(p,{start:f,end:d-1}))}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=u,e.extractFilenameFromHeader=c,e.validateRangeRequestCapabilities=o,e.validateResponseStatus=l;var n=t(1),s=t(158),i=t(142);function o(a){let{getResponseHeader:h,isHttp:y,rangeChunkSize:g,disableRange:m}=a;const b={allowRangeRequests:!1,suggestedLength:void 0},v=parseInt(h("Content-Length"),10);return!Number.isInteger(v)||(b.suggestedLength=v,v<=2*g)||m||!y||h("Accept-Ranges")!=="bytes"||(h("Content-Encoding")||"identity")!=="identity"||(b.allowRangeRequests=!0),b}function c(a){const h=a("Content-Disposition");if(h){let y=(0,s.getFilenameFromContentDispositionHeader)(h);if(y.includes("%"))try{y=decodeURIComponent(y)}catch{}if((0,i.isPdfFile)(y))return y}return null}function u(a,h){return a===404||a===0&&h.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+h+'".'):new n.UnexpectedResponseException(`Unexpected server response (${a}) while retrieving PDF "${h}".`,a)}function l(a){return a===200||a===206}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=s;var n=t(1);function s(i){let o=!0,c=u("filename\\*","i").exec(i);if(c){c=c[1];let b=y(c);return b=unescape(b),b=g(b),b=m(b),a(b)}if(c=h(i),c){const b=m(c);return a(b)}if(c=u("filename","i").exec(i),c){c=c[1];let b=y(c);return b=m(b),a(b)}function u(b,v){return new RegExp("(?:^|;)\\s*"+b+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',v)}function l(b,v){if(b){if(!/^[\x00-\xFF]+$/.test(v))return v;try{const S=new TextDecoder(b,{fatal:!0}),N=(0,n.stringToBytes)(v);v=S.decode(N),o=!1}catch{}}return v}function a(b){return o&&/[\x80-\xff]/.test(b)&&(b=l("utf-8",b),o&&(b=l("iso-8859-1",b))),b}function h(b){const v=[];let S;const N=u("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(S=N.exec(b))!==null;){let[,O,f,d]=S;if(O=parseInt(O,10),O in v){if(O===0)break;continue}v[O]=[f,d]}const k=[];for(let O=0;O<v.length&&O in v;++O){let[f,d]=v[O];d=y(d),f&&(d=unescape(d),O===0&&(d=g(d))),k.push(d)}return k.join("")}function y(b){if(b.startsWith('"')){const v=b.slice(1).split('\\"');for(let S=0;S<v.length;++S){const N=v[S].indexOf('"');N!==-1&&(v[S]=v[S].slice(0,N),v.length=S+1),v[S]=v[S].replaceAll(/\\(.)/g,"$1")}b=v.join('"')}return b}function g(b){const v=b.indexOf("'");if(v===-1)return b;const S=b.slice(0,v),k=b.slice(v+1).replace(/^[^']*'/,"");return l(S,k)}function m(b){return!b.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(b)?b:b.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(v,S,N,k){if(N==="q"||N==="Q")return k=k.replaceAll("_"," "),k=k.replaceAll(/=([0-9a-fA-F]{2})/g,function(O,f){return String.fromCharCode(parseInt(f,16))}),l(S,k);try{k=atob(k)}catch{}return l(S,k)})}return""}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var n=t(1),s=t(157);const i=200,o=206;function c(y){const g=y.response;return typeof g!="string"?g:(0,n.stringToBytes)(g).buffer}class u{constructor(g){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=g,this.isHttp=/^https?:/i.test(g),this.httpHeaders=this.isHttp&&m.httpHeaders||Object.create(null),this.withCredentials=m.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(g,m,b){const v={begin:g,end:m};for(const S in b)v[S]=b[S];return this.request(v)}requestFull(g){return this.request(g)}request(g){const m=new XMLHttpRequest,b=this.currXhrId++,v=this.pendingRequests[b]={xhr:m};m.open("GET",this.url),m.withCredentials=this.withCredentials;for(const S in this.httpHeaders){const N=this.httpHeaders[S];N!==void 0&&m.setRequestHeader(S,N)}return this.isHttp&&"begin"in g&&"end"in g?(m.setRequestHeader("Range",`bytes=${g.begin}-${g.end-1}`),v.expectedStatus=o):v.expectedStatus=i,m.responseType="arraybuffer",g.onError&&(m.onerror=function(S){g.onError(m.status)}),m.onreadystatechange=this.onStateChange.bind(this,b),m.onprogress=this.onProgress.bind(this,b),v.onHeadersReceived=g.onHeadersReceived,v.onDone=g.onDone,v.onError=g.onError,v.onProgress=g.onProgress,m.send(null),b}onProgress(g,m){var b;const v=this.pendingRequests[g];v&&((b=v.onProgress)===null||b===void 0||b.call(v,m))}onStateChange(g,m){const b=this.pendingRequests[g];if(!b)return;const v=b.xhr;if(v.readyState>=2&&b.onHeadersReceived&&(b.onHeadersReceived(),delete b.onHeadersReceived),v.readyState!==4||!(g in this.pendingRequests))return;if(delete this.pendingRequests[g],v.status===0&&this.isHttp){var S;(S=b.onError)===null||S===void 0||S.call(b,v.status);return}const N=v.status||i;if(!(N===i&&b.expectedStatus===o)&&N!==b.expectedStatus){var O;(O=b.onError)===null||O===void 0||O.call(b,v.status);return}const f=c(v);if(N===o){const p=v.getResponseHeader("Content-Range"),_=/bytes (\d+)-(\d+)\/(\d+)/.exec(p);b.onDone({begin:parseInt(_[1],10),chunk:f})}else if(f)b.onDone({begin:0,chunk:f});else{var d;(d=b.onError)===null||d===void 0||d.call(b,v.status)}}getRequestXhr(g){return this.pendingRequests[g].xhr}isPendingRequest(g){return g in this.pendingRequests}abortRequest(g){const m=this.pendingRequests[g].xhr;delete this.pendingRequests[g],m.abort()}}class l{constructor(g){this._source=g,this._manager=new u(g.url,{httpHeaders:g.httpHeaders,withCredentials:g.withCredentials}),this._rangeChunkSize=g.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(g){const m=this._rangeRequestReaders.indexOf(g);m>=0&&this._rangeRequestReaders.splice(m,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new a(this._manager,this._source),this._fullRequestReader}getRangeReader(g,m){const b=new h(this._manager,g,m);return b.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(b),b}cancelAllRequests(g){var m;(m=this._fullRequestReader)===null||m===void 0||m.cancel(g);for(const b of this._rangeRequestReaders.slice(0))b.cancel(g)}}e.PDFNetworkStream=l;class a{constructor(g,m){this._manager=g;const b={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=m.url,this._fullRequestId=g.requestFull(b),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=m.disableRange||!1,this._contentLength=m.length,this._rangeChunkSize=m.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const g=this._fullRequestId,m=this._manager.getRequestXhr(g),b=N=>m.getResponseHeader(N),{allowRangeRequests:v,suggestedLength:S}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:b,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});v&&(this._isRangeSupported=!0),this._contentLength=S||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(b),this._isRangeSupported&&this._manager.abortRequest(g),this._headersReceivedCapability.resolve()}_onDone(g){if(g&&(this._requests.length>0?this._requests.shift().resolve({value:g.chunk,done:!1}):this._cachedChunks.push(g.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(g){this._storedError=(0,s.createResponseStatusError)(g,this._url),this._headersReceivedCapability.reject(this._storedError);for(const m of this._requests)m.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(g){var m;(m=this.onProgress)===null||m===void 0||m.call(this,{loaded:g.loaded,total:g.lengthComputable?g.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const g=new n.PromiseCapability;return this._requests.push(g),g.promise}cancel(g){this._done=!0,this._headersReceivedCapability.reject(g);for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class h{constructor(g,m,b){this._manager=g;const v={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=g.url,this._requestId=g.requestRange(m,b,v),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var g;(g=this.onClosed)===null||g===void 0||g.call(this,this)}_onDone(g){const m=g.chunk;this._requests.length>0?this._requests.shift().resolve({value:m,done:!1}):this._queuedChunk=m,this._done=!0;for(const b of this._requests)b.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(g){this._storedError=(0,s.createResponseStatusError)(g,this._url);for(const m of this._requests)m.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(g){if(!this.isStreamingSupported){var m;(m=this.onProgress)===null||m===void 0||m.call(this,{loaded:g.loaded})}}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const m=this._queuedChunk;return this._queuedChunk=null,{value:m,done:!1}}if(this._done)return{value:void 0,done:!0};const g=new n.PromiseCapability;return this._requests.push(g),g.promise}cancel(g){this._done=!0;for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var n=t(1),s=t(157);function i(h,y,g){return{method:"GET",headers:h,signal:g.signal,mode:"cors",credentials:y?"include":"same-origin",redirect:"follow"}}function o(h){const y=new Headers;for(const g in h){const m=h[g];m!==void 0&&y.append(g,m)}return y}function c(h){return h instanceof Uint8Array?h.buffer:h instanceof ArrayBuffer?h:((0,n.warn)(`getArrayBuffer - unexpected data format: ${h}`),new Uint8Array(h).buffer)}class u{constructor(y){this.source=y,this.isHttp=/^https?:/i.test(y.url),this.httpHeaders=this.isHttp&&y.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var y;return((y=this._fullRequestReader)===null||y===void 0?void 0:y._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(y,g){if(g<=this._progressiveDataLength)return null;const m=new a(this,y,g);return this._rangeRequestReaders.push(m),m}cancelAllRequests(y){var g;(g=this._fullRequestReader)===null||g===void 0||g.cancel(y);for(const m of this._rangeRequestReaders.slice(0))m.cancel(y)}}e.PDFFetchStream=u;class l{constructor(y){this._stream=y,this._reader=null,this._loaded=0,this._filename=null;const g=y.source;this._withCredentials=g.withCredentials||!1,this._contentLength=g.length,this._headersCapability=new n.PromiseCapability,this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange,this._headers=o(this._stream.httpHeaders);const m=g.url;fetch(m,i(this._headers,this._withCredentials,this._abortController)).then(b=>{if(!(0,s.validateResponseStatus)(b.status))throw(0,s.createResponseStatusError)(b.status,m);this._reader=b.body.getReader(),this._headersCapability.resolve();const v=k=>b.headers.get(k),{allowRangeRequests:S,suggestedLength:N}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:v,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=S,this._contentLength=N||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(v),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var y;await this._headersCapability.promise;const{value:g,done:m}=await this._reader.read();return m?{value:g,done:m}:(this._loaded+=g.byteLength,(y=this.onProgress)===null||y===void 0||y.call(this,{loaded:this._loaded,total:this._contentLength}),{value:c(g),done:!1})}cancel(y){var g;(g=this._reader)===null||g===void 0||g.cancel(y),this._abortController.abort()}}class a{constructor(y,g,m){this._stream=y,this._reader=null,this._loaded=0;const b=y.source;this._withCredentials=b.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!b.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${g}-${m-1}`);const v=b.url;fetch(v,i(this._headers,this._withCredentials,this._abortController)).then(S=>{if(!(0,s.validateResponseStatus)(S.status))throw(0,s.createResponseStatusError)(S.status,v);this._readCapability.resolve(),this._reader=S.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var y;await this._readCapability.promise;const{value:g,done:m}=await this._reader.read();return m?{value:g,done:m}:(this._loaded+=g.byteLength,(y=this.onProgress)===null||y===void 0||y.call(this,{loaded:this._loaded}),{value:c(g),done:!1})}cancel(y){var g;(g=this._reader)===null||g===void 0||g.cancel(y),this._abortController.abort()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=b,e.updateTextLayer=v;var n=t(1),s=t(142);const i=1e5,o=30,c=.8,u=new Map;function l(S,N){let k;if(N&&n.FeatureTest.isOffscreenCanvasSupported)k=new OffscreenCanvas(S,S).getContext("2d",{alpha:!1});else{const O=document.createElement("canvas");O.width=O.height=S,k=O.getContext("2d",{alpha:!1})}return k}function a(S,N){const k=u.get(S);if(k)return k;const O=l(o,N);O.font=`${o}px ${S}`;const f=O.measureText("");let d=f.fontBoundingBoxAscent,p=Math.abs(f.fontBoundingBoxDescent);if(d){const w=d/(d+p);return u.set(S,w),O.canvas.width=O.canvas.height=0,w}O.strokeStyle="red",O.clearRect(0,0,o,o),O.strokeText("g",0,0);let _=O.getImageData(0,0,o,o).data;p=0;for(let w=_.length-1-3;w>=0;w-=4)if(_[w]>0){p=Math.ceil(w/4/o);break}O.clearRect(0,0,o,o),O.strokeText("A",0,o),_=O.getImageData(0,0,o,o).data,d=0;for(let w=0,M=_.length;w<M;w+=4)if(_[w]>0){d=o-Math.floor(w/4/o);break}if(O.canvas.width=O.canvas.height=0,d){const w=d/(d+p);return u.set(S,w),w}return u.set(S,c),c}function h(S,N,k){const O=document.createElement("span"),f={angle:0,canvasWidth:0,hasText:N.str!=="",hasEOL:N.hasEOL,fontSize:0};S._textDivs.push(O);const d=n.Util.transform(S._transform,N.transform);let p=Math.atan2(d[1],d[0]);const _=k[N.fontName];_.vertical&&(p+=Math.PI/2);const w=Math.hypot(d[2],d[3]),M=w*a(_.fontFamily,S._isOffscreenCanvasSupported);let E,F;p===0?(E=d[4],F=d[5]-M):(E=d[4]+M*Math.sin(p),F=d[5]-M*Math.cos(p));const G="calc(var(--scale-factor)*",H=O.style;S._container===S._rootContainer?(H.left=`${(100*E/S._pageWidth).toFixed(2)}%`,H.top=`${(100*F/S._pageHeight).toFixed(2)}%`):(H.left=`${G}${E.toFixed(2)}px)`,H.top=`${G}${F.toFixed(2)}px)`),H.fontSize=`${G}${w.toFixed(2)}px)`,H.fontFamily=_.fontFamily,f.fontSize=w,O.setAttribute("role","presentation"),O.textContent=N.str,O.dir=N.dir,S._fontInspectorEnabled&&(O.dataset.fontName=N.fontName),p!==0&&(f.angle=p*(180/Math.PI));let K=!1;if(N.str.length>1)K=!0;else if(N.str!==" "&&N.transform[0]!==N.transform[3]){const Z=Math.abs(N.transform[0]),ae=Math.abs(N.transform[3]);Z!==ae&&Math.max(Z,ae)/Math.min(Z,ae)>1.5&&(K=!0)}K&&(f.canvasWidth=_.vertical?N.height:N.width),S._textDivProperties.set(O,f),S._isReadableStream&&S._layoutText(O)}function y(S){const{div:N,scale:k,properties:O,ctx:f,prevFontSize:d,prevFontFamily:p}=S,{style:_}=N;let w="";if(O.canvasWidth!==0&&O.hasText){const{fontFamily:M}=_,{canvasWidth:E,fontSize:F}=O;(d!==F||p!==M)&&(f.font=`${F*k}px ${M}`,S.prevFontSize=F,S.prevFontFamily=M);const{width:G}=f.measureText(N.textContent);G>0&&(w=`scaleX(${E*k/G})`)}O.angle!==0&&(w=`rotate(${O.angle}deg) ${w}`),w.length>0&&(_.transform=w)}function g(S){if(S._canceled)return;const N=S._textDivs,k=S._capability;if(N.length>i){k.resolve();return}if(!S._isReadableStream)for(const f of N)S._layoutText(f);k.resolve()}class m{constructor(N){var k;let{textContentSource:O,container:f,viewport:d,textDivs:p,textDivProperties:_,textContentItemsStr:w,isOffscreenCanvasSupported:M}=N;this._textContentSource=O,this._isReadableStream=O instanceof ReadableStream,this._container=this._rootContainer=f,this._textDivs=p||[],this._textContentItemsStr=w||[],this._isOffscreenCanvasSupported=M,this._fontInspectorEnabled=!!((k=globalThis.FontInspector)!==null&&k!==void 0&&k.enabled),this._reader=null,this._textDivProperties=_||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:d.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,M)};const{pageWidth:E,pageHeight:F,pageX:G,pageY:H}=d.rawDims;this._transform=[1,0,0,-1,-G,H+F],this._pageWidth=E,this._pageHeight=F,(0,s.setLayerDimensions)(f,d),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(N,k){for(const O of N){if(O.str===void 0){if(O.type==="beginMarkedContentProps"||O.type==="beginMarkedContent"){const f=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),O.id!==null&&this._container.setAttribute("id",`${O.id}`),f.append(this._container)}else O.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(O.str),h(this,O,k)}}_layoutText(N){const k=this._layoutTextParams.properties=this._textDivProperties.get(N);if(this._layoutTextParams.div=N,y(this._layoutTextParams),k.hasText&&this._container.append(N),k.hasEOL){const O=document.createElement("br");O.setAttribute("role","presentation"),this._container.append(O)}}_render(){const N=new n.PromiseCapability;let k=Object.create(null);if(this._isReadableStream){const O=()=>{this._reader.read().then(f=>{let{value:d,done:p}=f;if(p){N.resolve();return}Object.assign(k,d.styles),this._processItems(d.items,k),O()},N.reject)};this._reader=this._textContentSource.getReader(),O()}else if(this._textContentSource){const{items:O,styles:f}=this._textContentSource;this._processItems(O,f),N.resolve()}else throw new Error('No "textContentSource" parameter specified.');N.promise.then(()=>{k=null,g(this)},this._capability.reject)}}e.TextLayerRenderTask=m;function b(S){!S.textContentSource&&(S.textContent||S.textContentStream)&&((0,s.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),S.textContentSource=S.textContent||S.textContentStream);const{container:N,viewport:k}=S,O=getComputedStyle(N),f=O.getPropertyValue("visibility"),d=parseFloat(O.getPropertyValue("--scale-factor"));f==="visible"&&(!d||Math.abs(d-k.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const p=new m(S);return p._render(),p}function v(S){let{container:N,viewport:k,textDivs:O,textDivProperties:f,isOffscreenCanvasSupported:d,mustRotate:p=!0,mustRescale:_=!0}=S;if(p&&(0,s.setLayerDimensions)(N,{rotation:k.rotation}),_){const w=l(0,d),E={prevFontSize:null,prevFontFamily:null,div:null,scale:k.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:w};for(const F of O)E.properties=f.get(F),E.div=F,y(E)}}},(r,e,t)=>{var l,a,h,y,g,m,b,v,S,Ht,k,yn,f,qt,p,Xt;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var n=t(1),s=t(141),i=t(163),o=t(164),c=t(142);const w=class{constructor(E){he(this,S);he(this,k);he(this,f);he(this,p);he(this,l,void 0);he(this,a,!1);he(this,h,this.pointerup.bind(this));he(this,y,this.pointerdown.bind(this));he(this,g,new Map);he(this,m,!1);he(this,b,!1);he(this,v,void 0);w._initialized||(w._initialized=!0,i.FreeTextEditor.initialize(E.l10n),o.InkEditor.initialize(E.l10n)),E.uiManager.registerEditorTypes([i.FreeTextEditor,o.InkEditor]),Ce(this,v,E.uiManager),this.pageIndex=E.pageIndex,this.div=E.div,Ce(this,l,E.accessibilityManager),D(this,v).addLayer(this)}get isEmpty(){return D(this,g).size===0}updateToolbar(E){D(this,v).updateToolbar(E)}updateMode(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D(this,v).getMode();me(this,p,Xt).call(this),E===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),D(this,v).unselectAll(),E!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",E===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",E===n.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(E){if(!E&&D(this,v).getMode()!==n.AnnotationEditorType.INK)return;if(!E){for(const G of D(this,g).values())if(G.isEmpty()){G.setInBackground();return}}me(this,f,qt).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(E){D(this,v).setEditingState(E)}addCommands(E){D(this,v).addCommands(E)}enable(){this.div.style.pointerEvents="auto";for(const E of D(this,g).values())E.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const E of D(this,g).values())E.disableEditing();me(this,p,Xt).call(this),this.isEmpty&&(this.div.hidden=!0)}setActiveEditor(E){D(this,v).getActive()!==E&&D(this,v).setActiveEditor(E)}enableClick(){this.div.addEventListener("pointerdown",D(this,y)),this.div.addEventListener("pointerup",D(this,h))}disableClick(){this.div.removeEventListener("pointerdown",D(this,y)),this.div.removeEventListener("pointerup",D(this,h))}attach(E){D(this,g).set(E.id,E)}detach(E){var F;D(this,g).delete(E.id),(F=D(this,l))===null||F===void 0||F.removePointerInTextLayer(E.contentDiv)}remove(E){D(this,v).removeEditor(E),this.detach(E),E.div.style.display="none",setTimeout(()=>{E.div.style.display="",E.div.remove(),E.isAttachedToDOM=!1,document.activeElement===document.body&&D(this,v).focusMainContainer()},0),D(this,b)||this.addInkEditorIfNeeded(!1)}add(E){if(me(this,S,Ht).call(this,E),D(this,v).addEditor(E),this.attach(E),!E.isAttachedToDOM){const F=E.render();this.div.append(F),E.isAttachedToDOM=!0}this.moveEditorInDOM(E),E.onceAdded(),D(this,v).addToAnnotationStorage(E)}moveEditorInDOM(E){var F;(F=D(this,l))===null||F===void 0||F.moveElementInDOM(this.div,E.div,E.contentDiv,!0)}addOrRebuild(E){E.needsToBeRebuilt()?E.rebuild():this.add(E)}addANewEditor(E){const F=()=>{this.addOrRebuild(E)},G=()=>{E.remove()};this.addCommands({cmd:F,undo:G,mustExec:!0})}addUndoableEditor(E){const F=()=>{this.addOrRebuild(E)},G=()=>{E.remove()};this.addCommands({cmd:F,undo:G,mustExec:!1})}getNextId(){return D(this,v).getId()}deserialize(E){switch(E.annotationType){case n.AnnotationEditorType.FREETEXT:return i.FreeTextEditor.deserialize(E,this,D(this,v));case n.AnnotationEditorType.INK:return o.InkEditor.deserialize(E,this,D(this,v))}return null}setSelected(E){D(this,v).setSelected(E)}toggleSelected(E){D(this,v).toggleSelected(E)}isSelected(E){return D(this,v).isSelected(E)}unselect(E){D(this,v).unselect(E)}pointerup(E){const{isMac:F}=n.FeatureTest.platform;if(!(E.button!==0||E.ctrlKey&&F)&&E.target===this.div&&D(this,m)){if(Ce(this,m,!1),!D(this,a)){Ce(this,a,!0);return}me(this,f,qt).call(this,E)}}pointerdown(E){const{isMac:F}=n.FeatureTest.platform;if(E.button!==0||E.ctrlKey&&F||E.target!==this.div)return;Ce(this,m,!0);const G=D(this,v).getActive();Ce(this,a,!G||G.isEmpty())}drop(E){const F=E.dataTransfer.getData("text/plain"),G=D(this,v).getEditor(F);if(!G)return;E.preventDefault(),E.dataTransfer.dropEffect="move",me(this,S,Ht).call(this,G);const H=this.div.getBoundingClientRect(),K=E.clientX-H.x,Z=E.clientY-H.y;G.translate(K-G.startX,Z-G.startY),this.moveEditorInDOM(G),G.div.focus()}dragover(E){E.preventDefault()}destroy(){var E;((E=D(this,v).getActive())===null||E===void 0?void 0:E.parent)===this&&D(this,v).setActiveEditor(null);for(const G of D(this,g).values()){var F;(F=D(this,l))===null||F===void 0||F.removePointerInTextLayer(G.contentDiv),G.setParent(null),G.isAttachedToDOM=!1,G.div.remove()}this.div=null,D(this,g).clear(),D(this,v).removeLayer(this)}render(E){let{viewport:F}=E;this.viewport=F,(0,c.setLayerDimensions)(this.div,F),(0,s.bindEvents)(this,this.div,["dragover","drop"]);for(const G of D(this,v).getEditors(this.pageIndex))this.add(G);this.updateMode()}update(E){let{viewport:F}=E;D(this,v).commitOrRemove(),this.viewport=F,(0,c.setLayerDimensions)(this.div,{rotation:F.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:E,pageHeight:F}=this.viewport.rawDims;return[E,F]}};let u=w;l=new WeakMap,a=new WeakMap,h=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakMap,b=new WeakMap,v=new WeakMap,S=new WeakSet,Ht=function(E){var F;E.parent!==this&&(this.attach(E),(F=E.parent)===null||F===void 0||F.detach(E),E.setParent(this),E.div&&E.isAttachedToDOM&&(E.div.remove(),this.div.append(E.div)))},k=new WeakSet,yn=function(E){switch(D(this,v).getMode()){case n.AnnotationEditorType.FREETEXT:return new i.FreeTextEditor(E);case n.AnnotationEditorType.INK:return new o.InkEditor(E)}return null},f=new WeakSet,qt=function(E){const F=this.getNextId(),G=me(this,k,yn).call(this,{parent:this,id:F,x:E.offsetX,y:E.offsetY,uiManager:D(this,v)});return G&&this.add(G),G},p=new WeakSet,Xt=function(){Ce(this,b,!0);for(const E of D(this,g).values())E.isEmpty()&&E.remove();Ce(this,b,!1)},Ke(u,"_initialized",!1),e.AnnotationEditorLayer=u},(r,e,t)=>{var c,u,l,a,h,y,g,m,b,v,An,N,bn,O,_n,d,Yt;Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var n=t(1),s=t(141),i=t(140);const _=class extends i.AnnotationEditor{constructor(E){super({...E,name:"freeTextEditor"});he(this,v);he(this,N);he(this,O);he(this,d);he(this,c,this.editorDivBlur.bind(this));he(this,u,this.editorDivFocus.bind(this));he(this,l,this.editorDivInput.bind(this));he(this,a,this.editorDivKeydown.bind(this));he(this,h,void 0);he(this,y,"");he(this,g,`${this.id}-editor`);he(this,m,!1);he(this,b,void 0);Ce(this,h,E.color||_._defaultColor||i.AnnotationEditor._defaultLineColor),Ce(this,b,E.fontSize||_._defaultFontSize)}static initialize(E){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(G=>[G,E.get(G)]));const F=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(F.getPropertyValue("--freetext-padding"))}static updateDefaultParams(E,F){switch(E){case n.AnnotationEditorParamsType.FREETEXT_SIZE:_._defaultFontSize=F;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:_._defaultColor=F;break}}updateParams(E,F){switch(E){case n.AnnotationEditorParamsType.FREETEXT_SIZE:me(this,v,An).call(this,F);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:me(this,N,bn).call(this,F);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,_._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,_._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,D(this,b)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,D(this,h)]]}getInitialTranslation(){const E=this.parentScale;return[-_._internalPadding*E,-(_._internalPadding+D(this,b))*E]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",D(this,a)),this.editorDiv.addEventListener("focus",D(this,u)),this.editorDiv.addEventListener("blur",D(this,c)),this.editorDiv.addEventListener("input",D(this,l)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",D(this,g)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",D(this,a)),this.editorDiv.removeEventListener("focus",D(this,u)),this.editorDiv.removeEventListener("blur",D(this,c)),this.editorDiv.removeEventListener("input",D(this,l)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(E){super.focusin(E),E.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){this.isInEditMode()&&(super.commit(),D(this,m)||(Ce(this,m,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),Ce(this,y,me(this,O,_n).call(this).trimEnd()),me(this,d,Yt).call(this))}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(E){this.enableEditMode(),this.editorDiv.focus()}keydown(E){E.target===this.div&&E.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(E){_._keyboardManager.exec(this,E)}editorDivFocus(E){this.isEditing=!0}editorDivBlur(E){this.isEditing=!1}editorDivInput(E){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let E,F;this.width&&(E=this.x,F=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",D(this,g)),this.enableEditing(),_._l10nPromise.get("editor_free_text2_aria_label").then(H=>{var K;return(K=this.editorDiv)===null||K===void 0?void 0:K.setAttribute("aria-label",H)}),_._l10nPromise.get("free_text2_default_content").then(H=>{var K;return(K=this.editorDiv)===null||K===void 0?void 0:K.setAttribute("default-content",H)}),this.editorDiv.contentEditable=!0;const{style:G}=this.editorDiv;if(G.fontSize=`calc(${D(this,b)}px * var(--scale-factor))`,G.color=D(this,h),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,s.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[H,K]=this.parentDimensions;this.setAt(E*H,F*K,this.width*H,this.height*K);for(const Z of D(this,y).split(`
`)){const ae=document.createElement("div");ae.append(Z?document.createTextNode(Z):document.createElement("br")),this.editorDiv.append(ae)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(E,F,G){const H=super.deserialize(E,F,G);return Ce(H,b,E.fontSize),Ce(H,h,n.Util.makeHexColor(...E.color)),Ce(H,y,E.value),H}serialize(){if(this.isEmpty())return null;const E=_._internalPadding*this.parentScale,F=this.getRect(E,E),G=i.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:D(this,h));return{annotationType:n.AnnotationEditorType.FREETEXT,color:G,fontSize:D(this,b),value:D(this,y),pageIndex:this.pageIndex,rect:F,rotation:this.rotation}}};let o=_;c=new WeakMap,u=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakMap,b=new WeakMap,v=new WeakSet,An=function(E){const F=H=>{this.editorDiv.style.fontSize=`calc(${H}px * var(--scale-factor))`,this.translate(0,-(H-D(this,b))*this.parentScale),Ce(this,b,H),me(this,d,Yt).call(this)},G=D(this,b);this.addCommands({cmd:()=>{F(E)},undo:()=>{F(G)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},N=new WeakSet,bn=function(E){const F=D(this,h);this.addCommands({cmd:()=>{Ce(this,h,this.editorDiv.style.color=E)},undo:()=>{Ce(this,h,this.editorDiv.style.color=F)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},O=new WeakSet,_n=function(){const E=this.editorDiv.getElementsByTagName("div");if(E.length===0)return this.editorDiv.innerText;const F=[];for(const G of E)F.push(G.innerText.replace(/\r\n?|\n/,""));return F.join(`
`)},d=new WeakSet,Yt=function(){const[E,F]=this.parentDimensions;let G;if(this.isAttachedToDOM)G=this.div.getBoundingClientRect();else{const{currentLayer:H,div:K}=this,Z=K.style.display;K.style.display="hidden",H.div.append(this.div),G=K.getBoundingClientRect(),K.remove(),K.style.display=Z}this.width=G.width/E,this.height=G.height/F},Ke(o,"_freeTextDefaultContent",""),Ke(o,"_l10nPromise"),Ke(o,"_internalPadding",0),Ke(o,"_defaultColor",null),Ke(o,"_defaultFontSize",10),Ke(o,"_keyboardManager",new s.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],_.prototype.commitOrRemove]])),Ke(o,"_type","freetext"),e.FreeTextEditor=o},(r,e,t)=>{var u,l,a,h,y,g,m,b,v,S,N,k,O,f,d,p,_,Sn,M,Tn,F,Cn,H,En,Z,Kt,oe,xn,ne,Zt,ge,wn,X,Nn,R,On,$,kn,ee,Pn,j,ft,x,Qt,I,It,U,Rt,ce,Et,fe,Jt,ye,Mt,ve,In,Oe,Rn,Le,Mn,Te,Fn,Ve,en,Q,Ft,te,xt,Re,tn;Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0;var n=t(1),s=t(140),i=t(141);const o=16,Ee=class extends s.AnnotationEditor{constructor(ue){super({...ue,name:"inkEditor"});he(this,_);he(this,M);he(this,F);he(this,H);he(this,Z);he(this,oe);he(this,ne);he(this,ge);he(this,X);he(this,R);he(this,$);he(this,ee);he(this,j);he(this,x);he(this,I);he(this,U);he(this,ce);he(this,fe);he(this,ye);he(this,Oe);he(this,Le);he(this,Te);he(this,Ve);he(this,Q);he(this,te);he(this,Re);he(this,u,0);he(this,l,0);he(this,a,0);he(this,h,this.canvasContextMenu.bind(this));he(this,y,this.canvasPointermove.bind(this));he(this,g,this.canvasPointerleave.bind(this));he(this,m,this.canvasPointerup.bind(this));he(this,b,this.canvasPointerdown.bind(this));he(this,v,new Path2D);he(this,S,!1);he(this,N,!1);he(this,k,!1);he(this,O,null);he(this,f,0);he(this,d,0);he(this,p,null);this.color=ue.color||null,this.thickness=ue.thickness||null,this.opacity=ue.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(ue){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(Ae=>[Ae,ue.get(Ae)]))}static updateDefaultParams(ue,Ae){switch(ue){case n.AnnotationEditorParamsType.INK_THICKNESS:Ee._defaultThickness=Ae;break;case n.AnnotationEditorParamsType.INK_COLOR:Ee._defaultColor=Ae;break;case n.AnnotationEditorParamsType.INK_OPACITY:Ee._defaultOpacity=Ae/100;break}}updateParams(ue,Ae){switch(ue){case n.AnnotationEditorParamsType.INK_THICKNESS:me(this,_,Sn).call(this,Ae);break;case n.AnnotationEditorParamsType.INK_COLOR:me(this,M,Tn).call(this,Ae);break;case n.AnnotationEditorParamsType.INK_OPACITY:me(this,F,Cn).call(this,Ae);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,Ee._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,Ee._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(Ee._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Ee._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||Ee._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Ee._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(me(this,I,It).call(this),me(this,U,Rt).call(this)),this.isAttachedToDOM||(this.parent.add(this),me(this,ce,Et).call(this)),me(this,te,xt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,D(this,O).disconnect(),Ce(this,O,null),super.remove())}setParent(ue){!this.parent&&ue?this._uiManager.removeShouldRescale(this):this.parent&&ue===null&&this._uiManager.addShouldRescale(this),super.setParent(ue)}onScaleChanging(){const[ue,Ae]=this.parentDimensions,Ie=this.width*ue,Ne=this.height*Ae;this.setDimensions(Ie,Ne)}enableEditMode(){D(this,S)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",D(this,b)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",D(this,b)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){D(this,S)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Ce(this,S,!0),this.div.classList.add("disabled"),me(this,te,xt).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(ue){super.focusin(ue),this.enableEditMode()}canvasPointerdown(ue){ue.button!==0||!this.isInEditMode()||D(this,S)||(this.setInForeground(),ue.preventDefault(),ue.type!=="mouse"&&this.div.focus(),me(this,oe,xn).call(this,ue.offsetX,ue.offsetY))}canvasContextMenu(ue){ue.preventDefault()}canvasPointermove(ue){ue.preventDefault(),me(this,ne,Zt).call(this,ue.offsetX,ue.offsetY)}canvasPointerup(ue){ue.preventDefault(),me(this,x,Qt).call(this,ue)}canvasPointerleave(ue){me(this,x,Qt).call(this,ue)}render(){if(this.div)return this.div;let ue,Ae;this.width&&(ue=this.x,Ae=this.y),super.render(),Ee._l10nPromise.get("editor_ink2_aria_label").then(Be=>{var We;return(We=this.div)===null||We===void 0?void 0:We.setAttribute("aria-label",Be)});const[Ie,Ne,De,Fe]=me(this,H,En).call(this);if(this.setAt(Ie,Ne,0,0),this.setDims(De,Fe),me(this,I,It).call(this),this.width){const[Be,We]=this.parentDimensions;this.setAt(ue*Be,Ae*We,this.width*Be,this.height*We),Ce(this,k,!0),me(this,ce,Et).call(this),this.setDims(this.width*Be,this.height*We),me(this,j,ft).call(this),me(this,Re,tn).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return me(this,U,Rt).call(this),this.div}setDimensions(ue,Ae){const Ie=Math.round(ue),Ne=Math.round(Ae);if(D(this,f)===Ie&&D(this,d)===Ne)return;Ce(this,f,Ie),Ce(this,d,Ne),this.canvas.style.visibility="hidden",D(this,u)&&Math.abs(D(this,u)-ue/Ae)>.01&&(Ae=Math.ceil(ue/D(this,u)),this.setDims(ue,Ae));const[De,Fe]=this.parentDimensions;this.width=ue/De,this.height=Ae/Fe,D(this,S)&&me(this,fe,Jt).call(this,ue,Ae),me(this,ce,Et).call(this),me(this,j,ft).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(ue,Ae,Ie){var Ge,Xe;const Ne=super.deserialize(ue,Ae,Ie);Ne.thickness=ue.thickness,Ne.color=n.Util.makeHexColor(...ue.color),Ne.opacity=ue.opacity;const[De,Fe]=Ne.pageDimensions,Be=Ne.width*De,We=Ne.height*Fe,He=Ne.parentScale,ze=ue.thickness/2;Ce(Ne,u,Be/We),Ce(Ne,S,!0),Ce(Ne,f,Math.round(Be)),Ce(Ne,d,Math.round(We));for(const{bezier:Ze}of ue.paths){const it=[];Ne.paths.push(it);let rt=He*(Ze[0]-ze),tt=He*(We-Ze[1]-ze);for(let st=2,mt=Ze.length;st<mt;st+=6){const at=He*(Ze[st]-ze),dt=He*(We-Ze[st+1]-ze),bt=He*(Ze[st+2]-ze),ut=He*(We-Ze[st+3]-ze),gt=He*(Ze[st+4]-ze),vt=He*(We-Ze[st+5]-ze);it.push([[rt,tt],[at,dt],[bt,ut],[gt,vt]]),rt=gt,tt=vt}const ct=me(this,ve,In).call(this,it);Ne.bezierPath2D.push(ct)}const Ye=me(Ge=Ne,Ve,en).call(Ge);return Ce(Ne,a,Math.max(o,Ye[2]-Ye[0])),Ce(Ne,l,Math.max(o,Ye[3]-Ye[1])),me(Xe=Ne,fe,Jt).call(Xe,Be,We),Ne}serialize(){if(this.isEmpty())return null;const ue=this.getRect(0,0),Ae=this.rotation%180===0?ue[3]-ue[1]:ue[2]-ue[0],Ie=s.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:Ie,thickness:this.thickness,opacity:this.opacity,paths:me(this,Oe,Rn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Ae),pageIndex:this.pageIndex,rect:ue,rotation:this.rotation}}};let c=Ee;u=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakMap,b=new WeakMap,v=new WeakMap,S=new WeakMap,N=new WeakMap,k=new WeakMap,O=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap,_=new WeakSet,Sn=function(ue){const Ae=this.thickness;this.addCommands({cmd:()=>{this.thickness=ue,me(this,te,xt).call(this)},undo:()=>{this.thickness=Ae,me(this,te,xt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},M=new WeakSet,Tn=function(ue){const Ae=this.color;this.addCommands({cmd:()=>{this.color=ue,me(this,j,ft).call(this)},undo:()=>{this.color=Ae,me(this,j,ft).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},F=new WeakSet,Cn=function(ue){ue/=100;const Ae=this.opacity;this.addCommands({cmd:()=>{this.opacity=ue,me(this,j,ft).call(this)},undo:()=>{this.opacity=Ae,me(this,j,ft).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},H=new WeakSet,En=function(){const{parentRotation:ue,parentDimensions:[Ae,Ie]}=this;switch(ue){case 90:return[0,Ie,Ie,Ae];case 180:return[Ae,Ie,Ae,Ie];case 270:return[Ae,0,Ie,Ae];default:return[0,0,Ae,Ie]}},Z=new WeakSet,Kt=function(){const{ctx:ue,color:Ae,opacity:Ie,thickness:Ne,parentScale:De,scaleFactor:Fe}=this;ue.lineWidth=Ne*De/Fe,ue.lineCap="round",ue.lineJoin="round",ue.miterLimit=10,ue.strokeStyle=`${Ae}${(0,i.opacityToHex)(Ie)}`},oe=new WeakSet,xn=function(ue,Ae){this.canvas.addEventListener("contextmenu",D(this,h)),this.canvas.addEventListener("pointerleave",D(this,g)),this.canvas.addEventListener("pointermove",D(this,y)),this.canvas.addEventListener("pointerup",D(this,m)),this.canvas.removeEventListener("pointerdown",D(this,b)),this.isEditing=!0,D(this,k)||(Ce(this,k,!0),me(this,ce,Et).call(this),this.thickness||(this.thickness=Ee._defaultThickness),this.color||(this.color=Ee._defaultColor||s.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Ee._defaultOpacity)),this.currentPath.push([ue,Ae]),Ce(this,N,!1),me(this,Z,Kt).call(this),Ce(this,p,()=>{me(this,R,On).call(this),D(this,p)&&window.requestAnimationFrame(D(this,p))}),window.requestAnimationFrame(D(this,p))},ne=new WeakSet,Zt=function(ue,Ae){const[Ie,Ne]=this.currentPath.at(-1);if(this.currentPath.length>1&&ue===Ie&&Ae===Ne)return;const De=this.currentPath;let Fe=D(this,v);if(De.push([ue,Ae]),Ce(this,N,!0),De.length<=2){Fe.moveTo(...De[0]),Fe.lineTo(ue,Ae);return}De.length===3&&(Ce(this,v,Fe=new Path2D),Fe.moveTo(...De[0])),me(this,$,kn).call(this,Fe,...De.at(-3),...De.at(-2),ue,Ae)},ge=new WeakSet,wn=function(){if(this.currentPath.length===0)return;const ue=this.currentPath.at(-1);D(this,v).lineTo(...ue)},X=new WeakSet,Nn=function(ue,Ae){Ce(this,p,null),ue=Math.min(Math.max(ue,0),this.canvas.width),Ae=Math.min(Math.max(Ae,0),this.canvas.height),me(this,ne,Zt).call(this,ue,Ae),me(this,ge,wn).call(this);let Ie;if(this.currentPath.length!==1)Ie=me(this,ee,Pn).call(this);else{const We=[ue,Ae];Ie=[[We,We.slice(),We.slice(),We]]}const Ne=D(this,v),De=this.currentPath;this.currentPath=[],Ce(this,v,new Path2D);const Fe=()=>{this.allRawPaths.push(De),this.paths.push(Ie),this.bezierPath2D.push(Ne),this.rebuild()},Be=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(me(this,I,It).call(this),me(this,U,Rt).call(this)),me(this,te,xt).call(this))};this.addCommands({cmd:Fe,undo:Be,mustExec:!0})},R=new WeakSet,On=function(){if(!D(this,N))return;Ce(this,N,!1);const ue=Math.ceil(this.thickness*this.parentScale),Ae=this.currentPath.slice(-3),Ie=Ae.map(Fe=>Fe[0]),Ne=Ae.map(Fe=>Fe[1]);Math.min(...Ie)-ue,Math.max(...Ie)+ue,Math.min(...Ne)-ue,Math.max(...Ne)+ue;const{ctx:De}=this;De.save(),De.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Fe of this.bezierPath2D)De.stroke(Fe);De.stroke(D(this,v)),De.restore()},$=new WeakSet,kn=function(ue,Ae,Ie,Ne,De,Fe,Be){const We=(Ae+Ne)/2,He=(Ie+De)/2,ze=(Ne+Fe)/2,Ye=(De+Be)/2;ue.bezierCurveTo(We+2*(Ne-We)/3,He+2*(De-He)/3,ze+2*(Ne-ze)/3,Ye+2*(De-Ye)/3,ze,Ye)},ee=new WeakSet,Pn=function(){const ue=this.currentPath;if(ue.length<=2)return[[ue[0],ue[0],ue.at(-1),ue.at(-1)]];const Ae=[];let Ie,[Ne,De]=ue[0];for(Ie=1;Ie<ue.length-2;Ie++){const[Ge,Xe]=ue[Ie],[Ze,it]=ue[Ie+1],rt=(Ge+Ze)/2,tt=(Xe+it)/2,ct=[Ne+2*(Ge-Ne)/3,De+2*(Xe-De)/3],st=[rt+2*(Ge-rt)/3,tt+2*(Xe-tt)/3];Ae.push([[Ne,De],ct,st,[rt,tt]]),[Ne,De]=[rt,tt]}const[Fe,Be]=ue[Ie],[We,He]=ue[Ie+1],ze=[Ne+2*(Fe-Ne)/3,De+2*(Be-De)/3],Ye=[We+2*(Fe-We)/3,He+2*(Be-He)/3];return Ae.push([[Ne,De],ze,Ye,[We,He]]),Ae},j=new WeakSet,ft=function(){if(this.isEmpty()){me(this,ye,Mt).call(this);return}me(this,Z,Kt).call(this);const{canvas:ue,ctx:Ae}=this;Ae.setTransform(1,0,0,1,0,0),Ae.clearRect(0,0,ue.width,ue.height),me(this,ye,Mt).call(this);for(const Ie of this.bezierPath2D)Ae.stroke(Ie)},x=new WeakSet,Qt=function(ue){this.canvas.removeEventListener("pointerleave",D(this,g)),this.canvas.removeEventListener("pointermove",D(this,y)),this.canvas.removeEventListener("pointerup",D(this,m)),this.canvas.addEventListener("pointerdown",D(this,b)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",D(this,h))},10),me(this,X,Nn).call(this,ue.offsetX,ue.offsetY),this.addToAnnotationStorage(),this.setInBackground()},I=new WeakSet,It=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Ee._l10nPromise.get("editor_ink_canvas_aria_label").then(ue=>{var Ae;return(Ae=this.canvas)===null||Ae===void 0?void 0:Ae.setAttribute("aria-label",ue)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},U=new WeakSet,Rt=function(){Ce(this,O,new ResizeObserver(ue=>{const Ae=ue[0].contentRect;Ae.width&&Ae.height&&this.setDimensions(Ae.width,Ae.height)})),D(this,O).observe(this.div)},ce=new WeakSet,Et=function(){if(!D(this,k))return;const[ue,Ae]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*ue),this.canvas.height=Math.ceil(this.height*Ae),me(this,ye,Mt).call(this)},fe=new WeakSet,Jt=function(ue,Ae){const Ie=me(this,Q,Ft).call(this),Ne=(ue-Ie)/D(this,a),De=(Ae-Ie)/D(this,l);this.scaleFactor=Math.min(Ne,De)},ye=new WeakSet,Mt=function(){const ue=me(this,Q,Ft).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+ue,this.translationY*this.scaleFactor+ue)},ve=new WeakSet,In=function(ue){const Ae=new Path2D;for(let Ie=0,Ne=ue.length;Ie<Ne;Ie++){const[De,Fe,Be,We]=ue[Ie];Ie===0&&Ae.moveTo(...De),Ae.bezierCurveTo(Fe[0],Fe[1],Be[0],Be[1],We[0],We[1])}return Ae},Oe=new WeakSet,Rn=function(ue,Ae,Ie,Ne){const Fe=[],Be=this.thickness/2;let We,He;for(const ze of this.paths){We=[],He=[];for(let Ye=0,Ge=ze.length;Ye<Ge;Ye++){const[Xe,Ze,it,rt]=ze[Ye],tt=ue*(Xe[0]+Ae)+Be,ct=Ne-ue*(Xe[1]+Ie)-Be,st=ue*(Ze[0]+Ae)+Be,mt=Ne-ue*(Ze[1]+Ie)-Be,at=ue*(it[0]+Ae)+Be,dt=Ne-ue*(it[1]+Ie)-Be,bt=ue*(rt[0]+Ae)+Be,ut=Ne-ue*(rt[1]+Ie)-Be;Ye===0&&(We.push(tt,ct),He.push(tt,ct)),We.push(st,mt,at,dt,bt,ut),me(this,Le,Mn).call(this,tt,ct,st,mt,at,dt,bt,ut,4,He)}Fe.push({bezier:We,points:He})}return Fe},Le=new WeakSet,Mn=function(ue,Ae,Ie,Ne,De,Fe,Be,We,He,ze){if(me(this,Te,Fn).call(this,ue,Ae,Ie,Ne,De,Fe,Be,We)){ze.push(Be,We);return}for(let Ye=1;Ye<He-1;Ye++){const Ge=Ye/He,Xe=1-Ge;let Ze=Ge*ue+Xe*Ie,it=Ge*Ae+Xe*Ne,rt=Ge*Ie+Xe*De,tt=Ge*Ne+Xe*Fe;const ct=Ge*De+Xe*Be,st=Ge*Fe+Xe*We;Ze=Ge*Ze+Xe*rt,it=Ge*it+Xe*tt,rt=Ge*rt+Xe*ct,tt=Ge*tt+Xe*st,Ze=Ge*Ze+Xe*rt,it=Ge*it+Xe*tt,ze.push(Ze,it)}ze.push(Be,We)},Te=new WeakSet,Fn=function(ue,Ae,Ie,Ne,De,Fe,Be,We){const ze=(3*Ie-2*ue-Be)**2,Ye=(3*Ne-2*Ae-We)**2,Ge=(3*De-ue-2*Be)**2,Xe=(3*Fe-Ae-2*We)**2;return Math.max(ze,Ge)+Math.max(Ye,Xe)<=10},Ve=new WeakSet,en=function(){let ue=1/0,Ae=-1/0,Ie=1/0,Ne=-1/0;for(const De of this.paths)for(const[Fe,Be,We,He]of De){const ze=n.Util.bezierBoundingBox(...Fe,...Be,...We,...He);ue=Math.min(ue,ze[0]),Ie=Math.min(Ie,ze[1]),Ae=Math.max(Ae,ze[2]),Ne=Math.max(Ne,ze[3])}return[ue,Ie,Ae,Ne]},Q=new WeakSet,Ft=function(){return D(this,S)?Math.ceil(this.thickness*this.parentScale):0},te=new WeakSet,xt=function(){let ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!D(this,S)){me(this,j,ft).call(this);return}const Ae=me(this,Ve,en).call(this),Ie=me(this,Q,Ft).call(this);Ce(this,a,Math.max(o,Ae[2]-Ae[0])),Ce(this,l,Math.max(o,Ae[3]-Ae[1]));const Ne=Math.ceil(Ie+D(this,a)*this.scaleFactor),De=Math.ceil(Ie+D(this,l)*this.scaleFactor),[Fe,Be]=this.parentDimensions;this.width=Ne/Fe,this.height=De/Be,Ce(this,u,Ne/De),me(this,Re,tn).call(this);const We=this.translationX,He=this.translationY;this.translationX=-Ae[0],this.translationY=-Ae[1],me(this,ce,Et).call(this),me(this,j,ft).call(this),Ce(this,f,Ne),Ce(this,d,De),this.setDims(Ne,De);const ze=ue?Ie/this.scaleFactor/2:0;this.translate(We-this.translationX-ze,He-this.translationY-ze)},Re=new WeakSet,tn=function(){const{style:ue}=this.div;D(this,u)>=1?(ue.minHeight=`${o}px`,ue.minWidth=`${Math.round(D(this,u)*o)}px`):(ue.minWidth=`${o}px`,ue.minHeight=`${Math.round(o/D(this,u))}px`)},he(c,ve),Ke(c,"_defaultColor",null),Ke(c,"_defaultOpacity",1),Ke(c,"_defaultThickness",1),Ke(c,"_l10nPromise"),Ke(c,"_type","ink"),e.InkEditor=c},(r,e,t)=>{var _e,At,P,Dn,$,nn,ee,rn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var n=t(1),s=t(142),i=t(139),o=t(166),c=t(167);const u=1e3,l=9,a=new WeakSet;function h(q){return{width:q[2]-q[0],height:q[3]-q[1]}}class y{static create(x){switch(x.data.annotationType){case n.AnnotationType.LINK:return new m(x);case n.AnnotationType.TEXT:return new b(x);case n.AnnotationType.WIDGET:switch(x.data.fieldType){case"Tx":return new S(x);case"Btn":return x.data.radioButton?new k(x):x.data.checkBox?new N(x):new O(x);case"Ch":return new f(x)}return new v(x);case n.AnnotationType.POPUP:return new d(x);case n.AnnotationType.FREETEXT:return new _(x);case n.AnnotationType.LINE:return new w(x);case n.AnnotationType.SQUARE:return new M(x);case n.AnnotationType.CIRCLE:return new E(x);case n.AnnotationType.POLYLINE:return new F(x);case n.AnnotationType.CARET:return new H(x);case n.AnnotationType.INK:return new K(x);case n.AnnotationType.POLYGON:return new G(x);case n.AnnotationType.HIGHLIGHT:return new Z(x);case n.AnnotationType.UNDERLINE:return new ae(x);case n.AnnotationType.SQUIGGLY:return new oe(x);case n.AnnotationType.STRIKEOUT:return new ie(x);case n.AnnotationType.STAMP:return new ne(x);case n.AnnotationType.FILEATTACHMENT:return new J(x);default:return new g(x)}}}class g{constructor(x){let{isRenderable:T=!1,ignoreBorder:I=!1,createQuadrilaterals:L=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=T,this.data=x.data,this.layer=x.layer,this.page=x.page,this.viewport=x.viewport,this.linkService=x.linkService,this.downloadManager=x.downloadManager,this.imageResourcesPath=x.imageResourcesPath,this.renderForms=x.renderForms,this.svgFactory=x.svgFactory,this.annotationStorage=x.annotationStorage,this.enableScripting=x.enableScripting,this.hasJSActions=x.hasJSActions,this._fieldObjects=x.fieldObjects,T&&(this.container=this._createContainer(I)),L&&(this.quadrilaterals=this._createQuadrilaterals(I))}_createContainer(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const{data:T,page:I,viewport:L}=this,U=document.createElement("section");U.setAttribute("data-annotation-id",T.id),T.noRotate&&U.classList.add("norotate");const{pageWidth:Y,pageHeight:ce,pageX:le,pageY:fe}=L.rawDims,{width:de,height:ye}=h(T.rect),be=n.Util.normalizeRect([T.rect[0],I.view[3]-T.rect[1]+I.view[1],T.rect[2],I.view[3]-T.rect[3]+I.view[1]]);if(!x&&T.borderStyle.width>0){U.style.borderWidth=`${T.borderStyle.width}px`;const xe=T.borderStyle.horizontalCornerRadius,Oe=T.borderStyle.verticalCornerRadius;if(xe>0||Oe>0){const Le=`calc(${xe}px * var(--scale-factor)) / calc(${Oe}px * var(--scale-factor))`;U.style.borderRadius=Le}else if(this instanceof k){const Le=`calc(${de}px * var(--scale-factor)) / calc(${ye}px * var(--scale-factor))`;U.style.borderRadius=Le}switch(T.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:U.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:U.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:U.style.borderBottomStyle="solid";break}const Pe=T.borderColor||null;Pe?U.style.borderColor=n.Util.makeHexColor(Pe[0]|0,Pe[1]|0,Pe[2]|0):U.style.borderWidth=0}U.style.left=`${100*(be[0]-le)/Y}%`,U.style.top=`${100*(be[1]-fe)/ce}%`;const{rotation:ve}=T;return T.hasOwnCanvas||ve===0?(U.style.width=`${100*de/Y}%`,U.style.height=`${100*ye/ce}%`):this.setRotation(ve,U),U}setRotation(x){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;const{pageWidth:I,pageHeight:L}=this.viewport.rawDims,{width:U,height:Y}=h(this.data.rect);let ce,le;x%180===0?(ce=100*U/I,le=100*Y/L):(ce=100*Y/I,le=100*U/L),T.style.width=`${ce}%`,T.style.height=`${le}%`,T.setAttribute("data-main-rotation",(360-x)%360)}get _commonActions(){const x=(T,I,L)=>{const U=L.detail[T];L.target.style[I]=o.ColorConverters[`${U[0]}_HTML`](U.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:T=>{const I=T.detail.display%2===1;this.container.style.visibility=I?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:I,print:T.detail.display===0||T.detail.display===3})},print:T=>{this.annotationStorage.setValue(this.data.id,{print:T.detail.print})},hidden:T=>{this.container.style.visibility=T.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:T.detail.hidden})},focus:T=>{setTimeout(()=>T.target.focus({preventScroll:!1}),0)},userName:T=>{T.target.title=T.detail.userName},readonly:T=>{T.detail.readonly?T.target.setAttribute("readonly",""):T.target.removeAttribute("readonly")},required:T=>{this._setRequired(T.target,T.detail.required)},bgColor:T=>{x("bgColor","backgroundColor",T)},fillColor:T=>{x("fillColor","backgroundColor",T)},fgColor:T=>{x("fgColor","color",T)},textColor:T=>{x("textColor","color",T)},borderColor:T=>{x("borderColor","borderColor",T)},strokeColor:T=>{x("strokeColor","borderColor",T)},rotation:T=>{const I=T.detail.rotation;this.setRotation(I),this.annotationStorage.setValue(this.data.id,{rotation:I})}})}_dispatchEventFromSandbox(x,T){const I=this._commonActions;for(const L of Object.keys(T.detail)){const U=x[L]||I[L];U==null||U(T)}}_setDefaultPropertiesFromJS(x){if(!this.enableScripting)return;const T=this.annotationStorage.getRawValue(this.data.id);if(!T)return;const I=this._commonActions;for(const[L,U]of Object.entries(T)){const Y=I[L];if(Y){const ce={detail:{[L]:U},target:x};Y(ce),delete T[L]}}}_createQuadrilaterals(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.data.quadPoints)return null;const T=[],I=this.data.rect;for(const L of this.data.quadPoints)this.data.rect=[L[2].x,L[2].y,L[1].x,L[1].y],T.push(this._createContainer(x));return this.data.rect=I,T}_createPopup(x,T){let I=this.container;this.quadrilaterals&&(x||(x=this.quadrilaterals),I=this.quadrilaterals[0]),x||(x=document.createElement("div"),x.classList.add("popupTriggerArea"),I.append(x));const U=new p({container:I,trigger:x,color:T.color,titleObj:T.titleObj,modificationDate:T.modificationDate,contentsObj:T.contentsObj,richText:T.richText,hideWrapper:!0}).render();U.style.left="100%",I.append(U)}_renderQuadrilaterals(x){for(const T of this.quadrilaterals)T.classList.add(x);return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(x){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const I=[];if(this._fieldObjects){const L=this._fieldObjects[x];if(L)for(const{page:U,id:Y,exportValues:ce}of L){if(U===-1||Y===T)continue;const le=typeof ce=="string"?ce:null,fe=document.querySelector(`[data-element-id="${Y}"]`);if(fe&&!a.has(fe)){(0,n.warn)(`_getElementsByName - element not allowed: ${Y}`);continue}I.push({id:Y,exportValue:le,domElement:fe})}return I}for(const L of document.getElementsByName(x)){const{exportValue:U}=L,Y=L.getAttribute("data-element-id");Y!==T&&a.has(L)&&I.push({id:Y,exportValue:U,domElement:L})}return I}}class m extends g{constructor(T){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(T,{isRenderable:!0,ignoreBorder:!!(I!=null&&I.ignoreBorder),createQuadrilaterals:!0});he(this,_e);he(this,P);this.isTooltipOnly=T.data.isTooltipOnly}render(){const{data:T,linkService:I}=this,L=document.createElement("a");L.setAttribute("data-element-id",T.id);let U=!1;return T.url?(I.addLinkAttributes(L,T.url,T.newWindow),U=!0):T.action?(this._bindNamedAction(L,T.action),U=!0):T.attachment?(this._bindAttachment(L,T.attachment),U=!0):T.setOCGState?(me(this,P,Dn).call(this,L,T.setOCGState),U=!0):T.dest?(this._bindLink(L,T.dest),U=!0):(T.actions&&(T.actions.Action||T.actions["Mouse Up"]||T.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(L,T),U=!0),T.resetForm?(this._bindResetFormAction(L,T.resetForm),U=!0):this.isTooltipOnly&&!U&&(this._bindLink(L,""),U=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((Y,ce)=>{const le=ce===0?L:L.cloneNode();return Y.append(le),Y}):(this.container.classList.add("linkAnnotation"),U&&this.container.append(L),this.container)}_bindLink(T,I){T.href=this.linkService.getDestinationHash(I),T.onclick=()=>(I&&this.linkService.goToDestination(I),!1),(I||I==="")&&me(this,_e,At).call(this)}_bindNamedAction(T,I){T.href=this.linkService.getAnchorUrl(""),T.onclick=()=>(this.linkService.executeNamedAction(I),!1),me(this,_e,At).call(this)}_bindAttachment(T,I){T.href=this.linkService.getAnchorUrl(""),T.onclick=()=>{var L;return(L=this.downloadManager)===null||L===void 0||L.openOrDownloadData(this.container,I.content,I.filename),!1},me(this,_e,At).call(this)}_bindJSAction(T,I){T.href=this.linkService.getAnchorUrl("");const L=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const U of Object.keys(I.actions)){const Y=L.get(U);Y&&(T[Y]=()=>{var ce;return(ce=this.linkService.eventBus)===null||ce===void 0||ce.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I.id,name:U}}),!1})}T.onclick||(T.onclick=()=>!1),me(this,_e,At).call(this)}_bindResetFormAction(T,I){const L=T.onclick;if(L||(T.href=this.linkService.getAnchorUrl("")),me(this,_e,At).call(this),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),L||(T.onclick=()=>!1);return}T.onclick=()=>{L==null||L();const{fields:U,refs:Y,include:ce}=I,le=[];if(U.length!==0||Y.length!==0){const be=new Set(Y);for(const ve of U){const xe=this._fieldObjects[ve]||[];for(const{id:Oe}of xe)be.add(Oe)}for(const ve of Object.values(this._fieldObjects))for(const xe of ve)be.has(xe.id)===ce&&le.push(xe)}else for(const be of Object.values(this._fieldObjects))le.push(...be);const fe=this.annotationStorage,de=[];for(const be of le){const{id:ve}=be;switch(de.push(ve),be.type){case"text":{const Oe=be.defaultValue||"";fe.setValue(ve,{value:Oe});break}case"checkbox":case"radiobutton":{const Oe=be.defaultValue===be.exportValues;fe.setValue(ve,{value:Oe});break}case"combobox":case"listbox":{const Oe=be.defaultValue||"";fe.setValue(ve,{value:Oe});break}default:continue}const xe=document.querySelector(`[data-element-id="${ve}"]`);if(xe){if(!a.has(xe)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${ve}`);continue}}else continue;xe.dispatchEvent(new Event("resetform"))}if(this.enableScripting){var ye;(ye=this.linkService.eventBus)===null||ye===void 0||ye.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:de,name:"ResetForm"}})}return!1}}}_e=new WeakSet,At=function(){this.container.setAttribute("data-internal-link","")},P=new WeakSet,Dn=function(T,I){T.href=this.linkService.getAnchorUrl(""),T.onclick=()=>(this.linkService.executeSetOCGState(I),!1),me(this,_e,At).call(this)};class b extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U})}render(){this.container.classList.add("textAnnotation");const x=document.createElement("img");return x.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",x.alt="[{{type}} Annotation]",x.dataset.l10nId="text_annotation_type",x.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(x,this.data),this.container.append(x),this.container}}class v extends g{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(x){if(this.data.hasOwnCanvas){var T;((T=x.previousSibling)===null||T===void 0?void 0:T.nodeName)==="CANVAS"&&(x.previousSibling.hidden=!0),x.hidden=!1}}_getKeyModifier(x){const{isWin:T,isMac:I}=n.FeatureTest.platform;return T&&x.ctrlKey||I&&x.metaKey}_setEventListener(x,T,I,L){T.includes("mouse")?x.addEventListener(T,U=>{var Y;(Y=this.linkService.eventBus)===null||Y===void 0||Y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:I,value:L(U),shift:U.shiftKey,modifier:this._getKeyModifier(U)}})}):x.addEventListener(T,U=>{var Y;(Y=this.linkService.eventBus)===null||Y===void 0||Y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:I,value:L(U)}})})}_setEventListeners(x,T,I){for(const[U,Y]of T){var L;(Y==="Action"||(L=this.data.actions)!==null&&L!==void 0&&L[Y])&&this._setEventListener(x,U,Y,I)}}_setBackgroundColor(x){const T=this.data.backgroundColor||null;x.style.backgroundColor=T===null?"transparent":n.Util.makeHexColor(T[0],T[1],T[2])}_setTextStyle(x){const T=["left","center","right"],{fontColor:I}=this.data.defaultAppearanceData,L=this.data.defaultAppearanceData.fontSize||l,U=x.style;let Y;const ce=2,le=fe=>Math.round(10*fe)/10;if(this.data.multiLine){const fe=Math.abs(this.data.rect[3]-this.data.rect[1]-ce),de=Math.round(fe/(n.LINE_FACTOR*L))||1,ye=fe/de;Y=Math.min(L,le(ye/n.LINE_FACTOR))}else{const fe=Math.abs(this.data.rect[3]-this.data.rect[1]-ce);Y=Math.min(L,le(fe/n.LINE_FACTOR))}U.fontSize=`calc(${Y}px * var(--scale-factor))`,U.color=n.Util.makeHexColor(I[0],I[1],I[2]),this.data.textAlignment!==null&&(U.textAlign=T[this.data.textAlignment])}_setRequired(x,T){T?x.setAttribute("required",!0):x.removeAttribute("required"),x.setAttribute("aria-required",T)}}class S extends v{constructor(x){const T=x.renderForms||!x.data.hasAppearance&&!!x.data.fieldValue;super(x,{isRenderable:T})}setPropertyOnSiblings(x,T,I,L){const U=this.annotationStorage;for(const Y of this._getElementsByName(x.name,x.id))Y.domElement&&(Y.domElement[T]=I),U.setValue(Y.id,{[L]:I})}render(){const x=this.annotationStorage,T=this.data.id;this.container.classList.add("textWidgetAnnotation");let I=null;if(this.renderForms){var L;const Y=x.getValue(T,{value:this.data.fieldValue});let ce=Y.value||"";const le=x.getValue(T,{charLimit:this.data.maxLen}).charLimit;le&&ce.length>le&&(ce=ce.slice(0,le));let fe=Y.formattedValue||((L=this.data.textContent)===null||L===void 0?void 0:L.join(`
`))||null;fe&&this.data.comb&&(fe=fe.replaceAll(/\s+/g,""));const de={userValue:ce,formattedValue:fe,lastCommittedValue:null,commitKey:1};this.data.multiLine?(I=document.createElement("textarea"),I.textContent=fe??ce,this.data.doNotScroll&&(I.style.overflowY="hidden")):(I=document.createElement("input"),I.type="text",I.setAttribute("value",fe??ce),this.data.doNotScroll&&(I.style.overflowX="hidden")),this.data.hasOwnCanvas&&(I.hidden=!0),a.add(I),I.setAttribute("data-element-id",T),I.disabled=this.data.readOnly,I.name=this.data.fieldName,I.tabIndex=u,this._setRequired(I,this.data.required),le&&(I.maxLength=le),I.addEventListener("input",be=>{x.setValue(T,{value:be.target.value}),this.setPropertyOnSiblings(I,"value",be.target.value,"value"),de.formattedValue=null}),I.addEventListener("resetform",be=>{const ve=this.data.defaultFieldValue??"";I.value=de.userValue=ve,de.formattedValue=null});let ye=be=>{const{formattedValue:ve}=de;ve!=null&&(be.target.value=ve),be.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var U;I.addEventListener("focus",ve=>{const{target:xe}=ve;de.userValue&&(xe.value=de.userValue),de.lastCommittedValue=xe.value,de.commitKey=1}),I.addEventListener("updatefromsandbox",ve=>{this.showElementAndHideCanvas(ve.target);const xe={value(Oe){de.userValue=Oe.detail.value??"",x.setValue(T,{value:de.userValue.toString()}),Oe.target.value=de.userValue},formattedValue(Oe){const{formattedValue:Pe}=Oe.detail;de.formattedValue=Pe,Pe!=null&&Oe.target!==document.activeElement&&(Oe.target.value=Pe),x.setValue(T,{formattedValue:Pe})},selRange(Oe){Oe.target.setSelectionRange(...Oe.detail.selRange)},charLimit:Oe=>{var Pe;const{charLimit:Le}=Oe.detail,{target:se}=Oe;if(Le===0){se.removeAttribute("maxLength");return}se.setAttribute("maxLength",Le);let Te=de.userValue;!Te||Te.length<=Le||(Te=Te.slice(0,Le),se.value=de.userValue=Te,x.setValue(T,{value:Te}),(Pe=this.linkService.eventBus)===null||Pe===void 0||Pe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:Te,willCommit:!0,commitKey:1,selStart:se.selectionStart,selEnd:se.selectionEnd}}))}};this._dispatchEventFromSandbox(xe,ve)}),I.addEventListener("keydown",ve=>{var xe;de.commitKey=1;let Oe=-1;if(ve.key==="Escape"?Oe=0:ve.key==="Enter"&&!this.data.multiLine?Oe=2:ve.key==="Tab"&&(de.commitKey=3),Oe===-1)return;const{value:Pe}=ve.target;de.lastCommittedValue!==Pe&&(de.lastCommittedValue=Pe,de.userValue=Pe,(xe=this.linkService.eventBus)===null||xe===void 0||xe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:Pe,willCommit:!0,commitKey:Oe,selStart:ve.target.selectionStart,selEnd:ve.target.selectionEnd}}))});const be=ye;ye=null,I.addEventListener("blur",ve=>{if(!ve.relatedTarget)return;const{value:xe}=ve.target;if(de.userValue=xe,de.lastCommittedValue!==xe){var Oe;(Oe=this.linkService.eventBus)===null||Oe===void 0||Oe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:xe,willCommit:!0,commitKey:de.commitKey,selStart:ve.target.selectionStart,selEnd:ve.target.selectionEnd}})}be(ve)}),(U=this.data.actions)!==null&&U!==void 0&&U.Keystroke&&I.addEventListener("beforeinput",ve=>{var xe;de.lastCommittedValue=null;const{data:Oe,target:Pe}=ve,{value:Le,selectionStart:se,selectionEnd:Te}=Pe;let Ue=se,Ve=Te;switch(ve.inputType){case"deleteWordBackward":{const $e=Le.substring(0,se).match(/\w*[^\w]*$/);$e&&(Ue-=$e[0].length);break}case"deleteWordForward":{const $e=Le.substring(se).match(/^[^\w]*\w*/);$e&&(Ve+=$e[0].length);break}case"deleteContentBackward":se===Te&&(Ue-=1);break;case"deleteContentForward":se===Te&&(Ve+=1);break}ve.preventDefault(),(xe=this.linkService.eventBus)===null||xe===void 0||xe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:Le,change:Oe||"",willCommit:!1,selStart:Ue,selEnd:Ve}})}),this._setEventListeners(I,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ve=>ve.target.value)}if(ye&&I.addEventListener("blur",ye),this.data.comb){const ve=(this.data.rect[2]-this.data.rect[0])/le;I.classList.add("comb"),I.style.letterSpacing=`calc(${ve}px * var(--scale-factor) - 1ch)`}}else I=document.createElement("div"),I.textContent=this.data.fieldValue,I.style.verticalAlign="middle",I.style.display="table-cell";return this._setTextStyle(I),this._setBackgroundColor(I),this._setDefaultPropertiesFromJS(I),this.container.append(I),this.container}}class N extends v{constructor(x){super(x,{isRenderable:x.renderForms})}render(){const x=this.annotationStorage,T=this.data,I=T.id;let L=x.getValue(I,{value:T.exportValue===T.fieldValue}).value;typeof L=="string"&&(L=L!=="Off",x.setValue(I,{value:L})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const U=document.createElement("input");return a.add(U),U.setAttribute("data-element-id",I),U.disabled=T.readOnly,this._setRequired(U,this.data.required),U.type="checkbox",U.name=T.fieldName,L&&U.setAttribute("checked",!0),U.setAttribute("exportValue",T.exportValue),U.tabIndex=u,U.addEventListener("change",Y=>{const{name:ce,checked:le}=Y.target;for(const fe of this._getElementsByName(ce,I)){const de=le&&fe.exportValue===T.exportValue;fe.domElement&&(fe.domElement.checked=de),x.setValue(fe.id,{value:de})}x.setValue(I,{value:le})}),U.addEventListener("resetform",Y=>{const ce=T.defaultFieldValue||"Off";Y.target.checked=ce===T.exportValue}),this.enableScripting&&this.hasJSActions&&(U.addEventListener("updatefromsandbox",Y=>{const ce={value(le){le.target.checked=le.detail.value!=="Off",x.setValue(I,{value:le.target.checked})}};this._dispatchEventFromSandbox(ce,Y)}),this._setEventListeners(U,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Y=>Y.target.checked)),this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class k extends v{constructor(x){super(x,{isRenderable:x.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const x=this.annotationStorage,T=this.data,I=T.id;let L=x.getValue(I,{value:T.fieldValue===T.buttonValue}).value;typeof L=="string"&&(L=L!==T.buttonValue,x.setValue(I,{value:L}));const U=document.createElement("input");if(a.add(U),U.setAttribute("data-element-id",I),U.disabled=T.readOnly,this._setRequired(U,this.data.required),U.type="radio",U.name=T.fieldName,L&&U.setAttribute("checked",!0),U.tabIndex=u,U.addEventListener("change",Y=>{const{name:ce,checked:le}=Y.target;for(const fe of this._getElementsByName(ce,I))x.setValue(fe.id,{value:!1});x.setValue(I,{value:le})}),U.addEventListener("resetform",Y=>{const ce=T.defaultFieldValue;Y.target.checked=ce!=null&&ce===T.buttonValue}),this.enableScripting&&this.hasJSActions){const Y=T.buttonValue;U.addEventListener("updatefromsandbox",ce=>{const le={value:fe=>{const de=Y===fe.detail.value;for(const ye of this._getElementsByName(fe.target.name)){const be=de&&ye.id===I;ye.domElement&&(ye.domElement.checked=be),x.setValue(ye.id,{value:be})}}};this._dispatchEventFromSandbox(le,ce)}),this._setEventListeners(U,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ce=>ce.target.checked)}return this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class O extends m{constructor(x){super(x,{ignoreBorder:x.data.hasAppearance})}render(){const x=super.render();x.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(x.title=this.data.alternativeText);const T=x.lastChild;return this.enableScripting&&this.hasJSActions&&T&&(this._setDefaultPropertiesFromJS(T),T.addEventListener("updatefromsandbox",I=>{this._dispatchEventFromSandbox({},I)})),x}}class f extends v{constructor(x){super(x,{isRenderable:x.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const x=this.annotationStorage,T=this.data.id,I=x.getValue(T,{value:this.data.fieldValue}),L=document.createElement("select");a.add(L),L.setAttribute("data-element-id",T),L.disabled=this.data.readOnly,this._setRequired(L,this.data.required),L.name=this.data.fieldName,L.tabIndex=u;let U=this.data.combo&&this.data.options.length>0;this.data.combo||(L.size=this.data.options.length,this.data.multiSelect&&(L.multiple=!0)),L.addEventListener("resetform",de=>{const ye=this.data.defaultFieldValue;for(const be of L.options)be.selected=be.value===ye});for(const de of this.data.options){const ye=document.createElement("option");ye.textContent=de.displayValue,ye.value=de.exportValue,I.value.includes(de.exportValue)&&(ye.setAttribute("selected",!0),U=!1),L.append(ye)}let Y=null;if(U){const de=document.createElement("option");de.value=" ",de.setAttribute("hidden",!0),de.setAttribute("selected",!0),L.prepend(de),Y=()=>{de.remove(),L.removeEventListener("input",Y),Y=null},L.addEventListener("input",Y)}const ce=de=>{const ye=de?"value":"textContent",{options:be,multiple:ve}=L;return ve?Array.prototype.filter.call(be,xe=>xe.selected).map(xe=>xe[ye]):be.selectedIndex===-1?null:be[be.selectedIndex][ye]};let le=ce(!1);const fe=de=>{const ye=de.target.options;return Array.prototype.map.call(ye,be=>({displayValue:be.textContent,exportValue:be.value}))};return this.enableScripting&&this.hasJSActions?(L.addEventListener("updatefromsandbox",de=>{const ye={value(be){var ve;(ve=Y)===null||ve===void 0||ve();const xe=be.detail.value,Oe=new Set(Array.isArray(xe)?xe:[xe]);for(const Pe of L.options)Pe.selected=Oe.has(Pe.value);x.setValue(T,{value:ce(!0)}),le=ce(!1)},multipleSelection(be){L.multiple=!0},remove(be){const ve=L.options,xe=be.detail.remove;ve[xe].selected=!1,L.remove(xe),ve.length>0&&Array.prototype.findIndex.call(ve,Pe=>Pe.selected)===-1&&(ve[0].selected=!0),x.setValue(T,{value:ce(!0),items:fe(be)}),le=ce(!1)},clear(be){for(;L.length!==0;)L.remove(0);x.setValue(T,{value:null,items:[]}),le=ce(!1)},insert(be){const{index:ve,displayValue:xe,exportValue:Oe}=be.detail.insert,Pe=L.children[ve],Le=document.createElement("option");Le.textContent=xe,Le.value=Oe,Pe?Pe.before(Le):L.append(Le),x.setValue(T,{value:ce(!0),items:fe(be)}),le=ce(!1)},items(be){const{items:ve}=be.detail;for(;L.length!==0;)L.remove(0);for(const xe of ve){const{displayValue:Oe,exportValue:Pe}=xe,Le=document.createElement("option");Le.textContent=Oe,Le.value=Pe,L.append(Le)}L.options.length>0&&(L.options[0].selected=!0),x.setValue(T,{value:ce(!0),items:fe(be)}),le=ce(!1)},indices(be){const ve=new Set(be.detail.indices);for(const xe of be.target.options)xe.selected=ve.has(xe.index);x.setValue(T,{value:ce(!0)}),le=ce(!1)},editable(be){be.target.disabled=!be.detail.editable}};this._dispatchEventFromSandbox(ye,de)}),L.addEventListener("input",de=>{var ye;const be=ce(!0);x.setValue(T,{value:be}),de.preventDefault(),(ye=this.linkService.eventBus)===null||ye===void 0||ye.dispatch("dispatcheventinsandbox",{source:this,detail:{id:T,name:"Keystroke",value:le,changeEx:be,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(L,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],de=>de.target.value)):L.addEventListener("input",function(de){x.setValue(T,{value:ce(!0)})}),this.data.combo&&this._setTextStyle(L),this._setBackgroundColor(L),this._setDefaultPropertiesFromJS(L),this.container.append(L),this.container}}const W=class extends g{constructor(x){var T,I,L;const{data:U}=x,Y=!W.IGNORE_TYPES.has(U.parentType)&&!!((T=U.titleObj)!==null&&T!==void 0&&T.str||(I=U.contentsObj)!==null&&I!==void 0&&I.str||(L=U.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:Y})}render(){this.container.classList.add("popupAnnotation");const x=this.layer.querySelectorAll(`[data-annotation-id="${this.data.parentId}"]`);if(x.length===0)return this.container;const T=new p({container:this.container,trigger:Array.from(x),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),I=this.page,L=n.Util.normalizeRect([this.data.parentRect[0],I.view[3]-this.data.parentRect[1]+I.view[1],this.data.parentRect[2],I.view[3]-this.data.parentRect[3]+I.view[1]]),U=L[0]+this.data.parentRect[2]-this.data.parentRect[0],Y=L[1],{pageWidth:ce,pageHeight:le,pageX:fe,pageY:de}=this.viewport.rawDims;return this.container.style.left=`${100*(U-fe)/ce}%`,this.container.style.top=`${100*(Y-de)/le}%`,this.container.append(T.render()),this.container}};let d=W;Ke(d,"IGNORE_TYPES",new Set(["Line","Square","Circle","PolyLine","Polygon","Ink"]));class p{constructor(x){this.container=x.container,this.trigger=x.trigger,this.color=x.color,this.titleObj=x.titleObj,this.modificationDate=x.modificationDate,this.contentsObj=x.contentsObj,this.richText=x.richText,this.hideWrapper=x.hideWrapper||!1,this.pinned=!1}render(){var x,T;const L=document.createElement("div");L.classList.add("popupWrapper"),this.hideElement=this.hideWrapper?L:this.container,this.hideElement.hidden=!0;const U=document.createElement("div");U.classList.add("popup");const Y=this.color;if(Y){const fe=.7*(255-Y[0])+Y[0],de=.7*(255-Y[1])+Y[1],ye=.7*(255-Y[2])+Y[2];U.style.backgroundColor=n.Util.makeHexColor(fe|0,de|0,ye|0)}const ce=document.createElement("h1");ce.dir=this.titleObj.dir,ce.textContent=this.titleObj.str,U.append(ce);const le=s.PDFDateString.toDateObject(this.modificationDate);if(le){const fe=document.createElement("span");fe.classList.add("popupDate"),fe.textContent="{{date}}, {{time}}",fe.dataset.l10nId="annotation_date_string",fe.dataset.l10nArgs=JSON.stringify({date:le.toLocaleDateString(),time:le.toLocaleTimeString()}),U.append(fe)}if((x=this.richText)!==null&&x!==void 0&&x.str&&(!((T=this.contentsObj)!==null&&T!==void 0&&T.str)||this.contentsObj.str===this.richText.str))c.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:U}),U.lastChild.classList.add("richText","popupContent");else{const fe=this._formatContents(this.contentsObj);U.append(fe)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const fe of this.trigger)fe.addEventListener("click",this._toggle.bind(this)),fe.addEventListener("mouseover",this._show.bind(this,!1)),fe.addEventListener("mouseout",this._hide.bind(this,!1));return U.addEventListener("click",this._hide.bind(this,!0)),L.append(U),L}_formatContents(x){let{str:T,dir:I}=x;const L=document.createElement("p");L.classList.add("popupContent"),L.dir=I;const U=T.split(/(?:\r\n?|\n)/);for(let Y=0,ce=U.length;Y<ce;++Y){const le=U[Y];L.append(document.createTextNode(le)),Y<ce-1&&L.append(document.createElement("br"))}return L}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0)&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class _ extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0}),this.textContent=x.data.textContent}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const x=document.createElement("div");x.classList.add("annotationTextContent"),x.setAttribute("role","comment");for(const T of this.textContent){const I=document.createElement("span");I.textContent=T,x.append(I)}this.container.append(x)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class w extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const x=this.data,{width:T,height:I}=h(x.rect),L=this.svgFactory.create(T,I,!0),U=this.svgFactory.createElement("svg:line");return U.setAttribute("x1",x.rect[2]-x.lineCoordinates[0]),U.setAttribute("y1",x.rect[3]-x.lineCoordinates[1]),U.setAttribute("x2",x.rect[2]-x.lineCoordinates[2]),U.setAttribute("y2",x.rect[3]-x.lineCoordinates[3]),U.setAttribute("stroke-width",x.borderStyle.width||1),U.setAttribute("stroke","transparent"),U.setAttribute("fill","transparent"),L.append(U),this.container.append(L),this._createPopup(U,x),this.container}}class M extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const x=this.data,{width:T,height:I}=h(x.rect),L=this.svgFactory.create(T,I,!0),U=x.borderStyle.width,Y=this.svgFactory.createElement("svg:rect");return Y.setAttribute("x",U/2),Y.setAttribute("y",U/2),Y.setAttribute("width",T-U),Y.setAttribute("height",I-U),Y.setAttribute("stroke-width",U||1),Y.setAttribute("stroke","transparent"),Y.setAttribute("fill","transparent"),L.append(Y),this.container.append(L),this._createPopup(Y,x),this.container}}class E extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const x=this.data,{width:T,height:I}=h(x.rect),L=this.svgFactory.create(T,I,!0),U=x.borderStyle.width,Y=this.svgFactory.createElement("svg:ellipse");return Y.setAttribute("cx",T/2),Y.setAttribute("cy",I/2),Y.setAttribute("rx",T/2-U/2),Y.setAttribute("ry",I/2-U/2),Y.setAttribute("stroke-width",U||1),Y.setAttribute("stroke","transparent"),Y.setAttribute("fill","transparent"),L.append(Y),this.container.append(L),this._createPopup(Y,x),this.container}}class F extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const x=this.data,{width:T,height:I}=h(x.rect),L=this.svgFactory.create(T,I,!0);let U=[];for(const ce of x.vertices){const le=ce.x-x.rect[0],fe=x.rect[3]-ce.y;U.push(le+","+fe)}U=U.join(" ");const Y=this.svgFactory.createElement(this.svgElementName);return Y.setAttribute("points",U),Y.setAttribute("stroke-width",x.borderStyle.width||1),Y.setAttribute("stroke","transparent"),Y.setAttribute("fill","transparent"),L.append(Y),this.container.append(L),this._createPopup(Y,x),this.container}}class G extends F{constructor(x){super(x),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class H extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class K extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const x=this.data,{width:T,height:I}=h(x.rect),L=this.svgFactory.create(T,I,!0);for(const U of x.inkLists){let Y=[];for(const le of U){const fe=le.x-x.rect[0],de=x.rect[3]-le.y;Y.push(`${fe},${de}`)}Y=Y.join(" ");const ce=this.svgFactory.createElement(this.svgElementName);ce.setAttribute("points",Y),ce.setAttribute("stroke-width",x.borderStyle.width||1),ce.setAttribute("stroke","transparent"),ce.setAttribute("fill","transparent"),this._createPopup(ce,x),L.append(ce)}return this.container.append(L),this.container}}class Z extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class ae extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class oe extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class ie extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class ne extends g{constructor(x){var T,I,L;const U=!!(x.data.hasPopup||(T=x.data.titleObj)!==null&&T!==void 0&&T.str||(I=x.data.contentsObj)!==null&&I!==void 0&&I.str||(L=x.data.richText)!==null&&L!==void 0&&L.str);super(x,{isRenderable:U,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class J extends g{constructor(x){var T;super(x,{isRenderable:!0});const{filename:I,content:L}=this.data.file;this.filename=(0,s.getFilenameFromUrl)(I,!0),this.content=L,(T=this.linkService.eventBus)===null||T===void 0||T.dispatch("fileattachmentannotation",{source:this,filename:I,content:L})}render(){var x,T;this.container.classList.add("fileAttachmentAnnotation");let I;return this.data.hasAppearance?I=document.createElement("div"):(I=document.createElement("img"),I.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),I.classList.add("popupTriggerArea"),I.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((x=this.data.titleObj)!==null&&x!==void 0&&x.str||(T=this.data.contentsObj)!==null&&T!==void 0&&T.str||this.data.richText)&&this._createPopup(I,this.data),this.container.append(I),this.container}_download(){var x;(x=this.downloadManager)===null||x===void 0||x.openOrDownloadData(this.container,this.content,this.filename)}}const j=class{static render(x){var le,fe;const{annotations:T,div:I,viewport:L,accessibilityManager:U}=x;(0,s.setLayerDimensions)(I,L);const Y={data:null,layer:I,page:x.page,viewport:L,linkService:x.linkService,downloadManager:x.downloadManager,imageResourcesPath:x.imageResourcesPath||"",renderForms:x.renderForms!==!1,svgFactory:new s.DOMSVGFactory,annotationStorage:x.annotationStorage||new i.AnnotationStorage,enableScripting:x.enableScripting===!0,hasJSActions:x.hasJSActions,fieldObjects:x.fieldObjects};let ce=0;for(const de of T){if(de.noHTML)continue;if(de.annotationType!==n.AnnotationType.POPUP){const{width:ve,height:xe}=h(de.rect);if(ve<=0||xe<=0)continue}Y.data=de;const ye=y.create(Y);if(!ye.isRenderable)continue;const be=ye.render();if(de.hidden&&(be.style.visibility="hidden"),Array.isArray(be))for(const ve of be)ve.style.zIndex=ce++,me(le=j,$,nn).call(le,ve,de.id,I,U);else be.style.zIndex=ce++,ye instanceof d?I.prepend(be):me(fe=j,$,nn).call(fe,be,de.id,I,U)}me(this,ee,rn).call(this,I,x.annotationCanvasMap)}static update(x){const{annotationCanvasMap:T,div:I,viewport:L}=x;(0,s.setLayerDimensions)(I,{rotation:L.rotation}),me(this,ee,rn).call(this,I,T),I.hidden=!1}};let ge=j;$=new WeakSet,nn=function(x,T,I,L){const U=x.firstChild||x;U.id=`${s.AnnotationPrefix}${T}`,I.append(x),L==null||L.moveElementInDOM(I,x,U,!1)},ee=new WeakSet,rn=function(x,T){if(T){for(const[I,L]of T){const U=x.querySelector(`[data-annotation-id="${I}"]`);if(!U)continue;const{firstChild:Y}=U;Y?Y.nodeName==="CANVAS"?Y.replaceWith(L):Y.before(L):U.append(L)}T.clear()}},he(ge,$),he(ge,ee),e.AnnotationLayer=ge},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}class n{static CMYK_G(i){let[o,c,u,l]=i;return["G",1-Math.min(1,.3*o+.59*u+.11*c+l)]}static G_CMYK(i){let[o]=i;return["CMYK",0,0,0,1-o]}static G_RGB(i){let[o]=i;return["RGB",o,o,o]}static G_HTML(i){let[o]=i;const c=t(o);return`#${c}${c}${c}`}static RGB_G(i){let[o,c,u]=i;return["G",.3*o+.59*c+.11*u]}static RGB_HTML(i){let[o,c,u]=i;const l=t(o),a=t(c),h=t(u);return`#${l}${a}${h}`}static T_HTML(){return"#00000000"}static CMYK_RGB(i){let[o,c,u,l]=i;return["RGB",1-Math.min(1,o+l),1-Math.min(1,u+l),1-Math.min(1,c+l)]}static CMYK_HTML(i){const o=this.CMYK_RGB(i).slice(1);return this.RGB_HTML(o)}static RGB_CMYK(i){let[o,c,u]=i;const l=1-o,a=1-c,h=1-u,y=Math.min(l,a,h);return["CMYK",l,a,h,y]}}e.ColorConverters=n},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var n=t(154);class s{static setupStorage(o,c,u,l,a){const h=l.getValue(c,{value:null});switch(u.name){case"textarea":if(h.value!==null&&(o.textContent=h.value),a==="print")break;o.addEventListener("input",y=>{l.setValue(c,{value:y.target.value})});break;case"input":if(u.attributes.type==="radio"||u.attributes.type==="checkbox"){if(h.value===u.attributes.xfaOn?o.setAttribute("checked",!0):h.value===u.attributes.xfaOff&&o.removeAttribute("checked"),a==="print")break;o.addEventListener("change",y=>{l.setValue(c,{value:y.target.checked?y.target.getAttribute("xfaOn"):y.target.getAttribute("xfaOff")})})}else{if(h.value!==null&&o.setAttribute("value",h.value),a==="print")break;o.addEventListener("input",y=>{l.setValue(c,{value:y.target.value})})}break;case"select":if(h.value!==null)for(const y of u.children)y.attributes.value===h.value&&(y.attributes.selected=!0);o.addEventListener("input",y=>{const g=y.target.options,m=g.selectedIndex===-1?"":g[g.selectedIndex].value;l.setValue(c,{value:m})});break}}static setAttributes(o){let{html:c,element:u,storage:l=null,intent:a,linkService:h}=o;const{attributes:y}=u,g=c instanceof HTMLAnchorElement;y.type==="radio"&&(y.name=`${y.name}-${a}`);for(const[m,b]of Object.entries(y))if(b!=null)switch(m){case"class":b.length&&c.setAttribute(m,b.join(" "));break;case"dataId":break;case"id":c.setAttribute("data-element-id",b);break;case"style":Object.assign(c.style,b);break;case"textContent":c.textContent=b;break;default:(!g||m!=="href"&&m!=="newWindow")&&c.setAttribute(m,b)}g&&h.addLinkAttributes(c,y.href,y.newWindow),l&&y.dataId&&this.setupStorage(c,y.dataId,u,l)}static render(o){const c=o.annotationStorage,u=o.linkService,l=o.xfaHtml,a=o.intent||"display",h=document.createElement(l.name);l.attributes&&this.setAttributes({html:h,element:l,intent:a,linkService:u});const y=[[l,-1,h]],g=o.div;if(g.append(h),o.viewport){const v=`matrix(${o.viewport.transform.join(",")})`;g.style.transform=v}a!=="richText"&&g.setAttribute("class","xfaLayer xfaFont");const m=[];for(;y.length>0;){var b;const[v,S,N]=y.at(-1);if(S+1===v.children.length){y.pop();continue}const k=v.children[++y.at(-1)[1]];if(k===null)continue;const{name:O}=k;if(O==="#text"){const d=document.createTextNode(k.value);m.push(d),N.append(d);continue}let f;if(k!=null&&(b=k.attributes)!==null&&b!==void 0&&b.xmlns?f=document.createElementNS(k.attributes.xmlns,O):f=document.createElement(O),N.append(f),k.attributes&&this.setAttributes({html:f,element:k,storage:c,intent:a,linkService:u}),k.children&&k.children.length>0)y.push([k,-1,f]);else if(k.value){const d=document.createTextNode(k.value);n.XfaText.shouldBuildText(O)&&m.push(d),f.append(d)}}for(const v of g.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))v.setAttribute("readOnly",!0);return{textDivs:m}}static update(o){const c=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=c,o.div.hidden=!1}}e.XfaLayer=s},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var n=t(142),s=t(1),i=t(3);let o=class{constructor(){(0,s.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=o;{let b=function(f){let d=[];const p=[];for(const _ of f){if(_.fn==="save"){d.push({fnId:92,fn:"group",items:[]}),p.push(d),d=d.at(-1).items;continue}_.fn==="restore"?d=p.pop():d.push(_)}return d},v=function(f){if(Number.isInteger(f))return f.toString();const d=f.toFixed(10);let p=d.length-1;if(d[p]!=="0")return d;do p--;while(d[p]==="0");return d.substring(0,d[p]==="."?p:p+1)},S=function(f){if(f[4]===0&&f[5]===0){if(f[1]===0&&f[2]===0)return f[0]===1&&f[3]===1?"":`scale(${v(f[0])} ${v(f[3])})`;if(f[0]===f[3]&&f[1]===-f[2]){const d=Math.acos(f[0])*180/Math.PI;return`rotate(${v(d)})`}}else if(f[0]===1&&f[1]===0&&f[2]===0&&f[3]===1)return`translate(${v(f[4])} ${v(f[5])})`;return`matrix(${v(f[0])} ${v(f[1])} ${v(f[2])} ${v(f[3])} ${v(f[4])} ${v(f[5])})`};const c={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},u="http://www.w3.org/XML/1998/namespace",l="http://www.w3.org/1999/xlink",a=["butt","round","square"],h=["miter","round","bevel"],y=function(f){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!p)return URL.createObjectURL(new Blob([f],{type:d}));const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let w=`data:${d};base64,`;for(let M=0,E=f.length;M<E;M+=3){const F=f[M]&255,G=f[M+1]&255,H=f[M+2]&255,K=F>>2,Z=(F&3)<<4|G>>4,ae=M+1<E?(G&15)<<2|H>>6:64,oe=M+2<E?H&63:64;w+=_[K]+_[Z]+_[ae]+_[oe]}return w},g=function(){const f=new Uint8Array([137,80,78,71,13,10,26,10]),d=12,p=new Int32Array(256);for(let H=0;H<256;H++){let K=H;for(let Z=0;Z<8;Z++)K&1?K=3988292384^K>>1&2147483647:K=K>>1&2147483647;p[H]=K}function _(H,K,Z){let ae=-1;for(let oe=K;oe<Z;oe++){const ie=(ae^H[oe])&255,ne=p[ie];ae=ae>>>8^ne}return ae^-1}function w(H,K,Z,ae){let oe=ae;const ie=K.length;Z[oe]=ie>>24&255,Z[oe+1]=ie>>16&255,Z[oe+2]=ie>>8&255,Z[oe+3]=ie&255,oe+=4,Z[oe]=H.charCodeAt(0)&255,Z[oe+1]=H.charCodeAt(1)&255,Z[oe+2]=H.charCodeAt(2)&255,Z[oe+3]=H.charCodeAt(3)&255,oe+=4,Z.set(K,oe),oe+=K.length;const ne=_(Z,ae+4,oe);Z[oe]=ne>>24&255,Z[oe+1]=ne>>16&255,Z[oe+2]=ne>>8&255,Z[oe+3]=ne&255}function M(H,K,Z){let ae=1,oe=0;for(let ie=K;ie<Z;++ie)ae=(ae+(H[ie]&255))%65521,oe=(oe+ae)%65521;return oe<<16|ae}function E(H){if(!i.isNodeJS)return F(H);try{let K;parseInt(process.versions.node)>=8?K=H:K=Buffer.from(H);const Z=require$$6.deflateSync(K,{level:9});return Z instanceof Uint8Array?Z:new Uint8Array(Z)}catch(K){(0,s.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+K)}return F(H)}function F(H){let K=H.length;const Z=65535,ae=Math.ceil(K/Z),oe=new Uint8Array(2+K+ae*5+4);let ie=0;oe[ie++]=120,oe[ie++]=156;let ne=0;for(;K>Z;)oe[ie++]=0,oe[ie++]=255,oe[ie++]=255,oe[ie++]=0,oe[ie++]=0,oe.set(H.subarray(ne,ne+Z),ie),ie+=Z,ne+=Z,K-=Z;oe[ie++]=1,oe[ie++]=K&255,oe[ie++]=K>>8&255,oe[ie++]=~K&65535&255,oe[ie++]=(~K&65535)>>8&255,oe.set(H.subarray(ne),ie),ie+=H.length-ne;const J=M(H,0,H.length);return oe[ie++]=J>>24&255,oe[ie++]=J>>16&255,oe[ie++]=J>>8&255,oe[ie++]=J&255,oe}function G(H,K,Z,ae){const oe=H.width,ie=H.height;let ne,J,ge;const _e=H.data;switch(K){case s.ImageKind.GRAYSCALE_1BPP:J=0,ne=1,ge=oe+7>>3;break;case s.ImageKind.RGB_24BPP:J=2,ne=8,ge=oe*3;break;case s.ImageKind.RGBA_32BPP:J=6,ne=8,ge=oe*4;break;default:throw new Error("invalid format")}const X=new Uint8Array((1+ge)*ie);let P=0,R=0;for(let j=0;j<ie;++j)X[P++]=0,X.set(_e.subarray(R,R+ge),P),R+=ge,P+=ge;if(K===s.ImageKind.GRAYSCALE_1BPP&&ae){P=0;for(let j=0;j<ie;j++){P++;for(let q=0;q<ge;q++)X[P++]^=255}}const W=new Uint8Array([oe>>24&255,oe>>16&255,oe>>8&255,oe&255,ie>>24&255,ie>>16&255,ie>>8&255,ie&255,ne,J,0,0,0]),$=E(X),V=f.length+d*3+W.length+$.length,ee=new Uint8Array(V);let z=0;return ee.set(f,z),z+=f.length,w("IHDR",W,ee,z),z+=d+W.length,w("IDATA",$,ee,z),z+=d+$.length,w("IEND",new Uint8Array(0),ee,z),y(ee,"image/png",Z)}return function(K,Z,ae){const oe=K.kind===void 0?s.ImageKind.GRAYSCALE_1BPP:K.kind;return G(K,oe,Z,ae)}}();class m{constructor(){this.fontSizeScale=1,this.fontWeight=c.fontWeight,this.fontSize=0,this.textMatrix=s.IDENTITY_MATRIX,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=s.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=c.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(d,p){this.x=d,this.y=p}}let N=0,k=0,O=0;e.SVGGraphics=o=class{constructor(f,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new m,this.transformMatrix=s.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=f,this.objs=d,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!p,this._operatorIdMapping=[];for(const _ in s.OPS)this._operatorIdMapping[s.OPS[_]]=_}getObject(f){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof f=="string"?f.startsWith("g_")?this.commonObjs.get(f):this.objs.get(f):d}save(){this.transformStack.push(this.transformMatrix);const f=this.current;this.extraStack.push(f),this.current=f.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(f){this.save(),this.executeOpTree(f),this.restore()}loadDependencies(f){const d=f.fnArray,p=f.argsArray;for(let _=0,w=d.length;_<w;_++)if(d[_]===s.OPS.dependency)for(const M of p[_]){const E=M.startsWith("g_")?this.commonObjs:this.objs,F=new Promise(G=>{E.get(M,G)});this.current.dependencies.push(F)}return Promise.all(this.current.dependencies)}transform(f,d,p,_,w,M){const E=[f,d,p,_,w,M];this.transformMatrix=s.Util.transform(this.transformMatrix,E),this.tgrp=null}getSVG(f,d){this.viewport=d;const p=this._initialize(d);return this.loadDependencies(f).then(()=>(this.transformMatrix=s.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(f)),p))}convertOpList(f){const d=this._operatorIdMapping,p=f.argsArray,_=f.fnArray,w=[];for(let M=0,E=_.length;M<E;M++){const F=_[M];w.push({fnId:F,fn:d[F],args:p[M]})}return b(w)}executeOpTree(f){for(const d of f){const p=d.fn,_=d.fnId,w=d.args;switch(_|0){case s.OPS.beginText:this.beginText();break;case s.OPS.dependency:break;case s.OPS.setLeading:this.setLeading(w);break;case s.OPS.setLeadingMoveText:this.setLeadingMoveText(w[0],w[1]);break;case s.OPS.setFont:this.setFont(w);break;case s.OPS.showText:this.showText(w[0]);break;case s.OPS.showSpacedText:this.showText(w[0]);break;case s.OPS.endText:this.endText();break;case s.OPS.moveText:this.moveText(w[0],w[1]);break;case s.OPS.setCharSpacing:this.setCharSpacing(w[0]);break;case s.OPS.setWordSpacing:this.setWordSpacing(w[0]);break;case s.OPS.setHScale:this.setHScale(w[0]);break;case s.OPS.setTextMatrix:this.setTextMatrix(w[0],w[1],w[2],w[3],w[4],w[5]);break;case s.OPS.setTextRise:this.setTextRise(w[0]);break;case s.OPS.setTextRenderingMode:this.setTextRenderingMode(w[0]);break;case s.OPS.setLineWidth:this.setLineWidth(w[0]);break;case s.OPS.setLineJoin:this.setLineJoin(w[0]);break;case s.OPS.setLineCap:this.setLineCap(w[0]);break;case s.OPS.setMiterLimit:this.setMiterLimit(w[0]);break;case s.OPS.setFillRGBColor:this.setFillRGBColor(w[0],w[1],w[2]);break;case s.OPS.setStrokeRGBColor:this.setStrokeRGBColor(w[0],w[1],w[2]);break;case s.OPS.setStrokeColorN:this.setStrokeColorN(w);break;case s.OPS.setFillColorN:this.setFillColorN(w);break;case s.OPS.shadingFill:this.shadingFill(w[0]);break;case s.OPS.setDash:this.setDash(w[0],w[1]);break;case s.OPS.setRenderingIntent:this.setRenderingIntent(w[0]);break;case s.OPS.setFlatness:this.setFlatness(w[0]);break;case s.OPS.setGState:this.setGState(w[0]);break;case s.OPS.fill:this.fill();break;case s.OPS.eoFill:this.eoFill();break;case s.OPS.stroke:this.stroke();break;case s.OPS.fillStroke:this.fillStroke();break;case s.OPS.eoFillStroke:this.eoFillStroke();break;case s.OPS.clip:this.clip("nonzero");break;case s.OPS.eoClip:this.clip("evenodd");break;case s.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case s.OPS.paintImageXObject:this.paintImageXObject(w[0]);break;case s.OPS.paintInlineImageXObject:this.paintInlineImageXObject(w[0]);break;case s.OPS.paintImageMaskXObject:this.paintImageMaskXObject(w[0]);break;case s.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(w[0],w[1]);break;case s.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case s.OPS.closePath:this.closePath();break;case s.OPS.closeStroke:this.closeStroke();break;case s.OPS.closeFillStroke:this.closeFillStroke();break;case s.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case s.OPS.nextLine:this.nextLine();break;case s.OPS.transform:this.transform(w[0],w[1],w[2],w[3],w[4],w[5]);break;case s.OPS.constructPath:this.constructPath(w[0],w[1]);break;case s.OPS.endPath:this.endPath();break;case 92:this.group(d.items);break;default:(0,s.warn)(`Unimplemented operator ${p}`);break}}}setWordSpacing(f){this.current.wordSpacing=f}setCharSpacing(f){this.current.charSpacing=f}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(f,d,p,_,w,M){const E=this.current;E.textMatrix=E.lineMatrix=[f,d,p,_,w,M],E.textMatrixScale=Math.hypot(f,d),E.x=E.lineX=0,E.y=E.lineY=0,E.xcoords=[],E.ycoords=[],E.tspan=this.svgFactory.createElement("svg:tspan"),E.tspan.setAttributeNS(null,"font-family",E.fontFamily),E.tspan.setAttributeNS(null,"font-size",`${v(E.fontSize)}px`),E.tspan.setAttributeNS(null,"y",v(-E.y)),E.txtElement=this.svgFactory.createElement("svg:text"),E.txtElement.append(E.tspan)}beginText(){const f=this.current;f.x=f.lineX=0,f.y=f.lineY=0,f.textMatrix=s.IDENTITY_MATRIX,f.lineMatrix=s.IDENTITY_MATRIX,f.textMatrixScale=1,f.tspan=this.svgFactory.createElement("svg:tspan"),f.txtElement=this.svgFactory.createElement("svg:text"),f.txtgrp=this.svgFactory.createElement("svg:g"),f.xcoords=[],f.ycoords=[]}moveText(f,d){const p=this.current;p.x=p.lineX+=f,p.y=p.lineY+=d,p.xcoords=[],p.ycoords=[],p.tspan=this.svgFactory.createElement("svg:tspan"),p.tspan.setAttributeNS(null,"font-family",p.fontFamily),p.tspan.setAttributeNS(null,"font-size",`${v(p.fontSize)}px`),p.tspan.setAttributeNS(null,"y",v(-p.y))}showText(f){const d=this.current,p=d.font,_=d.fontSize;if(_===0)return;const w=d.fontSizeScale,M=d.charSpacing,E=d.wordSpacing,F=d.fontDirection,G=d.textHScale*F,H=p.vertical,K=H?1:-1,Z=p.defaultVMetrics,ae=_*d.fontMatrix[0];let oe=0;for(const J of f){if(J===null){oe+=F*E;continue}else if(typeof J=="number"){oe+=K*J*_/1e3;continue}const ge=(J.isSpace?E:0)+M,_e=J.fontChar;let X,P,R=J.width;if(H){let $;const V=J.vmetric||Z;$=J.vmetric?V[1]:R*.5,$=-$*ae;const ee=V[2]*ae;R=V?-V[0]:R,X=$/w,P=(oe+ee)/w}else X=oe/w,P=0;(J.isInFont||p.missingFile)&&(d.xcoords.push(d.x+X),H&&d.ycoords.push(-d.y+P),d.tspan.textContent+=_e);let W;H?W=R*ae-ge*F:W=R*ae+ge*F,oe+=W}d.tspan.setAttributeNS(null,"x",d.xcoords.map(v).join(" ")),H?d.tspan.setAttributeNS(null,"y",d.ycoords.map(v).join(" ")):d.tspan.setAttributeNS(null,"y",v(-d.y)),H?d.y-=oe:d.x+=oe*G,d.tspan.setAttributeNS(null,"font-family",d.fontFamily),d.tspan.setAttributeNS(null,"font-size",`${v(d.fontSize)}px`),d.fontStyle!==c.fontStyle&&d.tspan.setAttributeNS(null,"font-style",d.fontStyle),d.fontWeight!==c.fontWeight&&d.tspan.setAttributeNS(null,"font-weight",d.fontWeight);const ie=d.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;if(ie===s.TextRenderingMode.FILL||ie===s.TextRenderingMode.FILL_STROKE?(d.fillColor!==c.fillColor&&d.tspan.setAttributeNS(null,"fill",d.fillColor),d.fillAlpha<1&&d.tspan.setAttributeNS(null,"fill-opacity",d.fillAlpha)):d.textRenderingMode===s.TextRenderingMode.ADD_TO_PATH?d.tspan.setAttributeNS(null,"fill","transparent"):d.tspan.setAttributeNS(null,"fill","none"),ie===s.TextRenderingMode.STROKE||ie===s.TextRenderingMode.FILL_STROKE){const J=1/(d.textMatrixScale||1);this._setStrokeAttributes(d.tspan,J)}let ne=d.textMatrix;d.textRise!==0&&(ne=ne.slice(),ne[5]+=d.textRise),d.txtElement.setAttributeNS(null,"transform",`${S(ne)} scale(${v(G)}, -1)`),d.txtElement.setAttributeNS(u,"xml:space","preserve"),d.txtElement.append(d.tspan),d.txtgrp.append(d.txtElement),this._ensureTransformGroup().append(d.txtElement)}setLeadingMoveText(f,d){this.setLeading(-d),this.moveText(f,d)}addFontStyle(f){if(!f.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const d=y(f.data,f.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${f.loadedName}"; src: url(${d}); }
`}setFont(f){const d=this.current,p=this.commonObjs.get(f[0]);let _=f[1];d.font=p,this.embedFonts&&!p.missingFile&&!this.embeddedFonts[p.loadedName]&&(this.addFontStyle(p),this.embeddedFonts[p.loadedName]=p),d.fontMatrix=p.fontMatrix||s.FONT_IDENTITY_MATRIX;let w="normal";p.black?w="900":p.bold&&(w="bold");const M=p.italic?"italic":"normal";_<0?(_=-_,d.fontDirection=-1):d.fontDirection=1,d.fontSize=_,d.fontFamily=p.loadedName,d.fontWeight=w,d.fontStyle=M,d.tspan=this.svgFactory.createElement("svg:tspan"),d.tspan.setAttributeNS(null,"y",v(-d.y)),d.xcoords=[],d.ycoords=[]}endText(){var f;const d=this.current;d.textRenderingMode&s.TextRenderingMode.ADD_TO_PATH_FLAG&&(f=d.txtElement)!==null&&f!==void 0&&f.hasChildNodes()&&(d.element=d.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(f){f>0&&(this.current.lineWidth=f)}setLineCap(f){this.current.lineCap=a[f]}setLineJoin(f){this.current.lineJoin=h[f]}setMiterLimit(f){this.current.miterLimit=f}setStrokeAlpha(f){this.current.strokeAlpha=f}setStrokeRGBColor(f,d,p){this.current.strokeColor=s.Util.makeHexColor(f,d,p)}setFillAlpha(f){this.current.fillAlpha=f}setFillRGBColor(f,d,p){this.current.fillColor=s.Util.makeHexColor(f,d,p),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(f){this.current.strokeColor=this._makeColorN_Pattern(f)}setFillColorN(f){this.current.fillColor=this._makeColorN_Pattern(f)}shadingFill(f){const d=this.viewport.width,p=this.viewport.height,_=s.Util.inverseTransform(this.transformMatrix),w=s.Util.applyTransform([0,0],_),M=s.Util.applyTransform([0,p],_),E=s.Util.applyTransform([d,0],_),F=s.Util.applyTransform([d,p],_),G=Math.min(w[0],M[0],E[0],F[0]),H=Math.min(w[1],M[1],E[1],F[1]),K=Math.max(w[0],M[0],E[0],F[0]),Z=Math.max(w[1],M[1],E[1],F[1]),ae=this.svgFactory.createElement("svg:rect");ae.setAttributeNS(null,"x",G),ae.setAttributeNS(null,"y",H),ae.setAttributeNS(null,"width",K-G),ae.setAttributeNS(null,"height",Z-H),ae.setAttributeNS(null,"fill",this._makeShadingPattern(f)),this.current.fillAlpha<1&&ae.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(ae)}_makeColorN_Pattern(f){return f[0]==="TilingPattern"?this._makeTilingPattern(f):this._makeShadingPattern(f)}_makeTilingPattern(f){const d=f[1],p=f[2],_=f[3]||s.IDENTITY_MATRIX,[w,M,E,F]=f[4],G=f[5],H=f[6],K=f[7],Z=`shading${O++}`,[ae,oe,ie,ne]=s.Util.normalizeRect([...s.Util.applyTransform([w,M],_),...s.Util.applyTransform([E,F],_)]),[J,ge]=s.Util.singularValueDecompose2dScale(_),_e=G*J,X=H*ge,P=this.svgFactory.createElement("svg:pattern");P.setAttributeNS(null,"id",Z),P.setAttributeNS(null,"patternUnits","userSpaceOnUse"),P.setAttributeNS(null,"width",_e),P.setAttributeNS(null,"height",X),P.setAttributeNS(null,"x",`${ae}`),P.setAttributeNS(null,"y",`${oe}`);const R=this.svg,W=this.transformMatrix,$=this.current.fillColor,V=this.current.strokeColor,ee=this.svgFactory.create(ie-ae,ne-oe);if(this.svg=ee,this.transformMatrix=_,K===2){const z=s.Util.makeHexColor(...d);this.current.fillColor=z,this.current.strokeColor=z}return this.executeOpTree(this.convertOpList(p)),this.svg=R,this.transformMatrix=W,this.current.fillColor=$,this.current.strokeColor=V,P.append(ee.childNodes[0]),this.defs.append(P),`url(#${Z})`}_makeShadingPattern(f){switch(typeof f=="string"&&(f=this.objs.get(f)),f[0]){case"RadialAxial":const d=`shading${O++}`,p=f[3];let _;switch(f[1]){case"axial":const w=f[4],M=f[5];_=this.svgFactory.createElement("svg:linearGradient"),_.setAttributeNS(null,"id",d),_.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),_.setAttributeNS(null,"x1",w[0]),_.setAttributeNS(null,"y1",w[1]),_.setAttributeNS(null,"x2",M[0]),_.setAttributeNS(null,"y2",M[1]);break;case"radial":const E=f[4],F=f[5],G=f[6],H=f[7];_=this.svgFactory.createElement("svg:radialGradient"),_.setAttributeNS(null,"id",d),_.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),_.setAttributeNS(null,"cx",F[0]),_.setAttributeNS(null,"cy",F[1]),_.setAttributeNS(null,"r",H),_.setAttributeNS(null,"fx",E[0]),_.setAttributeNS(null,"fy",E[1]),_.setAttributeNS(null,"fr",G);break;default:throw new Error(`Unknown RadialAxial type: ${f[1]}`)}for(const w of p){const M=this.svgFactory.createElement("svg:stop");M.setAttributeNS(null,"offset",w[0]),M.setAttributeNS(null,"stop-color",w[1]),_.append(M)}return this.defs.append(_),`url(#${d})`;case"Mesh":return(0,s.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${f[0]}`)}}setDash(f,d){this.current.dashArray=f,this.current.dashPhase=d}constructPath(f,d){const p=this.current;let _=p.x,w=p.y,M=[],E=0;for(const F of f)switch(F|0){case s.OPS.rectangle:_=d[E++],w=d[E++];const G=d[E++],H=d[E++],K=_+G,Z=w+H;M.push("M",v(_),v(w),"L",v(K),v(w),"L",v(K),v(Z),"L",v(_),v(Z),"Z");break;case s.OPS.moveTo:_=d[E++],w=d[E++],M.push("M",v(_),v(w));break;case s.OPS.lineTo:_=d[E++],w=d[E++],M.push("L",v(_),v(w));break;case s.OPS.curveTo:_=d[E+4],w=d[E+5],M.push("C",v(d[E]),v(d[E+1]),v(d[E+2]),v(d[E+3]),v(_),v(w)),E+=6;break;case s.OPS.curveTo2:M.push("C",v(_),v(w),v(d[E]),v(d[E+1]),v(d[E+2]),v(d[E+3])),_=d[E+2],w=d[E+3],E+=4;break;case s.OPS.curveTo3:_=d[E+2],w=d[E+3],M.push("C",v(d[E]),v(d[E+1]),v(_),v(w),v(_),v(w)),E+=4;break;case s.OPS.closePath:M.push("Z");break}M=M.join(" "),p.path&&f.length>0&&f[0]!==s.OPS.rectangle&&f[0]!==s.OPS.moveTo?M=p.path.getAttributeNS(null,"d")+M:(p.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(p.path)),p.path.setAttributeNS(null,"d",M),p.path.setAttributeNS(null,"fill","none"),p.element=p.path,p.setCurrentPoint(_,w)}endPath(){const f=this.current;if(f.path=null,!this.pendingClip)return;if(!f.element){this.pendingClip=null;return}const d=`clippath${N++}`,p=this.svgFactory.createElement("svg:clipPath");p.setAttributeNS(null,"id",d),p.setAttributeNS(null,"transform",S(this.transformMatrix));const _=f.element.cloneNode(!0);if(this.pendingClip==="evenodd"?_.setAttributeNS(null,"clip-rule","evenodd"):_.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,p.append(_),this.defs.append(p),f.activeClipUrl){f.clipGroup=null;for(const w of this.extraStack)w.clipGroup=null;p.setAttributeNS(null,"clip-path",f.activeClipUrl)}f.activeClipUrl=`url(#${d})`,this.tgrp=null}clip(f){this.pendingClip=f}closePath(){const f=this.current;if(f.path){const d=`${f.path.getAttributeNS(null,"d")}Z`;f.path.setAttributeNS(null,"d",d)}}setLeading(f){this.current.leading=-f}setTextRise(f){this.current.textRise=f}setTextRenderingMode(f){this.current.textRenderingMode=f}setHScale(f){this.current.textHScale=f/100}setRenderingIntent(f){}setFlatness(f){}setGState(f){for(const[d,p]of f)switch(d){case"LW":this.setLineWidth(p);break;case"LC":this.setLineCap(p);break;case"LJ":this.setLineJoin(p);break;case"ML":this.setMiterLimit(p);break;case"D":this.setDash(p[0],p[1]);break;case"RI":this.setRenderingIntent(p);break;case"FL":this.setFlatness(p);break;case"Font":this.setFont(p);break;case"CA":this.setStrokeAlpha(p);break;case"ca":this.setFillAlpha(p);break;default:(0,s.warn)(`Unimplemented graphic state operator ${d}`);break}}fill(){const f=this.current;f.element&&(f.element.setAttributeNS(null,"fill",f.fillColor),f.element.setAttributeNS(null,"fill-opacity",f.fillAlpha),this.endPath())}stroke(){const f=this.current;f.element&&(this._setStrokeAttributes(f.element),f.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(f){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=this.current;let _=p.dashArray;d!==1&&_.length>0&&(_=_.map(function(w){return d*w})),f.setAttributeNS(null,"stroke",p.strokeColor),f.setAttributeNS(null,"stroke-opacity",p.strokeAlpha),f.setAttributeNS(null,"stroke-miterlimit",v(p.miterLimit)),f.setAttributeNS(null,"stroke-linecap",p.lineCap),f.setAttributeNS(null,"stroke-linejoin",p.lineJoin),f.setAttributeNS(null,"stroke-width",v(d*p.lineWidth)+"px"),f.setAttributeNS(null,"stroke-dasharray",_.map(v).join(" ")),f.setAttributeNS(null,"stroke-dashoffset",v(d*p.dashPhase)+"px")}eoFill(){var f;(f=this.current.element)===null||f===void 0||f.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var f;(f=this.current.element)===null||f===void 0||f.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const f=this.svgFactory.createElement("svg:rect");f.setAttributeNS(null,"x","0"),f.setAttributeNS(null,"y","0"),f.setAttributeNS(null,"width","1px"),f.setAttributeNS(null,"height","1px"),f.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(f)}paintImageXObject(f){const d=this.getObject(f);if(!d){(0,s.warn)(`Dependent image with object ID ${f} is not ready yet`);return}this.paintInlineImageXObject(d)}paintInlineImageXObject(f,d){const p=f.width,_=f.height,w=g(f,this.forceDataSchema,!!d),M=this.svgFactory.createElement("svg:rect");M.setAttributeNS(null,"x","0"),M.setAttributeNS(null,"y","0"),M.setAttributeNS(null,"width",v(p)),M.setAttributeNS(null,"height",v(_)),this.current.element=M,this.clip("nonzero");const E=this.svgFactory.createElement("svg:image");E.setAttributeNS(l,"xlink:href",w),E.setAttributeNS(null,"x","0"),E.setAttributeNS(null,"y",v(-_)),E.setAttributeNS(null,"width",v(p)+"px"),E.setAttributeNS(null,"height",v(_)+"px"),E.setAttributeNS(null,"transform",`scale(${v(1/p)} ${v(-1/_)})`),d?d.append(E):this._ensureTransformGroup().append(E)}paintImageMaskXObject(f){const d=this.getObject(f.data,f);if(d.bitmap){(0,s.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const p=this.current,_=d.width,w=d.height,M=p.fillColor;p.maskId=`mask${k++}`;const E=this.svgFactory.createElement("svg:mask");E.setAttributeNS(null,"id",p.maskId);const F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",v(_)),F.setAttributeNS(null,"height",v(w)),F.setAttributeNS(null,"fill",M),F.setAttributeNS(null,"mask",`url(#${p.maskId})`),this.defs.append(E),this._ensureTransformGroup().append(F),this.paintInlineImageXObject(d,E)}paintFormXObjectBegin(f,d){if(Array.isArray(f)&&f.length===6&&this.transform(f[0],f[1],f[2],f[3],f[4],f[5]),d){const p=d[2]-d[0],_=d[3]-d[1],w=this.svgFactory.createElement("svg:rect");w.setAttributeNS(null,"x",d[0]),w.setAttributeNS(null,"y",d[1]),w.setAttributeNS(null,"width",v(p)),w.setAttributeNS(null,"height",v(_)),this.current.element=w,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(f){const d=this.svgFactory.create(f.width,f.height),p=this.svgFactory.createElement("svg:defs");d.append(p),this.defs=p;const _=this.svgFactory.createElement("svg:g");return _.setAttributeNS(null,"transform",S(f.transform)),d.append(_),this.svg=_,d}_ensureClipGroup(){if(!this.current.clipGroup){const f=this.svgFactory.createElement("svg:g");f.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(f),this.current.clipGroup=f}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",S(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}}],__webpack_module_cache__={};function __w_pdfjs_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r].call(t.exports,t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var r=__webpack_exports__;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(r,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(r,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(r,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(r,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(r,"AnnotationLayer",{enumerable:!0,get:function(){return c.AnnotationLayer}}),Object.defineProperty(r,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(r,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(r,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(r,"GlobalWorkerOptions",{enumerable:!0,get:function(){return u.GlobalWorkerOptions}}),Object.defineProperty(r,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(r,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(r,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(r,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(r,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(r,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(r,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(r,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(r,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(r,"PromiseCapability",{enumerable:!0,get:function(){return e.PromiseCapability}}),Object.defineProperty(r,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(r,"SVGGraphics",{enumerable:!0,get:function(){return l.SVGGraphics}}),Object.defineProperty(r,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(r,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(r,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(r,"XfaLayer",{enumerable:!0,get:function(){return a.XfaLayer}}),Object.defineProperty(r,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(r,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(r,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(r,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(r,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(r,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(r,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(r,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(r,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(r,"normalizeUnicode",{enumerable:!0,get:function(){return e.normalizeUnicode}}),Object.defineProperty(r,"renderTextLayer",{enumerable:!0,get:function(){return s.renderTextLayer}}),Object.defineProperty(r,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(r,"updateTextLayer",{enumerable:!0,get:function(){return s.updateTextLayer}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(138),n=__w_pdfjs_require__(142),s=__w_pdfjs_require__(161),i=__w_pdfjs_require__(162),o=__w_pdfjs_require__(141),c=__w_pdfjs_require__(165),u=__w_pdfjs_require__(149),l=__w_pdfjs_require__(168),a=__w_pdfjs_require__(167)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const pdfjsWorkerURL="/acchymns-pr-PR_kwDOHpETuc5W7BSL/assets/pdf.worker.min-5181731e.js",_sfc_main$2=defineComponent({__name:"PDFWrapper",props:{src:{}},emits:["error"],setup(r,{emit:e}){const t=r;pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorkerURL;let n=ref();return onMounted(async()=>{var i;let s;try{s=await pdfExports.getDocument(t.src).promise}catch{e("error");return}for(let o=1;o<=s.numPages;o++){let c=document.createElement("canvas"),u=await s.getPage(o);const l=Capacitor.getPlatform()=="web"?5:window.devicePixelRatio;let a=u.getViewport({scale:l});c.height=a.height,c.width=a.width;let h=c.getContext("2d");if(h===null){e("error");return}try{await u.render({canvasContext:h,viewport:a}).promise,c.style.width="100%";const y=c.toDataURL("image/png"),g=document.createElement("img");g.classList.add("song-img"),g.src=y,(i=n.value)==null||i.appendChild(g)}catch{e("error");return}}}),(s,i)=>(openBlock(),createElementBlock("div",{ref_key:"root",ref:n,class:"container"},null,512))}}),PDFWrapper_vue_vue_type_style_index_0_lang="",PDFWrapper_vue_vue_type_style_index_1_lang="",_withScopeId=r=>(pushScopeId("data-v-1226a89e"),r=r(),popScopeId(),r),_hoisted_1$1={key:0,class:"fallback-container"},_hoisted_2$1=_withScopeId(()=>createBaseVNode("img",{src:_imports_0,class:"wifi-fallback"},null,-1)),_hoisted_3$1=[_hoisted_2$1],_hoisted_4$1=["src"],_sfc_main$1=defineComponent({__name:"SongContainer",props:{book:{},number:{}},setup(r){const e=r;let t=ref(""),n=ref();function s(N,k,O){const f=k+"."+O[N].fileExtension;return`${O[N].srcUrl}/songs/${f}`}let i=ref(""),o=ref(!1);const c=useMediaQuery("(prefers-color-scheme: dark)"),u=useLocalStorage("ACCOptions.overrideSystemTheme",!1),l=useLocalStorage("ACCOptions.overrideDarkMode",!1);let a=useLocalStorage("ACCOptions.songInverted",!1);const h=computed(()=>u.value?l.value:c.value),y=computed(()=>h.value&&a.value);let g=readonly(useLocalStorage("ACCOptions.panzoomEnable",!0)),m;var b=Capacitor.getPlatform()!=="web";onMounted(async()=>{const N=await getAllBookMetaData();if(console.log(N[e.book]),N[e.book]==null){o.value=!0;return}const k=s(e.book,e.number,N);t.value=N[e.book].fileExtension,i.value=k,g.value&&(m=createPanZoom$1(n.value,{beforeWheel:O=>O.shiftKey,maxZoom:3,minZoom:b?1:.25,bounds:!0,boundsPadding:b?1:.5})),b&&setInterval(()=>{S.refresh()},10)});class v{constructor(k){Ke(this,"_observer");Ke(this,"_observedNodes");this._observer=k,this._observedNodes=new Set}observe(k){this._observedNodes.add(k),this._observer.observe(k)}unobserve(k){this._observedNodes.delete(k),this._observer.unobserve(k)}disconnect(){this._observedNodes.clear(),this._observer.disconnect()}refresh(){for(let k of this._observedNodes)this._observer.unobserve(k),this._observer.observe(k)}}const S=new v(new IntersectionObserver((N,k)=>{for(const O of N){let f=O.boundingClientRect;O.intersectionRect.height<f.height?m.setVerticalPan(!0):m.setVerticalPan(!1)}},{root:null,rootMargin:"0px",threshold:1}));return onUpdated(async()=>{b&&S.observe(n.value)}),(N,k)=>unref(o)?(openBlock(),createElementBlock("div",_hoisted_1$1,_hoisted_3$1)):(openBlock(),createElementBlock("div",{key:1,ref_key:"panzoom_container",ref:n,class:"panzoom-container"},[unref(t)=="pdf"?(openBlock(),createBlock(_sfc_main$2,{key:0,onError:k[0]||(k[0]=O=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":y.value}])},null,8,["src","class"])):unref(t)!==""?(openBlock(),createElementBlock("img",{key:1,onError:k[1]||(k[1]=O=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":y.value}])},null,42,_hoisted_4$1)):createCommentVNode("",!0)],512))}}),SongContainer_vue_vue_type_style_index_0_scoped_1226a89e_lang="",SongContainer=_export_sfc(_sfc_main$1,[["__scopeId","data-v-1226a89e"]]),version="14.7.77",createExtendedExponentialRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:r}),createExtendedLinearRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:r}),createSetValueAutomationEvent=(r,e)=>({startTime:e,type:"setValue",value:r}),createSetValueCurveAutomationEvent=(r,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:r}),getTargetValueAtTime=(r,e,{startTime:t,target:n,timeConstant:s})=>n+(e-n)*Math.exp((t-r)/s),isExponentialRampToValueAutomationEvent=r=>r.type==="exponentialRampToValue",isLinearRampToValueAutomationEvent=r=>r.type==="linearRampToValue",isAnyRampToValueAutomationEvent=r=>isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r),isSetValueAutomationEvent=r=>r.type==="setValue",isSetValueCurveAutomationEvent=r=>r.type==="setValueCurve",getValueOfAutomationEventAtIndexAtTime=(r,e,t,n)=>{const s=r[e];return s===void 0?n:isAnyRampToValueAutomationEvent(s)||isSetValueAutomationEvent(s)?s.value:isSetValueCurveAutomationEvent(s)?s.values[s.values.length-1]:getTargetValueAtTime(t,getValueOfAutomationEventAtIndexAtTime(r,e-1,s.startTime,n),s)},getEndTimeAndValueOfPreviousAutomationEvent=(r,e,t,n,s)=>t===void 0?[n.insertTime,s]:isAnyRampToValueAutomationEvent(t)?[t.endTime,t.value]:isSetValueAutomationEvent(t)?[t.startTime,t.value]:isSetValueCurveAutomationEvent(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,getValueOfAutomationEventAtIndexAtTime(r,e-1,t.startTime,s)],isCancelAndHoldAutomationEvent=r=>r.type==="cancelAndHold",isCancelScheduledValuesAutomationEvent=r=>r.type==="cancelScheduledValues",getEventTime=r=>isCancelAndHoldAutomationEvent(r)||isCancelScheduledValuesAutomationEvent(r)?r.cancelTime:isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r)?r.endTime:r.startTime,getExponentialRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t===s?s:0<t&&0<s||t<0&&s<0?t*(s/t)**((r-e)/(n-e)):0,getLinearRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t+(r-e)/(n-e)*(s-t),interpolateValue=(r,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?r[t]:(1-(e-t))*r[t]+(1-(n-e))*r[n]},getValueCurveValueAtTime=(r,{duration:e,startTime:t,values:n})=>{const s=(r-t)/e*(n.length-1);return interpolateValue(n,s)},isSetTargetAutomationEvent=r=>r.type==="setTarget";class AutomationEventList{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=getEventTime(e);if(isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)){const n=this._automationEvents.findIndex(i=>isCancelScheduledValuesAutomationEvent(e)&&isSetValueCurveAutomationEvent(i)?i.startTime+i.duration>=t:getEventTime(i)>=t),s=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),isCancelAndHoldAutomationEvent(e)){const i=this._automationEvents[this._automationEvents.length-1];if(s!==void 0&&isAnyRampToValueAutomationEvent(s)){if(i!==void 0&&isSetTargetAutomationEvent(i))throw new Error("The internal list is malformed.");const o=i===void 0?s.insertTime:isSetValueCurveAutomationEvent(i)?i.startTime+i.duration:getEventTime(i),c=i===void 0?this._defaultValue:isSetValueCurveAutomationEvent(i)?i.values[i.values.length-1]:i.value,u=isExponentialRampToValueAutomationEvent(s)?getExponentialRampValueAtTime(t,o,c,s):getLinearRampValueAtTime(t,o,c,s),l=isExponentialRampToValueAutomationEvent(s)?createExtendedExponentialRampToValueAutomationEvent(u,t,this._currenTime):createExtendedLinearRampToValueAutomationEvent(u,t,this._currenTime);this._automationEvents.push(l)}if(i!==void 0&&isSetTargetAutomationEvent(i)&&this._automationEvents.push(createSetValueAutomationEvent(this.getValue(t),t)),i!==void 0&&isSetValueCurveAutomationEvent(i)&&i.startTime+i.duration>t){const o=t-i.startTime,c=(i.values.length-1)/i.duration,u=Math.max(2,1+Math.ceil(o*c)),l=o/(u-1)*c,a=i.values.slice(0,u);if(l<1)for(let h=1;h<u;h+=1){const y=l*h%1;a[h]=i.values[h-1]*(1-y)+i.values[h]*y}this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent(a,i.startTime,o)}}}else{const n=this._automationEvents.findIndex(o=>getEventTime(o)>t),s=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(s!==void 0&&isSetValueCurveAutomationEvent(s)&&getEventTime(s)+s.duration>t)return!1;const i=isExponentialRampToValueAutomationEvent(e)?createExtendedExponentialRampToValueAutomationEvent(e.value,e.endTime,this._currenTime):isLinearRampToValueAutomationEvent(e)?createExtendedLinearRampToValueAutomationEvent(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(i);else{if(isSetValueCurveAutomationEvent(e)&&t+e.duration>getEventTime(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>getEventTime(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),s=n[0];isSetTargetAutomationEvent(s)&&n.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,t-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>getEventTime(o)>e),n=this._automationEvents[t],s=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[s];if(i!==void 0&&isSetTargetAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||n.insertTime>e))return getTargetValueAtTime(e,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(i!==void 0&&isSetValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(i!==void 0&&isSetValueCurveAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?getValueCurveValueAtTime(e,i):i.values[i.values.length-1];if(i!==void 0&&isAnyRampToValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(n!==void 0&&isExponentialRampToValueAutomationEvent(n)){const[o,c]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,i,n,this._defaultValue);return getExponentialRampValueAtTime(e,o,c,n)}if(n!==void 0&&isLinearRampToValueAutomationEvent(n)){const[o,c]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,i,n,this._defaultValue);return getLinearRampValueAtTime(e,o,c,n)}return this._defaultValue}}const createCancelAndHoldAutomationEvent=r=>({cancelTime:r,type:"cancelAndHold"}),createCancelScheduledValuesAutomationEvent=r=>({cancelTime:r,type:"cancelScheduledValues"}),createExponentialRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"exponentialRampToValue",value:r}),createLinearRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"linearRampToValue",value:r}),createSetTargetAutomationEvent=(r,e,t)=>({startTime:e,target:r,timeConstant:t,type:"setTarget"}),createAbortError=()=>new DOMException("","AbortError"),createAddActiveInputConnectionToAudioNode=r=>(e,t,[n,s,i],o)=>{r(e[s],[t,n,i],c=>c[0]===t&&c[1]===n,o)},createAddAudioNodeConnections=r=>(e,t,n)=>{const s=[];for(let i=0;i<n.numberOfInputs;i+=1)s.push(new Set);r.set(e,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},createAddAudioParamConnections=r=>(e,t)=>{r.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap,handler={construct(){return handler}},isConstructible=r=>{try{const e=new Proxy(r,handler);new e}catch{return!1}return!0},IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(r,e)=>{const t=[];let n=r.replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX);for(;s!==null;){const i=s[1].slice(1,-1),o=s[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(o),n=n.slice(s[0].length).replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX)}return[t.join(";"),n]},verifyParameterDescriptors=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=r=>{if(!isConstructible(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(r,e,t,n,s,i,o,c,u,l,a,h,y)=>{let g=0;return(m,b,v={credentials:"omit"})=>{const S=a.get(m);if(S!==void 0&&S.has(b))return Promise.resolve();const N=l.get(m);if(N!==void 0){const f=N.get(b);if(f!==void 0)return f}const k=i(m),O=k.audioWorklet===void 0?s(b).then(([f,d])=>{const[p,_]=splitImportStatements(f,d),w=`${p};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${_}
})})(window,'_AWGS')`;return t(w)}).then(()=>{const f=y._AWGS.pop();if(f===void 0)throw new SyntaxError;n(k.currentTime,k.sampleRate,()=>f(class{},void 0,(d,p)=>{if(d.trim()==="")throw e();const _=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(k);if(_!==void 0){if(_.has(d))throw e();verifyProcessorCtor(p),verifyParameterDescriptors(p.parameterDescriptors),_.set(d,p)}else verifyProcessorCtor(p),verifyParameterDescriptors(p.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(k,new Map([[d,p]]))},k.sampleRate,void 0,void 0))}):Promise.all([s(b),Promise.resolve(r(h,h))]).then(([[f,d],p])=>{const _=g+1;g=_;const[w,M]=splitImportStatements(f,d),H=`${w};((AudioWorkletProcessor,registerProcessor)=>{${M}
})(${p?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${p?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${p?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${_}',class extends AudioWorkletProcessor{process(){return !1}})`,K=new Blob([H],{type:"application/javascript; charset=utf-8"}),Z=URL.createObjectURL(K);return k.audioWorklet.addModule(Z,v).then(()=>{if(c(k))return k;const ae=o(k);return ae.audioWorklet.addModule(Z,v).then(()=>ae)}).then(ae=>{if(u===null)throw new SyntaxError;try{new u(ae,`__sac${_}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Z))});return N===void 0?l.set(m,new Map([[b,O]])):N.set(b,O),O.then(()=>{const f=a.get(m);f===void 0?a.set(m,new Set([b])):f.add(b)}).finally(()=>{const f=l.get(m);f!==void 0&&f.delete(b)}),O}},getValueForKey=(r,e)=>{const t=r.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},pickElementFromSet=(r,e)=>{const t=Array.from(r).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return r.delete(n),n},deletePassiveInputConnectionToAudioNode=(r,e,t,n)=>{const s=getValueForKey(r,e),i=pickElementFromSet(s,o=>o[0]===t&&o[1]===n);return s.size===0&&r.delete(e),i},getEventListenersOfAudioNode=r=>getValueForKey(EVENT_LISTENERS,r),setInternalStateToActive=r=>{if(ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(r),getEventListenersOfAudioNode(r).forEach(e=>e(!0))},isAudioWorkletNode=r=>"port"in r,setInternalStateToPassive=r=>{if(!ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(r),getEventListenersOfAudioNode(r).forEach(e=>e(!1))},setInternalStateToPassiveWhenNecessary=(r,e)=>{!isAudioWorkletNode(r)&&e.every(t=>t.size===0)&&setInternalStateToPassive(r)},createAddConnectionToAudioNode=(r,e,t,n,s,i,o,c,u,l,a,h,y)=>{const g=new WeakMap;return(m,b,v,S,N)=>{const{activeInputs:k,passiveInputs:O}=i(b),{outputs:f}=i(m),d=c(m),p=_=>{const w=u(b),M=u(m);if(_){const E=deletePassiveInputConnectionToAudioNode(O,m,v,S);r(k,m,E,!1),!N&&!h(m)&&t(M,w,v,S),y(b)&&setInternalStateToActive(b)}else{const E=n(k,m,v,S);e(O,S,E,!1),!N&&!h(m)&&s(M,w,v,S);const F=o(b);if(F===0)a(b)&&setInternalStateToPassiveWhenNecessary(b,k);else{const G=g.get(b);G!==void 0&&clearTimeout(G),g.set(b,setTimeout(()=>{a(b)&&setInternalStateToPassiveWhenNecessary(b,k)},F*1e3))}}};return l(f,[b,v,S],_=>_[0]===b&&_[1]===v&&_[2]===S,!0)?(d.add(p),a(m)?r(k,m,[v,S,p],!0):e(O,S,[m,v,p],!0),!0):!1}},createAddPassiveInputConnectionToAudioNode=r=>(e,t,[n,s,i],o)=>{const c=e.get(n);c===void 0?e.set(n,new Set([[s,t,i]])):r(c,[s,t,i],u=>u[0]===s&&u[1]===t,o)},createAddSilentConnection=r=>(e,t)=>{const n=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const s=()=>{t.removeEventListener("ended",s),t.disconnect(n),n.disconnect()};t.addEventListener("ended",s)},createAddUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).add(t)},DEFAULT_OPTIONS$j={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=s(c),a={...DEFAULT_OPTIONS$j,...u},h=n(l,a),y=i(l)?e():null;super(c,!1,h,y),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(c){this._nativeAnalyserNode.fftSize=c}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(c){const u=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=c,!(c>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=u,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(c){const u=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=c,!(this._nativeAnalyserNode.maxDecibels>c))throw this._nativeAnalyserNode.minDecibels=u,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(c){this._nativeAnalyserNode.smoothingTimeConstant=c}getByteFrequencyData(c){this._nativeAnalyserNode.getByteFrequencyData(c)}getByteTimeDomainData(c){this._nativeAnalyserNode.getByteTimeDomainData(c)}getFloatFrequencyData(c){this._nativeAnalyserNode.getFloatFrequencyData(c)}getFloatTimeDomainData(c){this._nativeAnalyserNode.getFloatTimeDomainData(c)}},isOwnedByContext=(r,e)=>r.context===e,createAnalyserNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let c=e(i);if(!isOwnedByContext(c,o)){const l={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,fftSize:c.fftSize,maxDecibels:c.maxDecibels,minDecibels:c.minDecibels,smoothingTimeConstant:c.smoothingTimeConstant};c=r(o,l)}return n.set(o,c),await t(i,o,c),c};return{render(i,o){const c=n.get(o);return c!==void 0?Promise.resolve(c):s(i,o)}}},testAudioBufferCopyChannelMethodsOutOfBoundsSupport=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},createIndexSizeError=()=>new DOMException("","IndexSizeError"),wrapAudioBufferGetChannelDataMethod=r=>{r.getChannelData=(e=>t=>{try{return e.call(r,t)}catch(n){throw n.code===12?createIndexSizeError():n}})(r.getChannelData)},DEFAULT_OPTIONS$i={numberOfChannels:1},createAudioBufferConstructor=(r,e,t,n,s,i,o,c)=>{let u=null;return class Ln{constructor(a){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:y,sampleRate:g}={...DEFAULT_OPTIONS$i,...a};u===null&&(u=new s(1,1,44100));const m=n!==null&&e(i,i)?new n({length:h,numberOfChannels:y,sampleRate:g}):u.createBuffer(y,h,g);if(m.numberOfChannels===0)throw t();return typeof m.copyFromChannel!="function"?(o(m),wrapAudioBufferGetChannelDataMethod(m)):e(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(m))||c(m),r.add(m),m}static[Symbol.hasInstance](a){return a!==null&&typeof a=="object"&&Object.getPrototypeOf(a)===Ln.prototype||r.has(a)}}},MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT,isActiveAudioNode=r=>ACTIVE_AUDIO_NODE_STORE.has(r),DEFAULT_OPTIONS$h={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(r,e,t,n,s,i,o,c)=>class extends r{constructor(l,a){const h=i(l),y={...DEFAULT_OPTIONS$h,...a},g=s(h,y),m=o(h),b=m?e():null;super(l,!1,g,b),this._audioBufferSourceNodeRenderer=b,this._isBufferNullified=!1,this._isBufferSet=y.buffer!==null,this._nativeAudioBufferSourceNode=g,this._onended=null,this._playbackRate=t(this,m,g.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const a=typeof l=="function"?c(this,l):null;this._nativeAudioBufferSourceNode.onended=a;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===a?l:h}get playbackRate(){return this._playbackRate}start(l=0,a=0,h){if(this._nativeAudioBufferSourceNode.start(l,a,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,a]:[l,a,h]),this.context.state!=="closed"){setInternalStateToActive(this);const y=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",y),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",y)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},createAudioBufferSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,c=null;const u=async(l,a)=>{let h=t(l);const y=isOwnedByContext(h,a);if(!y){const g={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(a,g),o!==null&&h.start(...o),c!==null&&h.stop(c)}return i.set(a,h),y?await r(a,l.playbackRate,h.playbackRate):await n(a,l.playbackRate,h.playbackRate),await s(l,a,h),h};return{set start(l){o=l},set stop(l){c=l},render(l,a){const h=i.get(a);return h!==void 0?Promise.resolve(h):u(l,a)}}},isAudioBufferSourceNode=r=>"playbackRate"in r,isBiquadFilterNode=r=>"frequency"in r&&"gain"in r,isConstantSourceNode=r=>"offset"in r,isGainNode=r=>!("frequency"in r)&&"gain"in r,isOscillatorNode=r=>"detune"in r&&"frequency"in r,isStereoPannerNode=r=>"pan"in r,getAudioNodeConnections=r=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,r),getAudioParamConnections=r=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,r),deactivateActiveAudioNodeInputConnections=(r,e)=>{const{activeInputs:t}=getAudioNodeConnections(r);t.forEach(s=>s.forEach(([i])=>{e.includes(r)||deactivateActiveAudioNodeInputConnections(i,[...e,r])}));const n=isAudioBufferSourceNode(r)?[r.playbackRate]:isAudioWorkletNode(r)?Array.from(r.parameters.values()):isBiquadFilterNode(r)?[r.Q,r.detune,r.frequency,r.gain]:isConstantSourceNode(r)?[r.offset]:isGainNode(r)?[r.gain]:isOscillatorNode(r)?[r.detune,r.frequency]:isStereoPannerNode(r)?[r.pan]:[];for(const s of n){const i=getAudioParamConnections(s);i!==void 0&&i.activeInputs.forEach(([o])=>deactivateActiveAudioNodeInputConnections(o,e))}isActiveAudioNode(r)&&setInternalStateToPassive(r)},deactivateAudioGraph=r=>{deactivateActiveAudioNodeInputConnections(r.destination,[])},isValidLatencyHint=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback"),createAudioContextConstructor=(r,e,t,n,s,i,o,c,u)=>class extends r{constructor(a={}){if(u===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new u(a)}catch(m){throw m.code===12&&m.message==="sampleRate is not in range"?t():m}if(h===null)throw n();if(!isValidLatencyHint(a.latencyHint))throw new TypeError(`The provided value '${a.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(a.sampleRate!==void 0&&h.sampleRate!==a.sampleRate)throw t();super(h,2);const{latencyHint:y}=a,{sampleRate:g}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:y==="balanced"?512/g:y==="interactive"||y===void 0?256/g:y==="playback"?1024/g:Math.max(2,Math.min(128,Math.round(y*g/128)))*128/g,this._nativeAudioContext=h,u.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const m=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",m)};h.addEventListener("statechange",m)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}createMediaElementSource(a){return new s(this,{mediaElement:a})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(a){return new o(this,{mediaStream:a})}createMediaStreamTrackSource(a){return new c(this,{mediaStreamTrack:a})}resume(){return this._state==="suspended"?new Promise((a,h)=>{const y=()=>{this._nativeAudioContext.removeEventListener("statechange",y),this._nativeAudioContext.state==="running"?a():this.resume().then(a,h)};this._nativeAudioContext.addEventListener("statechange",y)}):this._nativeAudioContext.resume().catch(a=>{throw a===void 0||a.code===15?e():a})}suspend(){return this._nativeAudioContext.suspend().catch(a=>{throw a===void 0?e():a})}},createAudioDestinationNodeConstructor=(r,e,t,n,s,i,o,c)=>class extends r{constructor(l,a){const h=i(l),y=o(h),g=s(h,a,y),m=y?e(c):null;super(l,!1,g,m),this._isNodeOfNativeOfflineAudioContext=y,this._nativeAudioDestinationNode=g}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},createAudioDestinationNodeRenderer=r=>{const e=new WeakMap,t=async(n,s)=>{const i=s.destination;return e.set(s,i),await r(n,s,i),i};return{render(n,s){const i=e.get(s);return i!==void 0?Promise.resolve(i):t(n,s)}}},createAudioListenerFactory=(r,e,t,n,s,i,o,c)=>(u,l)=>{const a=l.listener,h=()=>{const f=new Float32Array(1),d=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=o(l);let _=!1,w=[0,0,-1,0,1,0],M=[0,0,0];const E=()=>{if(_)return;_=!0;const K=n(l,256,9,0);K.onaudioprocess=({inputBuffer:Z})=>{const ae=[i(Z,f,0),i(Z,f,1),i(Z,f,2),i(Z,f,3),i(Z,f,4),i(Z,f,5)];ae.some((ie,ne)=>ie!==w[ne])&&(a.setOrientation(...ae),w=ae);const oe=[i(Z,f,6),i(Z,f,7),i(Z,f,8)];oe.some((ie,ne)=>ie!==M[ne])&&(a.setPosition(...oe),M=oe)},d.connect(K)},F=K=>Z=>{Z!==w[K]&&(w[K]=Z,a.setOrientation(...w))},G=K=>Z=>{Z!==M[K]&&(M[K]=Z,a.setPosition(...M))},H=(K,Z,ae)=>{const oe=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Z});oe.connect(d,0,K),oe.start(),Object.defineProperty(oe.offset,"defaultValue",{get(){return Z}});const ie=r({context:u},p,oe.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT);return c(ie,"value",ne=>()=>ne.call(ie),ne=>J=>{try{ne.call(ie,J)}catch(ge){if(ge.code!==9)throw ge}E(),p&&ae(J)}),ie.cancelAndHoldAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.cancelAndHoldAtTime),ie.cancelScheduledValues=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.cancelScheduledValues),ie.exponentialRampToValueAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.exponentialRampToValueAtTime),ie.linearRampToValueAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.linearRampToValueAtTime),ie.setTargetAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.setTargetAtTime),ie.setValueAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.setValueAtTime),ie.setValueCurveAtTime=(ne=>p?()=>{throw s()}:(...J)=>{const ge=ne.apply(ie,J);return E(),ge})(ie.setValueCurveAtTime),ie};return{forwardX:H(0,0,F(0)),forwardY:H(1,0,F(1)),forwardZ:H(2,-1,F(2)),positionX:H(6,0,G(0)),positionY:H(7,0,G(1)),positionZ:H(8,0,G(2)),upX:H(3,0,F(3)),upY:H(4,1,F(4)),upZ:H(5,0,F(5))}},{forwardX:y,forwardY:g,forwardZ:m,positionX:b,positionY:v,positionZ:S,upX:N,upY:k,upZ:O}=a.forwardX===void 0?h():a;return{get forwardX(){return y},get forwardY(){return g},get forwardZ(){return m},get positionX(){return b},get positionY(){return v},get positionZ(){return S},get upX(){return N},get upY(){return k},get upZ(){return O}}},isAudioNode$1=r=>"context"in r,isAudioNodeOutputConnection=r=>isAudioNode$1(r[0]),insertElementInSet=(r,e,t,n)=>{for(const s of r)if(t(s)){if(n)return!1;throw Error("The set contains at least one similar element.")}return r.add(e),!0},addActiveInputConnectionToAudioParam=(r,e,[t,n],s)=>{insertElementInSet(r,[e,t,n],i=>i[0]===e&&i[1]===t,s)},addPassiveInputConnectionToAudioParam=(r,[e,t,n],s)=>{const i=r.get(e);i===void 0?r.set(e,new Set([[t,n]])):insertElementInSet(i,[t,n],o=>o[0]===t,s)},isNativeAudioNodeFaker=r=>"inputs"in r,connectNativeAudioNodeToNativeAudioNode=(r,e,t,n)=>{if(isNativeAudioNodeFaker(e)){const s=e.inputs[n];return r.connect(s,t,0),[s,t,0]}return r.connect(e,t,n),[e,t,n]},deleteActiveInputConnection=(r,e,t)=>{for(const n of r)if(n[0]===e&&n[1]===t)return r.delete(n),n;return null},deleteActiveInputConnectionToAudioParam=(r,e,t)=>pickElementFromSet(r,n=>n[0]===e&&n[1]===t),deleteEventListenerOfAudioNode=(r,e)=>{if(!getEventListenersOfAudioNode(r).delete(e))throw new Error("Missing the expected event listener.")},deletePassiveInputConnectionToAudioParam=(r,e,t)=>{const n=getValueForKey(r,e),s=pickElementFromSet(n,i=>i[0]===t);return n.size===0&&r.delete(e),s},disconnectNativeAudioNodeFromNativeAudioNode=(r,e,t,n)=>{isNativeAudioNodeFaker(e)?r.disconnect(e.inputs[n],t,0):r.disconnect(e,t,n)},getNativeAudioNode=r=>getValueForKey(AUDIO_NODE_STORE,r),getNativeAudioParam=r=>getValueForKey(AUDIO_PARAM_STORE,r),isPartOfACycle=r=>CYCLE_COUNTERS.has(r),isPassiveAudioNode=r=>!ACTIVE_AUDIO_NODE_STORE.has(r),testAudioNodeDisconnectMethodSupport=(r,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=r.createScriptProcessor(256,1,1),s=r.createGain(),i=r.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const c=r.createBufferSource();c.buffer=i,c.loop=!0,c.connect(n).connect(r.destination),c.connect(s),c.disconnect(s),n.onaudioprocess=u=>{const l=u.inputBuffer.getChannelData(0);Array.prototype.some.call(l,a=>a===1)?t(!0):t(!1),c.stop(),n.onaudioprocess=null,c.disconnect(n),n.disconnect(r.destination)},c.start()}}),visitEachAudioNodeOnce=(r,e)=>{const t=new Map;for(const n of r)for(const s of n){const i=t.get(s);t.set(s,i===void 0?1:i+1)}t.forEach((n,s)=>e(s,n))},isNativeAudioNode$1=r=>"context"in r,wrapAudioNodeDisconnectMethod=r=>{const e=new Map;r.connect=(t=>(n,s=0,i=0)=>{const o=isNativeAudioNode$1(n)?t(n,s,i):t(n,s),c=e.get(n);return c===void 0?e.set(n,[{input:i,output:s}]):c.every(u=>u.input!==i||u.output!==s)&&c.push({input:i,output:s}),o})(r.connect.bind(r)),r.disconnect=(t=>(n,s,i)=>{if(t.apply(r),n===void 0)e.clear();else if(typeof n=="number")for(const[o,c]of e){const u=c.filter(l=>l.output!==n);u.length===0?e.delete(o):e.set(o,u)}else if(e.has(n))if(s===void 0)e.delete(n);else{const o=e.get(n);if(o!==void 0){const c=o.filter(u=>u.output!==s&&(u.input!==i||i===void 0));c.length===0?e.delete(n):e.set(n,c)}}for(const[o,c]of e)c.forEach(u=>{isNativeAudioNode$1(o)?r.connect(o,u.output,u.input):r.connect(o,u.output)})})(r.disconnect)},addConnectionToAudioParamOfAudioContext=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:i}=getAudioParamConnections(e),{outputs:o}=getAudioNodeConnections(r),c=getEventListenersOfAudioNode(r),u=l=>{const a=getNativeAudioNode(r),h=getNativeAudioParam(e);if(l){const y=deletePassiveInputConnectionToAudioParam(i,r,t);addActiveInputConnectionToAudioParam(s,r,y,!1),!n&&!isPartOfACycle(r)&&a.connect(h,t)}else{const y=deleteActiveInputConnectionToAudioParam(s,r,t);addPassiveInputConnectionToAudioParam(i,y,!1),!n&&!isPartOfACycle(r)&&a.disconnect(h,t)}};return insertElementInSet(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(c.add(u),isActiveAudioNode(r)?addActiveInputConnectionToAudioParam(s,r,[t,u],!0):addPassiveInputConnectionToAudioParam(i,[r,t,u],!0),!0):!1},deleteInputConnectionOfAudioNode=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:i}=getAudioNodeConnections(e),o=deleteActiveInputConnection(s[n],r,t);return o===null?[deletePassiveInputConnectionToAudioNode(i,r,t,n)[2],!1]:[o[2],!0]},deleteInputConnectionOfAudioParam=(r,e,t)=>{const{activeInputs:n,passiveInputs:s}=getAudioParamConnections(e),i=deleteActiveInputConnection(n,r,t);return i===null?[deletePassiveInputConnectionToAudioParam(s,r,t)[1],!1]:[i[2],!0]},deleteInputsOfAudioNode=(r,e,t,n,s)=>{const[i,o]=deleteInputConnectionOfAudioNode(r,t,n,s);if(i!==null&&(deleteEventListenerOfAudioNode(r,i),o&&!e&&!isPartOfACycle(r)&&disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(r),getNativeAudioNode(t),n,s)),isActiveAudioNode(t)){const{activeInputs:c}=getAudioNodeConnections(t);setInternalStateToPassiveWhenNecessary(t,c)}},deleteInputsOfAudioParam=(r,e,t,n)=>{const[s,i]=deleteInputConnectionOfAudioParam(r,t,n);s!==null&&(deleteEventListenerOfAudioNode(r,s),i&&!e&&!isPartOfACycle(r)&&getNativeAudioNode(r).disconnect(getNativeAudioParam(t),n))},deleteAnyConnection=(r,e)=>{const t=getAudioNodeConnections(r),n=[];for(const s of t.outputs)isAudioNodeOutputConnection(s)?deleteInputsOfAudioNode(r,e,...s):deleteInputsOfAudioParam(r,e,...s),n.push(s[0]);return t.outputs.clear(),n},deleteConnectionAtOutput=(r,e,t)=>{const n=getAudioNodeConnections(r),s=[];for(const i of n.outputs)i[1]===t&&(isAudioNodeOutputConnection(i)?deleteInputsOfAudioNode(r,e,...i):deleteInputsOfAudioParam(r,e,...i),s.push(i[0]),n.outputs.delete(i));return s},deleteConnectionToDestination=(r,e,t,n,s)=>{const i=getAudioNodeConnections(r);return Array.from(i.outputs).filter(o=>o[0]===t&&(n===void 0||o[1]===n)&&(s===void 0||o[2]===s)).map(o=>(isAudioNodeOutputConnection(o)?deleteInputsOfAudioNode(r,e,...o):deleteInputsOfAudioParam(r,e,...o),i.outputs.delete(o),o[0]))},createAudioNodeConstructor=(r,e,t,n,s,i,o,c,u,l,a,h,y,g,m,b)=>class extends l{constructor(S,N,k,O){super(k),this._context=S,this._nativeAudioNode=k;const f=a(S);h(f)&&t(testAudioNodeDisconnectMethodSupport,()=>testAudioNodeDisconnectMethodSupport(f,b))!==!0&&wrapAudioNodeDisconnectMethod(k),AUDIO_NODE_STORE.set(this,k),EVENT_LISTENERS.set(this,new Set),S.state!=="closed"&&N&&setInternalStateToActive(this),r(this,O,k)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(S){this._nativeAudioNode.channelCount=S}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(S){this._nativeAudioNode.channelCountMode=S}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(S){this._nativeAudioNode.channelInterpretation=S}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(S,N=0,k=0){if(N<0||N>=this._nativeAudioNode.numberOfOutputs)throw s();const O=a(this._context),f=m(O);if(y(S)||g(S))throw i();if(isAudioNode$1(S)){const _=getNativeAudioNode(S);try{const M=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,_,N,k),E=isPassiveAudioNode(this);(f||E)&&this._nativeAudioNode.disconnect(...M),this.context.state!=="closed"&&!E&&isPassiveAudioNode(S)&&setInternalStateToActive(S)}catch(M){throw M.code===12?i():M}if(e(this,S,N,k,f)){const M=u([this],S);visitEachAudioNodeOnce(M,n(f))}return S}const d=getNativeAudioParam(S);if(d.name==="playbackRate"&&d.maxValue===1024)throw o();try{this._nativeAudioNode.connect(d,N),(f||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(d,N)}catch(_){throw _.code===12?i():_}if(addConnectionToAudioParamOfAudioContext(this,S,N,f)){const _=u([this],S);visitEachAudioNodeOnce(_,n(f))}}disconnect(S,N,k){let O;const f=a(this._context),d=m(f);if(S===void 0)O=deleteAnyConnection(this,d);else if(typeof S=="number"){if(S<0||S>=this.numberOfOutputs)throw s();O=deleteConnectionAtOutput(this,d,S)}else{if(N!==void 0&&(N<0||N>=this.numberOfOutputs)||isAudioNode$1(S)&&k!==void 0&&(k<0||k>=S.numberOfInputs))throw s();if(O=deleteConnectionToDestination(this,d,S,N,k),O.length===0)throw i()}for(const p of O){const _=u([this],p);visitEachAudioNodeOnce(_,c)}}},createAudioParamFactory=(r,e,t,n,s,i,o,c,u,l,a,h,y)=>(g,m,b,v=null,S=null)=>{const N=b.value,k=new AutomationEventList(N),O=m?n(k):null,f={get defaultValue(){return N},get maxValue(){return v===null?b.maxValue:v},get minValue(){return S===null?b.minValue:S},get value(){return b.value},set value(d){b.value=d,f.setValueAtTime(d,g.context.currentTime)},cancelAndHoldAtTime(d){if(typeof b.cancelAndHoldAtTime=="function")O===null&&k.flush(g.context.currentTime),k.add(s(d)),b.cancelAndHoldAtTime(d);else{const p=Array.from(k).pop();O===null&&k.flush(g.context.currentTime),k.add(s(d));const _=Array.from(k).pop();b.cancelScheduledValues(d),p!==_&&_!==void 0&&(_.type==="exponentialRampToValue"?b.exponentialRampToValueAtTime(_.value,_.endTime):_.type==="linearRampToValue"?b.linearRampToValueAtTime(_.value,_.endTime):_.type==="setValue"?b.setValueAtTime(_.value,_.startTime):_.type==="setValueCurve"&&b.setValueCurveAtTime(_.values,_.startTime,_.duration))}return f},cancelScheduledValues(d){return O===null&&k.flush(g.context.currentTime),k.add(i(d)),b.cancelScheduledValues(d),f},exponentialRampToValueAtTime(d,p){if(d===0)throw new RangeError;if(!Number.isFinite(p)||p<0)throw new RangeError;const _=g.context.currentTime;return O===null&&k.flush(_),Array.from(k).length===0&&(k.add(l(N,_)),b.setValueAtTime(N,_)),k.add(o(d,p)),b.exponentialRampToValueAtTime(d,p),f},linearRampToValueAtTime(d,p){const _=g.context.currentTime;return O===null&&k.flush(_),Array.from(k).length===0&&(k.add(l(N,_)),b.setValueAtTime(N,_)),k.add(c(d,p)),b.linearRampToValueAtTime(d,p),f},setTargetAtTime(d,p,_){return O===null&&k.flush(g.context.currentTime),k.add(u(d,p,_)),b.setTargetAtTime(d,p,_),f},setValueAtTime(d,p){return O===null&&k.flush(g.context.currentTime),k.add(l(d,p)),b.setValueAtTime(d,p),f},setValueCurveAtTime(d,p,_){const w=d instanceof Float32Array?d:new Float32Array(d);if(h!==null&&h.name==="webkitAudioContext"){const M=p+_,E=g.context.sampleRate,F=Math.ceil(p*E),G=Math.floor(M*E),H=G-F,K=new Float32Array(H);for(let ae=0;ae<H;ae+=1){const oe=(w.length-1)/_*((F+ae)/E-p),ie=Math.floor(oe),ne=Math.ceil(oe);K[ae]=ie===ne?w[ie]:(1-(oe-ie))*w[ie]+(1-(ne-oe))*w[ne]}O===null&&k.flush(g.context.currentTime),k.add(a(K,p,_)),b.setValueCurveAtTime(K,p,_);const Z=G/E;Z<M&&y(f,K[K.length-1],Z),y(f,w[w.length-1],M)}else O===null&&k.flush(g.context.currentTime),k.add(a(w,p,_)),b.setValueCurveAtTime(w,p,_);return f}};return t.set(f,b),e.set(f,g),r(f,O),f},createAudioParamRenderer=r=>({replay(e){for(const t of r)if(t.type==="exponentialRampToValue"){const{endTime:n,value:s}=t;e.exponentialRampToValueAtTime(s,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:s}=t;e.linearRampToValueAtTime(s,n)}else if(t.type==="setTarget"){const{startTime:n,target:s,timeConstant:i}=t;e.setTargetAtTime(s,n,i)}else if(t.type==="setValue"){const{startTime:n,value:s}=t;e.setValueAtTime(s,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:s,values:i}=t;e.setValueCurveAtTime(i,s,n)}else throw new Error("Can't apply an unknown automation.")}});class ReadOnlyMap{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,s)=>e.call(t,n,s,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const DEFAULT_OPTIONS$g={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(r,e,t,n,s,i,o,c,u,l,a,h,y,g)=>class extends e{constructor(b,v,S){var N;const k=c(b),O=u(k),f=a({...DEFAULT_OPTIONS$g,...S});y(f);const d=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(k),p=d==null?void 0:d.get(v),_=O||k.state!=="closed"?k:(N=o(k))!==null&&N!==void 0?N:k,w=s(_,O?null:b.baseLatency,l,v,p,f),M=O?n(v,f,p):null;super(b,!0,w,M);const E=[];w.parameters.forEach((G,H)=>{const K=t(this,O,G);E.push([H,K])}),this._nativeAudioWorkletNode=w,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(E),O&&r(k,this);const{activeInputs:F}=i(this);h(w,F)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(b){const v=typeof b=="function"?g(this,b):null;this._nativeAudioWorkletNode.onprocessorerror=v;const S=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=S!==null&&S===v?b:S}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(r,e,t,n,s){if(typeof r.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),r.copyFromChannel(e[t],n,s);else{const i=r.getChannelData(n);if(e[t].byteLength===0)e[t]=i.slice(s,s+128);else{const o=new Float32Array(i.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const copyToChannel=(r,e,t,n,s)=>{typeof r.copyToChannel=="function"?e[t].byteLength!==0&&r.copyToChannel(e[t],n,s):e[t].byteLength!==0&&r.getChannelData(n).set(e[t],s)},createNestedArrays=(r,e)=>{const t=[];for(let n=0;n<r;n+=1){const s=[],i=typeof e=="number"?e:e[n];for(let o=0;o<i;o+=1)s.push(new Float32Array(128));t.push(s)}return t},getAudioWorkletProcessor=(r,e)=>{const t=getValueForKey(NODE_TO_PROCESSOR_MAPS,r),n=getNativeAudioNode(e);return getValueForKey(t,n)},processBuffer=async(r,e,t,n,s,i,o)=>{const c=e===null?Math.ceil(r.context.length/128)*128:e.length,u=n.channelCount*n.numberOfInputs,l=s.reduce((v,S)=>v+S,0),a=l===0?null:t.createBuffer(l,c,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const h=getAudioNodeConnections(r),y=await getAudioWorkletProcessor(t,r),g=createNestedArrays(n.numberOfInputs,n.channelCount),m=createNestedArrays(n.numberOfOutputs,s),b=Array.from(r.parameters.keys()).reduce((v,S)=>({...v,[S]:new Float32Array(128)}),{});for(let v=0;v<c;v+=128){if(n.numberOfInputs>0&&e!==null)for(let S=0;S<n.numberOfInputs;S+=1)for(let N=0;N<n.channelCount;N+=1)copyFromChannel(e,g[S],N,N,v);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:S},N)=>{copyFromChannel(e,b,S,u+N,v)});for(let S=0;S<n.numberOfInputs;S+=1)for(let N=0;N<s[S];N+=1)m[S][N].byteLength===0&&(m[S][N]=new Float32Array(128));try{const S=g.map((k,O)=>h.activeInputs[O].size===0?[]:k),N=o(v/t.sampleRate,t.sampleRate,()=>y.process(S,m,b));if(a!==null)for(let k=0,O=0;k<n.numberOfOutputs;k+=1){for(let f=0;f<s[k];f+=1)copyToChannel(a,m[k],f,O+f,v);O+=s[k]}if(!N)break}catch(S){r.dispatchEvent(new ErrorEvent("processorerror",{colno:S.colno,filename:S.filename,lineno:S.lineno,message:S.message}));break}}return a},createAudioWorkletNodeRendererFactory=(r,e,t,n,s,i,o,c,u,l,a,h,y,g,m,b)=>(v,S,N)=>{const k=new WeakMap;let O=null;const f=async(d,p)=>{let _=a(d),w=null;const M=isOwnedByContext(_,p),E=Array.isArray(S.outputChannelCount)?S.outputChannelCount:Array.from(S.outputChannelCount);if(h===null){const F=E.reduce((Z,ae)=>Z+ae,0),G=s(p,{channelCount:Math.max(1,F),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,F)}),H=[];for(let Z=0;Z<d.numberOfOutputs;Z+=1)H.push(n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[Z]}));const K=o(p,{channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,gain:1});K.connect=e.bind(null,H),K.disconnect=u.bind(null,H),w=[G,H,K]}else M||(_=new h(p,v));if(k.set(p,w===null?_:w[2]),w!==null){if(O===null){if(N===void 0)throw new Error("Missing the processor constructor.");if(y===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ae=d.channelCount*d.numberOfInputs,oe=N.parameterDescriptors===void 0?0:N.parameterDescriptors.length,ie=ae+oe;O=processBuffer(d,ie===0?null:await(async()=>{const J=new y(ie,Math.ceil(d.context.length/128)*128,p.sampleRate),ge=[],_e=[];for(let R=0;R<S.numberOfInputs;R+=1)ge.push(o(J,{channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,gain:1})),_e.push(s(J,{channelCount:S.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:S.channelCount}));const X=await Promise.all(Array.from(d.parameters.values()).map(async R=>{const W=i(J,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R.value});return await g(J,R,W.offset),W})),P=n(J,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ae+oe)});for(let R=0;R<S.numberOfInputs;R+=1){ge[R].connect(_e[R]);for(let W=0;W<S.channelCount;W+=1)_e[R].connect(P,W,R*S.channelCount+W)}for(const[R,W]of X.entries())W.connect(P,0,ae+R),W.start(0);return P.connect(J.destination),await Promise.all(ge.map(R=>m(d,J,R))),b(J)})(),p,S,E,N,l)}const F=await O,G=t(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[H,K,Z]=w;F!==null&&(G.buffer=F,G.start(0)),G.connect(H);for(let ae=0,oe=0;ae<d.numberOfOutputs;ae+=1){const ie=K[ae];for(let ne=0;ne<E[ae];ne+=1)H.connect(ie,oe+ne,ne);oe+=E[ae]}return Z}if(M)for(const[F,G]of d.parameters.entries())await r(p,G,_.parameters.get(F));else for(const[F,G]of d.parameters.entries())await g(p,G,_.parameters.get(F));return await m(d,p,_),_};return{render(d,p){c(p,d);const _=k.get(p);return _!==void 0?Promise.resolve(_):f(d,p)}}},createBaseAudioContextConstructor=(r,e,t,n,s,i,o,c,u,l,a,h,y,g,m,b,v,S,N,k)=>class extends m{constructor(f,d){super(f,d),this._nativeContext=f,this._audioWorklet=r===void 0?void 0:{addModule:(p,_)=>r(this,p,_)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new s(this)}createBuffer(f,d,p){return new t({length:d,numberOfChannels:f,sampleRate:p})}createBufferSource(){return new n(this)}createChannelMerger(f=6){return new i(this,{numberOfInputs:f})}createChannelSplitter(f=6){return new o(this,{numberOfOutputs:f})}createConstantSource(){return new c(this)}createConvolver(){return new u(this)}createDelay(f=1){return new a(this,{maxDelayTime:f})}createDynamicsCompressor(){return new h(this)}createGain(){return new y(this)}createIIRFilter(f,d){return new g(this,{feedback:d,feedforward:f})}createOscillator(){return new b(this)}createPanner(){return new v(this)}createPeriodicWave(f,d,p={disableNormalization:!1}){return new S(this,{...p,imag:d,real:f})}createStereoPanner(){return new N(this)}createWaveShaper(){return new k(this)}decodeAudioData(f,d,p){return l(this._nativeContext,f).then(_=>(typeof d=="function"&&d(_),_),_=>{throw typeof p=="function"&&p(_),_})}},DEFAULT_OPTIONS$f={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(r,e,t,n,s,i,o,c)=>class extends r{constructor(l,a){const h=i(l),y={...DEFAULT_OPTIONS$f,...a},g=s(h,y),m=o(h),b=m?t():null;super(l,!1,g,b),this._Q=e(this,m,g.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=e(this,m,g.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=e(this,m,g.frequency,l.sampleRate/2,0),this._gain=e(this,m,g.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=g,c(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,a,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,a,h)}catch(y){throw y.code===11?n():y}if(l.length!==a.length||a.length!==h.length)throw n()}},createBiquadFilterNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(c,u)=>{let l=t(c);const a=isOwnedByContext(l,u);if(!a){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(u,h)}return i.set(u,l),a?(await r(u,c.Q,l.Q),await r(u,c.detune,l.detune),await r(u,c.frequency,l.frequency),await r(u,c.gain,l.gain)):(await n(u,c.Q,l.Q),await n(u,c.detune,l.detune),await n(u,c.frequency,l.frequency),await n(u,c.gain,l.gain)),await s(c,u,l),l};return{render(c,u){const l=i.get(u);return l!==void 0?Promise.resolve(l):o(c,u)}}},createCacheTestResult=(r,e)=>(t,n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r.get(t);if(i!==void 0)return i;try{const o=n();return o instanceof Promise?(r.set(t,o),o.catch(()=>!1).then(c=>(r.delete(t),e.set(t,c),c))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},DEFAULT_OPTIONS$e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(r,e,t,n,s)=>class extends r{constructor(o,c){const u=n(o),l={...DEFAULT_OPTIONS$e,...c},a=t(u,l),h=s(u)?e():null;super(o,!1,a,h)}},createChannelMergerNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let c=e(i);if(!isOwnedByContext(c,o)){const l={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,numberOfInputs:c.numberOfInputs};c=r(o,l)}return n.set(o,c),await t(i,o,c),c};return{render(i,o){const c=n.get(o);return c!==void 0?Promise.resolve(c):s(i,o)}}},DEFAULT_OPTIONS$d={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=n(c),a=i({...DEFAULT_OPTIONS$d,...u}),h=t(l,a),y=s(l)?e():null;super(c,!1,h,y)}},createChannelSplitterNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let c=e(i);if(!isOwnedByContext(c,o)){const l={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,numberOfOutputs:c.numberOfOutputs};c=r(o,l)}return n.set(o,c),await t(i,o,c),c};return{render(i,o){const c=n.get(o);return c!==void 0?Promise.resolve(c):s(i,o)}}},createConnectAudioParam=r=>(e,t,n)=>r(t,e,n),createConnectMultipleOutputs=r=>(e,t,n=0,s=0)=>{const i=e[n];if(i===void 0)throw r();return isNativeAudioNode$1(t)?i.connect(t,0,s):i.connect(t,0)},createConnectedNativeAudioBufferSourceNodeFactory=r=>(e,t)=>{const n=r(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=e.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},DEFAULT_OPTIONS$c={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(u,l){const a=s(u),h={...DEFAULT_OPTIONS$c,...l},y=n(a,h),g=i(a),m=g?t():null;super(u,!1,y,m),this._constantSourceNodeRenderer=m,this._nativeConstantSourceNode=y,this._offset=e(this,g,y.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(u){const l=typeof u=="function"?o(this,u):null;this._nativeConstantSourceNode.onended=l;const a=this._nativeConstantSourceNode.onended;this._onended=a!==null&&a===l?u:a}start(u=0){if(this._nativeConstantSourceNode.start(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=u),this.context.state!=="closed"){setInternalStateToActive(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(u=0){this._nativeConstantSourceNode.stop(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=u)}},createConstantSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,c=null;const u=async(l,a)=>{let h=t(l);const y=isOwnedByContext(h,a);if(!y){const g={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(a,g),o!==null&&h.start(o),c!==null&&h.stop(c)}return i.set(a,h),y?await r(a,l.offset,h.offset):await n(a,l.offset,h.offset),await s(l,a,h),h};return{set start(l){o=l},set stop(l){c=l},render(l,a){const h=i.get(a);return h!==void 0?Promise.resolve(h):u(l,a)}}},createConvertNumberToUnsignedLong=r=>e=>(r[0]=e,r[0]),DEFAULT_OPTIONS$b={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=n(c),a={...DEFAULT_OPTIONS$b,...u},h=t(l,a),g=s(l)?e():null;super(c,!1,h,g),this._isBufferNullified=!1,this._nativeConvolverNode=h,a.buffer!==null&&i(this,a.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(c){if(this._nativeConvolverNode.buffer=c,c===null&&this._nativeConvolverNode.buffer!==null){const u=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=u.createBuffer(1,1,u.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(c){this._nativeConvolverNode.normalize=c}},createConvolverNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let c=e(i);if(!isOwnedByContext(c,o)){const l={buffer:c.buffer,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,disableNormalization:!c.normalize};c=r(o,l)}return n.set(o,c),isNativeAudioNodeFaker(c)?await t(i,o,c.inputs[0]):await t(i,o,c),c};return{render(i,o){const c=n.get(o);return c!==void 0?Promise.resolve(c):s(i,o)}}},createCreateNativeOfflineAudioContext=(r,e)=>(t,n,s)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,s)}catch(i){throw i.name==="SyntaxError"?r():i}},createDataCloneError=()=>new DOMException("","DataCloneError"),detachArrayBuffer=r=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const s=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>s();try{e.postMessage(r,[r])}catch{}finally{s()}})},createDecodeAudioData=(r,e,t,n,s,i,o,c,u,l,a)=>(h,y)=>{const g=o(h)?h:i(h);if(s.has(y)){const m=t();return Promise.reject(m)}try{s.add(y)}catch{}return e(u,()=>u(g))?g.decodeAudioData(y).then(m=>(detachArrayBuffer(y).catch(()=>{}),e(c,()=>c(m))||a(m),r.add(m),m)):new Promise((m,b)=>{const v=async()=>{try{await detachArrayBuffer(y)}catch{}},S=N=>{b(N),v()};try{g.decodeAudioData(y,N=>{typeof N.copyFromChannel!="function"&&(l(N),wrapAudioBufferGetChannelDataMethod(N)),r.add(N),v().then(()=>m(N))},N=>{S(N===null?n():N)})}catch(N){S(N)}})},createDecrementCycleCounter=(r,e,t,n,s,i,o,c)=>(u,l)=>{const a=e.get(u);if(a===void 0)throw new Error("Missing the expected cycle count.");const h=i(u.context),y=c(h);if(a===l){if(e.delete(u),!y&&o(u)){const g=n(u),{outputs:m}=t(u);for(const b of m)if(isAudioNodeOutputConnection(b)){const v=n(b[0]);r(g,v,b[1],b[2])}else{const v=s(b[0]);g.connect(v,b[1])}}}else e.set(u,a-l)},DEFAULT_OPTIONS$a={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(u,l){const a=s(u),h={...DEFAULT_OPTIONS$a,...l},y=n(a,h),g=i(a),m=g?t(h.maxDelayTime):null;super(u,!1,y,m),this._delayTime=e(this,g,y.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},createDelayNodeRendererFactory=(r,e,t,n,s)=>i=>{const o=new WeakMap,c=async(u,l)=>{let a=t(u);const h=isOwnedByContext(a,l);if(!h){const y={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,delayTime:a.delayTime.value,maxDelayTime:i};a=e(l,y)}return o.set(l,a),h?await r(l,u.delayTime,a.delayTime):await n(l,u.delayTime,a.delayTime),await s(u,l,a),a};return{render(u,l){const a=o.get(l);return a!==void 0?Promise.resolve(a):c(u,l)}}},createDeleteActiveInputConnectionToAudioNode=r=>(e,t,n,s)=>r(e[s],i=>i[0]===t&&i[1]===n),createDeleteUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).delete(t)},isDelayNode=r=>"delayTime"in r,createDetectCycles=(r,e,t)=>function n(s,i){const o=isAudioNode$1(i)?i:t(r,i);if(isDelayNode(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];const{outputs:c}=e(o);return Array.from(c).map(u=>n([...s,o],u[0])).reduce((u,l)=>u.concat(l),[])},getOutputAudioNodeAtIndex=(r,e,t)=>{const n=e[t];if(n===void 0)throw r();return n},createDisconnectMultipleOutputs=r=>(e,t=void 0,n=void 0,s=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?getOutputAudioNodeAtIndex(r,e,t).disconnect():isNativeAudioNode$1(t)?n===void 0?e.forEach(i=>i.disconnect(t)):s===void 0?getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0,s):n===void 0?e.forEach(i=>i.disconnect(t)):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0),DEFAULT_OPTIONS$9={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(r,e,t,n,s,i,o,c)=>class extends r{constructor(l,a){const h=i(l),y={...DEFAULT_OPTIONS$9,...a},g=n(h,y),m=o(h),b=m?t():null;super(l,!1,g,b),this._attack=e(this,m,g.attack),this._knee=e(this,m,g.knee),this._nativeDynamicsCompressorNode=g,this._ratio=e(this,m,g.ratio),this._release=e(this,m,g.release),this._threshold=e(this,m,g.threshold),c(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const a=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=a,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const a=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=a,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},createDynamicsCompressorNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(c,u)=>{let l=t(c);const a=isOwnedByContext(l,u);if(!a){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(u,h)}return i.set(u,l),a?(await r(u,c.attack,l.attack),await r(u,c.knee,l.knee),await r(u,c.ratio,l.ratio),await r(u,c.release,l.release),await r(u,c.threshold,l.threshold)):(await n(u,c.attack,l.attack),await n(u,c.knee,l.knee),await n(u,c.ratio,l.ratio),await n(u,c.release,l.release),await n(u,c.threshold,l.threshold)),await s(c,u,l),l};return{render(c,u){const l=i.get(u);return l!==void 0?Promise.resolve(l):o(c,u)}}},createEncodingError=()=>new DOMException("","EncodingError"),createEvaluateSource=r=>e=>new Promise((t,n)=>{if(r===null){n(new SyntaxError);return}const s=r.document.head;if(s===null)n(new SyntaxError);else{const i=r.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),c=URL.createObjectURL(o),u=r.onerror,l=()=>{r.onerror=u,URL.revokeObjectURL(c)};r.onerror=(a,h,y,g,m)=>{if(h===c||h===r.location.href&&y===1&&g===1)return l(),n(m),!1;if(u!==null)return u(a,h,y,g,m)},i.onerror=()=>{l(),n(new SyntaxError)},i.onload=()=>{l(),t()},i.src=c,i.type="module",s.appendChild(i)}}),createEventTargetConstructor=r=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,s){if(n!==null){let i=this._listeners.get(n);i===void 0&&(i=r(this,n),typeof n=="function"&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,s){const i=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,s)}},createExposeCurrentFrameAndCurrentTime=r=>(e,t,n)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}},createFetchSource=r=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw r()},DEFAULT_OPTIONS$8={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=s(c),a={...DEFAULT_OPTIONS$8,...u},h=n(l,a),y=i(l),g=y?t():null;super(c,!1,h,g),this._gain=e(this,y,h.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}},createGainNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(c,u)=>{let l=t(c);const a=isOwnedByContext(l,u);if(!a){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(u,h)}return i.set(u,l),a?await r(u,c.gain,l.gain):await n(u,c.gain,l.gain),await s(c,u,l),l};return{render(c,u){const l=i.get(u);return l!==void 0?Promise.resolve(l):o(c,u)}}},createGetActiveAudioWorkletNodeInputs=(r,e)=>t=>e(r,t),createGetAudioNodeRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},createGetAudioNodeTailTime=r=>e=>{var t;return(t=r.get(e))!==null&&t!==void 0?t:0},createGetAudioParamRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},createGetBackupOfflineAudioContext=r=>e=>r.get(e),createInvalidStateError=()=>new DOMException("","InvalidStateError"),createGetNativeContext=r=>e=>{const t=r.get(e);if(t===void 0)throw createInvalidStateError();return t},createGetOrCreateBackupOfflineAudioContext=(r,e)=>t=>{let n=r.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),r.set(t,n),n},createGetUnrenderedAudioWorkletNodes=r=>e=>{const t=r.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},createInvalidAccessError=()=>new DOMException("","InvalidAccessError"),wrapIIRFilterNodeGetFrequencyResponseMethod=r=>{r.getFrequencyResponse=(e=>(t,n,s)=>{if(t.length!==n.length||n.length!==s.length)throw createInvalidAccessError();return e.call(r,t,n,s)})(r.getFrequencyResponse)},DEFAULT_OPTIONS$7={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=n(c),a=s(l),h={...DEFAULT_OPTIONS$7,...u},y=e(l,a?null:c.baseLatency,h),g=a?t(h.feedback,h.feedforward):null;super(c,!1,y,g),wrapIIRFilterNodeGetFrequencyResponseMethod(y),this._nativeIIRFilterNode=y,i(this,1)}getFrequencyResponse(c,u,l){return this._nativeIIRFilterNode.getFrequencyResponse(c,u,l)}},filterBuffer=(r,e,t,n,s,i,o,c,u,l,a)=>{const h=l.length;let y=c;for(let g=0;g<h;g+=1){let m=t[0]*l[g];for(let b=1;b<s;b+=1){const v=y-b&u-1;m+=t[b]*i[v],m-=r[b]*o[v]}for(let b=s;b<n;b+=1)m+=t[b]*i[y-b&u-1];for(let b=s;b<e;b+=1)m-=r[b]*o[y-b&u-1];i[y]=l[g],o[y]=m,y=y+1&u-1,a[g]=m}return y},filterFullBuffer=(r,e,t,n)=>{const s=t instanceof Float64Array?t:new Float64Array(t),i=n instanceof Float64Array?n:new Float64Array(n),o=s.length,c=i.length,u=Math.min(o,c);if(s[0]!==1){for(let m=0;m<o;m+=1)i[m]/=s[0];for(let m=1;m<c;m+=1)s[m]/=s[0]}const l=32,a=new Float32Array(l),h=new Float32Array(l),y=e.createBuffer(r.numberOfChannels,r.length,r.sampleRate),g=r.numberOfChannels;for(let m=0;m<g;m+=1){const b=r.getChannelData(m),v=y.getChannelData(m);a.fill(0),h.fill(0),filterBuffer(s,o,i,c,u,a,h,0,l,b,v)}return y},createIIRFilterNodeRendererFactory=(r,e,t,n,s)=>(i,o)=>{const c=new WeakMap;let u=null;const l=async(a,h)=>{let y=null,g=e(a);const m=isOwnedByContext(g,h);if(h.createIIRFilter===void 0?y=r(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(g=h.createIIRFilter(o,i)),c.set(h,y===null?g:y),y!==null){if(u===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new t(a.context.destination.channelCount,a.context.length,h.sampleRate);u=(async()=>{await n(a,v,v.destination);const S=await s(v);return filterFullBuffer(S,h,i,o)})()}const b=await u;return y.buffer=b,y.start(0),y}return await n(a,h,g),g};return{render(a,h){const y=c.get(h);return y!==void 0?Promise.resolve(y):l(a,h)}}},createIncrementCycleCounterFactory=(r,e,t,n,s,i)=>o=>(c,u)=>{const l=r.get(c);if(l===void 0){if(!o&&i(c)){const a=n(c),{outputs:h}=t(c);for(const y of h)if(isAudioNodeOutputConnection(y)){const g=n(y[0]);e(a,g,y[1],y[2])}else{const g=s(y[0]);a.disconnect(g,y[1])}}r.set(c,u)}else r.set(c,l+u)},createIsAnyAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsAnyAudioNode=(r,e)=>t=>r.has(t)||e(t),createIsAnyAudioParam=(r,e)=>t=>r.has(t)||e(t),createIsAnyOfflineAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsNativeAudioContext=r=>e=>r!==null&&e instanceof r,createIsNativeAudioNode=r=>e=>r!==null&&typeof r.AudioNode=="function"&&e instanceof r.AudioNode,createIsNativeAudioParam=r=>e=>r!==null&&typeof r.AudioParam=="function"&&e instanceof r.AudioParam,createIsNativeContext=(r,e)=>t=>r(t)||e(t),createIsNativeOfflineAudioContext=r=>e=>r!==null&&e instanceof r,createIsSecureContext=r=>r!==null&&r.isSecureContext,createMediaElementAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const c=t(i),u=e(c,o);if(n(c))throw TypeError();super(i,!0,u,null),this._nativeMediaElementAudioSourceNode=u}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DEFAULT_OPTIONS$6={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const c=t(i);if(n(c))throw new TypeError;const u={...DEFAULT_OPTIONS$6,...o},l=e(c,u);super(i,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},createMediaStreamAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const c=t(i),u=e(c,o);if(n(c))throw new TypeError;super(i,!0,u,null),this._nativeMediaStreamAudioSourceNode=u}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},createMediaStreamTrackAudioSourceNodeConstructor=(r,e,t)=>class extends r{constructor(s,i){const o=t(s),c=e(o,i);super(s,!0,c,null)}},createMinimalBaseAudioContextConstructor=(r,e,t,n,s,i)=>class extends t{constructor(c,u){super(c),this._nativeContext=c,CONTEXT_STORE.set(this,c),n(c)&&s.set(c,new Set),this._destination=new r(this,u),this._listener=e(this,c),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(c){const u=typeof c=="function"?i(this,c):null;this._nativeContext.onstatechange=u;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===u?c:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},testPromiseSupport=r=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=r.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},createMonitorConnections=(r,e)=>(t,n,s)=>{const i=new Set;return t.connect=(o=>(c,u=0,l=0)=>{const a=i.size===0;if(e(c))return o.call(t,c,u,l),r(i,[c,u,l],h=>h[0]===c&&h[1]===u&&h[2]===l,!0),a&&n(),c;o.call(t,c,u),r(i,[c,u],h=>h[0]===c&&h[1]===u,!0),a&&n()})(t.connect),t.disconnect=(o=>(c,u,l)=>{const a=i.size>0;if(c===void 0)o.apply(t),i.clear();else if(typeof c=="number"){o.call(t,c);for(const y of i)y[1]===c&&i.delete(y)}else{e(c)?o.call(t,c,u,l):o.call(t,c,u);for(const y of i)y[0]===c&&(u===void 0||y[1]===u)&&(l===void 0||y[2]===l)&&i.delete(y)}const h=i.size===0;a&&h&&s()})(t.disconnect),t},assignNativeAudioNodeOption=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t]&&(r[t]=n)},assignNativeAudioNodeOptions=(r,e)=>{assignNativeAudioNodeOption(r,e,"channelCount"),assignNativeAudioNodeOption(r,e,"channelCountMode"),assignNativeAudioNodeOption(r,e,"channelInterpretation")},testAnalyserNodeGetFloatTimeDomainDataMethodSupport=r=>typeof r.getFloatTimeDomainData=="function",wrapAnalyserNodeGetFloatTimeDomainDataMethod=r=>{r.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);r.getByteTimeDomainData(t);const n=Math.max(t.length,r.fftSize);for(let s=0;s<n;s+=1)e[s]=(t[s]-128)*.0078125;return e}},createNativeAnalyserNodeFactory=(r,e)=>(t,n)=>{const s=t.createAnalyser();if(assignNativeAudioNodeOptions(s,n),!(n.maxDecibels>n.minDecibels))throw e();return assignNativeAudioNodeOption(s,n,"fftSize"),assignNativeAudioNodeOption(s,n,"maxDecibels"),assignNativeAudioNodeOption(s,n,"minDecibels"),assignNativeAudioNodeOption(s,n,"smoothingTimeConstant"),r(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(s))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(s),s},createNativeAudioBufferConstructor=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null,assignNativeAudioNodeAudioParamValue=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t].value&&(r[t].value=n)},wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=r=>{r.start=(e=>{let t=!1;return(n=0,s=0,i)=>{if(t)throw createInvalidStateError();e.call(r,n,s,i),t=!0}})(r.start)},wrapAudioScheduledSourceNodeStartMethodNegativeParameters=r=>{r.start=(e=>(t=0,n=0,s)=>{if(typeof s=="number"&&s<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(r,t,n,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodNegativeParameters=r=>{r.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(r,t)})(r.stop)},createNativeAudioBufferSourceNodeFactory=(r,e,t,n,s,i,o,c,u,l,a)=>(h,y)=>{const g=h.createBufferSource();return assignNativeAudioNodeOptions(g,y),assignNativeAudioNodeAudioParamValue(g,y,"playbackRate"),assignNativeAudioNodeOption(g,y,"buffer"),assignNativeAudioNodeOption(g,y,"loop"),assignNativeAudioNodeOption(g,y,"loopEnd"),assignNativeAudioNodeOption(g,y,"loopStart"),e(t,()=>t(h))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(g),e(n,()=>n(h))||u(g),e(s,()=>s(h))||l(g,h),e(i,()=>i(h))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(g),e(o,()=>o(h))||a(g,h),e(c,()=>c(h))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(g),r(h,g),g},createNativeAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null,createNativeAudioDestinationNodeFactory=(r,e)=>(t,n,s)=>{const i=t.destination;if(i.channelCount!==n)try{i.channelCount=n}catch{}s&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:n});const o=r(t,{channelCount:n,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(o,"channelCount",c=>()=>c.call(o),c=>u=>{c.call(o,u);try{i.channelCount=u}catch(l){if(u>i.maxChannelCount)throw l}}),e(o,"channelCountMode",c=>()=>c.call(o),c=>u=>{c.call(o,u),i.channelCountMode=u}),e(o,"channelInterpretation",c=>()=>c.call(o),c=>u=>{c.call(o,u),i.channelInterpretation=u}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},createNativeAudioWorkletNodeConstructor=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null,testClonabilityOfAudioWorkletNodeOptions=r=>{const{port1:e}=new MessageChannel;try{e.postMessage(r)}finally{e.close()}},createNativeAudioWorkletNodeFactory=(r,e,t,n,s)=>(i,o,c,u,l,a)=>{if(c!==null)try{const h=new c(i,u,a),y=new Map;let g=null;if(Object.defineProperties(h,{channelCount:{get:()=>a.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>g,set:m=>{typeof g=="function"&&h.removeEventListener("processorerror",g),g=typeof m=="function"?m:null,typeof g=="function"&&h.addEventListener("processorerror",g)}}}),h.addEventListener=(m=>(...b)=>{if(b[0]==="processorerror"){const v=typeof b[1]=="function"?b[1]:typeof b[1]=="object"&&b[1]!==null&&typeof b[1].handleEvent=="function"?b[1].handleEvent:null;if(v!==null){const S=y.get(b[1]);S!==void 0?b[1]=S:(b[1]=N=>{N.type==="error"?(Object.defineProperties(N,{type:{value:"processorerror"}}),v(N)):v(new ErrorEvent(b[0],{...N}))},y.set(v,b[1]))}}return m.call(h,"error",b[1],b[2]),m.call(h,...b)})(h.addEventListener),h.removeEventListener=(m=>(...b)=>{if(b[0]==="processorerror"){const v=y.get(b[1]);v!==void 0&&(y.delete(b[1]),b[1]=v)}return m.call(h,"error",b[1],b[2]),m.call(h,b[0],b[1],b[2])})(h.removeEventListener),a.numberOfOutputs!==0){const m=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(m).connect(i.destination),s(h,()=>m.disconnect(),()=>m.connect(i.destination))}return h}catch(h){throw h.code===11?n():h}if(l===void 0)throw n();return testClonabilityOfAudioWorkletNodeOptions(a),e(i,o,l,a)},computeBufferSize=(r,e)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*e))))),cloneAudioWorkletNodeOptions=r=>new Promise((e,t)=>{const{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:i})=>{n.close(),s.close(),e(i)},n.onmessageerror=({data:i})=>{n.close(),s.close(),t(i)},s.postMessage(r)}),createAudioWorkletProcessorPromise=async(r,e)=>{const t=await cloneAudioWorkletNodeOptions(e);return new r(t)},createAudioWorkletProcessor=(r,e,t,n)=>{let s=NODE_TO_PROCESSOR_MAPS.get(r);s===void 0&&(s=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(r,s));const i=createAudioWorkletProcessorPromise(t,n);return s.set(e,i),i},createNativeAudioWorkletNodeFakerFactory=(r,e,t,n,s,i,o,c,u,l,a,h,y)=>(g,m,b,v)=>{if(v.numberOfInputs===0&&v.numberOfOutputs===0)throw u();const S=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(S.some(T=>T<1))throw u();if(S.length!==v.numberOfOutputs)throw e();if(v.channelCountMode!=="explicit")throw u();const N=v.channelCount*v.numberOfInputs,k=S.reduce((T,I)=>T+I,0),O=b.parameterDescriptors===void 0?0:b.parameterDescriptors.length;if(N+O>6||k>6)throw u();const f=new MessageChannel,d=[],p=[];for(let T=0;T<v.numberOfInputs;T+=1)d.push(o(g,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),p.push(s(g,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const _=[];if(b.parameterDescriptors!==void 0)for(const{defaultValue:T,maxValue:I,minValue:L,name:U}of b.parameterDescriptors){const Y=i(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.parameterData[U]!==void 0?v.parameterData[U]:T===void 0?0:T});Object.defineProperties(Y.offset,{defaultValue:{get:()=>T===void 0?0:T},maxValue:{get:()=>I===void 0?MOST_POSITIVE_SINGLE_FLOAT:I},minValue:{get:()=>L===void 0?MOST_NEGATIVE_SINGLE_FLOAT:L}}),_.push(Y)}const w=n(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,N+O)}),M=computeBufferSize(m,g.sampleRate),E=c(g,M,N+O,Math.max(1,k)),F=s(g,{channelCount:Math.max(1,k),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,k)}),G=[];for(let T=0;T<v.numberOfOutputs;T+=1)G.push(n(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:S[T]}));for(let T=0;T<v.numberOfInputs;T+=1){d[T].connect(p[T]);for(let I=0;I<v.channelCount;I+=1)p[T].connect(w,I,T*v.channelCount+I)}const H=new ReadOnlyMap(b.parameterDescriptors===void 0?[]:b.parameterDescriptors.map(({name:T},I)=>{const L=_[I];return L.connect(w,0,N+I),L.start(0),[T,L.offset]}));w.connect(E);let K=v.channelInterpretation,Z=null;const ae=v.numberOfOutputs===0?[E]:G,oe={get bufferSize(){return M},get channelCount(){return v.channelCount},set channelCount(T){throw t()},get channelCountMode(){return v.channelCountMode},set channelCountMode(T){throw t()},get channelInterpretation(){return K},set channelInterpretation(T){for(const I of d)I.channelInterpretation=T;K=T},get context(){return E.context},get inputs(){return d},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return Z},set onprocessorerror(T){typeof Z=="function"&&oe.removeEventListener("processorerror",Z),Z=typeof T=="function"?T:null,typeof Z=="function"&&oe.addEventListener("processorerror",Z)},get parameters(){return H},get port(){return f.port2},addEventListener(...T){return E.addEventListener(T[0],T[1],T[2])},connect:r.bind(null,ae),disconnect:l.bind(null,ae),dispatchEvent(...T){return E.dispatchEvent(T[0])},removeEventListener(...T){return E.removeEventListener(T[0],T[1],T[2])}},ie=new Map;f.port1.addEventListener=(T=>(...I)=>{if(I[0]==="message"){const L=typeof I[1]=="function"?I[1]:typeof I[1]=="object"&&I[1]!==null&&typeof I[1].handleEvent=="function"?I[1].handleEvent:null;if(L!==null){const U=ie.get(I[1]);U!==void 0?I[1]=U:(I[1]=Y=>{a(g.currentTime,g.sampleRate,()=>L(Y))},ie.set(L,I[1]))}}return T.call(f.port1,I[0],I[1],I[2])})(f.port1.addEventListener),f.port1.removeEventListener=(T=>(...I)=>{if(I[0]==="message"){const L=ie.get(I[1]);L!==void 0&&(ie.delete(I[1]),I[1]=L)}return T.call(f.port1,I[0],I[1],I[2])})(f.port1.removeEventListener);let ne=null;Object.defineProperty(f.port1,"onmessage",{get:()=>ne,set:T=>{typeof ne=="function"&&f.port1.removeEventListener("message",ne),ne=typeof T=="function"?T:null,typeof ne=="function"&&(f.port1.addEventListener("message",ne),f.port1.start())}}),b.prototype.port=f.port1;let J=null;createAudioWorkletProcessor(g,oe,b,v).then(T=>J=T);const _e=createNestedArrays(v.numberOfInputs,v.channelCount),X=createNestedArrays(v.numberOfOutputs,S),P=b.parameterDescriptors===void 0?[]:b.parameterDescriptors.reduce((T,{name:I})=>({...T,[I]:new Float32Array(128)}),{});let R=!0;const W=()=>{v.numberOfOutputs>0&&E.disconnect(F);for(let T=0,I=0;T<v.numberOfOutputs;T+=1){const L=G[T];for(let U=0;U<S[T];U+=1)F.disconnect(L,I+U,U);I+=S[T]}},$=new Map;E.onaudioprocess=({inputBuffer:T,outputBuffer:I})=>{if(J!==null){const L=h(oe);for(let U=0;U<M;U+=128){for(let Y=0;Y<v.numberOfInputs;Y+=1)for(let ce=0;ce<v.channelCount;ce+=1)copyFromChannel(T,_e[Y],ce,ce,U);b.parameterDescriptors!==void 0&&b.parameterDescriptors.forEach(({name:Y},ce)=>{copyFromChannel(T,P,Y,N+ce,U)});for(let Y=0;Y<v.numberOfInputs;Y+=1)for(let ce=0;ce<S[Y];ce+=1)X[Y][ce].byteLength===0&&(X[Y][ce]=new Float32Array(128));try{const Y=_e.map((le,fe)=>{if(L[fe].size>0)return $.set(fe,M/128),le;const ye=$.get(fe);return ye===void 0?[]:(le.every(be=>be.every(ve=>ve===0))&&(ye===1?$.delete(fe):$.set(fe,ye-1)),le)});R=a(g.currentTime+U/g.sampleRate,g.sampleRate,()=>J.process(Y,X,P));for(let le=0,fe=0;le<v.numberOfOutputs;le+=1){for(let de=0;de<S[le];de+=1)copyToChannel(I,X[le],de,fe+de,U);fe+=S[le]}}catch(Y){R=!1,oe.dispatchEvent(new ErrorEvent("processorerror",{colno:Y.colno,filename:Y.filename,lineno:Y.lineno,message:Y.message}))}if(!R){for(let Y=0;Y<v.numberOfInputs;Y+=1){d[Y].disconnect(p[Y]);for(let ce=0;ce<v.channelCount;ce+=1)p[U].disconnect(w,ce,Y*v.channelCount+ce)}if(b.parameterDescriptors!==void 0){const Y=b.parameterDescriptors.length;for(let ce=0;ce<Y;ce+=1){const le=_[ce];le.disconnect(w,0,N+ce),le.stop()}}w.disconnect(E),E.onaudioprocess=null,V?W():j();break}}}};let V=!1;const ee=o(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),z=()=>E.connect(ee).connect(g.destination),j=()=>{E.disconnect(ee),ee.disconnect()},q=()=>{if(R){j(),v.numberOfOutputs>0&&E.connect(F);for(let T=0,I=0;T<v.numberOfOutputs;T+=1){const L=G[T];for(let U=0;U<S[T];U+=1)F.connect(L,I+U,U);I+=S[T]}}V=!0},x=()=>{R&&(z(),W()),V=!1};return z(),y(oe,q,x)},createNativeBiquadFilterNode=(r,e)=>{const t=r.createBiquadFilter();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"Q"),assignNativeAudioNodeAudioParamValue(t,e,"detune"),assignNativeAudioNodeAudioParamValue(t,e,"frequency"),assignNativeAudioNodeAudioParamValue(t,e,"gain"),assignNativeAudioNodeOption(t,e,"type"),t},createNativeChannelMergerNodeFactory=(r,e)=>(t,n)=>{const s=t.createChannelMerger(n.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&e(t,s),assignNativeAudioNodeOptions(s,n),s},wrapChannelSplitterNode=r=>{const e=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw createInvalidStateError()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw createInvalidStateError()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw createInvalidStateError()}})},createNativeChannelSplitterNode=(r,e)=>{const t=r.createChannelSplitter(e.numberOfOutputs);return assignNativeAudioNodeOptions(t,e),wrapChannelSplitterNode(t),t},createNativeConstantSourceNodeFactory=(r,e,t,n,s)=>(i,o)=>{if(i.createConstantSource===void 0)return t(i,o);const c=i.createConstantSource();return assignNativeAudioNodeOptions(c,o),assignNativeAudioNodeAudioParamValue(c,o,"offset"),e(n,()=>n(i))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(c),e(s,()=>s(i))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(c),r(i,c),c},interceptConnections=(r,e)=>(r.connect=e.connect.bind(e),r.disconnect=e.disconnect.bind(e),r),createNativeConstantSourceNodeFakerFactory=(r,e,t,n)=>(s,{offset:i,...o})=>{const c=s.createBuffer(1,2,44100),u=e(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(s,{...o,gain:i}),a=c.getChannelData(0);a[0]=1,a[1]=1,u.buffer=c,u.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(m){l.channelCount=m},get channelCountMode(){return l.channelCountMode},set channelCountMode(m){l.channelCountMode=m},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(m){l.channelInterpretation=m},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return u.onended},set onended(m){u.onended=m},addEventListener(...m){return u.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return u.dispatchEvent(m[0])},removeEventListener(...m){return u.removeEventListener(m[0],m[1],m[2])},start(m=0){u.start.call(u,m)},stop(m=0){u.stop.call(u,m)}},y=()=>u.connect(l),g=()=>u.disconnect(l);return r(s,u),n(interceptConnections(h,l),y,g)},createNativeConvolverNodeFactory=(r,e)=>(t,n)=>{const s=t.createConvolver();if(assignNativeAudioNodeOptions(s,n),n.disableNormalization===s.normalize&&(s.normalize=!n.disableNormalization),assignNativeAudioNodeOption(s,n,"buffer"),n.channelCount>2||(e(s,"channelCount",i=>()=>i.call(s),i=>o=>{if(o>2)throw r();return i.call(s,o)}),n.channelCountMode==="max"))throw r();return e(s,"channelCountMode",i=>()=>i.call(s),i=>o=>{if(o==="max")throw r();return i.call(s,o)}),s},createNativeDelayNode=(r,e)=>{const t=r.createDelay(e.maxDelayTime);return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"delayTime"),t},createNativeDynamicsCompressorNodeFactory=r=>(e,t)=>{const n=e.createDynamicsCompressor();if(assignNativeAudioNodeOptions(n,t),t.channelCount>2||t.channelCountMode==="max")throw r();return assignNativeAudioNodeAudioParamValue(n,t,"attack"),assignNativeAudioNodeAudioParamValue(n,t,"knee"),assignNativeAudioNodeAudioParamValue(n,t,"ratio"),assignNativeAudioNodeAudioParamValue(n,t,"release"),assignNativeAudioNodeAudioParamValue(n,t,"threshold"),n},createNativeGainNode=(r,e)=>{const t=r.createGain();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"gain"),t},createNativeIIRFilterNodeFactory=r=>(e,t,n)=>{if(e.createIIRFilter===void 0)return r(e,t,n);const s=e.createIIRFilter(n.feedforward,n.feedback);return assignNativeAudioNodeOptions(s,n),s};function divide(r,e){const t=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/t,(r[1]*e[0]-r[0]*e[1])/t]}function multiply(r,e){return[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]}function evaluatePolynomial(r,e){let t=[0,0];for(let n=r.length-1;n>=0;n-=1)t=multiply(t,e),t[0]+=r[n];return t}const createNativeIIRFilterNodeFakerFactory=(r,e,t,n)=>(s,i,{channelCount:o,channelCountMode:c,channelInterpretation:u,feedback:l,feedforward:a})=>{const h=computeBufferSize(i,s.sampleRate),y=l instanceof Float64Array?l:new Float64Array(l),g=a instanceof Float64Array?a:new Float64Array(a),m=y.length,b=g.length,v=Math.min(m,b);if(m===0||m>20)throw n();if(y[0]===0)throw e();if(b===0||b>20)throw n();if(g[0]===0)throw e();if(y[0]!==1){for(let _=0;_<b;_+=1)g[_]/=y[0];for(let _=1;_<m;_+=1)y[_]/=y[0]}const S=t(s,h,o,o);S.channelCount=o,S.channelCountMode=c,S.channelInterpretation=u;const N=32,k=[],O=[],f=[];for(let _=0;_<o;_+=1){k.push(0);const w=new Float32Array(N),M=new Float32Array(N);w.fill(0),M.fill(0),O.push(w),f.push(M)}S.onaudioprocess=_=>{const w=_.inputBuffer,M=_.outputBuffer,E=w.numberOfChannels;for(let F=0;F<E;F+=1){const G=w.getChannelData(F),H=M.getChannelData(F);k[F]=filterBuffer(y,m,g,b,v,O[F],f[F],k[F],N,G,H)}};const d=s.sampleRate/2;return interceptConnections({get bufferSize(){return h},get channelCount(){return S.channelCount},set channelCount(_){S.channelCount=_},get channelCountMode(){return S.channelCountMode},set channelCountMode(_){S.channelCountMode=_},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(_){S.channelInterpretation=_},get context(){return S.context},get inputs(){return[S]},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},addEventListener(..._){return S.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return S.dispatchEvent(_[0])},getFrequencyResponse(_,w,M){if(_.length!==w.length||w.length!==M.length)throw r();const E=_.length;for(let F=0;F<E;F+=1){const G=-Math.PI*(_[F]/d),H=[Math.cos(G),Math.sin(G)],K=evaluatePolynomial(g,H),Z=evaluatePolynomial(y,H),ae=divide(K,Z);w[F]=Math.sqrt(ae[0]*ae[0]+ae[1]*ae[1]),M[F]=Math.atan2(ae[1],ae[0])}},removeEventListener(..._){return S.removeEventListener(_[0],_[1],_[2])}},S)},createNativeMediaElementAudioSourceNode=(r,e)=>r.createMediaElementSource(e.mediaElement),createNativeMediaStreamAudioDestinationNode=(r,e)=>{const t=r.createMediaStreamDestination();return assignNativeAudioNodeOptions(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},createNativeMediaStreamAudioSourceNode=(r,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const n=t.slice(0,1),s=r.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(s,"mediaStream",{value:e}),s},createNativeMediaStreamTrackAudioSourceNodeFactory=(r,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const s=new MediaStream([n]),i=t.createMediaStreamSource(s);if(n.kind!=="audio")throw r();if(e(t))throw new TypeError;return i},createNativeOfflineAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null,createNativeOscillatorNodeFactory=(r,e,t,n,s,i)=>(o,c)=>{const u=o.createOscillator();return assignNativeAudioNodeOptions(u,c),assignNativeAudioNodeAudioParamValue(u,c,"detune"),assignNativeAudioNodeAudioParamValue(u,c,"frequency"),c.periodicWave!==void 0?u.setPeriodicWave(c.periodicWave):assignNativeAudioNodeOption(u,c,"type"),e(t,()=>t(o))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(u),e(n,()=>n(o))||i(u,o),e(s,()=>s(o))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(u),r(o,u),u},createNativePannerNodeFactory=r=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?r(e,t):(assignNativeAudioNodeOptions(n,t),assignNativeAudioNodeAudioParamValue(n,t,"orientationX"),assignNativeAudioNodeAudioParamValue(n,t,"orientationY"),assignNativeAudioNodeAudioParamValue(n,t,"orientationZ"),assignNativeAudioNodeAudioParamValue(n,t,"positionX"),assignNativeAudioNodeAudioParamValue(n,t,"positionY"),assignNativeAudioNodeAudioParamValue(n,t,"positionZ"),assignNativeAudioNodeOption(n,t,"coneInnerAngle"),assignNativeAudioNodeOption(n,t,"coneOuterAngle"),assignNativeAudioNodeOption(n,t,"coneOuterGain"),assignNativeAudioNodeOption(n,t,"distanceModel"),assignNativeAudioNodeOption(n,t,"maxDistance"),assignNativeAudioNodeOption(n,t,"panningModel"),assignNativeAudioNodeOption(n,t,"refDistance"),assignNativeAudioNodeOption(n,t,"rolloffFactor"),n)},createNativePannerNodeFakerFactory=(r,e,t,n,s,i,o,c,u,l)=>(a,{coneInnerAngle:h,coneOuterAngle:y,coneOuterGain:g,distanceModel:m,maxDistance:b,orientationX:v,orientationY:S,orientationZ:N,panningModel:k,positionX:O,positionY:f,positionZ:d,refDistance:p,rolloffFactor:_,...w})=>{const M=a.createPanner();if(w.channelCount>2||w.channelCountMode==="max")throw o();assignNativeAudioNodeOptions(M,w);const E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},F=t(a,{...E,channelInterpretation:"speakers",numberOfInputs:6}),G=n(a,{...w,gain:1}),H=n(a,{...E,gain:1}),K=n(a,{...E,gain:0}),Z=n(a,{...E,gain:0}),ae=n(a,{...E,gain:0}),oe=n(a,{...E,gain:0}),ie=n(a,{...E,gain:0}),ne=s(a,256,6,1),J=i(a,{...E,curve:new Float32Array([1,1]),oversample:"none"});let ge=[v,S,N],_e=[O,f,d];const X=new Float32Array(1);ne.onaudioprocess=({inputBuffer:$})=>{const V=[u($,X,0),u($,X,1),u($,X,2)];V.some((z,j)=>z!==ge[j])&&(M.setOrientation(...V),ge=V);const ee=[u($,X,3),u($,X,4),u($,X,5)];ee.some((z,j)=>z!==_e[j])&&(M.setPosition(...ee),_e=ee)},Object.defineProperty(K.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ae.gain,"defaultValue",{get:()=>0}),Object.defineProperty(oe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ie.gain,"defaultValue",{get:()=>0});const P={get bufferSize(){},get channelCount(){return M.channelCount},set channelCount($){if($>2)throw o();G.channelCount=$,M.channelCount=$},get channelCountMode(){return M.channelCountMode},set channelCountMode($){if($==="max")throw o();G.channelCountMode=$,M.channelCountMode=$},get channelInterpretation(){return M.channelInterpretation},set channelInterpretation($){G.channelInterpretation=$,M.channelInterpretation=$},get coneInnerAngle(){return M.coneInnerAngle},set coneInnerAngle($){M.coneInnerAngle=$},get coneOuterAngle(){return M.coneOuterAngle},set coneOuterAngle($){M.coneOuterAngle=$},get coneOuterGain(){return M.coneOuterGain},set coneOuterGain($){if($<0||$>1)throw e();M.coneOuterGain=$},get context(){return M.context},get distanceModel(){return M.distanceModel},set distanceModel($){M.distanceModel=$},get inputs(){return[G]},get maxDistance(){return M.maxDistance},set maxDistance($){if($<0)throw new RangeError;M.maxDistance=$},get numberOfInputs(){return M.numberOfInputs},get numberOfOutputs(){return M.numberOfOutputs},get orientationX(){return H.gain},get orientationY(){return K.gain},get orientationZ(){return Z.gain},get panningModel(){return M.panningModel},set panningModel($){M.panningModel=$},get positionX(){return ae.gain},get positionY(){return oe.gain},get positionZ(){return ie.gain},get refDistance(){return M.refDistance},set refDistance($){if($<0)throw new RangeError;M.refDistance=$},get rolloffFactor(){return M.rolloffFactor},set rolloffFactor($){if($<0)throw new RangeError;M.rolloffFactor=$},addEventListener(...$){return G.addEventListener($[0],$[1],$[2])},dispatchEvent(...$){return G.dispatchEvent($[0])},removeEventListener(...$){return G.removeEventListener($[0],$[1],$[2])}};h!==P.coneInnerAngle&&(P.coneInnerAngle=h),y!==P.coneOuterAngle&&(P.coneOuterAngle=y),g!==P.coneOuterGain&&(P.coneOuterGain=g),m!==P.distanceModel&&(P.distanceModel=m),b!==P.maxDistance&&(P.maxDistance=b),v!==P.orientationX.value&&(P.orientationX.value=v),S!==P.orientationY.value&&(P.orientationY.value=S),N!==P.orientationZ.value&&(P.orientationZ.value=N),k!==P.panningModel&&(P.panningModel=k),O!==P.positionX.value&&(P.positionX.value=O),f!==P.positionY.value&&(P.positionY.value=f),d!==P.positionZ.value&&(P.positionZ.value=d),p!==P.refDistance&&(P.refDistance=p),_!==P.rolloffFactor&&(P.rolloffFactor=_),(ge[0]!==1||ge[1]!==0||ge[2]!==0)&&M.setOrientation(...ge),(_e[0]!==0||_e[1]!==0||_e[2]!==0)&&M.setPosition(..._e);const R=()=>{G.connect(M),r(G,J,0,0),J.connect(H).connect(F,0,0),J.connect(K).connect(F,0,1),J.connect(Z).connect(F,0,2),J.connect(ae).connect(F,0,3),J.connect(oe).connect(F,0,4),J.connect(ie).connect(F,0,5),F.connect(ne).connect(a.destination)},W=()=>{G.disconnect(M),c(G,J,0,0),J.disconnect(H),H.disconnect(F),J.disconnect(K),K.disconnect(F),J.disconnect(Z),Z.disconnect(F),J.disconnect(ae),ae.disconnect(F),J.disconnect(oe),oe.disconnect(F),J.disconnect(ie),ie.disconnect(F),F.disconnect(ne),ne.disconnect(a.destination)};return l(interceptConnections(P,M),R,W)},createNativePeriodicWaveFactory=r=>(e,{disableNormalization:t,imag:n,real:s})=>{const i=n instanceof Float32Array?n:new Float32Array(n),o=s instanceof Float32Array?s:new Float32Array(s),c=e.createPeriodicWave(o,i,{disableNormalization:t});if(Array.from(n).length<2)throw r();return c},createNativeScriptProcessorNode=(r,e,t,n)=>r.createScriptProcessor(e,t,n),createNativeStereoPannerNodeFactory=(r,e)=>(t,n)=>{const s=n.channelCountMode;if(s==="clamped-max")throw e();if(t.createStereoPanner===void 0)return r(t,n);const i=t.createStereoPanner();return assignNativeAudioNodeOptions(i,n),assignNativeAudioNodeAudioParamValue(i,n,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>s,set:o=>{if(o!==s)throw e()}}),i},createNativeStereoPannerNodeFakerFactory=(r,e,t,n,s,i)=>{const c=new Float32Array([1,1]),u=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},a={...l,oversample:"none"},h=(m,b,v,S)=>{const N=new Float32Array(16385),k=new Float32Array(16385);for(let w=0;w<16385;w+=1){const M=w/16384*u;N[w]=Math.cos(M),k[w]=Math.sin(M)}const O=t(m,{...l,gain:0}),f=n(m,{...a,curve:N}),d=n(m,{...a,curve:c}),p=t(m,{...l,gain:0}),_=n(m,{...a,curve:k});return{connectGraph(){b.connect(O),b.connect(d.inputs===void 0?d:d.inputs[0]),b.connect(p),d.connect(v),v.connect(f.inputs===void 0?f:f.inputs[0]),v.connect(_.inputs===void 0?_:_.inputs[0]),f.connect(O.gain),_.connect(p.gain),O.connect(S,0,0),p.connect(S,0,1)},disconnectGraph(){b.disconnect(O),b.disconnect(d.inputs===void 0?d:d.inputs[0]),b.disconnect(p),d.disconnect(v),v.disconnect(f.inputs===void 0?f:f.inputs[0]),v.disconnect(_.inputs===void 0?_:_.inputs[0]),f.disconnect(O.gain),_.disconnect(p.gain),O.disconnect(S,0,0),p.disconnect(S,0,1)}}},y=(m,b,v,S)=>{const N=new Float32Array(16385),k=new Float32Array(16385),O=new Float32Array(16385),f=new Float32Array(16385),d=Math.floor(16385/2);for(let ae=0;ae<16385;ae+=1)if(ae>d){const oe=(ae-d)/(16384-d)*u;N[ae]=Math.cos(oe),k[ae]=Math.sin(oe),O[ae]=0,f[ae]=1}else{const oe=ae/(16384-d)*u;N[ae]=1,k[ae]=0,O[ae]=Math.cos(oe),f[ae]=Math.sin(oe)}const p=e(m,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),_=t(m,{...l,gain:0}),w=n(m,{...a,curve:N}),M=t(m,{...l,gain:0}),E=n(m,{...a,curve:k}),F=n(m,{...a,curve:c}),G=t(m,{...l,gain:0}),H=n(m,{...a,curve:O}),K=t(m,{...l,gain:0}),Z=n(m,{...a,curve:f});return{connectGraph(){b.connect(p),b.connect(F.inputs===void 0?F:F.inputs[0]),p.connect(_,0),p.connect(M,0),p.connect(G,1),p.connect(K,1),F.connect(v),v.connect(w.inputs===void 0?w:w.inputs[0]),v.connect(E.inputs===void 0?E:E.inputs[0]),v.connect(H.inputs===void 0?H:H.inputs[0]),v.connect(Z.inputs===void 0?Z:Z.inputs[0]),w.connect(_.gain),E.connect(M.gain),H.connect(G.gain),Z.connect(K.gain),_.connect(S,0,0),G.connect(S,0,0),M.connect(S,0,1),K.connect(S,0,1)},disconnectGraph(){b.disconnect(p),b.disconnect(F.inputs===void 0?F:F.inputs[0]),p.disconnect(_,0),p.disconnect(M,0),p.disconnect(G,1),p.disconnect(K,1),F.disconnect(v),v.disconnect(w.inputs===void 0?w:w.inputs[0]),v.disconnect(E.inputs===void 0?E:E.inputs[0]),v.disconnect(H.inputs===void 0?H:H.inputs[0]),v.disconnect(Z.inputs===void 0?Z:Z.inputs[0]),w.disconnect(_.gain),E.disconnect(M.gain),H.disconnect(G.gain),Z.disconnect(K.gain),_.disconnect(S,0,0),G.disconnect(S,0,0),M.disconnect(S,0,1),K.disconnect(S,0,1)}}},g=(m,b,v,S,N)=>{if(b===1)return h(m,v,S,N);if(b===2)return y(m,v,S,N);throw s()};return(m,{channelCount:b,channelCountMode:v,pan:S,...N})=>{if(v==="max")throw s();const k=r(m,{...N,channelCount:1,channelCountMode:v,numberOfInputs:2}),O=t(m,{...N,channelCount:b,channelCountMode:v,gain:1}),f=t(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:S});let{connectGraph:d,disconnectGraph:p}=g(m,b,O,f,k);Object.defineProperty(f.gain,"defaultValue",{get:()=>0}),Object.defineProperty(f.gain,"maxValue",{get:()=>1}),Object.defineProperty(f.gain,"minValue",{get:()=>-1});const _={get bufferSize(){},get channelCount(){return O.channelCount},set channelCount(F){O.channelCount!==F&&(w&&p(),{connectGraph:d,disconnectGraph:p}=g(m,F,O,f,k),w&&d()),O.channelCount=F},get channelCountMode(){return O.channelCountMode},set channelCountMode(F){if(F==="clamped-max"||F==="max")throw s();O.channelCountMode=F},get channelInterpretation(){return O.channelInterpretation},set channelInterpretation(F){O.channelInterpretation=F},get context(){return O.context},get inputs(){return[O]},get numberOfInputs(){return O.numberOfInputs},get numberOfOutputs(){return O.numberOfOutputs},get pan(){return f.gain},addEventListener(...F){return O.addEventListener(F[0],F[1],F[2])},dispatchEvent(...F){return O.dispatchEvent(F[0])},removeEventListener(...F){return O.removeEventListener(F[0],F[1],F[2])}};let w=!1;const M=()=>{d(),w=!0},E=()=>{p(),w=!1};return i(interceptConnections(_,k),M,E)}},createNativeWaveShaperNodeFactory=(r,e,t,n,s,i,o)=>(c,u)=>{const l=c.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&c.createGain().gain.automationRate===void 0)return t(c,u);assignNativeAudioNodeOptions(l,u);const a=u.curve===null||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(a!==null&&a.length<2)throw e();assignNativeAudioNodeOption(l,{curve:a},"curve"),assignNativeAudioNodeOption(l,u,"oversample");let h=null,y=!1;return o(l,"curve",b=>()=>b.call(l),b=>v=>(b.call(l,v),y&&(n(v)&&h===null?h=r(c,l):!n(v)&&h!==null&&(h(),h=null)),v)),s(l,()=>{y=!0,n(l.curve)&&(h=r(c,l))},()=>{y=!1,h!==null&&(h(),h=null)})},createNativeWaveShaperNodeFakerFactory=(r,e,t,n,s)=>(i,{curve:o,oversample:c,...u})=>{const l=i.createWaveShaper(),a=i.createWaveShaper();assignNativeAudioNodeOptions(l,u),assignNativeAudioNodeOptions(a,u);const h=t(i,{...u,gain:1}),y=t(i,{...u,gain:-1}),g=t(i,{...u,gain:1}),m=t(i,{...u,gain:-1});let b=null,v=!1,S=null;const N={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(f){h.channelCount=f,y.channelCount=f,l.channelCount=f,g.channelCount=f,a.channelCount=f,m.channelCount=f},get channelCountMode(){return l.channelCountMode},set channelCountMode(f){h.channelCountMode=f,y.channelCountMode=f,l.channelCountMode=f,g.channelCountMode=f,a.channelCountMode=f,m.channelCountMode=f},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(f){h.channelInterpretation=f,y.channelInterpretation=f,l.channelInterpretation=f,g.channelInterpretation=f,a.channelInterpretation=f,m.channelInterpretation=f},get context(){return l.context},get curve(){return S},set curve(f){if(f!==null&&f.length<2)throw e();if(f===null)l.curve=f,a.curve=f;else{const d=f.length,p=new Float32Array(d+2-d%2),_=new Float32Array(d+2-d%2);p[0]=f[0],_[0]=-f[d-1];const w=Math.ceil((d+1)/2),M=(d+1)/2-1;for(let E=1;E<w;E+=1){const F=E/w*M,G=Math.floor(F),H=Math.ceil(F);p[E]=G===H?f[G]:(1-(F-G))*f[G]+(1-(H-F))*f[H],_[E]=G===H?-f[d-1-G]:-((1-(F-G))*f[d-1-G])-(1-(H-F))*f[d-1-H]}p[w]=d%2===1?f[w-1]:(f[w-2]+f[w-1])/2,l.curve=p,a.curve=_}S=f,v&&(n(S)&&b===null?b=r(i,h):b!==null&&(b(),b=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(f){l.oversample=f,a.oversample=f},addEventListener(...f){return h.addEventListener(f[0],f[1],f[2])},dispatchEvent(...f){return h.dispatchEvent(f[0])},removeEventListener(...f){return h.removeEventListener(f[0],f[1],f[2])}};o!==null&&(N.curve=o instanceof Float32Array?o:new Float32Array(o)),c!==N.oversample&&(N.oversample=c);const k=()=>{h.connect(l).connect(g),h.connect(y).connect(a).connect(m).connect(g),v=!0,n(S)&&(b=r(i,h))},O=()=>{h.disconnect(l),l.disconnect(g),h.disconnect(y),y.disconnect(a),a.disconnect(m),m.disconnect(g),v=!1,b!==null&&(b(),b=null)};return s(interceptConnections(N,g),k,O)},createNotSupportedError=()=>new DOMException("","NotSupportedError"),DEFAULT_OPTIONS$5={numberOfChannels:1},createOfflineAudioContextConstructor=(r,e,t,n,s)=>class extends r{constructor(o,c,u){let l;if(typeof o=="number"&&c!==void 0&&u!==void 0)l={length:c,numberOfChannels:o,sampleRate:u};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:a,numberOfChannels:h,sampleRate:y}={...DEFAULT_OPTIONS$5,...l},g=n(h,a,y);e(testPromiseSupport,()=>testPromiseSupport(g))||g.addEventListener("statechange",(()=>{let m=0;const b=v=>{this._state==="running"&&(m>0?(g.removeEventListener("statechange",b),v.stopImmediatePropagation(),this._waitForThePromiseToSettle(v)):m+=1)};return b})()),super(g,h),this._length=a,this._nativeOfflineAudioContext=g,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},DEFAULT_OPTIONS$4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(u,l){const a=s(u),h={...DEFAULT_OPTIONS$4,...l},y=t(a,h),g=i(a),m=g?n():null,b=u.sampleRate/2;super(u,!1,y,m),this._detune=e(this,g,y.detune,153600,-153600),this._frequency=e(this,g,y.frequency,b,-b),this._nativeOscillatorNode=y,this._onended=null,this._oscillatorNodeRenderer=m,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(u){const l=typeof u=="function"?o(this,u):null;this._nativeOscillatorNode.onended=l;const a=this._nativeOscillatorNode.onended;this._onended=a!==null&&a===l?u:a}get type(){return this._nativeOscillatorNode.type}set type(u){this._nativeOscillatorNode.type=u,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(u){this._nativeOscillatorNode.setPeriodicWave(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=u)}start(u=0){if(this._nativeOscillatorNode.start(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=u),this.context.state!=="closed"){setInternalStateToActive(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(u=0){this._nativeOscillatorNode.stop(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=u)}},createOscillatorNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,c=null,u=null;const l=async(a,h)=>{let y=t(a);const g=isOwnedByContext(y,h);if(!g){const m={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,detune:y.detune.value,frequency:y.frequency.value,periodicWave:o===null?void 0:o,type:y.type};y=e(h,m),c!==null&&y.start(c),u!==null&&y.stop(u)}return i.set(h,y),g?(await r(h,a.detune,y.detune),await r(h,a.frequency,y.frequency)):(await n(h,a.detune,y.detune),await n(h,a.frequency,y.frequency)),await s(a,h,y),y};return{set periodicWave(a){o=a},set start(a){c=a},set stop(a){u=a},render(a,h){const y=i.get(h);return y!==void 0?Promise.resolve(y):l(a,h)}}},DEFAULT_OPTIONS$3={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(u,l){const a=s(u),h={...DEFAULT_OPTIONS$3,...l},y=t(a,h),g=i(a),m=g?n():null;super(u,!1,y,m),this._nativePannerNode=y,this._orientationX=e(this,g,y.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=e(this,g,y.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=e(this,g,y.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=e(this,g,y.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=e(this,g,y.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=e(this,g,y.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(u){this._nativePannerNode.coneInnerAngle=u}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(u){this._nativePannerNode.coneOuterAngle=u}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(u){this._nativePannerNode.coneOuterGain=u}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(u){this._nativePannerNode.distanceModel=u}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(u){this._nativePannerNode.maxDistance=u}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(u){this._nativePannerNode.panningModel=u}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(u){this._nativePannerNode.refDistance=u}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(u){this._nativePannerNode.rolloffFactor=u}},createPannerNodeRendererFactory=(r,e,t,n,s,i,o,c,u,l)=>()=>{const a=new WeakMap;let h=null;const y=async(g,m)=>{let b=null,v=i(g);const S={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},N={...S,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},k=isOwnedByContext(v,m);if("bufferSize"in v)b=n(m,{...S,gain:1});else if(!k){const O={...N,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=s(m,O)}if(a.set(m,b===null?v:b),b!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const E=new o(6,g.context.length,m.sampleRate),F=e(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});F.connect(E.destination),h=(async()=>{const G=await Promise.all([g.orientationX,g.orientationY,g.orientationZ,g.positionX,g.positionY,g.positionZ].map(async(H,K)=>{const Z=t(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:K===0?1:0});return await c(E,H,Z.offset),Z}));for(let H=0;H<6;H+=1)G[H].connect(F,0,H),G[H].start(0);return l(E)})()}const O=await h,f=n(m,{...S,gain:1});await u(g,m,f);const d=[];for(let E=0;E<O.numberOfChannels;E+=1)d.push(O.getChannelData(E));let p=[d[0][0],d[1][0],d[2][0]],_=[d[3][0],d[4][0],d[5][0]],w=n(m,{...S,gain:1}),M=s(m,{...N,orientationX:p[0],orientationY:p[1],orientationZ:p[2],positionX:_[0],positionY:_[1],positionZ:_[2]});f.connect(w).connect(M.inputs[0]),M.connect(b);for(let E=128;E<O.length;E+=128){const F=[d[0][E],d[1][E],d[2][E]],G=[d[3][E],d[4][E],d[5][E]];if(F.some((H,K)=>H!==p[K])||G.some((H,K)=>H!==_[K])){p=F,_=G;const H=E/m.sampleRate;w.gain.setValueAtTime(0,H),w=n(m,{...S,gain:0}),M=s(m,{...N,orientationX:p[0],orientationY:p[1],orientationZ:p[2],positionX:_[0],positionY:_[1],positionZ:_[2]}),w.gain.setValueAtTime(1,H),f.connect(w).connect(M.inputs[0]),M.connect(b)}}return b}return k?(await r(m,g.orientationX,v.orientationX),await r(m,g.orientationY,v.orientationY),await r(m,g.orientationZ,v.orientationZ),await r(m,g.positionX,v.positionX),await r(m,g.positionY,v.positionY),await r(m,g.positionZ,v.positionZ)):(await c(m,g.orientationX,v.orientationX),await c(m,g.orientationY,v.orientationY),await c(m,g.orientationZ,v.orientationZ),await c(m,g.positionX,v.positionX),await c(m,g.positionY,v.positionY),await c(m,g.positionZ,v.positionZ)),isNativeAudioNodeFaker(v)?await u(g,m,v.inputs[0]):await u(g,m,v),v};return{render(g,m){const b=a.get(m);return b!==void 0?Promise.resolve(b):y(g,m)}}},DEFAULT_OPTIONS$2={disableNormalization:!1},createPeriodicWaveConstructor=(r,e,t,n)=>class Bn{constructor(i,o){const c=e(i),u=n({...DEFAULT_OPTIONS$2,...o}),l=r(c,u);return t.add(l),l}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Bn.prototype||t.has(i)}},createRenderAutomation=(r,e)=>(t,n,s)=>(r(n).replay(s),e(n,t,s)),createRenderInputsOfAudioNode=(r,e,t)=>async(n,s,i)=>{const o=r(n);await Promise.all(o.activeInputs.map((c,u)=>Array.from(c).map(async([l,a])=>{const y=await e(l).render(l,s),g=n.context.destination;!t(l)&&(n!==g||!t(n))&&y.connect(i,a,u)})).reduce((c,u)=>[...c,...u],[]))},createRenderInputsOfAudioParam=(r,e,t)=>async(n,s,i)=>{const o=e(n);await Promise.all(Array.from(o.activeInputs).map(async([c,u])=>{const a=await r(c).render(c,s);t(c)||a.connect(i,u)}))},createRenderNativeOfflineAudioContext=(r,e,t,n)=>s=>r(testPromiseSupport,()=>testPromiseSupport(s))?Promise.resolve(r(n,n)).then(i=>{if(!i){const o=t(s,512,0,1);s.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>s.currentTime,o.connect(s.destination)}return s.startRendering()}):new Promise(i=>{const o=e(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=c=>{o.disconnect(),i(c.renderedBuffer)},o.connect(s.destination),s.startRendering()}),createSetActiveAudioWorkletNodeInputs=r=>(e,t)=>{r.set(e,t)},createSetAudioNodeTailTime=r=>(e,t)=>r.set(e,t),createStartRendering=(r,e,t,n,s,i,o,c)=>(u,l)=>t(u).render(u,l).then(()=>Promise.all(Array.from(n(l)).map(a=>t(a).render(a,l)))).then(()=>s(l)).then(a=>(typeof a.copyFromChannel!="function"?(o(a),wrapAudioBufferGetChannelDataMethod(a)):e(i,()=>i(a))||c(a),r.add(a),a)),DEFAULT_OPTIONS$1={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(c,u){const l=s(c),a={...DEFAULT_OPTIONS$1,...u},h=t(l,a),y=i(l),g=y?n():null;super(c,!1,h,g),this._pan=e(this,y,h.pan)}get pan(){return this._pan}},createStereoPannerNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(c,u)=>{let l=t(c);const a=isOwnedByContext(l,u);if(!a){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(u,h)}return i.set(u,l),a?await r(u,c.pan,l.pan):await n(u,c.pan,l.pan),isNativeAudioNodeFaker(l)?await s(c,u,l.inputs[0]):await s(c,u,l),l};return{render(c,u){const l=i.get(u);return l!==void 0?Promise.resolve(l):o(c,u)}}},createTestAudioBufferConstructorSupport=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0},createTestAudioWorkletProcessorPostMessageSupport=(r,e)=>async()=>{if(r===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),s=URL.createObjectURL(t);let i=!1,o=!1;try{await n.audioWorklet.addModule(s);const c=new r(n,"a",{numberOfOutputs:0}),u=n.createOscillator();c.port.onmessage=()=>i=!0,c.onprocessorerror=()=>o=!0,u.connect(c),u.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return i&&!o},createTestOfflineAudioContextCurrentTimeSupport=(r,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(s=>{t.oncomplete=()=>{n.disconnect(),s(t.currentTime!==0)},t.startRendering()})},createUnknownError=()=>new DOMException("","UnknownError"),DEFAULT_OPTIONS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(u,l){const a=s(u),h={...DEFAULT_OPTIONS,...l},y=t(a,h),m=i(a)?n():null;super(u,!0,y,m),this._isCurveNullified=!1,this._nativeWaveShaperNode=y,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(u){if(u===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(u.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=u}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(u){this._nativeWaveShaperNode.oversample=u}},createWaveShaperNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let c=e(i);if(!isOwnedByContext(c,o)){const l={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,curve:c.curve,oversample:c.oversample};c=r(o,l)}return n.set(o,c),isNativeAudioNodeFaker(c)?await t(i,o,c.inputs[0]):await t(i,o,c),c};return{render(i,o){const c=n.get(o);return c!==void 0?Promise.resolve(c):s(i,o)}}},createWindow=()=>typeof window>"u"?null:window,createWrapAudioBufferCopyChannelMethods=(r,e)=>t=>{t.copyFromChannel=(n,s,i=0)=>{const o=r(i),c=r(s);if(c>=t.numberOfChannels)throw e();const u=t.length,l=t.getChannelData(c),a=n.length;for(let h=o<0?-o:0;h+o<u&&h<a;h+=1)n[h]=l[h+o]},t.copyToChannel=(n,s,i=0)=>{const o=r(i),c=r(s);if(c>=t.numberOfChannels)throw e();const u=t.length,l=t.getChannelData(c),a=n.length;for(let h=o<0?-o:0;h+o<u&&h<a;h+=1)l[h+o]=n[h]}},createWrapAudioBufferCopyChannelMethodsOutOfBounds=r=>e=>{e.copyFromChannel=(t=>(n,s,i=0)=>{const o=r(i),c=r(s);if(o<e.length)return t.call(e,n,c,o)})(e.copyFromChannel),e.copyToChannel=(t=>(n,s,i=0)=>{const o=r(i),c=r(s);if(o<e.length)return t.call(e,n,c,o)})(e.copyToChannel)},createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=r=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),r(e,"buffer",s=>()=>{const i=s.call(e);return i===n?null:i},s=>i=>s.call(e,i===null?n:i))},createWrapChannelMergerNode=(r,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});const s=t.createBufferSource();e(n,()=>{const c=n.numberOfInputs;for(let u=0;u<c;u+=1)s.connect(n,0,u)},()=>s.disconnect(n))},getFirstSample=(r,e,t)=>r.copyFromChannel===void 0?r.getChannelData(t)[0]:(r.copyFromChannel(e,t),e[0]),isDCCurve=r=>{if(r===null)return!1;const e=r.length;return e%2!==0?r[Math.floor(e/2)]!==0:r[e/2-1]+r[e/2]!==0},overwriteAccessors=(r,e,t,n)=>{let s=r;for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);const{get:i,set:o}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(r,e,{get:t(i),set:n(o)})},sanitizeAudioWorkletNodeOptions=r=>({...r,outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)}),sanitizeChannelSplitterOptions=r=>({...r,channelCount:r.numberOfOutputs}),sanitizePeriodicWaveOptions=r=>{const{imag:e,real:t}=r;return e===void 0?t===void 0?{...r,imag:[0,0],real:[0,0]}:{...r,imag:Array.from(t,()=>0),real:t}:t===void 0?{...r,imag:e,real:Array.from(e,()=>0)}:{...r,imag:e,real:t}},setValueAtTimeUntilPossible=(r,e,t)=>{try{r.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;setValueAtTimeUntilPossible(r,e,t+1e-7)}},testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=r=>{const e=r.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},testAudioBufferSourceNodeStartMethodOffsetClampingSupport=r=>{const e=r.createBufferSource(),t=r.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=r=>{const e=r.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=r=>{const e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},testAudioWorkletNodeOptionsClonability=r=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(r)}finally{e.close(),t.close()}},wrapAudioBufferSourceNodeStartMethodOffsetClamping=r=>{r.start=(e=>(t=0,n=0,s)=>{const i=r.buffer,o=i===null?n:Math.min(i.duration,n);i!==null&&o>i.duration-.5/r.context.sampleRate?e.call(r,t,0,0):e.call(r,t,o,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(r,e)=>{const t=e.createGain();r.connect(t);const n=(s=>()=>{s.call(r,t),r.removeEventListener("ended",n)})(r.disconnect);r.addEventListener("ended",n),interceptConnections(r,t),r.stop=(s=>{let i=!1;return(o=0)=>{if(i)try{s.call(r,o)}catch{t.gain.setValueAtTime(0,o)}else s.call(r,o),i=!0}})(r.stop)},wrapEventListener=(r,e)=>t=>{const n={value:r};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(r,t):e.handleEvent.call(r,t)},addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window$1=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window$1),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window$1),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode=createIsNativeAudioNode(window$1),isNativeAudioParam=createIsNativeAudioParam(window$1),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window$1),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode,isNativeAudioParam,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext),audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window$1),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,createCancelAndHoldAutomationEvent,createCancelScheduledValuesAutomationEvent,createExponentialRampToValueAutomationEvent,createLinearRampToValueAutomationEvent,createSetTargetAutomationEvent,createSetValueAutomationEvent,createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,createNotSupportedError,getFirstSample,isNativeOfflineAudioContext,overwriteAccessors),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,getFirstSample,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window$1),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window$1),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window$1),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window$1):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor),getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0,createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering),isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext);function assert(r,e){if(!r)throw new Error(e)}function assertRange(r,e,t=1/0){if(!(e<=r&&r<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${r}`)}function assertContextRunning(r){!r.isOffline&&r.state!=="running"&&warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let defaultLogger=console;function log(...r){defaultLogger.log(...r)}function warn(...r){defaultLogger.warn(...r)}function isUndef(r){return typeof r>"u"}function isDefined(r){return!isUndef(r)}function isFunction(r){return typeof r=="function"}function isNumber(r){return typeof r=="number"}function isObject(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function isBoolean(r){return typeof r=="boolean"}function isArray(r){return Array.isArray(r)}function isString(r){return typeof r=="string"}function isNote(r){return isString(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function createAudioContext(r){return new audioContextConstructor(r)}function createOfflineAudioContext(r,e,t){return new offlineAudioContextConstructor(r,e,t)}const theWindow=typeof self=="object"?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(r,e,t){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(r,e,t)}function __decorate(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var c=r.length-1;c>=0;c--)(o=r[c])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function __awaiter(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(a){try{l(n.next(a))}catch(h){o(h)}}function u(a){try{l(n.throw(a))}catch(h){o(h)}}function l(a){a.done?i(a.value):s(a.value).then(c,u)}l((n=n.apply(r,e||[])).next())})}class Ticker{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(e*1e3,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function isAudioParam(r){return isAnyAudioParam(r)}function isAudioNode(r){return isAnyAudioNode(r)}function isOfflineAudioContext(r){return isAnyOfflineAudioContext(r)}function isAudioContext(r){return isAnyAudioContext(r)}function isAudioBuffer(r){return r instanceof AudioBuffer}function noCopy(r,e){return r==="value"||isAudioParam(e)||isAudioNode(e)||isAudioBuffer(e)}function deepMerge(r,...e){if(!e.length)return r;const t=e.shift();if(isObject(r)&&isObject(t))for(const n in t)noCopy(n,t[n])?r[n]=t[n]:isObject(t[n])?(r[n]||Object.assign(r,{[n]:{}}),deepMerge(r[n],t[n])):Object.assign(r,{[n]:t[n]});return deepMerge(r,...e)}function deepEquals(r,e){return r.length===e.length&&r.every((t,n)=>e[n]===t)}function optionsFromArguments(r,e,t=[],n){const s={},i=Array.from(e);if(isObject(i[0])&&n&&!Reflect.has(i[0],n)&&(Object.keys(i[0]).some(c=>Reflect.has(r,c))||(deepMerge(s,{[n]:i[0]}),t.splice(t.indexOf(n),1),i.shift())),i.length===1&&isObject(i[0]))deepMerge(s,i[0]);else for(let o=0;o<t.length;o++)isDefined(i[o])&&(s[t[o]]=i[o]);return deepMerge(r,s)}function getDefaultsFromInstance(r){return r.constructor.getDefaults()}function defaultArg(r,e){return isUndef(r)?e:r}function omitFromObject(r,e){return e.forEach(t=>{Reflect.has(r,t)&&delete r[t]}),r}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Tone{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tone.version=version;const EPSILON=1e-6;function GT(r,e){return r>e+EPSILON}function GTE(r,e){return GT(r,e)||EQ(r,e)}function LT(r,e){return r+EPSILON<e}function EQ(r,e){return Math.abs(r-e)<EPSILON}function clamp(r,e,t){return Math.max(Math.min(r,t),e)}class Timeline extends Tone{constructor(){super(),this.name="Timeline",this._timeline=[];const e=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(assert(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];assert(GTE(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(EQ(this._timeline[t].time,e)){for(let n=t;n>=0&&EQ(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&GTE(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][t]<=e)return s-1;for(;n<i;){let o=Math.floor(n+(i-n)/2);const c=this._timeline[o],u=this._timeline[o+1];if(EQ(c[t],e)){for(let l=o;l<this._timeline.length;l++){const a=this._timeline[l];if(EQ(a[t],e))o=l;else break}return o}else{if(LT(c[t],e)&&GT(u[t],e))return o;GT(c[t],e)?i=o:n=o+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let s=this._search(e),i=this._search(t);return s!==-1&&i!==-1?(this._timeline[s].time!==e&&(s+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,s,i)):s===-1&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&EQ(this._timeline[n].time,e)){let s=n;for(let i=n;i>=0&&EQ(this._timeline[i].time,e);i--)s=i;this._iterate(i=>{t(i)},s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const notifyNewContext=[];function onContextInit(r){notifyNewContext.push(r)}function initializeContext(r){notifyNewContext.forEach(e=>e(r))}const notifyCloseContext=[];function onContextClose(r){notifyCloseContext.push(r)}function closeContext(r){notifyCloseContext.forEach(e=>e(r))}class Emitter extends Tone{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(s=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(s)||(this._events[s]=[]),this._events[s].push(t)}),this}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(s=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(isUndef(t))this._events[e]=[];else{const i=this._events[e];for(let o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let s=0,i=n.length;s<i;s++)n[s].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(Emitter.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class BaseContext extends Emitter{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Context extends BaseContext{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=optionsFromArguments(Context.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=createAudioContext({latencyHint:e.latencyHint}),this._ticker=new Ticker(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return createAudioWorkletNode(this.rawContext,e,t)}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)})}workletsAreReady(){return __awaiter(this,void 0,void 0,function*(){const e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,isString(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25;break}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter(this,void 0,void 0,function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=t,s.loop=!0,s.start(0),this._constants.set(e,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),s()},id:n,time:i+t})};return s(),n}}class DummyContext extends BaseContext{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function readOnly(r,e){isArray(e)?e.forEach(t=>readOnly(r,t)):Object.defineProperty(r,e,{enumerable:!0,writable:!1})}function writable(r,e){isArray(e)?e.forEach(t=>writable(r,t)):Object.defineProperty(r,e,{writable:!0})}const noOp=()=>{};class ToneAudioBuffer extends Tone{constructor(){super(),this.name="ToneAudioBuffer",this.onload=noOp;const e=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&isAudioBuffer(e.url)||e.url instanceof ToneAudioBuffer?this.set(e.url):isString(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(e){return e instanceof ToneAudioBuffer?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return __awaiter(this,void 0,void 0,function*(){const t=ToneAudioBuffer.load(e).then(n=>{this.set(n),this.onload(this)});ToneAudioBuffer.downloads.push(t);try{yield t}finally{const n=ToneAudioBuffer.downloads.indexOf(t);ToneAudioBuffer.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=isArray(e)&&e[0].length>0,n=t?e.length:1,s=t?e[0].length:e.length,i=getContext(),o=i.createBuffer(n,s,i.sampleRate),c=!t&&n===1?[e]:e;for(let u=0;u<n;u++)o.copyToChannel(c[u],u);return this._buffer=o,this}toMono(e){if(isNumber(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let s=0;s<n;s++){const i=this.toArray(s);for(let o=0;o<i.length;o++)t[o]+=i[o]}t=t.map(s=>s/n),this.fromArray(t)}return this}toArray(e){if(isNumber(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),s=Math.floor(t*this.sampleRate);assert(n<s,"The start time must be less than the end time");const i=s-n,o=getContext().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let c=0;c<this.numberOfChannels;c++)o.copyToChannel(this.getChannelData(c).subarray(n,s),c);return new ToneAudioBuffer(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ToneAudioBuffer().fromArray(e)}static fromUrl(e){return __awaiter(this,void 0,void 0,function*(){return yield new ToneAudioBuffer().load(e)})}static load(e){return __awaiter(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let u=c[0];for(const l of c)if(ToneAudioBuffer.supportsType(l)){u=l;break}e=e.replace(t[0],u)}const n=ToneAudioBuffer.baseUrl===""||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",s=yield fetch(n+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const i=yield s.arrayBuffer();return yield getContext().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return __awaiter(this,void 0,void 0,function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]})}}ToneAudioBuffer.baseUrl="";ToneAudioBuffer.downloads=[];class OfflineContext extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return __awaiter(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(s=>setTimeout(s,1)))}})}render(e=!0){return __awaiter(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ToneAudioBuffer(t)})}close(){return Promise.resolve()}}const dummyContext=new DummyContext;let globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(r){isAudioContext(r)?globalContext=new Context(r):isOfflineAudioContext(r)?globalContext=new OfflineContext(r):globalContext=r}function start(){return globalContext.resume()}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){const e=` * Tone.js v${version} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function dbToGain(r){return Math.pow(10,r/20)}function gainToDb(r){return 20*(Math.log(r)/Math.LN10)}function intervalToFrequencyRatio(r){return Math.pow(2,r/12)}let A4=440;function getA4(){return A4}function setA4(r){A4=r}function ftom(r){return Math.round(ftomf(r))}function ftomf(r){return 69+12*Math.log2(r/A4)}function mtof(r){return A4*Math.pow(2,(r-69)/12)}class TimeBaseClass extends Tone{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),s=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let s=0;return e&&e!=="0"&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(isObject(this._val)){let e=0;for(const t in this._val)if(isDefined(this._val[t])){const n=this._val[t],s=new this.constructor(this.context,t).valueOf()*n;e+=s}return e}if(isDefined(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class TimeClass extends TimeBaseClass{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new TimeClass(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),s=this.valueOf(),c=Math.round(s/n)*n-s;return s+c*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let n=t[0],s=new TimeClass(this.context,t[0]).toSeconds();return t.forEach(i=>{const o=new TimeClass(this.context,i).toSeconds();Math.abs(o-e)<Math.abs(s-e)&&(n=i,s=o)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let s=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=s.toString();return i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3))),[n,t,s].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}}class FrequencyClass extends TimeClass{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(e){setA4(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:FrequencyClass.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const s=noteToScaleIndex[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?s:FrequencyClass.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let s=1;return e&&e!=="0"&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(e){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ftom(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/FrequencyClass.A4);let n=Math.round(12*t)+57;const s=Math.floor(n/12);return s<0&&(n+=-12*s),scaleIndexToNote[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mtof(e)}static ftom(e){return ftom(e)}}const noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class TransportTimeClass extends TimeClass{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ToneWithContext extends Tone{constructor(){super();const e=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new TimeClass(this.context,e).toSeconds()}toFrequency(e){return new FrequencyClass(this.context,e).toFrequency()}toTicks(e){return new TransportTimeClass(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{isUndef(e[n])&&delete t[n]}),t}get(){const e=getDefaultsFromInstance(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];isDefined(n)&&isDefined(n.value)&&isDefined(n.setValueAtTime)?e[t]=n.value:n instanceof ToneWithContext?e[t]=n._getPartialProperties(e[t]):isArray(n)||isNumber(n)||isString(n)||isBoolean(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&isDefined(this[t])&&(this[t]&&isDefined(this[t].value)&&isDefined(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ToneWithContext?this[t].set(e[t]):this[t]=e[t])}),this}}class StateTimeline extends Timeline{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return assertRange(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let s=n;s>=0;s--){const i=this._timeline[s];if(i.state===e)return i}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let s=n;s<this._timeline.length;s++){const i=this._timeline[s];if(i.state===e)return i}}}class Param extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(e.param)&&(isAudioParam(e.param)||e.param instanceof Param),"param must be an AudioParam");!isAudioParam(e.param);)e.param=e.param._param;this._swappable=isDefined(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,isDefined(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?dbToGain(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?gainToDb(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),s=this._fromType(e);return assert(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),s=this._events.get(t);let i=this._initialValue;if(s===null)i=this._initialValue;else if(s.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const o=this._events.getBefore(s.time);let c;o===null?c=this._initialValue:c=o.value,s.type==="setTargetAtTime"&&(i=this._exponentialApproach(s.time,c,s.value,s.constant,t))}else if(n===null)i=s.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let o=s.value;if(s.type==="setTargetAtTime"){const c=this._events.getBefore(s.time);c===null?o=this._initialValue:o=c.value}n.type==="linearRampToValueAtTime"?i=this._linearInterpolate(s.time,o,n.time,n.value,t):i=this._exponentialInterpolate(s.time,o,n.time,n.value,t)}else i=s.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=EQ(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,s),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const s=this._fromType(e);assert(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(s),assert(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(e,t,n,s=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*s;this.setValueAtTime(this._toType(i),t);const o=n/(e.length-1);for(let c=1;c<e.length;c++){const u=this._fromType(e[c])*s;this.linearRampToValueAtTime(this._toType(u),t+c*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return assert(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));assert(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const s=this._events.get(t),i=this._events.getAfter(t);return s&&EQ(s.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const s=this._events.getAfter(n.time),i=s?s.time:t+2,o=(i-t)/10;for(let c=t;c<i;c+=o)e.linearRampToValueAtTime(this.getValueAtTime(c),c)}return this._events.forEachAfter(this.context.currentTime,s=>{s.type==="cancelScheduledValues"?e.cancelScheduledValues(s.time):s.type==="setTargetAtTime"?e.setTargetAtTime(s.value,s.time,s.constant):e[s.type](s.value,s.time)}),this}setParam(e){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,s,i){return n+(t-n)*Math.exp(-(i-e)/s)}_linearInterpolate(e,t,n,s,i){return t+(s-t)*((i-e)/(n-e))}_exponentialInterpolate(e,t,n,s,i){return t*Math.pow(s/t,(i-e)/(n-e))}}class ToneAudioNode extends ToneWithContext{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return isDefined(e)&&(e instanceof ToneAudioNode||isAudioNode(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();assert(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return connect(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return disconnect(this,e,t,n),this}chain(...e){return connectSeries(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function connectSeries(...r){const e=r.shift();r.reduce((t,n)=>(t instanceof ToneAudioNode?t.connect(n):isAudioNode(t)&&connect(t,n),n),e)}function connect(r,e,t=0,n=0){for(assert(isDefined(r),"Cannot connect from undefined node"),assert(isDefined(e),"Cannot connect to undefined node"),(e instanceof ToneAudioNode||isAudioNode(e))&&assert(e.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(r.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof ToneAudioNode||e instanceof Param;)isDefined(e.input)&&(e=e.input);for(;r instanceof ToneAudioNode;)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.connect(e,t):r.connect(e,t,n)}function disconnect(r,e,t=0,n=0){if(isDefined(e))for(;e instanceof ToneAudioNode;)e=e.input;for(;!isAudioNode(r);)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.disconnect(e,t):isAudioNode(e)?r.disconnect(e,t,n):r.disconnect()}class Gain extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class OneShotSource extends ToneAudioNode{constructor(e){super(e),this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(e,t=1){assert(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){assert(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ToneConstantSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Signal extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=optionsFromArguments(Signal.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,s){return this._param.setValueCurveAtTime(e,t,n,s),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function connectSignal(r,e,t,n){(e instanceof Param||isAudioParam(e)||e instanceof Signal&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Signal&&(e.overridden=!0)),connect(r,e,t,n)}class TickParam extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Timeline(1/0),this._multiplier=1;const e=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const s=this._fromType(e),i=this._events.get(t),o=Math.round(Math.max(1/n,1));for(let c=0;c<=o;c++){const u=n*c+t,l=this._exponentialApproach(i.time,i.value,s,n,u);this.linearRampToValueAtTime(this._toType(l),u)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),o=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),o=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),s=this._events.get(t),i=Math.round(Math.max((t-s.time)*10,1)),o=(t-s.time)/i;for(let c=0;c<=i;c++){const u=o*c+s.time,l=this._exponentialInterpolate(s.time,s.value,t,n,u);this.linearRampToValueAtTime(this._toType(l),u)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let s=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(s=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+s)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(t);return this.getTimeOfTick(s+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const s=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-t.time),c=Math.sqrt(Math.pow(s,2)-2*o*(t.ticks-e)),u=(-s+c)/o,l=(-s-c)/o;return(u>0?u:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),s=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class TickSignal extends Signal{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Signal.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class TickSource extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;const e=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:e.units,value:e.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),isDefined(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let i=n,o=0;return this._state.forEachBetween(n.time,t+this.sampleTime,c=>{let u=i.time;const l=this._tickOffset.get(c.time);l&&l.time>=i.time&&(o=l.ticks,u=l.time),i.state==="started"&&c.state!=="started"&&(o+=this.frequency.getTicksAtTime(c.time)-this.frequency.getTicksAtTime(u)),i=c}),this._state.remove(s),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let s=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,o=>{let c=s.time;const u=this._tickOffset.get(o.time);u&&u.time>=s.time&&(i=u.seconds,c=u.time),s.state==="started"&&o.state!=="started"&&(i+=o.time-c),s=o}),this._state.remove(n),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),s=this._state.get(t),i=Math.max(n.time,s.time),o=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,n){let s=this._state.get(e);this._state.forEachBetween(e,t,o=>{s&&s.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(s.time,e),o.time-this.sampleTime,n),s=o});let i=null;if(s&&s.state==="started"){const o=Math.max(s.time,e),c=this.frequency.getTicksAtTime(o),u=this.frequency.getTicksAtTime(s.time),l=c-u;let a=Math.ceil(l)-l;a=EQ(a,1)?0:a;let h=this.frequency.getTimeOfTick(c+a);for(;h<t;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(y){i=y;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Clock extends ToneWithContext{constructor(){super(optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);const e=optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new TickSource({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){assertContextRunning(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const s=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,s);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,s)=>{this.callback(n,s)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Emitter.mixin(Clock);class ToneAudioBuffers extends Tone{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return assert(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=noOp,s=noOp){return isString(t)?this._buffers.set(e.toString(),new ToneAudioBuffer(this.baseUrl+t,n,s)):this._buffers.set(e.toString(),new ToneAudioBuffer(t,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class TicksClass extends TransportTimeClass{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Draw extends ToneWithContext{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}onContextInit(r=>{r.draw=new Draw({context:r})});onContextClose(r=>{r.draw.dispose()});class IntervalTimeline extends Tone{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){assert(isDefined(e.time),"Events must have a time property"),assert(isDefined(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new IntervalNode(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,s=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,s=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,s=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,s=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,s=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),s&&this._rebalance(s)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),s=e.right;s&&(e.right=s.left,s.left=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),s=e.left;s&&(e.left=s.right,s.right=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let s=1;s<t.length;s++)t[s].low>n.low&&(n=t[s]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class IntervalNode{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Volume extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"])),this.name="Volume";const e=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Destination extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments)),this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;const e=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),connectSeries(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}onContextInit(r=>{r.destination=new Destination({context:r})});onContextClose(r=>{r.destination.dispose()});class TimelineValue extends Tone{constructor(e){super(),this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class TransportEvent{constructor(e,t){this.id=TransportEvent._eventId++;const n=Object.assign(TransportEvent.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}TransportEvent._eventId=0;class TransportRepeatEvent extends TransportEvent{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(TransportRepeatEvent.getDefaults(),t);this.duration=new TicksClass(e.context,n.duration).valueOf(),this._interval=new TicksClass(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Transport extends ToneWithContext{constructor(){super(optionsFromArguments(Transport.getDefaults(),arguments)),this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;const e=optionsFromArguments(Transport.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Clock({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),readOnly(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),s=Math.sin(n*Math.PI)*this._swingAmount;e+=new TicksClass(this.context,this._swingTicks*2/3).toSeconds()*s}this._timeline.forEachAtTime(t,n=>n.invoke(e))}schedule(e,t){const n=new TransportEvent(this,{callback:e,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,s=1/0){const i=new TransportRepeatEvent(this,{callback:e,duration:new TimeClass(this.context,s).toTicks(),interval:new TimeClass(this.context,t).toTicks(),time:new TransportTimeClass(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new TransportEvent(this,{callback:e,once:!0,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new TicksClass(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return isDefined(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new TicksClass(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),s=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),i=t+s;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),s=e-n%e;return this._clock.nextTickTime(s,t)}}syncSignal(e,t){if(!t){const s=this.now();if(e.getValueAtTime(s)!==0){const o=1/(60/this.bpm.getValueAtTime(s)/this.PPQ);t=e.getValueAtTime(s)/o}else t=0}const n=new Gain(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Emitter.mixin(Transport);onContextInit(r=>{r.transport=new Transport({context:r})});onContextClose(r=>{r.transport.dispose()});class Source extends ToneAudioNode{constructor(e){super(e),this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let s=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),!this._synced&&this._state.getValueAtTime(s)==="started")assert(GT(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,t,n);else if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const i=this._state.get(s);i&&(i.offset=this.toSeconds(defaultArg(t,0)),i.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule(c=>{this._start(c,t,n)},s);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(s,t,n);return this}stop(e){let t=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||isDefined(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const s=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(e,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ToneBufferSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ToneAudioBuffer(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,s=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,s),this.loop?t=defaultArg(t,this.loopStart):t=defaultArg(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const c=this.toSeconds(this.loopEnd)||this.buffer.duration,u=this.toSeconds(this.loopStart),l=c-u;GTE(o,c)&&(o=(o-u)%l+u),EQ(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),isDefined(n)){let c=this.toSeconds(n);c=Math.max(c,0),this.stop(i+c)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function generateWaveform(r,e){return __awaiter(this,void 0,void 0,function*(){const t=e/r.context.sampleRate,n=new OfflineContext(1,t,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class ToneOscillatorNode extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Oscillator extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),readOnly(this,"frequency"),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Oscillator._periodicWaveCache.find(t=>t.phase===this._phase&&deepEquals(t.partials,this._partials));{const e=Oscillator._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(isDefined(n)){const{partials:s,wave:i}=n;this._wave=i,this._partials=s,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[s,i]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(s,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){assertRange(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const s=new Float32Array(e);this._partials.forEach((i,o)=>s[o]=i),this._partials=Array.from(s),this.type=this._type}}_getRealImaginary(e,t){let s=2048;const i=new Float32Array(s),o=new Float32Array(s);let c=1;if(e==="custom"){if(c=this._partials.length+1,this._partialCount=this._partials.length,s=c,this._partials.length===0)return[i,o]}else{const u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);u?(c=parseInt(u[2],10)+1,this._partialCount=parseInt(u[2],10),e=u[1],c=Math.max(c,2),s=c):this._partialCount=0,this._partials=[]}for(let u=1;u<s;++u){const l=2/(u*Math.PI);let a;switch(e){case"sine":a=u<=c?1:0,this._partials[u-1]=a;break;case"square":a=u&1?2*l:0,this._partials[u-1]=a;break;case"sawtooth":a=l*(u&1?1:-1),this._partials[u-1]=a;break;case"triangle":u&1?a=2*(l*l)*(u-1>>1&1?-1:1):a=0,this._partials[u-1]=a;break;case"custom":a=this._partials[u-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}a!==0?(i[u]=-a*Math.sin(t*u),o[u]=a*Math.cos(t*u)):(i[u]=0,o[u]=0)}return[i,o]}_inverseFFT(e,t,n){let s=0;const i=e.length;for(let o=0;o<i;o++)s+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return s}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const s=Math.PI*2,i=32;for(let o=0;o<i;o++)n=Math.max(this._inverseFFT(e,t,o/i*s),n);return clamp(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Oscillator._periodicWaveCache=[];class SignalOperator extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}}class WaveShaper extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):isFunction(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Signal.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let s=0,i=t;s<i;s++){const o=s/(i-1)*2-1;n[s]=e(o,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));assert(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class AudioToGain extends SignalOperator{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Multiply extends Signal{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Signal.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AMOscillator extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});const e=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class FMOscillator extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});const e=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class PulseOscillator extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:t=>t<=0?-1:1});const e=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class FatOscillator extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((s,i)=>s.detune.value=t+n*i)}}get count(){return this._oscillators.length}set count(e){if(assertRange(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new Oscillator({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):noOp});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class PWMOscillator extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});const e=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator};class OmniOscillator extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=OmniOscillatorSourceMap[e],n=this.now();if(this._oscillator){const s=this._oscillator;s.stop(n),this.context.setTimeout(()=>s.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof OmniOscillatorSourceMap[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function range(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(i,r,e),t.set(this,i)}})}}function timeRange(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(this.toSeconds(i),r,e),t.set(this,i)}})}}class Player extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(e){return __awaiter(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=noOp){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=defaultArg(t,this._loopStart):t=defaultArg(t,0);const s=this.toSeconds(t),i=n;n=defaultArg(n,Math.max(this._buffer.duration-s,0));let o=this.toSeconds(n);o=o/this._playbackRate,e=this.toSeconds(e);const c=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(c),this._loop&&isUndef(i)?c.start(e,s):c.start(e,s,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const s=this.toSeconds(e);this._stop(n),this._start(n,s)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(s=>s.cancelStop())),this._activeSources.forEach(s=>{s.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0);__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);class Envelope extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Signal({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(isString(e))return e;{let n;for(n in EnvelopeCurves)if(EnvelopeCurves[n][t]===e)return n;return e}}_setCurve(e,t,n){if(isString(n)&&Reflect.has(EnvelopeCurves,n)){const s=EnvelopeCurves[n];isObject(s)?e!=="_decayCurve"&&(this[e]=s[t]):this[e]=s}else if(isArray(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){assert(["linear","exponential"].some(t=>t===e),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let s=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const c=1/s;s=(1-o)/c}if(s<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,s,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,s,e);else{this._sig.cancelAndHoldAtTime(e);let c=this._attackCurve;for(let u=1;u<c.length;u++)if(c[u-1]<=o&&o<=c[u]){c=this._attackCurve.slice(u),c[0]=o;break}this._sig.setValueCurveAtTime(c,e,s,t)}if(i&&this.sustain<1){const c=t*this.sustain,u=e+s;this.log("decay",u),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(c,i+u):this._sig.exponentialApproachValueAtTime(c,u,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(assert(isArray(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,n=new OfflineContext(1,t,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),o=i*.1,c=i+o,u=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/c,decay:t*this.toSeconds(this.decay)/c,release:t*this.toSeconds(this.release)/c,context:n}));return u._sig.toDestination(),u.triggerAttackRelease(t*(s+o)/c,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}__decorate([timeRange(0)],Envelope.prototype,"attack",void 0);__decorate([timeRange(0)],Envelope.prototype,"decay",void 0);__decorate([range(0,1)],Envelope.prototype,"sustain",void 0);__decorate([timeRange(0)],Envelope.prototype,"release",void 0);const EnvelopeCurves=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/(128-1)*(Math.PI/2));const s=[],i=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const y=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;s[e]=y/10+t*.83}s[128-1]=1;const o=[],c=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*c)/c;const u=[];for(e=0;e<128;e++)t=e/(128-1),u[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/(128-1);const y=Math.pow(t,3)*4+.2,g=Math.cos(y*Math.PI*2*t);l[e]=Math.abs(g*(1-t))}function a(y){const g=new Array(y.length);for(let m=0;m<y.length;m++)g[m]=1-y[m];return g}function h(y){return y.slice(0).reverse()}return{bounce:{In:a(l),Out:l},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:s,Out:a(s)},sine:{In:u,Out:a(u)},step:{In:o,Out:a(o)}}})();class Instrument extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...s)=>{const i=s[t],o=this.context.transport.schedule(c=>{s[t]=c,n.apply(this,s)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,s){const i=this.toSeconds(n),o=this.toSeconds(t);return this.triggerAttack(e,i,s),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Monophonic extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));const e=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const s=this.toSeconds(t);return this._triggerEnvelopeAttack(s,n),this.setNote(e,s),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),s=e instanceof FrequencyClass?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,i,n)}else this.frequency.setValueAtTime(s,n);return this}}__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);class AmplitudeEnvelope extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Synth extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments)),this.name="Synth";const e=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+s)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MembraneSynth extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),s=this.toFrequency(e instanceof FrequencyClass?e.toFrequency():e),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}__decorate([range(0)],MembraneSynth.prototype,"octaves",void 0);__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);const workletContext=new Set;function addToWorklet(r){workletContext.add(r)}function registerProcessor(r,e){const t=`registerProcessor("${r}", ${e})`;workletContext.add(t)}const toneAudioWorkletProcessor=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;addToWorklet(toneAudioWorkletProcessor);const singleIOProcess=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;addToWorklet(singleIOProcess);const delayLine=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;addToWorklet(delayLine);const workletName$1="feedback-comb-filter",feedbackCombFilter=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;registerProcessor(workletName$1,feedbackCombFilter);class Sampler extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(n=>{const s=parseInt(n,10);if(assert(isNote(n)||isNumber(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),isNote(n)){const i=new FrequencyClass(this.context,n).toMidi();t[i]=e.urls[n]}else isNumber(s)&&isFinite(s)&&(t[s]=e.urls[s])}),this._buffers=new ToneAudioBuffers({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=ftomf(new FrequencyClass(this.context,s).toFrequency()),o=Math.round(i),c=i-o,u=this._findClosest(o),l=o-u,a=this._buffers.get(l),h=intervalToFrequencyRatio(u+c),y=new ToneBufferSource({url:a,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);y.start(t,0,a.duration/h,n),isArray(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(y),y.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const g=this._activeSources.get(o),m=g.indexOf(y);m!==-1&&g.splice(m,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const s=new FrequencyClass(this.context,n).toMidi();if(this._activeSources.has(s)&&this._activeSources.get(s).length){const i=this._activeSources.get(s);t=this.toSeconds(t),i.forEach(o=>{o.stop(t)}),this._activeSources.set(s,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,s),isArray(t)?(assert(isArray(e),"notes must be an array when duration is array"),e.forEach((o,c)=>{const u=t[Math.min(c,t.length-1)];this.triggerRelease(o,i+this.toSeconds(u))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(assert(isNote(e)||isFinite(e),`note must be a pitch or midi: ${e}`),isNote(e)){const s=new FrequencyClass(this.context,e).toMidi();this._buffers.add(s,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}__decorate([timeRange(0)],Sampler.prototype,"attack",void 0);__decorate([timeRange(0)],Sampler.prototype,"release",void 0);class Panner extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const workletName="bit-crusher",bitCrusherWorklet=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;registerProcessor(workletName,bitCrusherWorklet);class Solo extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"])),this.name="Solo";const e=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Solo._allSolos=new Map;Solo._soloed=new Map;class PanVol extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Channel extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:e.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Channel.buses.has(e)||Channel.buses.set(e,new Gain({context:this.context})),Channel.buses.get(e)}send(e,t=0){const n=this._getBus(e),s=new Gain({context:this.context,units:"decibels",gain:t});return this.connect(s),s.connect(n),s}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Channel.buses=new Map;class Listener extends ToneAudioNode{constructor(){super(...arguments),this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}onContextInit(r=>{r.listener=new Listener({context:r})});onContextClose(r=>{r.listener.dispose()});getContext().transport;getContext().destination;getContext().destination;getContext().listener;getContext().draw;const context=getContext();function loaded(){return ToneAudioBuffer.loaded()}const notes_to_load=["A2","C3","A3","C4","A4","C5"],notes_loaded=Object.fromEntries(notes_to_load.map(r=>[r,!1])),sampler=new Sampler().toDestination();context.lookAhead=.05;for(const r of notes_to_load)fetch(`/acchymns-pr-PR_kwDOHpETuc5W7BSL/assets/notes/${r}.mp3`).then(async e=>{const t=URL.createObjectURL(await e.blob());sampler.add(r,t),notes_loaded[r]=!0});const interval=useLocalStorage("ACCOptions.playbackInterval",.25),duration=useLocalStorage("ACCOptions.playbackDuration",2.5),staggered=useLocalStorage("ACCOptions.staggered",!0),isPlaying=ref(!1);let cancel_interval_id;const scheduled_notes_interval_id=[],player={async play(r){if(isPlaying.value)return;if(isPlaying.value=!0,await start(),!Object.values(notes_loaded).every(t=>t)){console.log("Not all notes have been loaded!");return}if(!sampler.loaded){console.log("Sampler hasn't loaded!");return}console.log("attempting to start notes"),console.log(...unref(r)),await loaded();let e;if(staggered.value){for(const[t,n]of unref(r).entries())scheduled_notes_interval_id.push(setTimeout(()=>{sampler.triggerAttack(n)},interval.value*t*1e3));e=duration.value+interval.value*unref(r).length}else sampler.triggerAttack(unref(r)),e=duration.value;cancel_interval_id=setTimeout(()=>{sampler.releaseAll(),isPlaying.value=!1},e*1e3)},stop(){for(const r of scheduled_notes_interval_id)clearTimeout(r);clearTimeout(cancel_interval_id),sampler.releaseAll(),isPlaying.value=!1}};function useNotes(){return{player,isPlaying}}const _hoisted_1={class:"menu"},_hoisted_2={class:"title"},_hoisted_3={class:"title--left"},_hoisted_4={class:"title--center"},_hoisted_5={class:"title--right"},_hoisted_6={key:1,class:"ionicon",src:_imports_2$1},_hoisted_7=createBaseVNode("p",{class:"tooltiptext"},"New! Starting Notes",-1),_hoisted_8=[_hoisted_7],_hoisted_9={class:"w-100",style:{height:"100vh"}},_sfc_main=defineComponent({__name:"SongDisplayView",props:{book:{},number:{}},setup(r){const e=r,t=useRouter(),{player:n,isPlaying:s}=useNotes(),i=ref([]),o=useCapacitorPreferences("bookmarks",[]),c=computed(()=>o.value.findIndex(g=>g.book==e.book&&g.number==e.number)!=-1);async function u(){if(!c.value)o.value.push(e),await Toast.show({text:`#${e.number} added to Bookmarks`});else{const g=o.value.findIndex(m=>m.book==e.book&&m.number==e.number);o.value.splice(g,1),await Toast.show({text:`#${e.number} removed from Bookmarks`})}}onMounted(async()=>{var m;const g=await getSongMetaData(e.book);g!=null&&(i.value=(((m=g[e.number])==null?void 0:m.notes)??[]).reverse())}),onUnmounted(()=>{n.stop()});let l=useLocalStorage("starting_notes_tooltip_complete",!1),a=ref();function h(){n.play(i),y()}function y(){var g,m;(g=a.value)==null||g.classList.add("tooltiphidden"),(m=a.value)==null||m.classList.add("tooltip"),setTimeout(()=>{l.value=!0},1e3)}return(g,m)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("img",{onClick:m[0]||(m[0]=b=>unref(t).back()),class:"ionicon",src:_imports_0$1})]),createBaseVNode("div",_hoisted_4,[createBaseVNode("h1",null,"#"+toDisplayString(e.number),1)]),createBaseVNode("div",_hoisted_5,[i.value.length!=0?(openBlock(),createElementBlock(Fragment,{key:0},[unref(s)?(openBlock(),createElementBlock("img",_hoisted_6)):(openBlock(),createElementBlock("img",{key:0,onClick:h,class:"ionicon",src:_imports_1})),unref(l)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:2,class:"tooltip",ref_key:"tooltip",ref:a,onClick:m[1]||(m[1]=b=>y())},_hoisted_8,512))],64)):createCommentVNode("",!0),c.value?(openBlock(),createElementBlock("img",{key:1,onClick:m[2]||(m[2]=b=>u()),class:"ionicon",src:_imports_3})):(openBlock(),createElementBlock("img",{key:2,onClick:m[3]||(m[3]=b=>u()),class:"ionicon",src:_imports_2}))])])]),createBaseVNode("div",_hoisted_9,[createVNode(SongContainer,{book:e.book,number:e.number},null,8,["book","number"])])],64))}}),SongDisplayView_vue_vue_type_style_index_0_lang="";export{_sfc_main as default};
